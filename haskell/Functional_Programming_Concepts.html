<?xml version="1.0" encoding="utf-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN"
"http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en">
<head>
<title>Functional Programming Concepts</title>
<!-- 2016-04-07 Thu 13:16 -->
<meta  http-equiv="Content-Type" content="text/html;charset=utf-8" />
<meta  name="generator" content="Org-mode" />
<meta  name="author" content="Caio Rodrigues" />
<meta  name="description" content="Functional programming concepts, examples, algorithms and ideas."
 />
<style type="text/css">
 <!--/*--><![CDATA[/*><!--*/
  .title  { text-align: center; }
  .todo   { font-family: monospace; color: red; }
  .done   { color: green; }
  .tag    { background-color: #eee; font-family: monospace;
            padding: 2px; font-size: 80%; font-weight: normal; }
  .timestamp { color: #bebebe; }
  .timestamp-kwd { color: #5f9ea0; }
  .right  { margin-left: auto; margin-right: 0px;  text-align: right; }
  .left   { margin-left: 0px;  margin-right: auto; text-align: left; }
  .center { margin-left: auto; margin-right: auto; text-align: center; }
  .underline { text-decoration: underline; }
  #postamble p, #preamble p { font-size: 90%; margin: .2em; }
  p.verse { margin-left: 3%; }
  pre {
    border: 1px solid #ccc;
    box-shadow: 3px 3px 3px #eee;
    padding: 8pt;
    font-family: monospace;
    overflow: auto;
    margin: 1.2em;
  }
  pre.src {
    position: relative;
    overflow: visible;
    padding-top: 1.2em;
  }
  pre.src:before {
    display: none;
    position: absolute;
    background-color: white;
    top: -10px;
    right: 10px;
    padding: 3px;
    border: 1px solid black;
  }
  pre.src:hover:before { display: inline;}
  pre.src-sh:before    { content: 'sh'; }
  pre.src-bash:before  { content: 'sh'; }
  pre.src-emacs-lisp:before { content: 'Emacs Lisp'; }
  pre.src-R:before     { content: 'R'; }
  pre.src-perl:before  { content: 'Perl'; }
  pre.src-java:before  { content: 'Java'; }
  pre.src-sql:before   { content: 'SQL'; }

  table { border-collapse:collapse; }
  caption.t-above { caption-side: top; }
  caption.t-bottom { caption-side: bottom; }
  td, th { vertical-align:top;  }
  th.right  { text-align: center;  }
  th.left   { text-align: center;   }
  th.center { text-align: center; }
  td.right  { text-align: right;  }
  td.left   { text-align: left;   }
  td.center { text-align: center; }
  dt { font-weight: bold; }
  .footpara:nth-child(2) { display: inline; }
  .footpara { display: block; }
  .footdef  { margin-bottom: 1em; }
  .figure { padding: 1em; }
  .figure p { text-align: center; }
  .inlinetask {
    padding: 10px;
    border: 2px solid gray;
    margin: 10px;
    background: #ffffcc;
  }
  #org-div-home-and-up
   { text-align: right; font-size: 70%; white-space: nowrap; }
  textarea { overflow-x: auto; }
  .linenr { font-size: smaller }
  .code-highlighted { background-color: #ffff00; }
  .org-info-js_info-navigation { border-style: none; }
  #org-info-js_console-label
    { font-size: 10px; font-weight: bold; white-space: nowrap; }
  .org-info-js_search-highlight
    { background-color: #ffff00; color: #000000; font-weight: bold; }
  /*]]>*/-->
</style>
<link href="/Functional-Programming/theme/style.css" rel="stylesheet">

<script type="text/javascript" src="/Functional-Programming/theme/org-info.js">
/**
 *
 * @source: /Functional-Programming/theme/org-info.js
 *
 * @licstart  The following is the entire license notice for the
 *  JavaScript code in /Functional-Programming/theme/org-info.js.
 *
 * Copyright (C) 2012-2013 Free Software Foundation, Inc.
 *
 *
 * The JavaScript code in this tag is free software: you can
 * redistribute it and/or modify it under the terms of the GNU
 * General Public License (GNU GPL) as published by the Free Software
 * Foundation, either version 3 of the License, or (at your option)
 * any later version.  The code is distributed WITHOUT ANY WARRANTY;
 * without even the implied warranty of MERCHANTABILITY or FITNESS
 * FOR A PARTICULAR PURPOSE.  See the GNU GPL for more details.
 *
 * As additional permission under GNU GPL version 3 section 7, you
 * may distribute non-source (e.g., minimized or compacted) forms of
 * that code without the copy of the GNU GPL normally required by
 * section 4, provided you include this license notice and a URL
 * through which recipients can access the Corresponding Source.
 *
 * @licend  The above is the entire license notice
 * for the JavaScript code in /Functional-Programming/theme/org-info.js.
 *
 */
</script>

<script type="text/javascript">

/*
@licstart  The following is the entire license notice for the
JavaScript code in this tag.

Copyright (C) 2012-2013 Free Software Foundation, Inc.

The JavaScript code in this tag is free software: you can
redistribute it and/or modify it under the terms of the GNU
General Public License (GNU GPL) as published by the Free Software
Foundation, either version 3 of the License, or (at your option)
any later version.  The code is distributed WITHOUT ANY WARRANTY;
without even the implied warranty of MERCHANTABILITY or FITNESS
FOR A PARTICULAR PURPOSE.  See the GNU GPL for more details.

As additional permission under GNU GPL version 3 section 7, you
may distribute non-source (e.g., minimized or compacted) forms of
that code without the copy of the GNU GPL normally required by
section 4, provided you include this license notice and a URL
through which recipients can access the Corresponding Source.


@licend  The above is the entire license notice
for the JavaScript code in this tag.
*/

<!--/*--><![CDATA[/*><!--*/
org_html_manager.set("TOC_DEPTH", "4");
org_html_manager.set("LINK_HOME", "");
org_html_manager.set("LINK_UP", "");
org_html_manager.set("LOCAL_TOC", "1");
org_html_manager.set("VIEW_BUTTONS", "0");
org_html_manager.set("MOUSE_HINT", "underline");
org_html_manager.set("FIXED_TOC", "0");
org_html_manager.set("TOC", "1");
org_html_manager.set("VIEW", "showall");
org_html_manager.setup();  // activate after the parameters are set
/*]]>*///-->
</script>
<script type="text/javascript">
/*
@licstart  The following is the entire license notice for the
JavaScript code in this tag.

Copyright (C) 2012-2013 Free Software Foundation, Inc.

The JavaScript code in this tag is free software: you can
redistribute it and/or modify it under the terms of the GNU
General Public License (GNU GPL) as published by the Free Software
Foundation, either version 3 of the License, or (at your option)
any later version.  The code is distributed WITHOUT ANY WARRANTY;
without even the implied warranty of MERCHANTABILITY or FITNESS
FOR A PARTICULAR PURPOSE.  See the GNU GPL for more details.

As additional permission under GNU GPL version 3 section 7, you
may distribute non-source (e.g., minimized or compacted) forms of
that code without the copy of the GNU GPL normally required by
section 4, provided you include this license notice and a URL
through which recipients can access the Corresponding Source.


@licend  The above is the entire license notice
for the JavaScript code in this tag.
*/
<!--/*--><![CDATA[/*><!--*/
 function CodeHighlightOn(elem, id)
 {
   var target = document.getElementById(id);
   if(null != target) {
     elem.cacheClassElem = elem.className;
     elem.cacheClassTarget = target.className;
     target.className = "code-highlighted";
     elem.className   = "code-highlighted";
   }
 }
 function CodeHighlightOff(elem, id)
 {
   var target = document.getElementById(id);
   if(elem.cacheClassElem)
     elem.className = elem.cacheClassElem;
   if(elem.cacheClassTarget)
     target.className = elem.cacheClassTarget;
 }
/*]]>*///-->
</script>
</head>
<body>
<div id="content">
<h1 class="title">Functional Programming Concepts</h1>
<div id="table-of-contents">
<h2>Table of Contents</h2>
<div id="text-table-of-contents">
<ul>
<li><a href="#sec-1">1. Concepts</a>
<ul>
<li><a href="#sec-1-1">1.1. Overview</a></li>
<li><a href="#sec-1-2">1.2. Evaluation Strategy / Parameter Passing</a>
<ul>
<li><a href="#sec-1-2-1">1.2.1. Call-by-value</a></li>
<li><a href="#sec-1-2-2">1.2.2. Call-by-name</a></li>
<li><a href="#sec-1-2-3">1.2.3. Call-by-need</a></li>
<li><a href="#sec-1-2-4">1.2.4. Call-by-reference</a></li>
<li><a href="#sec-1-2-5">1.2.5. References</a></li>
</ul>
</li>
<li><a href="#sec-1-3">1.3. First-Class Function</a></li>
<li><a href="#sec-1-4">1.4. Pure Functions</a></li>
<li><a href="#sec-1-5">1.5. Referential Transparency</a></li>
<li><a href="#sec-1-6">1.6. Closure</a></li>
<li><a href="#sec-1-7">1.7. Currying and Partial Application</a>
<ul>
<li><a href="#sec-1-7-1">1.7.1. Currying</a></li>
<li><a href="#sec-1-7-2">1.7.2. Partial Application</a></li>
</ul>
</li>
<li><a href="#sec-1-8">1.8. Lazy Evaluation</a></li>
<li><a href="#sec-1-9">1.9. Tail Call Optimization and Tail Recursive Functions</a>
<ul>
<li><a href="#sec-1-9-1">1.9.1. Tail Call</a></li>
<li><a href="#sec-1-9-2">1.9.2. Tail Call Optimization</a></li>
<li><a href="#sec-1-9-3">1.9.3. Summary</a></li>
<li><a href="#sec-1-9-4">1.9.4. Examples</a></li>
<li><a href="#sec-1-9-5">1.9.5. See also</a></li>
</ul>
</li>
<li><a href="#sec-1-10">1.10. Fundamental Higher Order Functions</a>
<ul>
<li><a href="#sec-1-10-1">1.10.1. Overview</a></li>
<li><a href="#sec-1-10-2">1.10.2. Map</a></li>
<li><a href="#sec-1-10-3">1.10.3. Filter</a></li>
<li><a href="#sec-1-10-4">1.10.4. Reduce or Fold</a>
<ul>
<li><a href="#sec-1-10-4-1">1.10.4.1. Overview</a></li>
<li><a href="#sec-1-10-4-2">1.10.4.2. Haskell</a></li>
<li><a href="#sec-1-10-4-3">1.10.4.3. Python</a></li>
<li><a href="#sec-1-10-4-4">1.10.4.4. Clojure</a></li>
<li><a href="#sec-1-10-4-5">1.10.4.5. Fsharp</a></li>
</ul>
</li>
<li><a href="#sec-1-10-5">1.10.5. For Each, Impure map</a></li>
<li><a href="#sec-1-10-6">1.10.6. Apply</a></li>
</ul>
</li>
<li><a href="#sec-1-11">1.11. Special Functions</a>
<ul>
<li><a href="#sec-1-11-1">1.11.1. Identity Function</a></li>
<li><a href="#sec-1-11-2">1.11.2. Constant Function</a></li>
<li><a href="#sec-1-11-3">1.11.3. List Constructor (Cons)</a></li>
<li><a href="#sec-1-11-4">1.11.4. Zip</a>
<ul>
<li><a href="#sec-1-11-4-1">1.11.4.1. Overview</a></li>
<li><a href="#sec-1-11-4-2">1.11.4.2. Zip in Haskell</a></li>
<li><a href="#sec-1-11-4-3">1.11.4.3. Zip in Python</a></li>
<li><a href="#sec-1-11-4-4">1.11.4.4. Zip in Scheme</a></li>
<li><a href="#sec-1-11-4-5">1.11.4.5. Zip in Clojure</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#sec-1-12">1.12. Function Composition</a>
<ul>
<li><a href="#sec-1-12-1">1.12.1. Overview</a></li>
<li><a href="#sec-1-12-2">1.12.2. Function Composition in Haskell</a></li>
<li><a href="#sec-1-12-3">1.12.3. Function Composition in Python</a></li>
<li><a href="#sec-1-12-4">1.12.4. Function Composition in F#</a></li>
</ul>
</li>
<li><a href="#sec-1-13">1.13. Functors</a>
<ul>
<li><a href="#sec-1-13-1">1.13.1. Overview</a></li>
<li><a href="#sec-1-13-2">1.13.2. Show all Functor instances</a></li>
<li><a href="#sec-1-13-3">1.13.3. Functor Implementations</a>
<ul>
<li><a href="#sec-1-13-3-1">1.13.3.1. Identity</a></li>
<li><a href="#sec-1-13-3-2">1.13.3.2. List</a></li>
<li><a href="#sec-1-13-3-3">1.13.3.3. Maybe / Option</a></li>
<li><a href="#sec-1-13-3-4">1.13.3.4. Either</a></li>
<li><a href="#sec-1-13-3-5">1.13.3.5. IO</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#sec-1-14">1.14. Monads</a>
<ul>
<li><a href="#sec-1-14-1">1.14.1. Overview</a></li>
<li><a href="#sec-1-14-2">1.14.2. Identity Monad</a></li>
<li><a href="#sec-1-14-3">1.14.3. List Monad</a>
<ul>
<li><a href="#sec-1-14-3-1">1.14.3.1. List Monad in Haskell</a></li>
<li><a href="#sec-1-14-3-2">1.14.3.2. List Monad in OCaml</a></li>
<li><a href="#sec-1-14-3-3">1.14.3.3. List Monad in F#</a></li>
<li><a href="#sec-1-14-3-4">1.14.3.4. List Monad in Python</a></li>
</ul>
</li>
<li><a href="#sec-1-14-4">1.14.4. Maybe / Option Monad</a>
<ul>
<li><a href="#sec-1-14-4-1">1.14.4.1. Overview</a></li>
<li><a href="#sec-1-14-4-2">1.14.4.2. Maybe Monad in Haskell</a></li>
<li><a href="#sec-1-14-4-3">1.14.4.3. Maybe Monad in OCaml</a></li>
<li><a href="#sec-1-14-4-4">1.14.4.4. Maybe Monad in Python</a></li>
</ul>
</li>
<li><a href="#sec-1-14-5">1.14.5. Either Monad</a>
<ul>
<li><a href="#sec-1-14-5-1">1.14.5.1. Overview</a></li>
<li><a href="#sec-1-14-5-2">1.14.5.2. Example</a></li>
</ul>
</li>
<li><a href="#sec-1-14-6">1.14.6. IO Monad</a>
<ul>
<li><a href="#sec-1-14-6-1">1.14.6.1. Overview</a></li>
<li><a href="#sec-1-14-6-2">1.14.6.2. Example</a></li>
<li><a href="#sec-1-14-6-3">1.14.6.3. IO Monad in OCaml</a></li>
</ul>
</li>
<li><a href="#sec-1-14-7">1.14.7. State Monad</a>
<ul>
<li><a href="#sec-1-14-7-1">1.14.7.1. Overview</a></li>
<li><a href="#sec-1-14-7-2">1.14.7.2. State monad in Haskell</a></li>
<li><a href="#sec-1-14-7-3">1.14.7.3. State monad in OCaml</a></li>
</ul>
</li>
<li><a href="#sec-1-14-8">1.14.8. Writer Monad</a></li>
<li><a href="#sec-1-14-9">1.14.9. See also</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#sec-2">2. Functional Languages</a></li>
<li><a href="#sec-3">3. Influential People</a></li>
<li><a href="#sec-4">4. Miscellaneous</a>
<ul>
<li><a href="#sec-4-1">4.1. Selected Wikipedia Articles</a></li>
<li><a href="#sec-4-2">4.2. Selected Rosettacode Pages</a>
<ul>
<li><a href="#sec-4-2-1">4.2.1. Concepts Examples</a></li>
<li><a href="#sec-4-2-2">4.2.2. Languages</a></li>
</ul>
</li>
<li><a href="#sec-4-3">4.3. Libraries and Frameworks</a></li>
</ul>
</li>
<li><a href="#sec-5">5. Reading</a>
<ul>
<li><a href="#sec-5-1">5.1. Monads</a></li>
<li><a href="#sec-5-2">5.2. Applicative Functor</a></li>
<li><a href="#sec-5-3">5.3. Category Theory</a></li>
<li><a href="#sec-5-4">5.4. Books about Haskell</a></li>
</ul>
</li>
</ul>
</div>
</div>
<lu> 
  <li><a href="/Functional-Programming/index.html">Index</a></li>
  <li><a href="https://github.com/caiorss/Functional-Programming">Repository</a></li>
</lu>

<div id="outline-container-sec-1" class="outline-2">
<h2 id="sec-1"><span class="section-number-2">1</span> Concepts</h2>
<div class="outline-text-2" id="text-1">
</div><div id="outline-container-sec-1-1" class="outline-3">
<h3 id="sec-1-1"><span class="section-number-3">1.1</span> Overview</h3>
<div class="outline-text-3" id="text-1-1">
<p>
<b>Functional Programming</b>
</p>

<p>
Functional Programming is all about programming with functions.
</p>

<p>
<b>Functional Programming Features</b>
</p>

<ul class="org-ul">
<li>Pure Functions / Referential Transparency / No side effect
</li>
<li>Function Composition
</li>
<li>Lambda Functions/ Anonymous Functions
</li>
<li>High Order Functions
</li>
<li>Currying/ Partial Function Application
</li>
<li>Closure - Returning functions from functions
</li>
<li>Data Immutability
</li>
<li>Pattern Matching
</li>
<li>Lists are the fundamental data Structure
</li>
</ul>

<p>
Non Essential Features:
</p>

<ul class="org-ul">
<li>Static Typing
</li>
<li>Type Inference
</li>
<li>Algebraic Data Types
</li>
</ul>

<p>
<b>Functional Programming Design Patterns</b>
</p>

<ul class="org-ul">
<li>Curry/ Partial function application  - Creating new functions by holding a parameter constant
</li>
<li>Closure - Return functions from functions
</li>
<li>Pure Functions: separate pure code from impure code.
</li>
<li>Function composition
</li>
<li>Composable functions
</li>
<li>High Order Functions
</li>
<li>MapReduce Algorithms - Split computation in multiple computers cores.
</li>
<li>Lazy Evaluation ( aka Delayed evaluation)
</li>
<li>Pattern Matching
</li>
<li>Monads
</li>
</ul>
</div>
</div>

<div id="outline-container-sec-1-2" class="outline-3">
<h3 id="sec-1-2"><span class="section-number-3">1.2</span> Evaluation Strategy / Parameter Passing</h3>
<div class="outline-text-3" id="text-1-2">
</div><div id="outline-container-sec-1-2-1" class="outline-4">
<h4 id="sec-1-2-1"><span class="section-number-4">1.2.1</span> Call-by-value</h4>
<div class="outline-text-4" id="text-1-2-1">
<p>
Call-by-value (aka pass-by-value, eager evaluation, strict evaluation or
applicative-order evaluation) Evaluation at the point of call, before
the function application application. This evaluation strategy is used
by most programming languages like Python, Scheme, Ocaml and others.
</p>


<pre class="example">
let add2xy x y = x + x + y 

add2xy (3 * 4) ( 2 + 3) 
add2xy 12 5 
=  12 + 12 + 5 
=  29
</pre>

<p>
Example in Python:
</p>

<div class="org-src-container">

<pre class="src src-python">&gt;&gt;&gt; <span class="org-keyword">def</span> <span class="org-function-name">add</span>(x, y):
...   <span class="org-builtin">sum</span> = x + y
...   <span class="org-variable-name">x</span> = <span class="org-builtin">sum</span> 
...   <span class="org-keyword">return</span> (x, <span class="org-builtin">sum</span>)
... 
&gt;&gt;&gt; 


&gt;&gt;&gt; <span class="org-variable-name">x</span> = 10
&gt;&gt;&gt; <span class="org-variable-name">y</span> = 20

<span class="org-comment-delimiter"># </span><span class="org-comment">In call-by-value strategy. The function doesn't change its arguments. </span>
<span class="org-comment-delimiter"># </span>
&gt;&gt;&gt; add(x, y)
(30, 30)

<span class="org-comment-delimiter"># </span><span class="org-comment">They remain unchanged.</span>
<span class="org-comment-delimiter">#</span>
&gt;&gt;&gt; x
10
&gt;&gt;&gt; y
20

<span class="org-comment-delimiter"># </span><span class="org-comment">Arguments are evaluated before the function invocation.</span>
<span class="org-comment-delimiter">#</span>
<span class="org-comment-delimiter"># </span><span class="org-comment">add((10 + 20), (3 * 3))</span>
<span class="org-comment-delimiter"># </span><span class="org-comment">add(30, 9)</span>
<span class="org-comment-delimiter"># </span><span class="org-comment">(39, 39)</span>
<span class="org-comment-delimiter">#</span>
&gt;&gt;&gt; add((10 + 20),(3 * 3))
(39, 39)
&gt;&gt;&gt; 
&gt;&gt;&gt; add((10 + 20),(3 / 0))
Traceback (most recent call last):
  File <span class="org-string">"&lt;stdin&gt;"</span>, line 1, <span class="org-keyword">in</span> &lt;module&gt;
<span class="org-function-name">ZeroDivisionError</span>: division by zero
&gt;&gt;&gt;
</pre>
</div>
</div>
</div>

<div id="outline-container-sec-1-2-2" class="outline-4">
<h4 id="sec-1-2-2"><span class="section-number-4">1.2.2</span> Call-by-name</h4>
<div class="outline-text-4" id="text-1-2-2">
<p>
Call-by-name (aka pass-by-name): It is a <span class="underline">non-memoized lazy</span>
<span class="underline">evaluation</span>. Arguments are passed non evaluated, they are only
evaluated when it is needed. The arguments are substituted in the
function. This evaluation strategy can be inefficient when the
arguments are evaluated many times.
</p>

<p>
Example: 
</p>

<pre class="example">
// Each use of x y and replaced in the function by (3 * 4) and (2 + 3)
// respectively. The arguments are evaluated after substituted 
// in the function

let add2xy x y = x + x + y
let add2xy (3 * 4) (2 + 3) 
= (3 * 4) + (3 * 4) + (2 + 3)
= 12 + 12 + 5
= 29
</pre>



<p>
Call-by-name can be simulated using thunks (functions without arguments).
</p>

<p>
Example in Python: 
</p>

<div class="org-src-container">

<pre class="src src-python">&gt;&gt;&gt; <span class="org-keyword">def</span> <span class="org-function-name">add2xy</span> (x, y):
...     <span class="org-keyword">return</span> x() + x() + y()
... 
&gt;&gt;&gt; add2xy (<span class="org-keyword">lambda</span> : (3 * 4), <span class="org-keyword">lambda</span>: (2 + 3))
29
&gt;&gt;&gt;
</pre>
</div>

<p>
Example in Scheme:
</p>

<div class="org-src-container">

<pre class="src src-scheme">&gt;  <span class="org-rainbow-delimiters-depth-1">(</span><span class="org-keyword">define</span> <span class="org-rainbow-delimiters-depth-2">(</span><span class="org-function-name">add2xy</span> x y<span class="org-rainbow-delimiters-depth-2">)</span> <span class="org-rainbow-delimiters-depth-2">(</span>+ <span class="org-rainbow-delimiters-depth-3">(</span>x<span class="org-rainbow-delimiters-depth-3">)</span> <span class="org-rainbow-delimiters-depth-3">(</span>x<span class="org-rainbow-delimiters-depth-3">)</span> <span class="org-rainbow-delimiters-depth-3">(</span>y<span class="org-rainbow-delimiters-depth-3">)</span><span class="org-rainbow-delimiters-depth-2">)</span><span class="org-rainbow-delimiters-depth-1">)</span> 
&gt; 
<span class="org-comment-delimiter">;; </span><span class="org-comment">The parameter is evaluated every time it is used. </span>
<span class="org-comment-delimiter">;;</span>
&gt; <span class="org-rainbow-delimiters-depth-1">(</span><span class="org-keyword">define</span> <span class="org-rainbow-delimiters-depth-2">(</span><span class="org-function-name">displayln</span> msg<span class="org-rainbow-delimiters-depth-2">)</span> 
      <span class="org-rainbow-delimiters-depth-2">(</span>display msg<span class="org-rainbow-delimiters-depth-2">)</span>
      <span class="org-rainbow-delimiters-depth-2">(</span>newline<span class="org-rainbow-delimiters-depth-2">)</span><span class="org-rainbow-delimiters-depth-1">)</span>


&gt; <span class="org-rainbow-delimiters-depth-1">(</span>add2xy <span class="org-rainbow-delimiters-depth-2">(</span><span class="org-keyword">lambda</span> <span class="org-rainbow-delimiters-depth-3">()</span> <span class="org-rainbow-delimiters-depth-3">(</span>displayln <span class="org-string">"Eval x"</span><span class="org-rainbow-delimiters-depth-3">)</span> <span class="org-rainbow-delimiters-depth-3">(</span>* 3 4<span class="org-rainbow-delimiters-depth-3">)</span><span class="org-rainbow-delimiters-depth-2">)</span>  
          <span class="org-rainbow-delimiters-depth-2">(</span><span class="org-keyword">lambda</span> <span class="org-rainbow-delimiters-depth-3">()</span> <span class="org-rainbow-delimiters-depth-3">(</span>displayln <span class="org-string">"Eval y"</span><span class="org-rainbow-delimiters-depth-3">)</span> <span class="org-rainbow-delimiters-depth-3">(</span>+ 2 3<span class="org-rainbow-delimiters-depth-3">)</span><span class="org-rainbow-delimiters-depth-2">)</span>
  <span class="org-rainbow-delimiters-depth-1">)</span>               
Eval x
Eval x
Eval y
29
&gt;
</pre>
</div>
</div>
</div>

<div id="outline-container-sec-1-2-3" class="outline-4">
<h4 id="sec-1-2-3"><span class="section-number-4">1.2.3</span> Call-by-need</h4>
<div class="outline-text-4" id="text-1-2-3">
<p>
Call-by-need_ (aka lazy evaluation, non-strict evaluation or
normal-order evaluation): <span class="underline">Memoized lazy-evaluation</span>. It is a 
memoized version of call-by-name, after its argument is evaluated,
the values are stored for further computations. When the argument
evaluation has no side-effects, in other words, always yields the
same output when evaluated many times it produces the same result
as call-by-name. This strategy is used in Haskell.
</p>

<p>
Example: In Haskell the parameters are not evaluated at the point they
are passed to the function. They are only evaluated when needed.
</p>

<div class="org-src-container">

<pre class="src src-haskell"><span class="org-haskell-operator">&gt;</span> <span class="org-haskell-keyword">let</span> add_xy x y z <span class="org-haskell-operator">=</span> x <span class="org-haskell-operator">+</span> y
<span class="org-haskell-operator">&gt;</span> 
<span class="org-haskell-operator">&gt;</span> <span class="org-haskell-constructor">:</span>t add_xy
<span class="org-function-name">add_xy</span> <span class="org-haskell-operator">::</span> <span class="org-haskell-constructor">Num</span> a <span class="org-haskell-operator">=&gt;</span> a <span class="org-haskell-operator">-&gt;</span> a <span class="org-haskell-operator">-&gt;</span> t <span class="org-haskell-operator">-&gt;</span> a
<span class="org-haskell-operator">&gt;</span>


<span class="org-haskell-operator">&gt;&gt;&gt;</span> div 10 2
5
<span class="org-haskell-operator">&gt;&gt;&gt;</span> div 10 0
 <span class="org-haskell-operator">***</span> <span class="org-haskell-constructor">Exception:</span> divide by zero
<span class="org-haskell-operator">&gt;&gt;&gt;</span> 


<span class="org-comment-delimiter">-- </span><span class="org-comment">The parameter z: (3 / 0) is not evaluated </span>
<span class="org-comment-delimiter">-- </span><span class="org-comment">because it is not needed.</span>
<span class="org-comment-delimiter">-- </span>
<span class="org-haskell-operator">&gt;</span> <span class="org-haskell-definition">add_xy</span> 3 4 (3 <span class="org-haskell-operator">/</span> 0)
7
<span class="org-haskell-operator">&gt;</span> 

<span class="org-haskell-operator">&gt;&gt;&gt;</span> add_xy 3 4 (div 10 0)
7
<span class="org-haskell-operator">&gt;&gt;&gt;</span> 

<span class="org-comment-delimiter">-- </span><span class="org-comment">sum [1 ..] is not evaluated. </span>
<span class="org-comment-delimiter">-- </span><span class="org-comment">If it were evaluated the computer would hang </span>
<span class="org-comment-delimiter">-- </span><span class="org-comment">or trow an arithmetic overflow exception</span>
<span class="org-comment-delimiter">--</span>
<span class="org-haskell-operator">&gt;&gt;&gt;</span> add_xy 3 4 (sum [1 <span class="org-haskell-operator">..</span>])
7
<span class="org-haskell-operator">&gt;&gt;&gt;</span> 

<span class="org-haskell-operator">&gt;&gt;&gt;</span> add_xy 3 4 (div (sum [1 <span class="org-haskell-operator">..</span>]) 0)
7
<span class="org-haskell-operator">&gt;&gt;&gt;</span> 

<span class="org-comment-delimiter">-- </span><span class="org-comment">The infinite list is not fully evaluated </span>
<span class="org-comment-delimiter">--</span>
<span class="org-haskell-operator">&gt;</span> <span class="org-haskell-keyword">let</span> ones <span class="org-haskell-operator">=</span> 1<span class="org-haskell-constructor">:</span>ones

<span class="org-haskell-operator">&gt;</span> <span class="org-haskell-definition">take</span> 10 ones
[1<span class="org-haskell-operator">,</span>1<span class="org-haskell-operator">,</span>1<span class="org-haskell-operator">,</span>1<span class="org-haskell-operator">,</span>1<span class="org-haskell-operator">,</span>1<span class="org-haskell-operator">,</span>1<span class="org-haskell-operator">,</span>1<span class="org-haskell-operator">,</span>1<span class="org-haskell-operator">,</span>1]
<span class="org-haskell-operator">&gt;</span> 
<span class="org-haskell-operator">&gt;</span> <span class="org-haskell-definition">take</span> 20 ones
[1<span class="org-haskell-operator">,</span>1<span class="org-haskell-operator">,</span>1<span class="org-haskell-operator">,</span>1<span class="org-haskell-operator">,</span>1<span class="org-haskell-operator">,</span>1<span class="org-haskell-operator">,</span>1<span class="org-haskell-operator">,</span>1<span class="org-haskell-operator">,</span>1<span class="org-haskell-operator">,</span>1<span class="org-haskell-operator">,</span>1<span class="org-haskell-operator">,</span>1<span class="org-haskell-operator">,</span>1<span class="org-haskell-operator">,</span>1<span class="org-haskell-operator">,</span>1<span class="org-haskell-operator">,</span>1<span class="org-haskell-operator">,</span>1<span class="org-haskell-operator">,</span>1<span class="org-haskell-operator">,</span>1<span class="org-haskell-operator">,</span>1]
<span class="org-haskell-operator">&gt;</span>
</pre>
</div>
</div>
</div>

<div id="outline-container-sec-1-2-4" class="outline-4">
<h4 id="sec-1-2-4"><span class="section-number-4">1.2.4</span> Call-by-reference</h4>
<div class="outline-text-4" id="text-1-2-4">
<ul class="org-ul">
<li><span class="underline">Call-by-reference</span> (aka pass-by-reference): The function changes
the value of the argument. Supported in: C++, Pascal, Python
Objects.
</li>
</ul>

<p>
Example in C:
</p>

<div class="org-src-container">

<pre class="src src-C"><span class="org-comment-delimiter">// </span><span class="org-comment">The function add10 changes it argument.</span>
<span class="org-comment-delimiter">//</span>
<span class="org-preprocessor">#include</span> <span class="org-string">&lt;stdio.h&gt;</span>

<span class="org-type">void</span> <span class="org-function-name">add10</span>(<span class="org-type">int</span> * <span class="org-variable-name">x</span>){
  *x = *x + 10 ;
}

<span class="org-type">void</span> <span class="org-function-name">main</span> (){
  
  <span class="org-type">int</span> <span class="org-variable-name">x</span> = 5;
  add10(&amp;x);
  printf(<span class="org-string">"x = %d\n"</span>, x);  
}
</pre>
</div>

<p>
Test:
</p>

<pre class="example">
$ gcc /tmp/test.c
$ ./a.out 
x = 15

$ tcc -run /tmp/test.c
x = 15
</pre>
</div>
</div>

<div id="outline-container-sec-1-2-5" class="outline-4">
<h4 id="sec-1-2-5"><span class="section-number-4">1.2.5</span> References</h4>
<div class="outline-text-4" id="text-1-2-5">
<ul class="org-ul">
<li><a href="http://www.lix.polytechnique.fr/~catuscia/teaching/cg428/02Spring/lecture_notes/L07.1.html">CSE 428: Lecture Notes 8</a>
</li>
<li><a href="http://users-cs.au.dk/danvy/dProgSprog12/Lecture-notes/parameter-passing-strategies.html">Parameter-passing strategies â€” dProgSprog 2012 Lecture Notes</a>
</li>
<li><a href="http://academic.udayton.edu/saverioperugini/courses/cps343/lecture_notes/lazyevaluation.html">CPS 343/543 Lecture notes: Lazy evaluation and thunks</a>
</li>
<li><a href="https://en.wikipedia.org/wiki/Evaluation_strategy#Strict_evaluation">Evaluation strategy - Wikipedia, the free encyclopedia</a>
</li>
<li><a href="http://www.lix.polytechnique.fr/~catuscia/teaching/cg428/02Spring/lecture_notes/L07.1.html">CSE 428: Lecture Notes 8 - Procedures and Functions</a> 
</li>
</ul>
</div>
</div>
</div>

<div id="outline-container-sec-1-3" class="outline-3">
<h3 id="sec-1-3"><span class="section-number-3">1.3</span> First-Class Function</h3>
<div class="outline-text-3" id="text-1-3">
<p>
Functions can be passed as arguments to another functions, returned
from functions, stored in variables and data structures and built at
run time. The majority of languages supports first-class functions
like Scheme, Javascript, Python, Haskell, ML, OCaml and many others
some exceptions are C, Java, Matlab (Octave open source
implementation), Bash, and Forth.
</p>

<p>
Examples:
</p>

<ul class="org-ul">
<li>Python:
</li>
</ul>

<p>
The function f is passed as argument to the derivate function that
returns a new function named _, that computes the derivate of f at x.
</p>

<div class="org-src-container">

<pre class="src src-python"><span class="org-keyword">def</span> <span class="org-function-name">derivate</span> (f, dx=1e-5):
    <span class="org-keyword">def</span> <span class="org-function-name">_</span>(x):
        <span class="org-keyword">return</span> (f(x+dx) - f(x))/dx
    <span class="org-keyword">return</span> _
    
 <span class="org-comment-delimiter">#  </span><span class="org-comment">Algebraic derivate:</span>
 <span class="org-comment-delimiter">#</span>
 <span class="org-comment-delimiter">#  </span><span class="org-comment">df(x) = 2*x - 3</span>
 <span class="org-comment-delimiter">#    </span>
&gt;&gt;&gt; <span class="org-keyword">def</span> <span class="org-function-name">f</span>(x): <span class="org-keyword">return</span> x**2 - 3*x + 4
... 

 <span class="org-comment-delimiter"># </span><span class="org-comment">Numerical derivate of f</span>
&gt;&gt;&gt; <span class="org-variable-name">df</span> = derivate(f)
&gt;&gt;&gt; 

  <span class="org-comment-delimiter"># </span><span class="org-comment">Algebraic derivate of f</span>
&gt;&gt;&gt; <span class="org-keyword">def</span> <span class="org-function-name">dfa</span> (x): <span class="org-keyword">return</span> 2*x - 3
... 
&gt;&gt;&gt; 

 ;; Functions can be stored <span class="org-keyword">in</span> variables
&gt;&gt;&gt; <span class="org-variable-name">func</span> = f
&gt;&gt;&gt; func(5)
14
&gt;&gt;&gt; 

&gt;&gt;&gt; <span class="org-variable-name">df</span> = derivate(f)
&gt;&gt;&gt; df(3)
3.000009999887254
&gt;&gt;&gt; df(4)
5.000009999633903
&gt;&gt;&gt; 

&gt;&gt;&gt; dfa(3)
3
&gt;&gt;&gt; dfa(4)
5
&gt;&gt;&gt; 


&gt;&gt;&gt; f(3)
4
&gt;&gt;&gt; f(10)
74
&gt;&gt;&gt;
</pre>
</div>

<p>
See also: 
</p>

<p>
Many examples of first class functions in several languages. 
</p>

<ul class="org-ul">
<li><a href="http://rosettacode.org/wiki/First-class_functions#C">First-class functions - Rosetta Code</a>
</li>

<li><a href="http://slidegur.com/doc/1814324/first-class-functions-in-scientific-programming">First-class Functions in Scientific Programming</a>
</li>

<li><a href="http://adv-r.had.co.nz/Functional-programming.html">Functional programming in R</a>
</li>
</ul>
</div>
</div>

<div id="outline-container-sec-1-4" class="outline-3">
<h3 id="sec-1-4"><span class="section-number-3">1.4</span> Pure Functions</h3>
<div class="outline-text-3" id="text-1-4">
<p>
Pure functions:
</p>

<ul class="org-ul">
<li>Are functions without side effects, like mathematical functions. 
</li>
<li>For the same input the functions always returns the same output.
</li>
<li>The result of any function call is fully determined by its arguments. 
</li>
<li>Pure functions don't rely on global variable and don't have internal states.
</li>
<li>They don't do IO, i.e .:. don't print, don't write a file &#x2026;
</li>
<li>Pure functions are stateless
</li>
<li>Pure functions are deterministic
</li>
</ul>

<p>
Why Pure Functions:
</p>

<ul class="org-ul">
<li>Composability, one function can be connected to another.
</li>
<li>Can run in parallel, multi-threading, multi-core, GPU and distributed systems.
</li>
<li>Better debugging and testing.
</li>
<li>Predictability
</li>
</ul>

<p>
<b>Example of pure functions</b>
</p>

<div class="org-src-container">

<pre class="src src-python"><span class="org-keyword">def</span> <span class="org-function-name">min</span>(x, y):
    <span class="org-keyword">if</span> x &lt; y:
        <span class="org-keyword">return</span> x
    <span class="org-keyword">else</span>:
        <span class="org-keyword">return</span> y
</pre>
</div>


<p>
<b>Example of impure function</b>
</p>

<ul class="org-ul">
<li>Impure functions doesn't have always the same output for the same
</li>
<li>Impure functions does IO or has Hidden State or Global Variables
</li>
</ul>

<div class="org-src-container">

<pre class="src src-python"><span class="org-variable-name">exponent</span> = 2

<span class="org-keyword">def</span> <span class="org-function-name">powers</span>(L):
    <span class="org-keyword">for</span> i <span class="org-keyword">in</span> <span class="org-builtin">range</span>(<span class="org-builtin">len</span>(L)):
        <span class="org-variable-name">L</span>[i] = L[i]**exponent
    <span class="org-keyword">return</span> L
</pre>
</div>
<p>
The function min is pure. It always produces the same result given 
the same inputs and it does not affect any external variable.
</p>

<p>
The function powers is impure because it not always gives the same output
for the same input, it depends on the global variable exponent:
</p>

<div class="org-src-container">

<pre class="src src-python">&gt;&gt;&gt; <span class="org-variable-name">exponent</span> = 2
&gt;&gt;&gt; 
&gt;&gt;&gt; <span class="org-keyword">def</span> <span class="org-function-name">powers</span>(L):
...     <span class="org-keyword">for</span> i <span class="org-keyword">in</span> <span class="org-builtin">range</span>(<span class="org-builtin">len</span>(L)):
...         <span class="org-variable-name">L</span>[i] = L[i]**exponent
...     <span class="org-keyword">return</span> L
... 
&gt;&gt;&gt; powers([1, 2, 3])
[1, 4, 9]
&gt;&gt;&gt; <span class="org-variable-name">exponent</span> = 4 
&gt;&gt;&gt; powers([1, 2, 3])  <span class="org-comment-delimiter"># </span><span class="org-comment">(It is impure since it doesn't give the same result )</span>
[1, 16, 81]
&gt;&gt;&gt;
</pre>
</div>

<p>
Another example, purifying an impure Language:
</p>

<div class="org-src-container">

<pre class="src src-python">&gt;&gt;&gt; <span class="org-variable-name">lst</span> = [1, 2, 3, 4]  <span class="org-comment-delimiter"># </span><span class="org-comment">An pure function doesn't modify its arguments.</span>
&gt;&gt;&gt;                     <span class="org-comment-delimiter"># </span><span class="org-comment">therefore lst reverse is impure</span>
&gt;&gt;&gt; <span class="org-variable-name">x</span> = lst.reverse()
&gt;&gt;&gt; x
&gt;&gt;&gt; lst
[4, 3, 2, 1]

&gt;&gt;&gt; lst.reverse()
&gt;&gt;&gt; lst
[1, 2, 3, 4]
</pre>
</div>

<p>
Reverse list function purified:
</p>

<div class="org-src-container">

<pre class="src src-python">&gt;&gt;&gt; <span class="org-variable-name">lst</span> = [1, 2, 3, 4]
&gt;&gt;&gt;
&gt;&gt;&gt; <span class="org-keyword">def</span> <span class="org-function-name">reverse</span>(lst):
...     <span class="org-variable-name">ls</span> = lst.copy()
...     ls.reverse()
...     <span class="org-keyword">return</span> ls
... 
&gt;&gt;&gt; 
&gt;&gt;&gt; reverse(lst)
[4, 3, 2, 1]
&gt;&gt;&gt; lst
[1, 2, 3, 4]
&gt;&gt;&gt; reverse(lst)
[4, 3, 2, 1]
&gt;&gt;&gt; lst
[1, 2, 3, 4]
</pre>
</div>
</div>
</div>

<div id="outline-container-sec-1-5" class="outline-3">
<h3 id="sec-1-5"><span class="section-number-3">1.5</span> Referential Transparency</h3>
<div class="outline-text-3" id="text-1-5">
<p>
Referential Transparency means that any sub-expression can be replaced
by its value within an expression at any time without changing the
evaluation of the whole expression. This property is a characteristic 
of mathematical expressions that allows program transformation,
program manipulation and equational reasoning. It can be basically be
stated as "replace equals by equals".  
</p>

<p>
If there is referential transparency the expression below is valid:
</p>

<p>
<code>f(x) + f(x) = 2 * f(x)</code>
</p>

<p>
The function f is <span class="underline">referentially transparent</span> only if it is a pure
function. The application of the function can be replaced by its value
without change the meaning of the expression and it yields always the
same result for the same input.
</p>

<p>
Referential transparency is only possible in the absence of
side-effects. Haskell is one the few language which is referencially
transparent owing to the fact that it enforces purity. 
</p>

<p>
Benefits:
</p>

<ul class="org-ul">
<li>Program transformation
</li>

<li>Equational reasoning
</li>

<li>Every expression can replaced by its value. 
</li>

<li>Reasoning about the result of a function can be done by replacing
its definition at the place of the application regardless of the
context.
</li>

<li>Evaluation order doesn't matter. 
</li>

<li>More opportunities for compiler optimization
</li>

<li>Computations can be safely distributed over multiple
processors/threads.
</li>

<li>Previous evaluated expressions can be memoized. 
</li>

<li>Programs with referential transparency can be easier to reason
about its behavior due to the reader does not have to think about
the side-effects like global states, internal states and IO.
</li>

<li>Help change the code without breaking it, easier refactoring. 
</li>
</ul>


<p>
Example: referential transparency in Python. Note: Python as ML
variants and Scheme doesn't enforce it.  
</p>

<div class="org-src-container">

<pre class="src src-python">&gt;&gt;&gt; <span class="org-keyword">def</span> <span class="org-function-name">square</span> (x):
...   <span class="org-keyword">return</span> x * x
... 
&gt;&gt;&gt; 
&gt;&gt;&gt; square (3) + square (3) 
18
&gt;&gt;&gt; 2 * square (3)
18
&gt;&gt;&gt; square (3) + square (3) == 2 * square (3)
<span class="org-constant">True</span>
&gt;&gt;&gt; 
&gt;&gt;&gt; <span class="org-variable-name">x</span>  = square (3)
&gt;&gt;&gt; x
9
&gt;&gt;&gt; x + x  == 2 * square (3)
<span class="org-constant">True</span>
</pre>
</div>

<p>
Example:violation of referential transparency or referential
opacity due to global state side-effect in Python.
</p>


<div class="org-src-container">

<pre class="src src-python"><span class="org-variable-name">state</span> = 1

<span class="org-keyword">def</span> <span class="org-function-name">f</span>(x):
  <span class="org-keyword">global</span> state 
  <span class="org-variable-name">state</span> = state + 1 
  <span class="org-keyword">return</span> x + state 

&gt;&gt;&gt; f(2) 
4
&gt;&gt;&gt; f(2) 
5
&gt;&gt;&gt; 2 * f(2)
12
&gt;&gt;&gt;

 <span class="org-comment-delimiter"># </span><span class="org-comment">Resetting the world:</span>
 <span class="org-comment-delimiter"># </span>
&gt;&gt;&gt; <span class="org-variable-name">state</span> = 1 
&gt;&gt;&gt; 
&gt;&gt;&gt; f(2) + f(2) == 2 * f(2)
<span class="org-constant">False</span>
&gt;&gt;&gt; 

&gt;&gt;&gt; <span class="org-keyword">import</span> random
&gt;&gt;&gt; 
&gt;&gt;&gt; random.random() + random.random () ==  2 * random.random()
<span class="org-constant">False</span>
&gt;&gt;&gt; 

&gt;&gt;&gt; <span class="org-variable-name">state</span> = 0 

&gt;&gt;&gt; <span class="org-keyword">def</span> <span class="org-function-name">counter</span> ():
...    <span class="org-keyword">global</span> state
...    <span class="org-variable-name">state</span> = state + 1
...    <span class="org-keyword">return</span> state
... 
&gt;&gt;&gt; counter () + counter () == 2 * counter ()
<span class="org-constant">False</span>
&gt;&gt;&gt; counter ()
4
&gt;&gt;&gt; counter ()
5
&gt;&gt;&gt;
</pre>
</div>


<p>
References:
</p>

<ul class="org-ul">
<li><a href="https://books.google.ca/books?id=NJ_xBwAAQBAJ&pg=PA232&lpg=PA232&dq=referential+transparency+equals+by+equals&source=bl&ots=1EDj-63h7P&sig=8H9rgzK1FvTlGsG6NDdwrB0LzaE&hl=en&sa=X&ved=0ahUKEwipkL3lndjLAhXE-g4KHXDeAaIQ6AEIQDAG#v=onepage&q=referential%20transparency%20equals%20by%20equals&f=false">Arrays, Functional Languages, and Parallel Systems - Google Books</a>
</li>

<li>Hudak P. <b>Evolution, and Application of Functional Programming
Languages.</b> Available at
<a href="http://www.utdallas.edu/~kXh060100/cs6301fa15/p359-hudak.pdf">http://www.utdallas.edu/~kXh060100/cs6301fa15/p359-hudak.pdf</a>
</li>

<li><b>Input/Output in Functional. Languages. Using Algebraic Union
Types.</b>. Available at
<a href="http://essay-test.utsp.utwente.nl/57287/1/scriptie_Rorije.pdf">http://essay-test.utsp.utwente.nl/57287/1/scriptie_Rorije.pdf</a>
</li>

<li><a href="http://www2.sys-con.com/itsg/virtualcd/java/archives/0404/callahan/index.html">Clarify Your Code in the Functional Style</a>
</li>

<li><a href="http://mccarthy.cs.iit.edu/cs440/videos/state-4up.pdf">http://mccarthy.cs.iit.edu/cs440/videos/state-4up.pdf</a>
</li>

<li><a href="http://www.macs.hw.ac.uk/~hwloidl/Courses/F21DP/gph_milan15_handout.pdf">http://www.macs.hw.ac.uk/~hwloidl/Courses/F21DP/gph_milan15_handout.pdf</a>
</li>

<li><a href="https://wiki.haskell.org/Referential_transparency">Referential transparency - HaskellWiki</a>
</li>

<li><a href="http://faculty.ycp.edu/~dhovemey/fall2012/cs340/lecture/lecture18.html">CS 340 - Lecture 18: Functional Programming in Scala</a>
</li>

<li><a href="http://www.cs.unc.edu/~block/comp524/Lectures/files2/Lecture14.pdf">Lecture 14: ML, Deep/Shallow Access, Referential Transparency</a>
</li>

<li><a href="http://programmers.stackexchange.com/questions/254304/what-is-referential-transparency">functional programming - What is referential transparency? -
Programmers Stack Exchange</a>
</li>

<li><a href="http://www.slideshare.net/AdrianGzz2112/functional-programming-ruby-mty">Functional programming ruby mty</a>
</li>
</ul>
</div>
</div>

<div id="outline-container-sec-1-6" class="outline-3">
<h3 id="sec-1-6"><span class="section-number-3">1.6</span> Closure</h3>
<div class="outline-text-3" id="text-1-6">
<p>
Closure is a function that remembers the environment at which it was created.
</p>

<div class="org-src-container">

<pre class="src src-python">&gt;&gt;&gt; <span class="org-variable-name">x</span> = 10

 <span class="org-comment-delimiter"># </span><span class="org-comment">The function adder remembers the environment at which it was created</span>
 <span class="org-comment-delimiter"># </span><span class="org-comment">it remembers the value of x</span>
 <span class="org-comment-delimiter">#</span>
<span class="org-keyword">def</span> <span class="org-function-name">make_adder</span>(x):
    <span class="org-keyword">def</span> <span class="org-function-name">adder</span>(y):
        <span class="org-keyword">return</span> x + y
    <span class="org-keyword">return</span> adder

&gt;&gt;&gt; <span class="org-variable-name">add5</span> = make_adder(5)
&gt;&gt;&gt; <span class="org-variable-name">add10</span> = make_adder(10)
&gt;&gt;&gt; 
&gt;&gt;&gt; add5(4)
9
&gt;&gt;&gt; <span class="org-builtin">list</span>(<span class="org-builtin">map</span>(add5, [1, 2, 3, 4, 5]))
[6, 7, 8, 9, 10]

&gt;&gt;&gt; x
10
&gt;&gt;&gt; 

&gt;&gt;&gt; <span class="org-builtin">list</span>(<span class="org-builtin">map</span>(add10, [1, 2, 3, 4, 5]))
[11, 12, 13, 14, 15]

 <span class="org-comment-delimiter">#</span>
 
<span class="org-keyword">def</span> <span class="org-function-name">make_printer</span>(msg):
    <span class="org-keyword">def</span> <span class="org-function-name">printer</span>():
        <span class="org-keyword">print</span>(msg)
    <span class="org-keyword">return</span> printer

&gt;&gt;&gt; <span class="org-variable-name">p1</span> = make_printer (<span class="org-string">"Hello world"</span>)
&gt;&gt;&gt; <span class="org-variable-name">p2</span> = make_printer (<span class="org-string">"FP programming Rocks!!"</span>)
&gt;&gt;&gt; 
&gt;&gt;&gt; p1()
Hello world
&gt;&gt;&gt; p2()
FP p

 <span class="org-comment-delimiter"># </span><span class="org-comment">Mutable state with closure</span>
 
<span class="org-variable-name">idx</span> = 100 
 
<span class="org-keyword">def</span> <span class="org-function-name">make_counter</span>():
    <span class="org-variable-name">idx</span> = -1    
    <span class="org-keyword">def</span> <span class="org-function-name">_</span>():
        <span class="org-keyword">nonlocal</span> idx
        <span class="org-variable-name">idx</span> = idx + 1
        <span class="org-keyword">return</span> idx    
    <span class="org-keyword">return</span> _

&gt;&gt;&gt; <span class="org-variable-name">idx</span> = 100
&gt;&gt;&gt; <span class="org-variable-name">counter1</span> = make_counter()
&gt;&gt;&gt; counter1()
0
&gt;&gt;&gt; counter1()
1
&gt;&gt;&gt; counter1()
2
&gt;&gt;&gt; counter1()
3

&gt;&gt;&gt; idx
100
&gt;&gt;&gt; <span class="org-variable-name">counter2</span> = make_counter ()
&gt;&gt;&gt; counter2()
0
&gt;&gt;&gt; counter2()
1
&gt;&gt;&gt; counter2()
2

&gt;&gt;&gt; counter1()
5
&gt;&gt;&gt; 

&gt;&gt;&gt; <span class="org-keyword">del</span> make_counter
&gt;&gt;&gt; make_counter
Traceback (most recent call last):
  File <span class="org-string">"&lt;stdin&gt;"</span>, line 1, <span class="org-keyword">in</span> &lt;module&gt;
<span class="org-function-name">NameError</span>: name <span class="org-string">'make_counter'</span> <span class="org-keyword">is</span> <span class="org-keyword">not</span> defined
&gt;&gt;&gt; 
&gt;&gt;&gt; counter1()
6
&gt;&gt;&gt; counter1()
7
</pre>
</div>

<p>
Example of closure in Clojure: 
</p>

<div class="org-src-container">

<pre class="src src-clojure"><span class="org-rainbow-delimiters-depth-1">(</span><span class="org-keyword">defn</span> <span class="org-function-name">make-adder</span> <span class="org-rainbow-delimiters-depth-2">[</span>x<span class="org-rainbow-delimiters-depth-2">]</span>
   <span class="org-rainbow-delimiters-depth-2">(</span><span class="org-keyword">fn</span> <span class="org-rainbow-delimiters-depth-3">[</span>y<span class="org-rainbow-delimiters-depth-3">]</span> <span class="org-rainbow-delimiters-depth-3">(</span>+ x y<span class="org-rainbow-delimiters-depth-3">)</span><span class="org-rainbow-delimiters-depth-2">)</span><span class="org-rainbow-delimiters-depth-1">)</span>

user=&gt; <span class="org-rainbow-delimiters-depth-1">(</span><span class="org-keyword">def</span> <span class="org-variable-name">add5</span> <span class="org-rainbow-delimiters-depth-2">(</span>make-adder 5<span class="org-rainbow-delimiters-depth-2">)</span><span class="org-rainbow-delimiters-depth-1">)</span>
#'<span class="org-type">user</span><span class="org-default">/</span>add5
user=&gt; 
user=&gt; <span class="org-rainbow-delimiters-depth-1">(</span><span class="org-keyword">def</span> <span class="org-variable-name">add10</span> <span class="org-rainbow-delimiters-depth-2">(</span>make-adder 10<span class="org-rainbow-delimiters-depth-2">)</span><span class="org-rainbow-delimiters-depth-1">)</span>
#'<span class="org-type">user</span><span class="org-default">/</span>add10
user=&gt; 
user=&gt; <span class="org-rainbow-delimiters-depth-1">(</span>add5 10<span class="org-rainbow-delimiters-depth-1">)</span>
15
user=&gt; <span class="org-rainbow-delimiters-depth-1">(</span>add10 20<span class="org-rainbow-delimiters-depth-1">)</span>
30
user=&gt; <span class="org-rainbow-delimiters-depth-1">(</span>map <span class="org-rainbow-delimiters-depth-2">(</span>juxt add5 add10<span class="org-rainbow-delimiters-depth-2">)</span>  <span class="org-rainbow-delimiters-depth-2">[</span>1 2 3 4 5 6<span class="org-rainbow-delimiters-depth-2">]</span><span class="org-rainbow-delimiters-depth-1">)</span>
<span class="org-rainbow-delimiters-depth-1">(</span><span class="org-rainbow-delimiters-depth-2">[</span>6 11<span class="org-rainbow-delimiters-depth-2">]</span> <span class="org-rainbow-delimiters-depth-2">[</span>7 12<span class="org-rainbow-delimiters-depth-2">]</span> <span class="org-rainbow-delimiters-depth-2">[</span>8 13<span class="org-rainbow-delimiters-depth-2">]</span> <span class="org-rainbow-delimiters-depth-2">[</span>9 14<span class="org-rainbow-delimiters-depth-2">]</span> <span class="org-rainbow-delimiters-depth-2">[</span>10 15<span class="org-rainbow-delimiters-depth-2">]</span> <span class="org-rainbow-delimiters-depth-2">[</span>11 16<span class="org-rainbow-delimiters-depth-2">]</span><span class="org-rainbow-delimiters-depth-1">)</span>
user=&gt; 

<span class="org-rainbow-delimiters-depth-1">(</span><span class="org-keyword">defn</span> <span class="org-function-name">make-printer</span> <span class="org-rainbow-delimiters-depth-2">[</span>message<span class="org-rainbow-delimiters-depth-2">]</span>
  
  <span class="org-rainbow-delimiters-depth-2">(</span><span class="org-keyword">fn</span> <span class="org-rainbow-delimiters-depth-3">[]</span> <span class="org-rainbow-delimiters-depth-3">(</span>println message<span class="org-rainbow-delimiters-depth-3">)</span><span class="org-rainbow-delimiters-depth-2">)</span><span class="org-rainbow-delimiters-depth-1">)</span>

user=&gt; <span class="org-rainbow-delimiters-depth-1">(</span><span class="org-keyword">def</span> <span class="org-variable-name">printer-1</span> <span class="org-rainbow-delimiters-depth-2">(</span>make-printer <span class="org-string">"Hello world"</span><span class="org-rainbow-delimiters-depth-2">)</span><span class="org-rainbow-delimiters-depth-1">)</span>
#'<span class="org-type">user</span><span class="org-default">/</span>printer-1
user=&gt; 
user=&gt; <span class="org-rainbow-delimiters-depth-1">(</span><span class="org-keyword">def</span> <span class="org-variable-name">printer-2</span> <span class="org-rainbow-delimiters-depth-2">(</span>make-printer <span class="org-string">"Hola Mundo"</span><span class="org-rainbow-delimiters-depth-2">)</span><span class="org-rainbow-delimiters-depth-1">)</span>
#'<span class="org-type">user</span><span class="org-default">/</span>printer-2
user=&gt; 
user=&gt; <span class="org-rainbow-delimiters-depth-1">(</span>printer-1<span class="org-rainbow-delimiters-depth-1">)</span>
<span class="org-type">Hello</span> world
<span class="org-constant">nil</span>
user=&gt; <span class="org-rainbow-delimiters-depth-1">(</span>printer-2<span class="org-rainbow-delimiters-depth-1">)</span>
<span class="org-type">Hola</span> <span class="org-type">Mundo</span>
<span class="org-constant">nil</span>
user=&gt;
</pre>
</div>

<p>
Example of closure in F# (F sharp):
</p>

<div class="org-src-container">

<pre class="src src-fsharp"><span class="org-keyword">let</span> <span class="org-function-name">make_adder</span> <span class="org-variable-name">x</span> =
    <span class="org-keyword">fun</span> <span class="org-variable-name">y</span> -&gt; x + y 

<span class="org-keyword">val</span> <span class="org-variable-name">make_adder</span> : <span class="org-type">x:int </span>-&gt; y:<span class="org-type">int </span>-&gt; int

&gt; <span class="org-keyword">let</span> add5 = make_adder 5 ;;

<span class="org-keyword">val</span> add5 : (int -&gt; int)

&gt; <span class="org-keyword">let</span> add10 = make_adder 10 ;;

<span class="org-keyword">val</span> add10 : (int -&gt; int)

&gt; add5 20 ;;
<span class="org-keyword">val</span> <span class="org-variable-name">it</span> : <span class="org-type">int </span>= 25
&gt; 
- add10 30 ;;
<span class="org-keyword">val</span> <span class="org-variable-name">it</span> : <span class="org-type">int </span>= 40
&gt; 
- List.map add5 [1 ; 2; 3; 4; 5; 6] ;;
<span class="org-keyword">val</span> <span class="org-variable-name">it</span> : <span class="org-type">int list </span>= [6; 7; 8; 9; 10; 11]
&gt; 

<span class="org-comment-delimiter">//  </span><span class="org-comment">As F# have currying like OCaml and Haskell </span>
<span class="org-comment-delimiter">//  </span><span class="org-comment">it could be also be done as </span>
<span class="org-comment-delimiter">//</span>

- <span class="org-keyword">let</span> <span class="org-function-name">make_adder</span> x y = x + y ;;

<span class="org-keyword">val</span> <span class="org-variable-name">make_adder</span> : <span class="org-type">x:int </span>-&gt; y:<span class="org-type">int </span>-&gt; int

&gt; <span class="org-keyword">let</span> add10 = make_adder 10 ;;

<span class="org-keyword">val</span> add10 : (int -&gt; int)

&gt; add10 20 ;;
<span class="org-keyword">val</span> <span class="org-variable-name">it</span> : <span class="org-type">int </span>= 30
&gt;
</pre>
</div>
</div>
</div>

<div id="outline-container-sec-1-7" class="outline-3">
<h3 id="sec-1-7"><span class="section-number-3">1.7</span> Currying and Partial Application</h3>
<div class="outline-text-3" id="text-1-7">
</div><div id="outline-container-sec-1-7-1" class="outline-4">
<h4 id="sec-1-7-1"><span class="section-number-4">1.7.1</span> Currying</h4>
<div class="outline-text-4" id="text-1-7-1">
<p>
Currying is the decomposition of a function of multiples arguments in
a chained sequence of functions of a single argument. The name
currying comes from the mathematician <a href="https://en.wikipedia.org/wiki/Haskell_Curry">Haskell Curry</a> who developed the
concept of curried functions.
</p>

<p>
In Haskell, Standard ML, OCaml and F# all functions are curryfied by
default:
</p>

<pre class="example">
    f (x, y) = 10*x - 3*y   
    
    f (4, 3)  = 10* 4 - 3*3 = 40 - 9 = 31
    f (4, 3)  = 31
    
In the curried form becomes:

     g(x) = (x -&gt; y -&gt; 10 * x - 3*y)
     
To evaluate f(4, 3): 

    h(y)  = (x -&gt; y -&gt; 10 * x - 3*y) 4 
          = ( y -&gt; 10 * 4 -  3*y )
          =  y -&gt; 40 - 3*y
          
    h(3)  = (y -&gt; 40 - 3*y) 3
          = 40 - 3*3
          = 31
          
Or:
    (x -&gt; y -&gt; 10 * x - 3*y) 4 3 
      = (x -&gt; (y -&gt; 10 * x - 3*y)) 4 3 
      = ((x -&gt; (y -&gt; 10 * x - 3*y)) 4) 3 
      = (y -&gt; 10 * 4 - 3 * y) 3
      = 10 * 4 - 3 * 3 
      = 31
</pre>

<p>
The same function h(y) can be reused: applied to another arguments, used in mapping, filtering and another higher order functions.
</p>

<pre class="example">
Ex1
    h(y) = (y -&gt; 40 - 3*y)
    
    h(10) = 40 - 3*10 = 40 - 30 = 10

Ex2    
    map(h, [2, 3, 4])
      = [h 2, h 3, h 4] 
      = [(y -&gt; 40 - 3*y) 2, (y -&gt; 40 - 3*y) 3, (y -&gt; 40 - 3*y) 4]
      = [34, 31, 28]
</pre>

<p>
<b>Example in Haskell GHCI</b>
</p>

<div class="org-src-container">

<pre class="src src-haskell"><span class="org-haskell-operator">&gt;</span> <span class="org-haskell-keyword">let</span> f x y <span class="org-haskell-operator">=</span> 10 <span class="org-haskell-operator">*</span> x <span class="org-haskell-operator">-</span> 3 <span class="org-haskell-operator">*</span> y
<span class="org-haskell-operator">&gt;</span> <span class="org-haskell-constructor">:</span>t f
<span class="org-function-name">f</span> <span class="org-haskell-operator">::</span> <span class="org-haskell-constructor">Num</span> a <span class="org-haskell-operator">=&gt;</span> a <span class="org-haskell-operator">-&gt;</span> a <span class="org-haskell-operator">-&gt;</span> a
<span class="org-haskell-operator">&gt;</span> 
<span class="org-haskell-operator">&gt;</span> <span class="org-haskell-definition">f</span> 4 3 
31
<span class="org-haskell-operator">&gt;</span> <span class="org-haskell-keyword">let</span> h_y <span class="org-haskell-operator">=</span> f 4
<span class="org-haskell-operator">&gt;</span> <span class="org-haskell-constructor">:</span>t h_y
<span class="org-function-name">h_y</span> <span class="org-haskell-operator">::</span> <span class="org-haskell-constructor">Integer</span> <span class="org-haskell-operator">-&gt;</span> <span class="org-haskell-constructor">Integer</span>
<span class="org-haskell-operator">&gt;</span> 
<span class="org-haskell-operator">&gt;</span> <span class="org-haskell-definition">h_y</span> 3
31
<span class="org-haskell-operator">&gt;</span> <span class="org-haskell-definition">map</span> h_y [2<span class="org-haskell-operator">,</span> 3<span class="org-haskell-operator">,</span> 4]
[34<span class="org-haskell-operator">,</span>31<span class="org-haskell-operator">,</span>28]
<span class="org-haskell-operator">&gt;</span> 

<span class="org-haskell-operator">&gt;</span> <span class="org-comment-delimiter">-- </span><span class="org-comment">It is evaluated as:</span>

<span class="org-haskell-operator">&gt;</span> ((f 4) 3)
31
<span class="org-haskell-operator">&gt;</span> 

<span class="org-comment-delimiter">{-</span>
<span class="org-comment">   The function f can be also seen in this way</span>
<span class="org-comment">-}</span>   

<span class="org-haskell-operator">&gt;</span> <span class="org-haskell-keyword">let</span> f' <span class="org-haskell-operator">=</span> <span class="org-haskell-operator">\</span>x <span class="org-haskell-operator">-&gt;</span> <span class="org-haskell-operator">\</span>y <span class="org-haskell-operator">-&gt;</span> 10 <span class="org-haskell-operator">*</span> x <span class="org-haskell-operator">-</span> 3 <span class="org-haskell-operator">*</span> y 
<span class="org-haskell-operator">&gt;</span> 

<span class="org-haskell-operator">&gt;</span> <span class="org-haskell-constructor">:</span>t f'
<span class="org-haskell-definition">f</span>' <span class="org-haskell-operator">::</span> <span class="org-haskell-constructor">Integer</span> <span class="org-haskell-operator">-&gt;</span> <span class="org-haskell-constructor">Integer</span> <span class="org-haskell-operator">-&gt;</span> <span class="org-haskell-constructor">Integer</span>
<span class="org-haskell-operator">&gt;</span> 

<span class="org-haskell-operator">&gt;</span> <span class="org-haskell-definition">f</span>' 4 3
31
<span class="org-haskell-operator">&gt;</span> 

<span class="org-haskell-operator">&gt;</span> (f' 4 ) 3
31
<span class="org-haskell-operator">&gt;</span> 

<span class="org-haskell-operator">&gt;</span> <span class="org-haskell-keyword">let</span> h__x_is_4_of_y <span class="org-haskell-operator">=</span> f' 4

<span class="org-haskell-operator">&gt;</span> <span class="org-haskell-definition">h__x_is_4_of_y</span> 3
31
<span class="org-haskell-operator">&gt;</span> 
<span class="org-comment-delimiter">{-</span>
<span class="org-comment">    (\x -&gt; \y -&gt; 10 * x - 3 * y) 4 3</span>
<span class="org-comment">    =  (\x -&gt; (\y -&gt; 10 * x - 3 * y) 4) 3</span>
<span class="org-comment">    =  (\y -&gt; 10 * 4 - 3 * y) 3</span>
<span class="org-comment">    =  (10 * 4 - 3 * 3)</span>
<span class="org-comment">    =  40 - 9 </span>
<span class="org-comment">    =  31    </span>
<span class="org-comment">-}</span>
<span class="org-haskell-operator">&gt;</span> (<span class="org-haskell-operator">\</span>x <span class="org-haskell-operator">-&gt;</span> <span class="org-haskell-operator">\</span>y <span class="org-haskell-operator">-&gt;</span> 10 <span class="org-haskell-operator">*</span> x <span class="org-haskell-operator">-</span> 3 <span class="org-haskell-operator">*</span> y) 4 3
31
<span class="org-haskell-operator">&gt;</span> 

<span class="org-haskell-operator">&gt;</span> ((<span class="org-haskell-operator">\</span>x <span class="org-haskell-operator">-&gt;</span> (<span class="org-haskell-operator">\</span>y <span class="org-haskell-operator">-&gt;</span> 10 <span class="org-haskell-operator">*</span> x <span class="org-haskell-operator">-</span> 3 <span class="org-haskell-operator">*</span> y)) 4) 3
31
<span class="org-haskell-operator">&gt;</span> 


<span class="org-comment-delimiter">{-</span>
<span class="org-comment">Curried functions are suitable for composition, pipelining </span>
<span class="org-comment">(F#, OCaml with the |&gt; operator),  mapping/ filtering operations,</span>
<span class="org-comment">and to create new function from previous defined increasing code reuse.</span>

<span class="org-comment">-}</span>

<span class="org-haskell-operator">&gt;</span> <span class="org-haskell-definition">map</span> (f 4) [2<span class="org-haskell-operator">,</span> 3<span class="org-haskell-operator">,</span> 4]
[34<span class="org-haskell-operator">,</span>31<span class="org-haskell-operator">,</span>28]
<span class="org-haskell-operator">&gt;</span> 

<span class="org-haskell-operator">&gt;</span> <span class="org-haskell-definition">map</span> ((<span class="org-haskell-operator">\</span>x <span class="org-haskell-operator">-&gt;</span> <span class="org-haskell-operator">\</span>y <span class="org-haskell-operator">-&gt;</span> 10 <span class="org-haskell-operator">*</span> x <span class="org-haskell-operator">-</span> 3 <span class="org-haskell-operator">*</span> y) 4) [2<span class="org-haskell-operator">,</span> 3<span class="org-haskell-operator">,</span> 4]
[34<span class="org-haskell-operator">,</span>31<span class="org-haskell-operator">,</span>28]
<span class="org-haskell-operator">&gt;</span> 


<span class="org-haskell-operator">&gt;</span> <span class="org-comment-delimiter">-- </span><span class="org-comment">----------------- </span>

<span class="org-haskell-operator">&gt;</span> <span class="org-haskell-keyword">let</span> f_of_x_y_z x y z <span class="org-haskell-operator">=</span> 10 <span class="org-haskell-operator">*</span> x <span class="org-haskell-operator">+</span> 3 <span class="org-haskell-operator">*</span> y <span class="org-haskell-operator">+</span> 4 <span class="org-haskell-operator">*</span> z
<span class="org-haskell-operator">&gt;</span> 

<span class="org-haskell-operator">&gt;</span> <span class="org-haskell-constructor">:</span>t f_of_x_y_z 
<span class="org-function-name">f_of_x_y_z</span> <span class="org-haskell-operator">::</span> <span class="org-haskell-constructor">Num</span> a <span class="org-haskell-operator">=&gt;</span> a <span class="org-haskell-operator">-&gt;</span> a <span class="org-haskell-operator">-&gt;</span> a <span class="org-haskell-operator">-&gt;</span> a

<span class="org-haskell-operator">&gt;</span> <span class="org-haskell-definition">f_of_x_y_z</span> 2 3 5
49
<span class="org-haskell-operator">&gt;</span> 

<span class="org-haskell-operator">&gt;</span> <span class="org-haskell-keyword">let</span> g_of_y_z <span class="org-haskell-operator">=</span> f_of_x_y_z 2

<span class="org-haskell-operator">&gt;</span> <span class="org-haskell-constructor">:</span>t g_of_y_z 
<span class="org-function-name">g_of_y_z</span> <span class="org-haskell-operator">::</span> <span class="org-haskell-constructor">Integer</span> <span class="org-haskell-operator">-&gt;</span> <span class="org-haskell-constructor">Integer</span> <span class="org-haskell-operator">-&gt;</span> <span class="org-haskell-constructor">Integer</span>
<span class="org-haskell-operator">&gt;</span> 

<span class="org-haskell-operator">&gt;</span> <span class="org-haskell-definition">g_of_y_z</span> 3 5
49
<span class="org-haskell-operator">&gt;</span> 

<span class="org-haskell-operator">&gt;</span> <span class="org-haskell-keyword">let</span> h_of_z <span class="org-haskell-operator">=</span> g_of_y_z 3
<span class="org-haskell-operator">&gt;</span> <span class="org-haskell-constructor">:</span>t h_of_z 
<span class="org-function-name">h_of_z</span> <span class="org-haskell-operator">::</span> <span class="org-haskell-constructor">Integer</span> <span class="org-haskell-operator">-&gt;</span> <span class="org-haskell-constructor">Integer</span>
<span class="org-haskell-operator">&gt;</span> 

<span class="org-haskell-operator">&gt;</span> <span class="org-haskell-definition">h_of_z</span> 5
49
<span class="org-haskell-operator">&gt;</span> 

<span class="org-haskell-operator">&gt;</span> <span class="org-comment-delimiter">-- </span><span class="org-comment">So it is evaluated as </span>
<span class="org-haskell-operator">&gt;</span> (((f_of_x_y_z 2) 3) 5)
49
<span class="org-haskell-operator">&gt;</span>
</pre>
</div>

<p>
<b>Example in Python 3</b>
</p>

<div class="org-src-container">

<pre class="src src-python"> <span class="org-comment-delimiter"># </span><span class="org-comment">In Python, the functions are not curried by default as in Haskell, </span>
 <span class="org-comment-delimiter"># </span><span class="org-comment">Standard ML, OCaml and F#</span>
 <span class="org-comment-delimiter">#</span>
&gt;&gt;&gt; <span class="org-keyword">def</span> <span class="org-function-name">f</span>(x, y): <span class="org-keyword">return</span> 10 * x - 3*y

&gt;&gt;&gt; f(4, 3)
    31

 <span class="org-comment-delimiter"># </span><span class="org-comment">However the user can create the curried form of the function f:</span>

&gt;&gt;&gt; <span class="org-variable-name">curried_f</span> = <span class="org-keyword">lambda</span> x: <span class="org-keyword">lambda</span> y: 10*x - 3*y

&gt;&gt;&gt; curried_f(4)
    &lt;function __main__.&lt;<span class="org-keyword">lambda</span>&gt;.&lt;<span class="org-builtin">locals</span>&gt;.&lt;<span class="org-keyword">lambda</span>&gt;&gt;

&gt;&gt;&gt; curried_f(4)(3)
    31

&gt;&gt;&gt; <span class="org-variable-name">h_y</span> = curried_f(4) <span class="org-comment-delimiter"># </span><span class="org-comment">x = 4 constant</span>

&gt;&gt;&gt; h_y(3)
    31

&gt;&gt;&gt; h_y(5)
    25

&gt;&gt;&gt; <span class="org-variable-name">mapl</span> = <span class="org-keyword">lambda</span> f_x, xs: <span class="org-builtin">list</span>(<span class="org-builtin">map</span>(f_x, xs))

&gt;&gt;&gt; mapl(h_y, [2, 3, 4])
    [34, 31, 28]

 <span class="org-comment-delimiter"># </span><span class="org-comment">Or </span>

&gt;&gt;&gt; mapl(curried_f(4), [2, 3, 4])
    [34, 31, 28]

 <span class="org-comment-delimiter"># </span><span class="org-comment">Without currying the mapping would be:</span>

&gt;&gt;&gt; mapl(<span class="org-keyword">lambda</span> y: f(4, y), [2, 3, 4])
    [34, 31, 28]

   <span class="org-comment-delimiter">########################################</span>

&gt;&gt; <span class="org-variable-name">f_of_x_y_z</span> = <span class="org-keyword">lambda</span> x, y, z: 10 * x + 3 * y + 4 * z

 <span class="org-comment-delimiter">## </span><span class="org-comment">Curried form:</span>
 
&gt;&gt;&gt; <span class="org-variable-name">curried_f_of_x_y_z</span> = <span class="org-keyword">lambda</span> x: <span class="org-keyword">lambda</span> y: <span class="org-keyword">lambda</span> z: 10 * x + 3 * y + 4 * z

&gt;&gt;&gt; f_of_x_y_z (2, 3, 5)
    49

&gt;&gt;&gt; curried_f_of_x_y_z (2)(3)(5)
    49

&gt;&gt;&gt; <span class="org-variable-name">g_of_y_z</span> = curried_f_of_x_y_z(2)

&gt;&gt;&gt; g_of_y_z
    &lt;function __main__.&lt;<span class="org-keyword">lambda</span>&gt;.&lt;<span class="org-builtin">locals</span>&gt;.&lt;<span class="org-keyword">lambda</span>&gt;&gt;

&gt;&gt;&gt; g_of_y_z (3)(5)
    49


&gt;&gt;&gt; <span class="org-variable-name">h_of_z</span> = g_of_y_z(3)

&gt;&gt;&gt; h_of_z
    &lt;function __main__.&lt;<span class="org-keyword">lambda</span>&gt;.&lt;<span class="org-builtin">locals</span>&gt;.&lt;<span class="org-keyword">lambda</span>&gt;.&lt;<span class="org-builtin">locals</span>&gt;.&lt;<span class="org-keyword">lambda</span>&gt;&gt;

&gt;&gt;&gt; h_of_z(5)
    49
</pre>
</div>

<p>
<b>Example in Ocaml and F#</b>
</p>

<div class="org-src-container">

<pre class="src src-ocaml">    <span class="org-tuareg-font-lock-operator">#</span> <span class="org-tuareg-font-lock-governing">let</span> <span class="org-function-name">f</span><span class="org-variable-name"> x y</span> <span class="org-tuareg-font-lock-operator">=</span> 10 <span class="org-tuareg-font-lock-operator">*</span> x <span class="org-tuareg-font-lock-operator">-</span> 3 <span class="org-tuareg-font-lock-operator">*</span> y <span class="org-tuareg-font-lock-operator">;;</span>
    <span class="org-tuareg-font-lock-governing">val</span> <span class="org-function-name">f</span> <span class="org-tuareg-font-lock-operator">:</span> int <span class="org-tuareg-font-lock-operator">-&gt;</span> int <span class="org-tuareg-font-lock-operator">-&gt;</span> int <span class="org-tuareg-font-lock-operator">=</span> <span class="org-tuareg-font-lock-operator">&lt;</span><span class="org-keyword">fun</span><span class="org-tuareg-font-lock-operator">&gt;</span>

    <span class="org-tuareg-font-lock-operator">#</span> f 4 3 <span class="org-tuareg-font-lock-operator">;;</span>
    <span class="org-tuareg-font-lock-operator">-</span> <span class="org-tuareg-font-lock-operator">:</span> int <span class="org-tuareg-font-lock-operator">=</span> 31

    <span class="org-tuareg-font-lock-operator">#</span> f 4 <span class="org-tuareg-font-lock-operator">;;</span>
    <span class="org-tuareg-font-lock-operator">-</span> <span class="org-tuareg-font-lock-operator">:</span> int <span class="org-tuareg-font-lock-operator">-&gt;</span> int <span class="org-tuareg-font-lock-operator">=</span> <span class="org-tuareg-font-lock-operator">&lt;</span><span class="org-keyword">fun</span><span class="org-tuareg-font-lock-operator">&gt;</span>

    <span class="org-tuareg-font-lock-operator">#</span> <span class="org-tuareg-font-lock-operator">(</span>f 4<span class="org-tuareg-font-lock-operator">)</span> 3 <span class="org-tuareg-font-lock-operator">;;</span>
    <span class="org-tuareg-font-lock-operator">-</span> <span class="org-tuareg-font-lock-operator">:</span> int <span class="org-tuareg-font-lock-operator">=</span> 31
    <span class="org-tuareg-font-lock-operator">#</span> 

    <span class="org-tuareg-font-lock-operator">#</span> <span class="org-tuareg-font-lock-governing">let</span> <span class="org-variable-name">h_y</span> <span class="org-tuareg-font-lock-operator">=</span> f 4 <span class="org-tuareg-font-lock-operator">;;</span>
    <span class="org-tuareg-font-lock-governing">val</span> <span class="org-function-name">h_y</span> <span class="org-tuareg-font-lock-operator">:</span> int <span class="org-tuareg-font-lock-operator">-&gt;</span> int <span class="org-tuareg-font-lock-operator">=</span> <span class="org-tuareg-font-lock-operator">&lt;</span><span class="org-keyword">fun</span><span class="org-tuareg-font-lock-operator">&gt;</span>

    <span class="org-tuareg-font-lock-operator">#</span> h_y 3 <span class="org-tuareg-font-lock-operator">;;</span>
    <span class="org-tuareg-font-lock-operator">-</span> <span class="org-tuareg-font-lock-operator">:</span> int <span class="org-tuareg-font-lock-operator">=</span> 31
    <span class="org-tuareg-font-lock-operator">#</span> 

    <span class="org-tuareg-font-lock-operator">#</span> <span class="org-tuareg-font-lock-module">List.</span>map h_y <span class="org-tuareg-font-lock-operator">[</span>2<span class="org-tuareg-font-lock-operator">;</span> 3<span class="org-tuareg-font-lock-operator">;</span> 4<span class="org-tuareg-font-lock-operator">]</span> <span class="org-tuareg-font-lock-operator">;;</span>
    <span class="org-tuareg-font-lock-operator">-</span> <span class="org-tuareg-font-lock-operator">:</span> int list <span class="org-tuareg-font-lock-operator">=</span> <span class="org-tuareg-font-lock-operator">[</span>34<span class="org-tuareg-font-lock-operator">;</span> 31<span class="org-tuareg-font-lock-operator">;</span> 28<span class="org-tuareg-font-lock-operator">]</span>
    <span class="org-tuareg-font-lock-operator">#</span> 

    <span class="org-tuareg-font-lock-operator">#</span> <span class="org-tuareg-font-lock-module">List.</span>map <span class="org-tuareg-font-lock-operator">(</span>f 4<span class="org-tuareg-font-lock-operator">)</span> <span class="org-tuareg-font-lock-operator">[</span>2<span class="org-tuareg-font-lock-operator">;</span> 3<span class="org-tuareg-font-lock-operator">;</span> 4<span class="org-tuareg-font-lock-operator">]</span> <span class="org-tuareg-font-lock-operator">;;</span>
    <span class="org-tuareg-font-lock-operator">-</span> <span class="org-tuareg-font-lock-operator">:</span> int list <span class="org-tuareg-font-lock-operator">=</span> <span class="org-tuareg-font-lock-operator">[</span>34<span class="org-tuareg-font-lock-operator">;</span> 31<span class="org-tuareg-font-lock-operator">;</span> 28<span class="org-tuareg-font-lock-operator">]</span>

    <span class="org-tuareg-font-lock-operator">#</span> <span class="org-tuareg-font-lock-governing">let</span> <span class="org-function-name">f'</span> <span class="org-tuareg-font-lock-operator">=</span> <span class="org-keyword">fun</span> <span class="org-variable-name">x</span> <span class="org-tuareg-font-lock-operator">-&gt;</span> <span class="org-keyword">fun</span> <span class="org-variable-name">y</span> <span class="org-tuareg-font-lock-operator">-&gt;</span> 10 <span class="org-tuareg-font-lock-operator">*</span> x <span class="org-tuareg-font-lock-operator">-</span> 3 <span class="org-tuareg-font-lock-operator">*</span> y <span class="org-tuareg-font-lock-operator">;;</span>
    <span class="org-tuareg-font-lock-governing">val</span> <span class="org-function-name">f'</span> <span class="org-tuareg-font-lock-operator">:</span> int <span class="org-tuareg-font-lock-operator">-&gt;</span> int <span class="org-tuareg-font-lock-operator">-&gt;</span> int <span class="org-tuareg-font-lock-operator">=</span> <span class="org-tuareg-font-lock-operator">&lt;</span><span class="org-keyword">fun</span><span class="org-tuareg-font-lock-operator">&gt;</span>

    <span class="org-tuareg-font-lock-operator">#</span> <span class="org-tuareg-font-lock-operator">(</span>f' 4<span class="org-tuareg-font-lock-operator">)</span> 3 <span class="org-tuareg-font-lock-operator">;;</span>
    <span class="org-tuareg-font-lock-operator">-</span> <span class="org-tuareg-font-lock-operator">:</span> int <span class="org-tuareg-font-lock-operator">=</span> 31

    <span class="org-tuareg-font-lock-operator">#</span> <span class="org-tuareg-font-lock-operator">(</span><span class="org-keyword">fun</span> <span class="org-variable-name">x</span> <span class="org-tuareg-font-lock-operator">-&gt;</span> <span class="org-keyword">fun</span> <span class="org-variable-name">y</span> <span class="org-tuareg-font-lock-operator">-&gt;</span> 10 <span class="org-tuareg-font-lock-operator">*</span> x <span class="org-tuareg-font-lock-operator">-</span> 3 <span class="org-tuareg-font-lock-operator">*</span> y<span class="org-tuareg-font-lock-operator">)</span> 4 3 <span class="org-tuareg-font-lock-operator">;;</span>
    <span class="org-tuareg-font-lock-operator">-</span> <span class="org-tuareg-font-lock-operator">:</span> int <span class="org-tuareg-font-lock-operator">=</span> 31
    <span class="org-tuareg-font-lock-operator">#</span> 

    <span class="org-tuareg-font-lock-operator">#</span> <span class="org-tuareg-font-lock-module">List.</span>map <span class="org-tuareg-font-lock-operator">((</span><span class="org-keyword">fun</span> <span class="org-variable-name">x</span> <span class="org-tuareg-font-lock-operator">-&gt;</span> <span class="org-keyword">fun</span> <span class="org-variable-name">y</span> <span class="org-tuareg-font-lock-operator">-&gt;</span> 10 <span class="org-tuareg-font-lock-operator">*</span> x <span class="org-tuareg-font-lock-operator">-</span> 3 <span class="org-tuareg-font-lock-operator">*</span> y<span class="org-tuareg-font-lock-operator">)</span> 4<span class="org-tuareg-font-lock-operator">)</span> <span class="org-tuareg-font-lock-operator">[</span>2<span class="org-tuareg-font-lock-operator">;</span> 3<span class="org-tuareg-font-lock-operator">;</span> 4<span class="org-tuareg-font-lock-operator">]</span> <span class="org-tuareg-font-lock-operator">;;</span>
    <span class="org-tuareg-font-lock-operator">-</span> <span class="org-tuareg-font-lock-operator">:</span> int list <span class="org-tuareg-font-lock-operator">=</span> <span class="org-tuareg-font-lock-operator">[</span>34<span class="org-tuareg-font-lock-operator">;</span> 31<span class="org-tuareg-font-lock-operator">;</span> 28<span class="org-tuareg-font-lock-operator">]</span>
</pre>
</div>
</div>
</div>

<div id="outline-container-sec-1-7-2" class="outline-4">
<h4 id="sec-1-7-2"><span class="section-number-4">1.7.2</span> Partial Application</h4>
<div class="outline-text-4" id="text-1-7-2">
<p>
A function of multiple arguments is converted into a new function that
takes fewer arguments, some arguments are supplied and returns
function with signature consisting of remaining arguments. <b>Partially
applied*</b> functions must not be confused with <b>*currying</b>.
</p>

<p>
Example in Python:
</p>

<div class="org-src-container">

<pre class="src src-python">&gt;&gt;&gt; <span class="org-keyword">from</span> functools <span class="org-keyword">import</span> partial

&gt;&gt;&gt; <span class="org-keyword">def</span> <span class="org-function-name">f</span>(x, y, z): <span class="org-keyword">return</span> 10 * x + 3 * y + 4 * z

&gt;&gt;&gt; f(2, 3, 5)
    49

&gt;&gt;&gt; <span class="org-variable-name">f_yz</span> = partial(f, 2) <span class="org-comment-delimiter"># </span><span class="org-comment">x = 2</span>
&gt;&gt;&gt; f_yz(3, 5)
    49

&gt;&gt;&gt; <span class="org-variable-name">f_z</span> = partial(f_yz, 3)

&gt;&gt;&gt; f_z(5)
    49
    
&gt;&gt;&gt; partial(f, 2, 3)(5)
    49
  
&gt;&gt;&gt; <span class="org-builtin">list</span>(<span class="org-builtin">map</span>(partial(f, 2, 3), [2, 3, 5]))
    [37, 41, 49]

<span class="org-comment-delimiter">#</span>
<span class="org-comment-delimiter"># </span><span class="org-comment">Alternative implementation of partial</span>
<span class="org-comment-delimiter">#</span>
<span class="org-keyword">def</span> <span class="org-function-name">partial</span>(f, *xs):
    <span class="org-keyword">return</span> <span class="org-keyword">lambda</span> x: f( * (<span class="org-builtin">tuple</span>(xs) + (x,)))

&gt;&gt;&gt; <span class="org-builtin">list</span>(<span class="org-builtin">map</span>(partial(f, 2, 3), [2, 3, 5]))
    [37, 41, 49]
&gt;&gt;&gt;
</pre>
</div>

<p>
In languages like Haskell, Standard ML, OCaml and F# currying is
similar to partial application.
</p>

<p>
Example in OCaml:
</p>

<div class="org-src-container">

<pre class="src src-ocaml">    <span class="org-tuareg-font-lock-operator">#</span> <span class="org-tuareg-font-lock-governing">let</span> <span class="org-function-name">f</span><span class="org-variable-name"> x y z</span> <span class="org-tuareg-font-lock-operator">=</span> 10 <span class="org-tuareg-font-lock-operator">*</span> x <span class="org-tuareg-font-lock-operator">+</span> 3 <span class="org-tuareg-font-lock-operator">*</span>y <span class="org-tuareg-font-lock-operator">+</span> 4 <span class="org-tuareg-font-lock-operator">*</span> z <span class="org-tuareg-font-lock-operator">;;</span>
    <span class="org-tuareg-font-lock-governing">val</span> <span class="org-function-name">f</span> <span class="org-tuareg-font-lock-operator">:</span> int <span class="org-tuareg-font-lock-operator">-&gt;</span> int <span class="org-tuareg-font-lock-operator">-&gt;</span> int <span class="org-tuareg-font-lock-operator">-&gt;</span> int <span class="org-tuareg-font-lock-operator">=</span> <span class="org-tuareg-font-lock-operator">&lt;</span><span class="org-keyword">fun</span><span class="org-tuareg-font-lock-operator">&gt;</span>
    <span class="org-tuareg-font-lock-operator">#</span> 

    <span class="org-tuareg-font-lock-operator">#</span> <span class="org-tuareg-font-lock-operator">(</span>f 2 3<span class="org-tuareg-font-lock-operator">)</span> <span class="org-tuareg-font-lock-operator">;;</span>
    <span class="org-tuareg-font-lock-operator">-</span> <span class="org-tuareg-font-lock-operator">:</span> int <span class="org-tuareg-font-lock-operator">-&gt;</span> int <span class="org-tuareg-font-lock-operator">=</span> <span class="org-tuareg-font-lock-operator">&lt;</span><span class="org-keyword">fun</span><span class="org-tuareg-font-lock-operator">&gt;</span>
    
    <span class="org-tuareg-font-lock-operator">#</span> <span class="org-tuareg-font-lock-governing">let</span> <span class="org-variable-name">f_z</span> <span class="org-tuareg-font-lock-operator">=</span> f 2 3 <span class="org-tuareg-font-lock-operator">;;</span>
    <span class="org-tuareg-font-lock-governing">val</span> <span class="org-function-name">f_z</span> <span class="org-tuareg-font-lock-operator">:</span> int <span class="org-tuareg-font-lock-operator">-&gt;</span> int <span class="org-tuareg-font-lock-operator">=</span> <span class="org-tuareg-font-lock-operator">&lt;</span><span class="org-keyword">fun</span><span class="org-tuareg-font-lock-operator">&gt;</span>

    <span class="org-tuareg-font-lock-operator">#</span> f_z 5 <span class="org-tuareg-font-lock-operator">;;</span>
    <span class="org-tuareg-font-lock-operator">-</span> <span class="org-tuareg-font-lock-operator">:</span> int <span class="org-tuareg-font-lock-operator">=</span> 49
    <span class="org-tuareg-font-lock-operator">#</span>    
    
    <span class="org-doc">(** Write (f 2 3) is the same as write (f 2)(3)  *)</span>
    <span class="org-tuareg-font-lock-operator">#</span> <span class="org-tuareg-font-lock-module">List.</span>map <span class="org-tuareg-font-lock-operator">(</span>f 2 3<span class="org-tuareg-font-lock-operator">)</span> <span class="org-tuareg-font-lock-operator">[</span>2<span class="org-tuareg-font-lock-operator">;</span> 3<span class="org-tuareg-font-lock-operator">;</span> 5<span class="org-tuareg-font-lock-operator">]</span> <span class="org-tuareg-font-lock-operator">;;</span>
    <span class="org-tuareg-font-lock-operator">-</span> <span class="org-tuareg-font-lock-operator">:</span> int list <span class="org-tuareg-font-lock-operator">=</span> <span class="org-tuareg-font-lock-operator">[</span>37<span class="org-tuareg-font-lock-operator">;</span> 41<span class="org-tuareg-font-lock-operator">;</span> 49<span class="org-tuareg-font-lock-operator">]</span>
    <span class="org-tuareg-font-lock-operator">#</span>
</pre>
</div>

<p>
See also:
</p>

<ul class="org-ul">
<li><a href="http://www.ibm.com/developerworks/library/j-jn9/">Java.next: Currying and partial application</a>
</li>
<li><a href="https://en.wikipedia.org/wiki/Partial_application">Partial application - Wikipedia</a>
</li>
<li><a href="https://dzone.com/articles/whats-wrong-java-8-currying-vs">What's Wrong with Java 8: Currying vs Closures</a>
</li>
</ul>
</div>
</div>
</div>

<div id="outline-container-sec-1-8" class="outline-3">
<h3 id="sec-1-8"><span class="section-number-3">1.8</span> Lazy Evaluation</h3>
<div class="outline-text-3" id="text-1-8">
<p>
"Lazy evaluation" means that data structures are computed
incrementally, as they are needed (so the trees never exist in memory
all at once) parts that are never needed are never computed. Haskell
uses lazy evaluation by default.
</p>

<p>
Example in Haskell: 
</p>

<div class="org-src-container">

<pre class="src src-haskell"><span class="org-haskell-operator">&gt;</span> <span class="org-haskell-keyword">let</span> lazylist <span class="org-haskell-operator">=</span> [2<span class="org-haskell-operator">..</span>1000000000]
<span class="org-haskell-operator">&gt;</span> 
<span class="org-haskell-operator">&gt;</span> <span class="org-haskell-keyword">let</span> f x <span class="org-haskell-operator">=</span> x<span class="org-haskell-operator">^</span>6 
<span class="org-haskell-operator">&gt;</span> 
<span class="org-haskell-operator">&gt;</span> <span class="org-haskell-definition">take</span> 5 lazylist 
[2<span class="org-haskell-operator">,</span>3<span class="org-haskell-operator">,</span>4<span class="org-haskell-operator">,</span>5<span class="org-haskell-operator">,</span>6]
<span class="org-haskell-operator">&gt;</span>
<span class="org-haskell-operator">&gt;</span>
<span class="org-haskell-operator">&gt;</span> <span class="org-comment-delimiter">{- </span><span class="org-comment">Only the terms needed are computed. -}</span>
<span class="org-haskell-operator">&gt;</span> <span class="org-haskell-definition">take</span> 5 ( map f lazylist )
[64<span class="org-haskell-operator">,</span>729<span class="org-haskell-operator">,</span>4096<span class="org-haskell-operator">,</span>15625<span class="org-haskell-operator">,</span>46656]
<span class="org-haskell-operator">&gt;</span>
</pre>
</div>

<p>
Example in Python:
</p>

<ul class="org-ul">
<li>Python uses eager evaluation by default. In order to get lazy evaluation in python the programmer must use iterators or generators. The example below uses generator.
</li>
</ul>

<div class="org-src-container">

<pre class="src src-python"><span class="org-keyword">def</span> <span class="org-function-name">lazy_list</span>():
    <span class="org-string">""" Infinite list """</span>
    <span class="org-variable-name">x</span> = 0 
    <span class="org-keyword">while</span> <span class="org-constant">True</span>:
        <span class="org-variable-name">x</span> += 2
        <span class="org-keyword">yield</span> x


&gt;&gt;&gt; <span class="org-variable-name">gen</span> = lazy_list()
&gt;&gt;&gt; <span class="org-builtin">next</span>(gen)
2
&gt;&gt;&gt; <span class="org-builtin">next</span>(gen)
4
&gt;&gt;&gt; <span class="org-builtin">next</span>(gen)
6
&gt;&gt;&gt; <span class="org-builtin">next</span>(gen)
8
&gt;&gt;&gt; <span class="org-builtin">next</span>(gen)
10
&gt;&gt;&gt; 

<span class="org-keyword">def</span> <span class="org-function-name">take</span>(n, iterable):
    <span class="org-keyword">return</span> [<span class="org-builtin">next</span>(iterable) <span class="org-keyword">for</span> i <span class="org-keyword">in</span> <span class="org-builtin">range</span>(n)]

<span class="org-keyword">def</span> <span class="org-function-name">mapi</span>(func, iterable):   
    <span class="org-keyword">while</span> <span class="org-constant">True</span>:
        <span class="org-keyword">yield</span> func(<span class="org-builtin">next</span>(iterable))
        
<span class="org-variable-name">f</span> = <span class="org-keyword">lambda</span> x: x**5

&gt;&gt;&gt; take(5, lazy_list())
[2, 4, 6, 8, 10]
&gt;&gt;&gt; take(10, lazy_list())
[2, 4, 6, 8, 10, 12, 14, 16, 18, 20]
&gt;&gt;&gt; 

&gt;&gt;&gt; take(5, mapi(f, lazy_list()))
[32, 1024, 7776, 32768, 100000]
&gt;&gt;&gt; 
&gt;&gt;&gt; take(6, mapi(f, lazy_list()))
[32, 1024, 7776, 32768, 100000, 248832]
&gt;&gt;&gt;
</pre>
</div>
</div>
</div>

<div id="outline-container-sec-1-9" class="outline-3">
<h3 id="sec-1-9"><span class="section-number-3">1.9</span> Tail Call Optimization and Tail Recursive Functions</h3>
<div class="outline-text-3" id="text-1-9">
</div><div id="outline-container-sec-1-9-1" class="outline-4">
<h4 id="sec-1-9-1"><span class="section-number-4">1.9.1</span> Tail Call</h4>
<div class="outline-text-4" id="text-1-9-1">
<p>
A tail call is a function call which is the last action performed by
a function.
</p>

<p>
Examples of <span class="underline">tail calls</span> and <span class="underline">non tail calls</span>: 
</p>

<p>
Example 1: Tail call 
</p>

<div class="org-src-container">

<pre class="src src-python"><span class="org-keyword">def</span> <span class="org-function-name">func1</span>(x):
    <span class="org-keyword">return</span>  tail_call_function (x * 2) <span class="org-comment-delimiter"># </span><span class="org-comment">It is a tail call</span>
</pre>
</div>


<p>
Example 2: Tail recursive call or tail recursive function. 
</p>

<div class="org-src-container">

<pre class="src src-python"><span class="org-keyword">def</span> <span class="org-function-name">tail_recursive_call</span> (n, acc);
    <span class="org-keyword">if</span> <span class="org-variable-name">n</span> = 0:
       <span class="org-keyword">return</span> acc 
       <span class="org-keyword">return</span> tai_recursive_acll (n - 1, n * acc) <span class="org-comment-delimiter"># </span><span class="org-comment">Tail recursive call, the </span>
                                                  <span class="org-comment-delimiter"># </span><span class="org-comment">function call is the last</span>
                                                  <span class="org-comment-delimiter"># </span><span class="org-comment">thing the function does.</span>
</pre>
</div>

<p>
Example 3: Non tail call 
</p>

<div class="org-src-container">

<pre class="src src-python"><span class="org-keyword">def</span> <span class="org-function-name">non_tail_call_function</span>(x):
    <span class="org-keyword">return</span> 1 + non_tail_call_function (x + 3)
</pre>
</div>
</div>
</div>

<div id="outline-container-sec-1-9-2" class="outline-4">
<h4 id="sec-1-9-2"><span class="section-number-4">1.9.2</span> Tail Call Optimization</h4>
<div class="outline-text-4" id="text-1-9-2">
<p>
Tail call optimization - TCO. (aka. tail call elimination - TCE or
tail recursion elimination - TRE) is a optimization that replaces
calls in tail positions with jumps which guarantees that loops
implemented using recursion are executed in constant stack
space. <a href="http://citeseerx.ist.psu.edu/viewdoc/download?doi=10.1.1.98.1934&rep=rep1&type=pdf">{Schinz M. and Odersky M. - 2001}</a> 
</p>

<p>
Without tail call optimization each recursive call creates a
new stack frame by growing the execution stack. Eventually the
stack runs out of space and the program has to stop.  To support
iteration by recursion functional languages need tail call
optimization. <a href="http://www.ssw.uni-linz.ac.at/Research/Papers/Schwaighofer09Master/schwaighofer09master.pdf">{Schwaighofer A. 2009}</a>  <sup><a id="fnr.1" name="fnr.1" class="footref" href="#fn.1">1</a></sup>
</p>

<p>
If the language doesn't support TCO it is not possible to perform
recursion safely. A big number of calls will lead to a stack overflow
exception and the program will crash unexpectedly.
</p>

<p>
Sometimes non tail recursive functions can be changed to tail
recursive by adding a new function with extra parameters
(accumulators) to store partial results (state).
</p>

<p>
Languages with TCO support: 
</p>

<ul class="org-ul">
<li>Scheme
</li>
<li>Common Lisp 
</li>
<li>Haskell
</li>
<li>Ocaml
</li>
<li>F# (F sharp)
</li>
<li>C# (C sharp)
</li>
<li>Scala
</li>
<li>Erlang 
</li>
</ul>

<p>
Languages without TCO support: 
</p>

<ul class="org-ul">
<li>Python <sup><a id="fnr.2" name="fnr.2" class="footref" href="#fn.2">2</a></sup> <sup>, </sup><sup><a id="fnr.3" name="fnr.3" class="footref" href="#fn.3">3</a></sup>
</li>
<li>Ruby 
</li>
<li>Java   (Note: The JVM doesn't support TCO)
</li>
<li>Clojure
</li>
<li>JavaScript
</li>
<li>R <sup><a id="fnr.4" name="fnr.4" class="footref" href="#fn.4">4</a></sup>
</li>
<li>Elisp - Emacs Lisp 
</li>
</ul>
</div>
</div>

<div id="outline-container-sec-1-9-3" class="outline-4">
<h4 id="sec-1-9-3"><span class="section-number-4">1.9.3</span> Summary</h4>
<div class="outline-text-4" id="text-1-9-3">
<ol class="org-ol">
<li>To perform recursion safely a language must support TCO - Tail Call
Optimization.
</li>

<li>Even if there is TCO support a non tail recursive function can lead
to an unexpected stack overflow.
</li>

<li>Recursion allow greater expressiveness and many algorithms are
better expressed with recursion.
</li>

<li>Recursion must be replaced by loops constructs in languages that
doesn't support TCO.
</li>
</ol>
</div>
</div>

<div id="outline-container-sec-1-9-4" class="outline-4">
<h4 id="sec-1-9-4"><span class="section-number-4">1.9.4</span> Examples</h4>
<div class="outline-text-4" id="text-1-9-4">
<p>
Example of non tail recursive function in Scheme (GNU Guile): 
</p>

<div class="org-src-container">

<pre class="src src-scheme"><span class="org-rainbow-delimiters-depth-1">(</span><span class="org-keyword">define</span> <span class="org-rainbow-delimiters-depth-2">(</span><span class="org-function-name">factorial</span> n<span class="org-rainbow-delimiters-depth-2">)</span>
    <span class="org-rainbow-delimiters-depth-2">(</span><span class="org-keyword">if</span> <span class="org-rainbow-delimiters-depth-3">(</span><span class="org-keyword">or</span> <span class="org-rainbow-delimiters-depth-4">(</span>= n 0<span class="org-rainbow-delimiters-depth-4">)</span> <span class="org-rainbow-delimiters-depth-4">(</span>= n 1<span class="org-rainbow-delimiters-depth-4">)</span><span class="org-rainbow-delimiters-depth-3">)</span>
        1
        <span class="org-rainbow-delimiters-depth-3">(</span>* n  <span class="org-rainbow-delimiters-depth-4">(</span>factorial <span class="org-rainbow-delimiters-depth-5">(</span>- n 1<span class="org-rainbow-delimiters-depth-5">)</span><span class="org-rainbow-delimiters-depth-4">)</span><span class="org-rainbow-delimiters-depth-3">)</span><span class="org-rainbow-delimiters-depth-2">)</span><span class="org-rainbow-delimiters-depth-1">)</span>
        
&gt; <span class="org-rainbow-delimiters-depth-1">(</span>factorial 10<span class="org-rainbow-delimiters-depth-1">)</span>
$1 = 3628800
&gt; 

<span class="org-comment-delimiter">;;  </span><span class="org-comment">For a very big number of iterations, non tail recursive functions</span>
<span class="org-comment-delimiter">;;  </span><span class="org-comment">will cause a stack overflow.</span>
<span class="org-comment-delimiter">;;</span>
&gt; <span class="org-rainbow-delimiters-depth-1">(</span>factorial 20000000<span class="org-rainbow-delimiters-depth-1">)</span>
warnings can be silenced by the --no-warnings <span class="org-rainbow-delimiters-depth-1">(</span>-n<span class="org-rainbow-delimiters-depth-1">)</span> option
Aborted <span class="org-rainbow-delimiters-depth-1">(</span>core dumped<span class="org-rainbow-delimiters-depth-1">)</span>

<span class="org-comment-delimiter">;;</span>
<span class="org-comment-delimiter">;; </span><span class="org-comment">This execution requires 5 stack frames</span>
<span class="org-comment-delimiter">;;</span>
<span class="org-comment-delimiter">;;  </span><span class="org-comment">(factorial 5)</span>
<span class="org-comment-delimiter">;;  </span><span class="org-comment">(* 5 (factorial 4))</span>
<span class="org-comment-delimiter">;;  </span><span class="org-comment">(* 5 (* 4 (factorial 3)))</span>
<span class="org-comment-delimiter">;;  </span><span class="org-comment">(* 5 (* 4 (3 * (factorial 2))))</span>
<span class="org-comment-delimiter">;;  </span><span class="org-comment">(* 5 (* 4 (* 3 (factorial 2))))</span>
<span class="org-comment-delimiter">;;  </span><span class="org-comment">(* 5 (* 4 (* 3 (* 2 (factorial 1)))))</span>
<span class="org-comment-delimiter">;;</span>
<span class="org-comment-delimiter">;;  </span><span class="org-comment">(* 5 (* 4 (* 3 (* 2 1))))</span>
<span class="org-comment-delimiter">;;  </span><span class="org-comment">(* 5 (* 4 (* 3 2)))</span>
<span class="org-comment-delimiter">;;  </span><span class="org-comment">(* 5 (* 4 6))</span>
<span class="org-comment-delimiter">;;  </span><span class="org-comment">(* 5 24)</span>
<span class="org-comment-delimiter">;;  </span><span class="org-comment">120</span>
<span class="org-comment-delimiter">;;</span>
<span class="org-comment-delimiter">;;</span>
<span class="org-comment-delimiter">;;</span>
<span class="org-comment-delimiter">;;</span>
&gt; ,trace <span class="org-rainbow-delimiters-depth-1">(</span>factorial 5<span class="org-rainbow-delimiters-depth-1">)</span>
<span class="org-function-name">trace</span>: <span class="org-string">|  (#&lt;procedure 99450c0&gt; #(#&lt;directory (guile-user) 95c3630&gt; &#8230;))</span>
<span class="org-string">trace: |</span>  #<span class="org-rainbow-delimiters-depth-1">(</span>#&lt;directory <span class="org-rainbow-delimiters-depth-2">(</span>guile-user<span class="org-rainbow-delimiters-depth-2">)</span> 95c3630&gt; factorial<span class="org-rainbow-delimiters-depth-1">)</span>
<span class="org-function-name">trace</span>: <span class="org-rainbow-delimiters-depth-1">(</span>#&lt;procedure 9953350 at &lt;current input&gt;:8:7 <span class="org-rainbow-delimiters-depth-2">()</span>&gt;<span class="org-rainbow-delimiters-depth-1">)</span>
<span class="org-function-name">trace</span>: <span class="org-rainbow-delimiters-depth-1">(</span>factorial 5<span class="org-rainbow-delimiters-depth-1">)</span>
<span class="org-function-name">trace</span>: <span class="org-string">|  (factorial 4)</span>
<span class="org-string">trace: |</span>  <span class="org-string">|  (factorial 3)</span>
<span class="org-string">trace: |</span>  <span class="org-string">|  |</span>  <span class="org-rainbow-delimiters-depth-1">(</span>factorial 2<span class="org-rainbow-delimiters-depth-1">)</span>
<span class="org-function-name">trace</span>: <span class="org-string">|  |</span>  <span class="org-string">|  |</span>  <span class="org-rainbow-delimiters-depth-1">(</span>factorial 1<span class="org-rainbow-delimiters-depth-1">)</span>
<span class="org-function-name">trace</span>: <span class="org-string">|  |</span>  <span class="org-string">|  |</span>  1
<span class="org-function-name">trace</span>: <span class="org-string">|  |</span>  <span class="org-string">|  2</span>
<span class="org-string">trace: |</span>  <span class="org-string">|  6</span>
<span class="org-string">trace: |</span>  24
<span class="org-function-name">trace</span>: 120
&gt; 

<span class="org-comment-delimiter">;;</span>
<span class="org-comment-delimiter">;; </span><span class="org-comment">It requires 10 stack frames</span>
<span class="org-comment-delimiter">;;</span>
<span class="org-comment-delimiter">;;        </span>
&gt; ,trace <span class="org-rainbow-delimiters-depth-1">(</span>factorial 10<span class="org-rainbow-delimiters-depth-1">)</span>
<span class="org-function-name">trace</span>: <span class="org-string">|  (#&lt;procedure 985cbd0&gt; #(#&lt;directory (guile-user) 95c3630&gt; &#8230;))</span>
<span class="org-string">trace: |</span>  #<span class="org-rainbow-delimiters-depth-1">(</span>#&lt;directory <span class="org-rainbow-delimiters-depth-2">(</span>guile-user<span class="org-rainbow-delimiters-depth-2">)</span> 95c3630&gt; factorial<span class="org-rainbow-delimiters-depth-1">)</span>
<span class="org-function-name">trace</span>: <span class="org-rainbow-delimiters-depth-1">(</span>#&lt;procedure 9880800 at &lt;current input&gt;:6:7 <span class="org-rainbow-delimiters-depth-2">()</span>&gt;<span class="org-rainbow-delimiters-depth-1">)</span>
<span class="org-function-name">trace</span>: <span class="org-rainbow-delimiters-depth-1">(</span>factorial 10<span class="org-rainbow-delimiters-depth-1">)</span>
<span class="org-function-name">trace</span>: <span class="org-string">|  (factorial 9)</span>
<span class="org-string">trace: |</span>  <span class="org-string">|  (factorial 8)</span>
<span class="org-string">trace: |</span>  <span class="org-string">|  |</span>  <span class="org-rainbow-delimiters-depth-1">(</span>factorial 7<span class="org-rainbow-delimiters-depth-1">)</span>
<span class="org-function-name">trace</span>: <span class="org-string">|  |</span>  <span class="org-string">|  |</span>  <span class="org-rainbow-delimiters-depth-1">(</span>factorial 6<span class="org-rainbow-delimiters-depth-1">)</span>
<span class="org-function-name">trace</span>: <span class="org-string">|  |</span>  <span class="org-string">|  |</span>  <span class="org-string">|  (factorial 5)</span>
<span class="org-string">trace: |</span>  <span class="org-string">|  |</span>  <span class="org-string">|  |</span>  <span class="org-string">|  (factorial 4)</span>
<span class="org-string">trace: |</span>  <span class="org-string">|  |</span>  <span class="org-string">|  |</span>  <span class="org-string">|  |</span>  <span class="org-rainbow-delimiters-depth-1">(</span>factorial 3<span class="org-rainbow-delimiters-depth-1">)</span>
<span class="org-function-name">trace</span>: <span class="org-string">|  |</span>  <span class="org-string">|  |</span>  <span class="org-string">|  |</span>  <span class="org-string">|  |</span>  <span class="org-rainbow-delimiters-depth-1">(</span>factorial 2<span class="org-rainbow-delimiters-depth-1">)</span>
<span class="org-function-name">trace</span>: <span class="org-string">|  |</span>  <span class="org-string">|  |</span>  <span class="org-string">|  |</span>  <span class="org-string">|  |</span>  <span class="org-string">|  (factorial 1)</span>
<span class="org-string">trace: |</span>  <span class="org-string">|  |</span>  <span class="org-string">|  |</span>  <span class="org-string">|  |</span>  <span class="org-string">|  |</span>  1
<span class="org-function-name">trace</span>: <span class="org-string">|  |</span>  <span class="org-string">|  |</span>  <span class="org-string">|  |</span>  <span class="org-string">|  |</span>  2
<span class="org-function-name">trace</span>: <span class="org-string">|  |</span>  <span class="org-string">|  |</span>  <span class="org-string">|  |</span>  <span class="org-string">|  6</span>
<span class="org-string">trace: |</span>  <span class="org-string">|  |</span>  <span class="org-string">|  |</span>  <span class="org-string">|  24</span>
<span class="org-string">trace: |</span>  <span class="org-string">|  |</span>  <span class="org-string">|  |</span>  120
<span class="org-function-name">trace</span>: <span class="org-string">|  |</span>  <span class="org-string">|  |</span>  720
<span class="org-function-name">trace</span>: <span class="org-string">|  |</span>  <span class="org-string">|  5040</span>
<span class="org-string">trace: |</span>  <span class="org-string">|  40320</span>
<span class="org-string">trace: |</span>  362880
<span class="org-function-name">trace</span>: 3628800
&gt;
</pre>
</div>

<p>
This function can be converted to a tail recursive function by using
an accumulator:
</p>

<div class="org-src-container">

<pre class="src src-scheme"><span class="org-rainbow-delimiters-depth-1">(</span><span class="org-keyword">define</span> <span class="org-rainbow-delimiters-depth-2">(</span><span class="org-function-name">factorial-aux</span> n acc<span class="org-rainbow-delimiters-depth-2">)</span>
    <span class="org-rainbow-delimiters-depth-2">(</span><span class="org-keyword">if</span> <span class="org-rainbow-delimiters-depth-3">(</span><span class="org-keyword">or</span> <span class="org-rainbow-delimiters-depth-4">(</span>= n 0<span class="org-rainbow-delimiters-depth-4">)</span> <span class="org-rainbow-delimiters-depth-4">(</span>= n 1<span class="org-rainbow-delimiters-depth-4">)</span><span class="org-rainbow-delimiters-depth-3">)</span>
        acc
        <span class="org-rainbow-delimiters-depth-3">(</span>factorial-aux <span class="org-rainbow-delimiters-depth-4">(</span>- n 1<span class="org-rainbow-delimiters-depth-4">)</span> <span class="org-rainbow-delimiters-depth-4">(</span>* n acc<span class="org-rainbow-delimiters-depth-4">)</span><span class="org-rainbow-delimiters-depth-3">)</span><span class="org-rainbow-delimiters-depth-2">)</span><span class="org-rainbow-delimiters-depth-1">)</span>

&gt; <span class="org-rainbow-delimiters-depth-1">(</span>factorial-aux 6 1<span class="org-rainbow-delimiters-depth-1">)</span>
$1 = 720

&gt; ,trace <span class="org-rainbow-delimiters-depth-1">(</span>factorial-aux 6 1<span class="org-rainbow-delimiters-depth-1">)</span>
<span class="org-function-name">trace</span>: <span class="org-string">|  (#&lt;procedure 9becf10&gt; #(#&lt;directory (guile-user) 984c630&gt; &#8230;))</span>
<span class="org-string">trace: |</span>  #<span class="org-rainbow-delimiters-depth-1">(</span>#&lt;directory <span class="org-rainbow-delimiters-depth-2">(</span>guile-user<span class="org-rainbow-delimiters-depth-2">)</span> 984c630&gt; factorial-aux<span class="org-rainbow-delimiters-depth-1">)</span>
<span class="org-function-name">trace</span>: <span class="org-rainbow-delimiters-depth-1">(</span>#&lt;procedure 9bec320 at &lt;current input&gt;:26:7 <span class="org-rainbow-delimiters-depth-2">()</span>&gt;<span class="org-rainbow-delimiters-depth-1">)</span>
<span class="org-function-name">trace</span>: <span class="org-rainbow-delimiters-depth-1">(</span>factorial-aux 6 1<span class="org-rainbow-delimiters-depth-1">)</span>
<span class="org-function-name">trace</span>: <span class="org-rainbow-delimiters-depth-1">(</span>factorial-aux 5 6<span class="org-rainbow-delimiters-depth-1">)</span>
<span class="org-function-name">trace</span>: <span class="org-rainbow-delimiters-depth-1">(</span>factorial-aux 4 30<span class="org-rainbow-delimiters-depth-1">)</span>
<span class="org-function-name">trace</span>: <span class="org-rainbow-delimiters-depth-1">(</span>factorial-aux 3 120<span class="org-rainbow-delimiters-depth-1">)</span>
<span class="org-function-name">trace</span>: <span class="org-rainbow-delimiters-depth-1">(</span>factorial-aux 2 360<span class="org-rainbow-delimiters-depth-1">)</span>
<span class="org-function-name">trace</span>: <span class="org-rainbow-delimiters-depth-1">(</span>factorial-aux 1 720<span class="org-rainbow-delimiters-depth-1">)</span>
<span class="org-function-name">trace</span>: 720
scheme@<span class="org-rainbow-delimiters-depth-1">(</span>guile-user<span class="org-rainbow-delimiters-depth-1">)</span>&gt; 

&gt; <span class="org-rainbow-delimiters-depth-1">(</span><span class="org-keyword">define</span> <span class="org-rainbow-delimiters-depth-2">(</span><span class="org-function-name">factorial2</span> n<span class="org-rainbow-delimiters-depth-2">)</span> <span class="org-rainbow-delimiters-depth-2">(</span>factorial-aux n 1<span class="org-rainbow-delimiters-depth-2">)</span><span class="org-rainbow-delimiters-depth-1">)</span>

scheme@<span class="org-rainbow-delimiters-depth-1">(</span>guile-user<span class="org-rainbow-delimiters-depth-1">)</span>&gt; <span class="org-rainbow-delimiters-depth-1">(</span>factorial2 5<span class="org-rainbow-delimiters-depth-1">)</span>
$3 = 120

<span class="org-comment-delimiter">;; </span><span class="org-comment">This function could also be implemented in this way:</span>
<span class="org-comment-delimiter">;;</span>
<span class="org-comment-delimiter">;;</span>
<span class="org-rainbow-delimiters-depth-1">(</span><span class="org-keyword">define</span> <span class="org-rainbow-delimiters-depth-2">(</span><span class="org-function-name">factorial3</span> n<span class="org-rainbow-delimiters-depth-2">)</span> 
    <span class="org-rainbow-delimiters-depth-2">(</span><span class="org-keyword">define</span> <span class="org-rainbow-delimiters-depth-3">(</span><span class="org-function-name">factorial-aux</span> n acc<span class="org-rainbow-delimiters-depth-3">)</span>
        <span class="org-rainbow-delimiters-depth-3">(</span><span class="org-keyword">if</span> <span class="org-rainbow-delimiters-depth-4">(</span><span class="org-keyword">or</span> <span class="org-rainbow-delimiters-depth-5">(</span>= n 0<span class="org-rainbow-delimiters-depth-5">)</span> <span class="org-rainbow-delimiters-depth-5">(</span>= n 1<span class="org-rainbow-delimiters-depth-5">)</span><span class="org-rainbow-delimiters-depth-4">)</span>
            acc
            <span class="org-rainbow-delimiters-depth-4">(</span>factorial-aux <span class="org-rainbow-delimiters-depth-5">(</span>- n 1<span class="org-rainbow-delimiters-depth-5">)</span> <span class="org-rainbow-delimiters-depth-5">(</span>* n acc<span class="org-rainbow-delimiters-depth-5">)</span><span class="org-rainbow-delimiters-depth-4">)</span><span class="org-rainbow-delimiters-depth-3">)</span><span class="org-rainbow-delimiters-depth-2">)</span>        
    <span class="org-rainbow-delimiters-depth-2">(</span>factorial-aux n 1<span class="org-rainbow-delimiters-depth-2">)</span><span class="org-rainbow-delimiters-depth-1">)</span>

&gt; <span class="org-rainbow-delimiters-depth-1">(</span>factorial3 6<span class="org-rainbow-delimiters-depth-1">)</span>
$4 = 720

&gt; <span class="org-rainbow-delimiters-depth-1">(</span>factorial3 5<span class="org-rainbow-delimiters-depth-1">)</span>
$5 = 120
</pre>
</div>

<p>
Example: Summation of a range of numbers:
</p>

<div class="org-src-container">

<pre class="src src-scheme"><span class="org-comment-delimiter">;;  </span><span class="org-comment">Non tail recursive function:</span>
<span class="org-comment-delimiter">;;</span>
<span class="org-rainbow-delimiters-depth-1">(</span><span class="org-keyword">define</span> <span class="org-rainbow-delimiters-depth-2">(</span><span class="org-function-name">sum-ints</span> a b<span class="org-rainbow-delimiters-depth-2">)</span>
    <span class="org-rainbow-delimiters-depth-2">(</span><span class="org-keyword">if</span> <span class="org-rainbow-delimiters-depth-3">(</span>&gt; a b<span class="org-rainbow-delimiters-depth-3">)</span>
        0
        <span class="org-rainbow-delimiters-depth-3">(</span>+ a <span class="org-rainbow-delimiters-depth-4">(</span>sum-ints <span class="org-rainbow-delimiters-depth-5">(</span>+ a 1<span class="org-rainbow-delimiters-depth-5">)</span> b<span class="org-rainbow-delimiters-depth-4">)</span><span class="org-rainbow-delimiters-depth-3">)</span><span class="org-rainbow-delimiters-depth-2">)</span><span class="org-rainbow-delimiters-depth-1">)</span>


<span class="org-comment-delimiter">;;</span>
<span class="org-comment-delimiter">;; </span><span class="org-comment">Using the trace command is possible to notice the growing amount of</span>
<span class="org-comment-delimiter">;; </span><span class="org-comment">stack frame In this case it requires 11 stack frames.</span>

&gt; ,trace <span class="org-rainbow-delimiters-depth-1">(</span>sum-ints 1 10<span class="org-rainbow-delimiters-depth-1">)</span>
<span class="org-function-name">trace</span>: <span class="org-string">|  (#&lt;procedure 9c42420&gt; #(#&lt;directory (guile-user) 984c630&gt; &#8230;))</span>
<span class="org-string">trace: |</span>  #<span class="org-rainbow-delimiters-depth-1">(</span>#&lt;directory <span class="org-rainbow-delimiters-depth-2">(</span>guile-user<span class="org-rainbow-delimiters-depth-2">)</span> 984c630&gt; sum-ints<span class="org-rainbow-delimiters-depth-1">)</span>
<span class="org-function-name">trace</span>: <span class="org-rainbow-delimiters-depth-1">(</span>#&lt;procedure 9c4b8c0 at &lt;current input&gt;:56:7 <span class="org-rainbow-delimiters-depth-2">()</span>&gt;<span class="org-rainbow-delimiters-depth-1">)</span>
<span class="org-function-name">trace</span>: <span class="org-rainbow-delimiters-depth-1">(</span>sum-ints 1 10<span class="org-rainbow-delimiters-depth-1">)</span>
<span class="org-function-name">trace</span>: <span class="org-string">|  (sum-ints 2 10)</span>
<span class="org-string">trace: |</span>  <span class="org-string">|  (sum-ints 3 10)</span>
<span class="org-string">trace: |</span>  <span class="org-string">|  |</span>  <span class="org-rainbow-delimiters-depth-1">(</span>sum-ints 4 10<span class="org-rainbow-delimiters-depth-1">)</span>
<span class="org-function-name">trace</span>: <span class="org-string">|  |</span>  <span class="org-string">|  |</span>  <span class="org-rainbow-delimiters-depth-1">(</span>sum-ints 5 10<span class="org-rainbow-delimiters-depth-1">)</span>
<span class="org-function-name">trace</span>: <span class="org-string">|  |</span>  <span class="org-string">|  |</span>  <span class="org-string">|  (sum-ints 6 10)</span>
<span class="org-string">trace: |</span>  <span class="org-string">|  |</span>  <span class="org-string">|  |</span>  <span class="org-string">|  (sum-ints 7 10)</span>
<span class="org-string">trace: |</span>  <span class="org-string">|  |</span>  <span class="org-string">|  |</span>  <span class="org-string">|  |</span>  <span class="org-rainbow-delimiters-depth-1">(</span>sum-ints 8 10<span class="org-rainbow-delimiters-depth-1">)</span>
<span class="org-function-name">trace</span>: <span class="org-string">|  |</span>  <span class="org-string">|  |</span>  <span class="org-string">|  |</span>  <span class="org-string">|  |</span>  <span class="org-rainbow-delimiters-depth-1">(</span>sum-ints 9 10<span class="org-rainbow-delimiters-depth-1">)</span>
<span class="org-function-name">trace</span>: <span class="org-string">|  |</span>  <span class="org-string">|  |</span>  <span class="org-string">|  |</span>  <span class="org-string">|  |</span>  <span class="org-string">|  (sum-ints 10 10)</span>
<span class="org-string">trace: |</span>  <span class="org-string">|  |</span>  <span class="org-string">|  |</span>  <span class="org-string">|  |</span>  <span class="org-string">|  |</span>  <span class="org-string">|  (sum-ints 11 10)</span>
<span class="org-string">trace: |</span>  <span class="org-string">|  |</span>  <span class="org-string">|  |</span>  <span class="org-string">|  |</span>  <span class="org-string">|  |</span>  <span class="org-string">|  0</span>
<span class="org-string">trace: |</span>  <span class="org-string">|  |</span>  <span class="org-string">|  |</span>  <span class="org-string">|  |</span>  <span class="org-string">|  |</span>  10
<span class="org-function-name">trace</span>: <span class="org-string">|  |</span>  <span class="org-string">|  |</span>  <span class="org-string">|  |</span>  <span class="org-string">|  |</span>  19
<span class="org-function-name">trace</span>: <span class="org-string">|  |</span>  <span class="org-string">|  |</span>  <span class="org-string">|  |</span>  <span class="org-string">|  27</span>
<span class="org-string">trace: |</span>  <span class="org-string">|  |</span>  <span class="org-string">|  |</span>  <span class="org-string">|  34</span>
<span class="org-string">trace: |</span>  <span class="org-string">|  |</span>  <span class="org-string">|  |</span>  40
<span class="org-function-name">trace</span>: <span class="org-string">|  |</span>  <span class="org-string">|  |</span>  45
<span class="org-function-name">trace</span>: <span class="org-string">|  |</span>  <span class="org-string">|  49</span>
<span class="org-string">trace: |</span>  <span class="org-string">|  52</span>
<span class="org-string">trace: |</span>  54
<span class="org-function-name">trace</span>: 55


<span class="org-comment-delimiter">;;  </span><span class="org-comment">Stack Overflow Error</span>
<span class="org-comment-delimiter">;;</span>
&gt; <span class="org-rainbow-delimiters-depth-1">(</span>sum-ints 1 10000<span class="org-rainbow-delimiters-depth-1">)</span>
&gt; &lt;unnamed port&gt;:4:13: In procedure sum-ints:
&lt;unnamed port&gt;:4:13: Throw to key `vm-error' with args `<span class="org-rainbow-delimiters-depth-1">(</span>vm-run <span class="org-string">"VM: Stack overflow"</span> <span class="org-rainbow-delimiters-depth-2">()</span><span class="org-rainbow-delimiters-depth-1">)</span>'.

<span class="org-comment-delimiter">;; </span>
<span class="org-comment-delimiter">;; </span><span class="org-comment">Safe summation </span>
<span class="org-comment-delimiter">;;</span>
<span class="org-rainbow-delimiters-depth-1">(</span><span class="org-keyword">define</span> <span class="org-rainbow-delimiters-depth-2">(</span><span class="org-function-name">sum-ints-aux</span> a b acc<span class="org-rainbow-delimiters-depth-2">)</span>
    <span class="org-rainbow-delimiters-depth-2">(</span><span class="org-keyword">if</span> <span class="org-rainbow-delimiters-depth-3">(</span>&gt; a b<span class="org-rainbow-delimiters-depth-3">)</span>
        acc
        <span class="org-rainbow-delimiters-depth-3">(</span>sum-ints-aux <span class="org-rainbow-delimiters-depth-4">(</span>+ a 1<span class="org-rainbow-delimiters-depth-4">)</span> b <span class="org-rainbow-delimiters-depth-4">(</span>+ a acc<span class="org-rainbow-delimiters-depth-4">)</span><span class="org-rainbow-delimiters-depth-3">)</span><span class="org-rainbow-delimiters-depth-2">)</span><span class="org-rainbow-delimiters-depth-1">)</span>
    
<span class="org-rainbow-delimiters-depth-1">(</span><span class="org-keyword">define</span> <span class="org-rainbow-delimiters-depth-2">(</span><span class="org-function-name">sum-ints-aux</span> a b acc<span class="org-rainbow-delimiters-depth-2">)</span>
    <span class="org-rainbow-delimiters-depth-2">(</span><span class="org-keyword">if</span> <span class="org-rainbow-delimiters-depth-3">(</span>&gt; a b<span class="org-rainbow-delimiters-depth-3">)</span>
        acc
        <span class="org-rainbow-delimiters-depth-3">(</span>sum-ints-aux <span class="org-rainbow-delimiters-depth-4">(</span>+ a 1<span class="org-rainbow-delimiters-depth-4">)</span> b <span class="org-rainbow-delimiters-depth-4">(</span>+ a acc<span class="org-rainbow-delimiters-depth-4">)</span><span class="org-rainbow-delimiters-depth-3">)</span><span class="org-rainbow-delimiters-depth-2">)</span><span class="org-rainbow-delimiters-depth-1">)</span>
    
&gt; <span class="org-rainbow-delimiters-depth-1">(</span>sum-ints-aux 1 10 0<span class="org-rainbow-delimiters-depth-1">)</span>
$4 = 55
&gt; 

&gt; <span class="org-rainbow-delimiters-depth-1">(</span>sum-ints-aux 1 10000 0<span class="org-rainbow-delimiters-depth-1">)</span>
$6 = 50005000

<span class="org-comment-delimiter">;;</span>
<span class="org-comment-delimiter">;; </span><span class="org-comment">It uses only one stack frame each call</span>
<span class="org-comment-delimiter">;;</span>
&gt; ,trace <span class="org-rainbow-delimiters-depth-1">(</span>sum-ints-aux 1 10 0<span class="org-rainbow-delimiters-depth-1">)</span>
<span class="org-function-name">trace</span>: <span class="org-string">|  (#&lt;procedure 985a270&gt; #(#&lt;directory (guile-user) 93fd630&gt; &#8230;))</span>
<span class="org-string">trace: |</span>  #<span class="org-rainbow-delimiters-depth-1">(</span>#&lt;directory <span class="org-rainbow-delimiters-depth-2">(</span>guile-user<span class="org-rainbow-delimiters-depth-2">)</span> 93fd630&gt; sum-ints-aux<span class="org-rainbow-delimiters-depth-1">)</span>
<span class="org-function-name">trace</span>: <span class="org-rainbow-delimiters-depth-1">(</span>#&lt;procedure 98646a0 at &lt;current input&gt;:31:7 <span class="org-rainbow-delimiters-depth-2">()</span>&gt;<span class="org-rainbow-delimiters-depth-1">)</span>
<span class="org-function-name">trace</span>: <span class="org-rainbow-delimiters-depth-1">(</span>sum-ints-aux 1 10 0<span class="org-rainbow-delimiters-depth-1">)</span>
<span class="org-function-name">trace</span>: <span class="org-rainbow-delimiters-depth-1">(</span>sum-ints-aux 2 10 1<span class="org-rainbow-delimiters-depth-1">)</span>
<span class="org-function-name">trace</span>: <span class="org-rainbow-delimiters-depth-1">(</span>sum-ints-aux 3 10 3<span class="org-rainbow-delimiters-depth-1">)</span>
<span class="org-function-name">trace</span>: <span class="org-rainbow-delimiters-depth-1">(</span>sum-ints-aux 4 10 6<span class="org-rainbow-delimiters-depth-1">)</span>
<span class="org-function-name">trace</span>: <span class="org-rainbow-delimiters-depth-1">(</span>sum-ints-aux 5 10 10<span class="org-rainbow-delimiters-depth-1">)</span>
<span class="org-function-name">trace</span>: <span class="org-rainbow-delimiters-depth-1">(</span>sum-ints-aux 6 10 15<span class="org-rainbow-delimiters-depth-1">)</span>
<span class="org-function-name">trace</span>: <span class="org-rainbow-delimiters-depth-1">(</span>sum-ints-aux 7 10 21<span class="org-rainbow-delimiters-depth-1">)</span>
<span class="org-function-name">trace</span>: <span class="org-rainbow-delimiters-depth-1">(</span>sum-ints-aux 8 10 28<span class="org-rainbow-delimiters-depth-1">)</span>
<span class="org-function-name">trace</span>: <span class="org-rainbow-delimiters-depth-1">(</span>sum-ints-aux 9 10 36<span class="org-rainbow-delimiters-depth-1">)</span>
<span class="org-function-name">trace</span>: <span class="org-rainbow-delimiters-depth-1">(</span>sum-ints-aux 10 10 45<span class="org-rainbow-delimiters-depth-1">)</span>
<span class="org-function-name">trace</span>: <span class="org-rainbow-delimiters-depth-1">(</span>sum-ints-aux 11 10 55<span class="org-rainbow-delimiters-depth-1">)</span>
<span class="org-function-name">trace</span>: 55
&gt; 

<span class="org-comment-delimiter">;; </span><span class="org-comment">It can also be implemented in this way:</span>
<span class="org-comment-delimiter">;; </span>
<span class="org-rainbow-delimiters-depth-1">(</span><span class="org-keyword">define</span> <span class="org-rainbow-delimiters-depth-2">(</span><span class="org-function-name">sum-ints-safe</span> a b<span class="org-rainbow-delimiters-depth-2">)</span>
    <span class="org-rainbow-delimiters-depth-2">(</span><span class="org-keyword">define</span> <span class="org-rainbow-delimiters-depth-3">(</span><span class="org-function-name">sum-ints-aux</span> a b acc<span class="org-rainbow-delimiters-depth-3">)</span>
        <span class="org-rainbow-delimiters-depth-3">(</span><span class="org-keyword">if</span> <span class="org-rainbow-delimiters-depth-4">(</span>&gt; a b<span class="org-rainbow-delimiters-depth-4">)</span>
            acc
            <span class="org-rainbow-delimiters-depth-4">(</span>sum-ints-aux <span class="org-rainbow-delimiters-depth-5">(</span>+ a 1<span class="org-rainbow-delimiters-depth-5">)</span> b <span class="org-rainbow-delimiters-depth-5">(</span>+ a acc<span class="org-rainbow-delimiters-depth-5">)</span><span class="org-rainbow-delimiters-depth-4">)</span><span class="org-rainbow-delimiters-depth-3">)</span><span class="org-rainbow-delimiters-depth-2">)</span>    
    <span class="org-rainbow-delimiters-depth-2">(</span>sum-ints-aux a b 0<span class="org-rainbow-delimiters-depth-2">)</span><span class="org-rainbow-delimiters-depth-1">)</span>

&gt; scheme@<span class="org-rainbow-delimiters-depth-1">(</span>guile-user<span class="org-rainbow-delimiters-depth-1">)</span>&gt; <span class="org-rainbow-delimiters-depth-1">(</span>sum-ints-safe 1 1000<span class="org-rainbow-delimiters-depth-1">)</span>
$2 = 500500


&gt; <span class="org-rainbow-delimiters-depth-1">(</span>sum-ints-safe 1 10000<span class="org-rainbow-delimiters-depth-1">)</span>
$7 = 50005000

&gt;  <span class="org-rainbow-delimiters-depth-1">(</span>sum-ints-safe 1 100000<span class="org-rainbow-delimiters-depth-1">)</span>
$8 = 5000050000
scheme@<span class="org-rainbow-delimiters-depth-1">(</span>guile-user<span class="org-rainbow-delimiters-depth-1">)</span>&gt;
</pre>
</div>

<p>
Example: of summation in a language without TCO: python  
</p>

<div class="org-src-container">

<pre class="src src-python"><span class="org-keyword">def</span> <span class="org-function-name">sum_ints_aux</span> (a, b, acc):
    <span class="org-keyword">if</span> a &gt; b:
       <span class="org-keyword">return</span> acc 
    <span class="org-keyword">else</span>:
       <span class="org-keyword">return</span> sum_ints_aux (a + 1, b, a + acc)

 <span class="org-comment-delimiter"># </span><span class="org-comment">Until now works </span>
&gt;&gt;&gt; 
&gt;&gt;&gt; sum_ints_aux(1, 10, 0)
55
&gt;&gt;&gt; sum_ints_aux(1, 100, 0)
5050

 <span class="org-comment-delimiter"># </span><span class="org-comment">Now it is going to fail: Stack Overflow!</span>

&gt;&gt;&gt; sum_ints_aux(1, 1000, 0)
Traceback (most recent call last):
  File <span class="org-string">"&lt;stdin&gt;"</span>, line 1, <span class="org-keyword">in</span> &lt;module&gt;
  File <span class="org-string">"&lt;stdin&gt;"</span>, line 5, <span class="org-keyword">in</span> sum_ints_aux
  File <span class="org-string">"&lt;stdin&gt;"</span>, line 5, <span class="org-keyword">in</span> sum_ints_aux
...
  File <span class="org-string">"&lt;stdin&gt;"</span>, line 5, <span class="org-keyword">in</span> sum_ints_aux
  File <span class="org-string">"&lt;stdin&gt;"</span>, line 2, <span class="org-keyword">in</span> sum_ints_aux
<span class="org-function-name">RuntimeError</span>: maximum recursion depth exceeded <span class="org-keyword">in</span> comparison
&gt;&gt;&gt; 

<span class="org-comment-delimiter">#  </span><span class="org-comment">Solution: Turn the recursion into a loop:</span>
<span class="org-comment-delimiter"># </span>
<span class="org-keyword">def</span> <span class="org-function-name">sum_ints</span> (a, b):
    <span class="org-variable-name">x</span>  = a 
    <span class="org-variable-name">acc</span> = 0

    <span class="org-keyword">while</span> x &lt; b:

        <span class="org-variable-name">x</span> = x + 1
        <span class="org-variable-name">acc</span> = acc + x 
           
    <span class="org-keyword">return</span> acc + 1
    
&gt;&gt; sum_ints (1, 1000)
    500500

&gt;&gt; sum_ints (1, 10000)
    50005000
</pre>
</div>


<p>
Example: Implementing map with tail recursion. 
</p>

<div class="org-src-container">

<pre class="src src-scheme"><span class="org-rainbow-delimiters-depth-1">(</span><span class="org-keyword">define</span> <span class="org-rainbow-delimiters-depth-2">(</span><span class="org-function-name">map2</span> f xs<span class="org-rainbow-delimiters-depth-2">)</span>
   <span class="org-rainbow-delimiters-depth-2">(</span><span class="org-keyword">if</span> <span class="org-rainbow-delimiters-depth-3">(</span>null? xs<span class="org-rainbow-delimiters-depth-3">)</span>
       '<span class="org-rainbow-delimiters-depth-3">()</span> 
        <span class="org-rainbow-delimiters-depth-3">(</span>cons  <span class="org-rainbow-delimiters-depth-4">(</span>f <span class="org-rainbow-delimiters-depth-5">(</span>car xs<span class="org-rainbow-delimiters-depth-5">)</span><span class="org-rainbow-delimiters-depth-4">)</span> 
               <span class="org-rainbow-delimiters-depth-4">(</span>map2 f <span class="org-rainbow-delimiters-depth-5">(</span>cdr xs<span class="org-rainbow-delimiters-depth-5">)</span><span class="org-rainbow-delimiters-depth-4">)</span><span class="org-rainbow-delimiters-depth-3">)</span><span class="org-rainbow-delimiters-depth-2">)</span><span class="org-rainbow-delimiters-depth-1">)</span>


<span class="org-rainbow-delimiters-depth-1">(</span><span class="org-keyword">define</span> <span class="org-rainbow-delimiters-depth-2">(</span><span class="org-function-name">inc</span> x<span class="org-rainbow-delimiters-depth-2">)</span> <span class="org-rainbow-delimiters-depth-2">(</span>+ x 1<span class="org-rainbow-delimiters-depth-2">)</span><span class="org-rainbow-delimiters-depth-1">)</span>


<span class="org-comment-delimiter">;; </span><span class="org-comment">It will eventually lead to an stack overflow for a big list. </span>
<span class="org-comment-delimiter">;;</span>
&gt; ,trace <span class="org-rainbow-delimiters-depth-1">(</span>map2 inc '<span class="org-rainbow-delimiters-depth-2">(</span>1 2 3<span class="org-rainbow-delimiters-depth-2">)</span><span class="org-rainbow-delimiters-depth-1">)</span>
<span class="org-function-name">trace</span>: <span class="org-string">|  (#&lt;procedure 9e14500&gt; #(#&lt;directory (guile-user) 984c630&gt; &#8230;))</span>
<span class="org-string">trace: |</span>  #<span class="org-rainbow-delimiters-depth-1">(</span>#&lt;directory <span class="org-rainbow-delimiters-depth-2">(</span>guile-user<span class="org-rainbow-delimiters-depth-2">)</span> 984c630&gt; map2 inc <span class="org-rainbow-delimiters-depth-2">(</span>1 2 3<span class="org-rainbow-delimiters-depth-2">)</span><span class="org-rainbow-delimiters-depth-1">)</span>
<span class="org-function-name">trace</span>: <span class="org-rainbow-delimiters-depth-1">(</span>#&lt;procedure 9e48360 at &lt;current input&gt;:109:7 <span class="org-rainbow-delimiters-depth-2">()</span>&gt;<span class="org-rainbow-delimiters-depth-1">)</span>
<span class="org-function-name">trace</span>: <span class="org-rainbow-delimiters-depth-1">(</span>map2 #&lt;procedure inc <span class="org-rainbow-delimiters-depth-2">(</span>x<span class="org-rainbow-delimiters-depth-2">)</span>&gt; <span class="org-rainbow-delimiters-depth-2">(</span>1 2 3<span class="org-rainbow-delimiters-depth-2">)</span><span class="org-rainbow-delimiters-depth-1">)</span>
<span class="org-function-name">trace</span>: <span class="org-string">|  (inc 1)</span>
<span class="org-string">trace: |</span>  2
<span class="org-function-name">trace</span>: <span class="org-string">|  (map2 #&lt;procedure inc (x)&gt; (2 3))</span>
<span class="org-string">trace: |</span>  <span class="org-string">|  (inc 2)</span>
<span class="org-string">trace: |</span>  <span class="org-string">|  3</span>
<span class="org-string">trace: |</span>  <span class="org-string">|  (map2 #&lt;procedure inc (x)&gt; (3))</span>
<span class="org-string">trace: |</span>  <span class="org-string">|  |</span>  <span class="org-rainbow-delimiters-depth-1">(</span>inc 3<span class="org-rainbow-delimiters-depth-1">)</span>
<span class="org-function-name">trace</span>: <span class="org-string">|  |</span>  <span class="org-string">|  4</span>
<span class="org-string">trace: |</span>  <span class="org-string">|  |</span>  <span class="org-rainbow-delimiters-depth-1">(</span>map2 #&lt;procedure inc <span class="org-rainbow-delimiters-depth-2">(</span>x<span class="org-rainbow-delimiters-depth-2">)</span>&gt; <span class="org-rainbow-delimiters-depth-2">()</span><span class="org-rainbow-delimiters-depth-1">)</span>
<span class="org-function-name">trace</span>: <span class="org-string">|  |</span>  <span class="org-string">|  ()</span>
<span class="org-string">trace: |</span>  <span class="org-string">|  (4)</span>
<span class="org-string">trace: |</span>  <span class="org-rainbow-delimiters-depth-1">(</span>3 4<span class="org-rainbow-delimiters-depth-1">)</span>
<span class="org-function-name">trace</span>: <span class="org-rainbow-delimiters-depth-1">(</span>2 3 4<span class="org-rainbow-delimiters-depth-1">)</span>



,trace <span class="org-rainbow-delimiters-depth-1">(</span>map2 inc '<span class="org-rainbow-delimiters-depth-2">(</span>1 2 3 4 5 6 7 8 9<span class="org-rainbow-delimiters-depth-2">)</span><span class="org-rainbow-delimiters-depth-1">)</span>
<span class="org-function-name">trace</span>: <span class="org-string">|  (#&lt;procedure 9cdcb00&gt; #(#&lt;directory (guile-user) 984c630&gt; &#8230;))</span>
<span class="org-string">trace: |</span>  #<span class="org-rainbow-delimiters-depth-1">(</span>#&lt;directory <span class="org-rainbow-delimiters-depth-2">(</span>guile-user<span class="org-rainbow-delimiters-depth-2">)</span> 984c630&gt; map2 inc <span class="org-rainbow-delimiters-depth-2">(</span>1 2 3 4 5 6 &#8230;<span class="org-rainbow-delimiters-depth-2">)</span><span class="org-rainbow-delimiters-depth-1">)</span>
<span class="org-function-name">trace</span>: <span class="org-rainbow-delimiters-depth-1">(</span>#&lt;procedure 9ceebf0 at &lt;current input&gt;:104:7 <span class="org-rainbow-delimiters-depth-2">()</span>&gt;<span class="org-rainbow-delimiters-depth-1">)</span>
<span class="org-function-name">trace</span>: <span class="org-rainbow-delimiters-depth-1">(</span>map2 #&lt;procedure inc <span class="org-rainbow-delimiters-depth-2">(</span>x<span class="org-rainbow-delimiters-depth-2">)</span>&gt; <span class="org-rainbow-delimiters-depth-2">(</span>1 2 3 4 5 6 7 8 9<span class="org-rainbow-delimiters-depth-2">)</span><span class="org-rainbow-delimiters-depth-1">)</span>
<span class="org-function-name">trace</span>: <span class="org-string">|  (inc 1)</span>
<span class="org-string">trace: |</span>  2
<span class="org-function-name">trace</span>: <span class="org-string">|  (map2 #&lt;procedure inc (x)&gt; (2 3 4 5 6 7 8 9))</span>
<span class="org-string">trace: |</span>  <span class="org-string">|  (inc 2)</span>
<span class="org-string">trace: |</span>  <span class="org-string">|  3</span>
<span class="org-string">trace: |</span>  <span class="org-string">|  (map2 #&lt;procedure inc (x)&gt; (3 4 5 6 7 8 9))</span>
<span class="org-string">trace: |</span>  <span class="org-string">|  |</span>  <span class="org-rainbow-delimiters-depth-1">(</span>inc 3<span class="org-rainbow-delimiters-depth-1">)</span>
<span class="org-function-name">trace</span>: <span class="org-string">|  |</span>  <span class="org-string">|  4</span>
<span class="org-string">trace: |</span>  <span class="org-string">|  |</span>  <span class="org-rainbow-delimiters-depth-1">(</span>map2 #&lt;procedure inc <span class="org-rainbow-delimiters-depth-2">(</span>x<span class="org-rainbow-delimiters-depth-2">)</span>&gt; <span class="org-rainbow-delimiters-depth-2">(</span>4 5 6 7 8 9<span class="org-rainbow-delimiters-depth-2">)</span><span class="org-rainbow-delimiters-depth-1">)</span>
<span class="org-function-name">trace</span>: <span class="org-string">|  |</span>  <span class="org-string">|  |</span>  <span class="org-rainbow-delimiters-depth-1">(</span>inc 4<span class="org-rainbow-delimiters-depth-1">)</span>
<span class="org-function-name">trace</span>: <span class="org-string">|  |</span>  <span class="org-string">|  |</span>  5
<span class="org-function-name">trace</span>: <span class="org-string">|  |</span>  <span class="org-string">|  |</span>  <span class="org-rainbow-delimiters-depth-1">(</span>map2 #&lt;procedure inc <span class="org-rainbow-delimiters-depth-2">(</span>x<span class="org-rainbow-delimiters-depth-2">)</span>&gt; <span class="org-rainbow-delimiters-depth-2">(</span>5 6 7 8 9<span class="org-rainbow-delimiters-depth-2">)</span><span class="org-rainbow-delimiters-depth-1">)</span>
<span class="org-function-name">trace</span>: <span class="org-string">|  |</span>  <span class="org-string">|  |</span>  <span class="org-string">|  (inc 5)</span>
<span class="org-string">trace: |</span>  <span class="org-string">|  |</span>  <span class="org-string">|  |</span>  6
<span class="org-function-name">trace</span>: <span class="org-string">|  |</span>  <span class="org-string">|  |</span>  <span class="org-string">|  (map2 #&lt;procedure inc (x)&gt; (6 7 8 9))</span>
<span class="org-string">trace: |</span>  <span class="org-string">|  |</span>  <span class="org-string">|  |</span>  <span class="org-string">|  (inc 6)</span>
<span class="org-string">trace: |</span>  <span class="org-string">|  |</span>  <span class="org-string">|  |</span>  <span class="org-string">|  7</span>
<span class="org-string">trace: |</span>  <span class="org-string">|  |</span>  <span class="org-string">|  |</span>  <span class="org-string">|  (map2 #&lt;procedure inc (x)&gt; (7 8 9))</span>
<span class="org-string">trace: |</span>  <span class="org-string">|  |</span>  <span class="org-string">|  |</span>  <span class="org-string">|  |</span>  <span class="org-rainbow-delimiters-depth-1">(</span>inc 7<span class="org-rainbow-delimiters-depth-1">)</span>
<span class="org-function-name">trace</span>: <span class="org-string">|  |</span>  <span class="org-string">|  |</span>  <span class="org-string">|  |</span>  <span class="org-string">|  8</span>
<span class="org-string">trace: |</span>  <span class="org-string">|  |</span>  <span class="org-string">|  |</span>  <span class="org-string">|  |</span>  <span class="org-rainbow-delimiters-depth-1">(</span>map2 #&lt;procedure inc <span class="org-rainbow-delimiters-depth-2">(</span>x<span class="org-rainbow-delimiters-depth-2">)</span>&gt; <span class="org-rainbow-delimiters-depth-2">(</span>8 9<span class="org-rainbow-delimiters-depth-2">)</span><span class="org-rainbow-delimiters-depth-1">)</span>
<span class="org-function-name">trace</span>: <span class="org-string">|  |</span>  <span class="org-string">|  |</span>  <span class="org-string">|  |</span>  <span class="org-string">|  |</span>  <span class="org-rainbow-delimiters-depth-1">(</span>inc 8<span class="org-rainbow-delimiters-depth-1">)</span>
<span class="org-function-name">trace</span>: <span class="org-string">|  |</span>  <span class="org-string">|  |</span>  <span class="org-string">|  |</span>  <span class="org-string">|  |</span>  9
<span class="org-function-name">trace</span>: <span class="org-string">|  |</span>  <span class="org-string">|  |</span>  <span class="org-string">|  |</span>  <span class="org-string">|  |</span>  <span class="org-rainbow-delimiters-depth-1">(</span>map2 #&lt;procedure inc <span class="org-rainbow-delimiters-depth-2">(</span>x<span class="org-rainbow-delimiters-depth-2">)</span>&gt; <span class="org-rainbow-delimiters-depth-2">(</span>9<span class="org-rainbow-delimiters-depth-2">)</span><span class="org-rainbow-delimiters-depth-1">)</span>
<span class="org-function-name">trace</span>: <span class="org-string">|  |</span>  <span class="org-string">|  |</span>  <span class="org-string">|  |</span>  <span class="org-string">|  |</span>  <span class="org-string">|  (inc 9)</span>
<span class="org-string">trace: |</span>  <span class="org-string">|  |</span>  <span class="org-string">|  |</span>  <span class="org-string">|  |</span>  <span class="org-string">|  |</span>  10
<span class="org-function-name">trace</span>: <span class="org-string">|  |</span>  <span class="org-string">|  |</span>  <span class="org-string">|  |</span>  <span class="org-string">|  |</span>  <span class="org-string">|  (map2 #&lt;procedure inc (x)&gt; ())</span>
<span class="org-string">trace: |</span>  <span class="org-string">|  |</span>  <span class="org-string">|  |</span>  <span class="org-string">|  |</span>  <span class="org-string">|  |</span>  <span class="org-rainbow-delimiters-depth-1">()</span>
<span class="org-function-name">trace</span>: <span class="org-string">|  |</span>  <span class="org-string">|  |</span>  <span class="org-string">|  |</span>  <span class="org-string">|  |</span>  <span class="org-rainbow-delimiters-depth-1">(</span>10<span class="org-rainbow-delimiters-depth-1">)</span>
<span class="org-function-name">trace</span>: <span class="org-string">|  |</span>  <span class="org-string">|  |</span>  <span class="org-string">|  |</span>  <span class="org-string">|  (9 10)</span>
<span class="org-string">trace: |</span>  <span class="org-string">|  |</span>  <span class="org-string">|  |</span>  <span class="org-string">|  (8 9 10)</span>
<span class="org-string">trace: |</span>  <span class="org-string">|  |</span>  <span class="org-string">|  |</span>  <span class="org-rainbow-delimiters-depth-1">(</span>7 8 9 10<span class="org-rainbow-delimiters-depth-1">)</span>
<span class="org-function-name">trace</span>: <span class="org-string">|  |</span>  <span class="org-string">|  |</span>  <span class="org-rainbow-delimiters-depth-1">(</span>6 7 8 9 10<span class="org-rainbow-delimiters-depth-1">)</span>
<span class="org-function-name">trace</span>: <span class="org-string">|  |</span>  <span class="org-string">|  (5 6 7 8 9 10)</span>
<span class="org-string">trace: |</span>  <span class="org-string">|  (4 5 6 7 8 9 10)</span>
<span class="org-string">trace: |</span>  <span class="org-rainbow-delimiters-depth-1">(</span>3 4 5 6 7 8 9 10<span class="org-rainbow-delimiters-depth-1">)</span>
<span class="org-function-name">trace</span>: <span class="org-rainbow-delimiters-depth-1">(</span>2 3 4 5 6 7 8 9 10<span class="org-rainbow-delimiters-depth-1">)</span>


<span class="org-rainbow-delimiters-depth-1">(</span><span class="org-keyword">define</span> <span class="org-rainbow-delimiters-depth-2">(</span><span class="org-function-name">map-aux</span> f xs acc<span class="org-rainbow-delimiters-depth-2">)</span> 

    <span class="org-rainbow-delimiters-depth-2">(</span><span class="org-keyword">if</span> <span class="org-rainbow-delimiters-depth-3">(</span>null? xs<span class="org-rainbow-delimiters-depth-3">)</span>

        <span class="org-rainbow-delimiters-depth-3">(</span>reverse acc<span class="org-rainbow-delimiters-depth-3">)</span>

        <span class="org-rainbow-delimiters-depth-3">(</span>map-aux f 
                 <span class="org-rainbow-delimiters-depth-4">(</span>cdr xs<span class="org-rainbow-delimiters-depth-4">)</span>
                 <span class="org-rainbow-delimiters-depth-4">(</span>cons <span class="org-rainbow-delimiters-depth-5">(</span>f <span class="org-rainbow-delimiters-depth-6">(</span>car xs<span class="org-rainbow-delimiters-depth-6">)</span><span class="org-rainbow-delimiters-depth-5">)</span> 
                       acc<span class="org-rainbow-delimiters-depth-4">)</span>
        <span class="org-rainbow-delimiters-depth-3">)</span>
      <span class="org-rainbow-delimiters-depth-2">)</span>
     <span class="org-rainbow-delimiters-depth-1">)</span> 
 
&gt; ,trace <span class="org-rainbow-delimiters-depth-1">(</span>map-aux inc '<span class="org-rainbow-delimiters-depth-2">(</span>1 2 3 4 5<span class="org-rainbow-delimiters-depth-2">)</span> '<span class="org-rainbow-delimiters-depth-2">()</span><span class="org-rainbow-delimiters-depth-1">)</span>
<span class="org-function-name">trace</span>: <span class="org-string">|  (#&lt;procedure 9e0c420&gt; #(#&lt;directory (guile-user) 984c630&gt; &#8230;))</span>
<span class="org-string">trace: |</span>  #<span class="org-rainbow-delimiters-depth-1">(</span>#&lt;directory <span class="org-rainbow-delimiters-depth-2">(</span>guile-user<span class="org-rainbow-delimiters-depth-2">)</span> 984c630&gt; map-aux inc <span class="org-rainbow-delimiters-depth-2">(</span>1 2 3 4 5<span class="org-rainbow-delimiters-depth-2">)</span><span class="org-rainbow-delimiters-depth-1">)</span>
<span class="org-function-name">trace</span>: <span class="org-rainbow-delimiters-depth-1">(</span>#&lt;procedure 9e4c070 at &lt;current input&gt;:180:7 <span class="org-rainbow-delimiters-depth-2">()</span>&gt;<span class="org-rainbow-delimiters-depth-1">)</span>
<span class="org-function-name">trace</span>: <span class="org-rainbow-delimiters-depth-1">(</span>map-aux #&lt;procedure inc <span class="org-rainbow-delimiters-depth-2">(</span>x<span class="org-rainbow-delimiters-depth-2">)</span>&gt; <span class="org-rainbow-delimiters-depth-2">(</span>1 2 3 4 5<span class="org-rainbow-delimiters-depth-2">)</span> <span class="org-rainbow-delimiters-depth-2">()</span><span class="org-rainbow-delimiters-depth-1">)</span>
<span class="org-function-name">trace</span>: <span class="org-string">|  (inc 1)</span>
<span class="org-string">trace: |</span>  2
<span class="org-function-name">trace</span>: <span class="org-rainbow-delimiters-depth-1">(</span>map-aux #&lt;procedure inc <span class="org-rainbow-delimiters-depth-2">(</span>x<span class="org-rainbow-delimiters-depth-2">)</span>&gt; <span class="org-rainbow-delimiters-depth-2">(</span>2 3 4 5<span class="org-rainbow-delimiters-depth-2">)</span> <span class="org-rainbow-delimiters-depth-2">(</span>2<span class="org-rainbow-delimiters-depth-2">)</span><span class="org-rainbow-delimiters-depth-1">)</span>
<span class="org-function-name">trace</span>: <span class="org-string">|  (inc 2)</span>
<span class="org-string">trace: |</span>  3
<span class="org-function-name">trace</span>: <span class="org-rainbow-delimiters-depth-1">(</span>map-aux #&lt;procedure inc <span class="org-rainbow-delimiters-depth-2">(</span>x<span class="org-rainbow-delimiters-depth-2">)</span>&gt; <span class="org-rainbow-delimiters-depth-2">(</span>3 4 5<span class="org-rainbow-delimiters-depth-2">)</span> <span class="org-rainbow-delimiters-depth-2">(</span>3 2<span class="org-rainbow-delimiters-depth-2">)</span><span class="org-rainbow-delimiters-depth-1">)</span>
<span class="org-function-name">trace</span>: <span class="org-string">|  (inc 3)</span>
<span class="org-string">trace: |</span>  4
<span class="org-function-name">trace</span>: <span class="org-rainbow-delimiters-depth-1">(</span>map-aux #&lt;procedure inc <span class="org-rainbow-delimiters-depth-2">(</span>x<span class="org-rainbow-delimiters-depth-2">)</span>&gt; <span class="org-rainbow-delimiters-depth-2">(</span>4 5<span class="org-rainbow-delimiters-depth-2">)</span> <span class="org-rainbow-delimiters-depth-2">(</span>4 3 2<span class="org-rainbow-delimiters-depth-2">)</span><span class="org-rainbow-delimiters-depth-1">)</span>
<span class="org-function-name">trace</span>: <span class="org-string">|  (inc 4)</span>
<span class="org-string">trace: |</span>  5
<span class="org-function-name">trace</span>: <span class="org-rainbow-delimiters-depth-1">(</span>map-aux #&lt;procedure inc <span class="org-rainbow-delimiters-depth-2">(</span>x<span class="org-rainbow-delimiters-depth-2">)</span>&gt; <span class="org-rainbow-delimiters-depth-2">(</span>5<span class="org-rainbow-delimiters-depth-2">)</span> <span class="org-rainbow-delimiters-depth-2">(</span>5 4 3 2<span class="org-rainbow-delimiters-depth-2">)</span><span class="org-rainbow-delimiters-depth-1">)</span>
<span class="org-function-name">trace</span>: <span class="org-string">|  (inc 5)</span>
<span class="org-string">trace: |</span>  6
<span class="org-function-name">trace</span>: <span class="org-rainbow-delimiters-depth-1">(</span>map-aux #&lt;procedure inc <span class="org-rainbow-delimiters-depth-2">(</span>x<span class="org-rainbow-delimiters-depth-2">)</span>&gt; <span class="org-rainbow-delimiters-depth-2">()</span> <span class="org-rainbow-delimiters-depth-2">(</span>6 5 4 3 2<span class="org-rainbow-delimiters-depth-2">)</span><span class="org-rainbow-delimiters-depth-1">)</span>
<span class="org-function-name">trace</span>: <span class="org-rainbow-delimiters-depth-1">(</span>reverse <span class="org-rainbow-delimiters-depth-2">(</span>6 5 4 3 2<span class="org-rainbow-delimiters-depth-2">)</span><span class="org-rainbow-delimiters-depth-1">)</span>
<span class="org-function-name">trace</span>: <span class="org-rainbow-delimiters-depth-1">(</span>2 3 4 5 6<span class="org-rainbow-delimiters-depth-1">)</span>

<span class="org-comment-delimiter">;; </span><span class="org-comment">Finally </span>
<span class="org-comment-delimiter">;; </span>

<span class="org-rainbow-delimiters-depth-1">(</span><span class="org-keyword">define</span> <span class="org-rainbow-delimiters-depth-2">(</span><span class="org-function-name">map-safe</span> f xs<span class="org-rainbow-delimiters-depth-2">)</span>
        <span class="org-rainbow-delimiters-depth-2">(</span>map-aux f xs '<span class="org-rainbow-delimiters-depth-3">()</span><span class="org-rainbow-delimiters-depth-2">)</span><span class="org-rainbow-delimiters-depth-1">)</span>

&gt; <span class="org-rainbow-delimiters-depth-1">(</span>map-safe inc '<span class="org-rainbow-delimiters-depth-2">(</span>1 2 3 3 4 5<span class="org-rainbow-delimiters-depth-2">)</span><span class="org-rainbow-delimiters-depth-1">)</span>
$14 = <span class="org-rainbow-delimiters-depth-1">(</span>2 3 4 4 5 6<span class="org-rainbow-delimiters-depth-1">)</span>
</pre>
</div>

<p>
Example in F#:
</p>

<div class="org-src-container">

<pre class="src src-fsharp">&gt; <span class="org-keyword">let</span> <span class="org-function-name">inc</span> x = x +  1 ;;

<span class="org-keyword">val</span> <span class="org-variable-name">inc</span> : <span class="org-type">x:int </span>-&gt; int

<span class="org-keyword">let</span> <span class="org-keyword">rec</span> <span class="org-function-name">map_aux</span> <span class="org-variable-name">f</span> <span class="org-variable-name">xs</span> <span class="org-variable-name">acc</span> =
    <span class="org-keyword">match</span> xs <span class="org-keyword">with</span> 
    | []    -&gt;  List.rev acc 
    | hd::tl -&gt;  map_aux f tl ((f hd)::acc)
;;

<span class="org-keyword">val</span> <span class="org-variable-name">map_aux</span> : <span class="org-type">f:('a </span>-&gt; 'b) -&gt; xs:'a list -&gt; acc:'b list -&gt; 'b list

&gt; map_aux inc [1; 2; 3; 4; 5] [] ;;
<span class="org-keyword">val</span> <span class="org-variable-name">it</span> : <span class="org-type">int list </span>= [2; 3; 4; 5; 6]

<span class="org-keyword">let</span> <span class="org-function-name">map2</span> <span class="org-variable-name">f</span> <span class="org-variable-name">xs</span> = 
    map_aux f xs [] ;;

<span class="org-keyword">val</span> <span class="org-variable-name">map2</span> : <span class="org-type">f:('a </span>-&gt; 'b) -&gt; xs:'a list -&gt; 'b list

&gt; map2 inc [1; 2; 3; 4; 5] ;;
<span class="org-keyword">val</span> <span class="org-variable-name">it</span> : <span class="org-type">int list </span>= [2; 3; 4; 5; 6]
&gt; 

<span class="org-comment-delimiter">//  </span><span class="org-comment">map_aux without pattern matching </span>
<span class="org-comment-delimiter">// </span>
<span class="org-keyword">let</span> <span class="org-keyword">rec</span> <span class="org-function-name">map_aux</span> <span class="org-variable-name">f</span> <span class="org-variable-name">xs</span> <span class="org-variable-name">acc</span> =
    <span class="org-keyword">if</span> List.isEmpty xs 
    <span class="org-keyword">then</span>  List.rev acc 
    <span class="org-keyword">else</span> (<span class="org-keyword">let</span> hd, tl = (List.head xs, List.tail xs) <span class="org-keyword">in</span> 
        map_aux f tl ((f hd)::acc))
;;

<span class="org-keyword">val</span> <span class="org-variable-name">map_aux</span> : <span class="org-type">f:('a </span>-&gt; 'b) -&gt; xs:'a list -&gt; acc:'b list -&gt; 'b list

&gt;  map2 inc [1; 2; 3; 4; 5] ;;
<span class="org-keyword">val</span> <span class="org-variable-name">it</span> : <span class="org-type">int list </span>= [2; 3; 4; 5; 6]
&gt; 

<span class="org-comment-delimiter">//  </span><span class="org-comment">Another way:</span>
<span class="org-comment-delimiter">//  </span>
<span class="org-comment-delimiter">//</span>
<span class="org-keyword">let</span> <span class="org-function-name">map3</span>  <span class="org-variable-name">f</span> <span class="org-variable-name">xs</span> = 
  
    <span class="org-keyword">let</span> <span class="org-keyword">rec</span> <span class="org-function-name">map_aux</span> <span class="org-variable-name">f</span> <span class="org-variable-name">xs</span> <span class="org-variable-name">acc</span> =
        <span class="org-keyword">match</span> xs <span class="org-keyword">with</span> 
        | []    -&gt;  List.rev acc 
        | hd::tl -&gt;  map_aux f tl ((f hd)::acc)
    
    <span class="org-keyword">in</span> map_aux f xs [] 

;;

<span class="org-keyword">val</span> <span class="org-variable-name">map3</span> : <span class="org-type">f:('a </span>-&gt; 'b) -&gt; xs:'a list -&gt; 'b list

&gt; map3 inc [1; 2; 3; 4; 5; 6] ;;
<span class="org-keyword">val</span> <span class="org-variable-name">it</span> : <span class="org-type">int list </span>= [2; 3; 4; 5; 6; 7]
&gt;
</pre>
</div>

<p>
Example: Tail recursive filter function.
</p>

<div class="org-src-container">

<pre class="src src-fsharp"><span class="org-keyword">let</span> <span class="org-keyword">rec</span> <span class="org-function-name">filter_aux</span> <span class="org-variable-name">f</span> <span class="org-variable-name">xs</span> <span class="org-variable-name">acc</span> = 
    <span class="org-keyword">match</span> xs <span class="org-keyword">with</span> 
    | []      -&gt;  List.rev acc 
    | hd::tl  -&gt;  <span class="org-keyword">if</span> (f hd) 
                  <span class="org-keyword">then</span>  filter_aux f tl (hd::acc)
                  <span class="org-keyword">else</span>  filter_aux f tl acc
;;

<span class="org-keyword">val</span> <span class="org-variable-name">filter_aux</span> : <span class="org-type">f:('a </span>-&gt; bool) -&gt; xs:'a list -&gt; acc:'a list -&gt; 'a list

&gt; filter_aux (<span class="org-keyword">fun</span> <span class="org-variable-name">x</span> -&gt; x % 2 = 0) [1; 2; 3; 4; 5; 6; 7; 8] [] ;;
<span class="org-keyword">val</span> <span class="org-variable-name">it</span> : <span class="org-type">int list </span>= [2; 4; 6; 8]
&gt; 

<span class="org-keyword">let</span> <span class="org-function-name">filter</span> <span class="org-variable-name">f</span> <span class="org-variable-name">xs</span> = 
    filter_aux f xs [] 
;;
<span class="org-keyword">val</span> <span class="org-variable-name">filter</span> : <span class="org-type">f:('a </span>-&gt; bool) -&gt; xs:'a list -&gt; 'a list

&gt; filter (<span class="org-keyword">fun</span> <span class="org-variable-name">x</span> -&gt; x % 2 = 0) [1; 2; 3; 4; 5; 6; 7; 8] ;;    
<span class="org-keyword">val</span> <span class="org-variable-name">it</span> : <span class="org-type">int list </span>= [2; 4; 6; 8]
&gt;
</pre>
</div>
</div>
</div>

<div id="outline-container-sec-1-9-5" class="outline-4">
<h4 id="sec-1-9-5"><span class="section-number-4">1.9.5</span> See also</h4>
<div class="outline-text-4" id="text-1-9-5">
<ul class="org-ul">
<li><a href="https://en.wikipedia.org/wiki/Tail_call">Tail call - Wikipedia, the free encyclopedia</a>
</li>

<li><a href="https://spin.atomicobject.com/2014/11/05/tail-call-recursion-optimization/">Optimizing Tail Call Recursion</a>
</li>

<li><a href="http://raganwald.com/2013/03/28/trampolines-in-javascript.html">Trampolines in JavaScript</a>
</li>

<li><a href="https://taylodl.wordpress.com/2013/06/07/functional-javascript-tail-call-optimization-and-trampolines/">Functional JavaScript â€“ Tail Call Optimization and Trampolines | @taylodl's getting IT done</a>
</li>

<li><a href="http://stackoverflow.com/questions/3616483/why-does-the-jvm-still-not-support-tail-call-optimization">java - Why does the JVM still not support tail-call optimization? - Stack Overflow</a>
</li>

<li><a href="http://scienceblogs.com/goodmath/2006/12/20/tail-recursion-iteration-in-ha-1/">Tail Recursion: Iteration in Haskell â€“ Good Math, Bad Math</a>
</li>

<li><a href="http://everything.explained.today/Tail_call/">Tail call explained</a>
</li>

<li><a href="http://users.dsic.upv.es/~jsilva/papers/TechReport-iter2rec.pdf">Automatic Transformation of Iterative Loops into Recursive Methods</a>
</li>

<li><a href="http://richardminerich.com/2011/02/the-road-to-functional-programming-in-f-from-imperative-to-computation-expressions/">The Road to Functional Programming in F# â€“ From Imperative to Computation Expressions Â« Inviting Epiphany</a>
</li>

<li><a href="https://blogs.janestreet.com/optimizing-list-map/">Optimizing List.map - Jane Street Tech Blogs</a>
</li>
</ul>
</div>
</div>
</div>
<div id="outline-container-sec-1-10" class="outline-3">
<h3 id="sec-1-10"><span class="section-number-3">1.10</span> Fundamental Higher Order Functions</h3>
<div class="outline-text-3" id="text-1-10">
</div><div id="outline-container-sec-1-10-1" class="outline-4">
<h4 id="sec-1-10-1"><span class="section-number-4">1.10.1</span> Overview</h4>
<div class="outline-text-4" id="text-1-10-1">
<p>
The functions map, filter and reduce (fold left) are ubiquitous in
many programming languages and also the most used higher order
functions.
</p>

<p>
They can be strict evaluated like in Scheme and JavaScript or lazy
evaluated like in Python and Haskell.
</p>
</div>
</div>

<div id="outline-container-sec-1-10-2" class="outline-4">
<h4 id="sec-1-10-2"><span class="section-number-4">1.10.2</span> Map</h4>
<div class="outline-text-4" id="text-1-10-2">
</div><ol class="org-ol"><li><a id="sec-1-10-2-0-1" name="sec-1-10-2-0-1"></a>Overview<br  /><div class="outline-text-6" id="text-1-10-2-0-1">
<p>
The function map applies a function to each element of a sequence:
list, vector, hash map or dictionary and trees. 
</p>

<pre class="example">
    map :: ( a -&gt; b) -&gt; [a] -&gt; [b]                
                |
                |
                |----&gt; f :: a -&gt; b
                
    
    
             f :: a -&gt; b
     a   ------------------------&gt;&gt;&gt;  b
    
    
           map f :: [a] -&gt; [b]                    
    [a] -------------------------&gt;&gt;&gt; [b]
</pre>
</div>
</li>

<li><a id="sec-1-10-2-0-2" name="sec-1-10-2-0-2"></a>Map in Haskell<br  /><div class="outline-text-6" id="text-1-10-2-0-2">
<p>
The function map is lazy evaluated.
</p>

<div class="org-src-container">

<pre class="src src-haskell"><span class="org-haskell-operator">&gt;</span> <span class="org-haskell-keyword">let</span> fun1 x <span class="org-haskell-operator">=</span> 3 <span class="org-haskell-operator">*</span> x <span class="org-haskell-operator">+</span> 1
<span class="org-haskell-operator">&gt;</span> <span class="org-haskell-definition">fun1</span> 2
7
<span class="org-haskell-operator">&gt;</span> <span class="org-haskell-definition">map</span> fun1 [1<span class="org-haskell-operator">,</span> 2<span class="org-haskell-operator">,</span> 3]
[4<span class="org-haskell-operator">,</span>7<span class="org-haskell-operator">,</span>10]
<span class="org-haskell-operator">&gt;</span> 

  <span class="org-comment-delimiter">-- </span><span class="org-comment">The sequence 1 to 1000000 is not evaluated at all, </span>
  <span class="org-comment-delimiter">--</span>
<span class="org-haskell-operator">&gt;</span> <span class="org-haskell-definition">take</span> 10 (map fun1 [1<span class="org-haskell-operator">..</span>1000000])
[4<span class="org-haskell-operator">,</span>7<span class="org-haskell-operator">,</span>10<span class="org-haskell-operator">,</span>13<span class="org-haskell-operator">,</span>16<span class="org-haskell-operator">,</span>19<span class="org-haskell-operator">,</span>22<span class="org-haskell-operator">,</span>25<span class="org-haskell-operator">,</span>28<span class="org-haskell-operator">,</span>31]

<span class="org-haskell-operator">&gt;</span> <span class="org-haskell-definition">take</span> 10 (map fun1 [1<span class="org-haskell-operator">..</span>10000000000])
[4<span class="org-haskell-operator">,</span>7<span class="org-haskell-operator">,</span>10<span class="org-haskell-operator">,</span>13<span class="org-haskell-operator">,</span>16<span class="org-haskell-operator">,</span>19<span class="org-haskell-operator">,</span>22<span class="org-haskell-operator">,</span>25<span class="org-haskell-operator">,</span>28<span class="org-haskell-operator">,</span>31]
<span class="org-haskell-operator">&gt;</span> 
<span class="org-haskell-operator">&gt;</span> 



 <span class="org-comment-delimiter">-- </span>
 <span class="org-comment-delimiter">-- </span><span class="org-comment">When applied to a function without a list, it creates </span>
 <span class="org-comment-delimiter">-- </span><span class="org-comment">another function that operates over lists because all</span>
 <span class="org-comment-delimiter">-- </span><span class="org-comment">Haskell functions are curried by default.</span>
 <span class="org-comment-delimiter">--</span>
 <span class="org-comment-delimiter">--         </span><span class="org-comment">f :: (a -&gt; b)</span>
 <span class="org-comment-delimiter">--  </span><span class="org-comment">map    :: (a -&gt; b) -&gt; [a] -&gt; [b]</span>
 <span class="org-comment-delimiter">--</span>
 <span class="org-comment-delimiter">-- </span><span class="org-comment">It can be seen as:</span>
 <span class="org-comment-delimiter">--</span>
 <span class="org-comment-delimiter">--  </span><span class="org-comment">When map is applied to f, it will create the function fs</span>
 <span class="org-comment-delimiter">--  </span><span class="org-comment">that take list of type a and returns list of type b.</span>
 <span class="org-comment-delimiter">--</span>
 <span class="org-comment-delimiter">--  </span><span class="org-comment">map    :: (a -&gt; b) -&gt; ([a] -&gt; [b])</span>
 <span class="org-comment-delimiter">--                </span><span class="org-comment">|            |</span>
 <span class="org-comment-delimiter">--                </span><span class="org-comment">|            |------ fs :: [a] -&gt; [b] </span>
 <span class="org-comment-delimiter">--                </span><span class="org-comment">|    </span>
 <span class="org-comment-delimiter">--                </span><span class="org-comment">-------------------- f  :: a -&gt; b </span>
 <span class="org-comment-delimiter">--</span>
<span class="org-haskell-operator">&gt;</span> <span class="org-haskell-constructor">:</span>t map
<span class="org-function-name">map</span> <span class="org-haskell-operator">::</span> (a <span class="org-haskell-operator">-&gt;</span> b) <span class="org-haskell-operator">-&gt;</span> [a] <span class="org-haskell-operator">-&gt;</span> [b]
  
<span class="org-haskell-operator">&gt;</span> <span class="org-haskell-keyword">let</span> f x <span class="org-haskell-operator">=</span> 3 <span class="org-haskell-operator">*</span> x <span class="org-haskell-operator">+</span> 6
<span class="org-haskell-operator">&gt;</span> <span class="org-haskell-constructor">:</span>t f
<span class="org-function-name">f</span> <span class="org-haskell-operator">::</span> <span class="org-haskell-constructor">Num</span> a <span class="org-haskell-operator">=&gt;</span> a <span class="org-haskell-operator">-&gt;</span> a
<span class="org-haskell-operator">&gt;</span> 


<span class="org-haskell-operator">&gt;</span> <span class="org-haskell-definition">map</span> f [1<span class="org-haskell-operator">,</span> 2<span class="org-haskell-operator">,</span> 3]
[9<span class="org-haskell-operator">,</span>12<span class="org-haskell-operator">,</span>15]
<span class="org-haskell-operator">&gt;</span> 

 <span class="org-comment-delimiter">-- </span><span class="org-comment">Note: let is only needed in the REPL</span>
 <span class="org-comment-delimiter">--</span>
<span class="org-haskell-operator">&gt;</span> <span class="org-haskell-keyword">let</span> fs <span class="org-haskell-operator">=</span> map f

<span class="org-haskell-operator">&gt;</span> <span class="org-haskell-constructor">:</span>t fs
<span class="org-function-name">fs</span> <span class="org-haskell-operator">::</span> [<span class="org-haskell-constructor">Integer</span>] <span class="org-haskell-operator">-&gt;</span> [<span class="org-haskell-constructor">Integer</span>]

<span class="org-haskell-operator">&gt;</span> <span class="org-haskell-definition">fs</span> [1<span class="org-haskell-operator">,</span> 2<span class="org-haskell-operator">,</span> 3]
[9<span class="org-haskell-operator">,</span>12<span class="org-haskell-operator">,</span>15]
<span class="org-haskell-operator">&gt;</span>
</pre>
</div>
</div>
</li>

<li><a id="sec-1-10-2-0-3" name="sec-1-10-2-0-3"></a>Map in Python<br  /><div class="outline-text-6" id="text-1-10-2-0-3">
<p>
In Python 3 map and filter are lazy evaluated, they return a
generator. 
</p>

<div class="org-src-container">

<pre class="src src-python">&gt;&gt;&gt; <span class="org-keyword">def</span> <span class="org-function-name">fun1</span> (x):
    <span class="org-keyword">return</span> 3*x + 6
... 
&gt;&gt;&gt; <span class="org-variable-name">g</span> = <span class="org-builtin">map</span>(fun1, [1, 2, 3])
&gt;&gt;&gt; g
&lt;<span class="org-builtin">map</span> <span class="org-builtin">object</span> at 0xb6b4a76c&gt;
&gt;&gt;&gt; <span class="org-builtin">next</span> (g)
9
&gt;&gt;&gt; <span class="org-builtin">next</span> (g)
12
&gt;&gt;&gt; <span class="org-builtin">next</span> (g)
15
&gt;&gt;&gt; <span class="org-builtin">next</span> (g)
Traceback (most recent call last):
  File <span class="org-string">"&lt;stdin&gt;"</span>, line 1, <span class="org-keyword">in</span> &lt;module&gt;
<span class="org-type">StopIteration</span>
&gt;&gt;&gt; g
&lt;<span class="org-builtin">map</span> <span class="org-builtin">object</span> at 0xb6b4a76c&gt;
&gt;&gt;&gt; 

 <span class="org-comment-delimiter"># </span><span class="org-comment">Force the evaluation: </span>
 <span class="org-comment-delimiter">#</span>
 &gt;&gt;&gt; <span class="org-builtin">list</span>(<span class="org-builtin">map</span>(fun1, [1, 2, 3]))
 [9, 12, 15]


 <span class="org-comment-delimiter"># </span><span class="org-comment">Strict Version of map</span>
 <span class="org-comment-delimiter"># </span>
 <span class="org-comment-delimiter"># </span><span class="org-comment">s_ stands for strict map.</span>

<span class="org-keyword">def</span> <span class="org-function-name">s_map</span> (f, xs):
    <span class="org-keyword">return</span> <span class="org-builtin">list</span>(<span class="org-builtin">map</span>(f, xs))
 
&gt;&gt;&gt; s_map (fun1, [1, 2, 3])
[9, 12, 15]
&gt;&gt;&gt; 

 <span class="org-comment-delimiter"># </span><span class="org-comment">As python doesn't have tail call optimization  </span>
 <span class="org-comment-delimiter"># </span><span class="org-comment">therefore recursion must be avoided because </span>
 <span class="org-comment-delimiter"># </span><span class="org-comment">a big number of function calls </span>
 <span class="org-comment-delimiter"># </span><span class="org-comment">can lead to stack overflow.</span>
 
<span class="org-keyword">def</span> <span class="org-function-name">strict_map</span> (f, xs):
    <span class="org-keyword">return</span> [f (x) <span class="org-keyword">for</span> x <span class="org-keyword">in</span> xs]
    
&gt;&gt;&gt; strict_map (fun1, [1, 2, 3])
[9, 12, 15]
&gt;&gt;&gt; strict_map (fun1, <span class="org-builtin">range</span>(5))
[6, 9, 12, 15, 18]
&gt;&gt;&gt; 

  <span class="org-comment-delimiter"># </span><span class="org-comment">Lazy map implementation:</span>
  <span class="org-comment-delimiter"># </span><span class="org-comment">Note: the python native map is implemented in C, so</span>
  <span class="org-comment-delimiter"># </span><span class="org-comment">it is faster.</span>
  <span class="org-comment-delimiter">#</span>
  
<span class="org-keyword">def</span> <span class="org-function-name">lazy_map</span> (f, xs):
    <span class="org-keyword">for</span> x <span class="org-keyword">in</span> xs:
        <span class="org-keyword">yield</span> x
        
&gt;&gt;&gt; <span class="org-variable-name">g</span> = lazy_map (fun1, [1, 2, 3])
&gt;&gt;&gt; <span class="org-builtin">next</span>(g)
1
&gt;&gt;&gt; <span class="org-builtin">next</span>(g)
2
&gt;&gt;&gt; <span class="org-builtin">next</span>(g)
3
&gt;&gt;&gt; <span class="org-builtin">next</span>(g)
Traceback (most recent call last):
  File <span class="org-string">"&lt;stdin&gt;"</span>, line 1, <span class="org-keyword">in</span> &lt;module&gt;
<span class="org-type">StopIteration</span>
&gt;&gt;&gt; <span class="org-builtin">list</span>(lazy_map (fun1, [1, 2, 3]))
[1, 2, 3]
&gt;&gt;&gt;           

 <span class="org-comment-delimiter">#</span>
 <span class="org-comment-delimiter"># </span><span class="org-comment">In order for the map function work in the same way </span>
 <span class="org-comment-delimiter"># </span><span class="org-comment">as Haskell and ML it is must be curried.   </span>
 <span class="org-comment-delimiter">#</span>

<span class="org-variable-name">curry2</span> = <span class="org-keyword">lambda</span> f: <span class="org-keyword">lambda</span> x: <span class="org-keyword">lambda</span> y: f(x, y)

 <span class="org-comment-delimiter"># </span><span class="org-comment">The function curry2 currify a function of two arguments</span>
 <span class="org-comment-delimiter">#</span>
&gt;&gt;&gt; <span class="org-variable-name">strict_map_c</span> = curry2(strict_map) 

&gt;&gt;&gt; strict_map_c(fun1)
&lt;function &lt;<span class="org-keyword">lambda</span>&gt;.&lt;<span class="org-builtin">locals</span>&gt;.&lt;<span class="org-keyword">lambda</span>&gt;.&lt;<span class="org-builtin">locals</span>&gt;.&lt;<span class="org-keyword">lambda</span>&gt; at 0xb6afc0bc&gt;

&gt;&gt;&gt; strict_map_c(fun1)([1, 2, 3, 4])
[9, 12, 15, 18]
&gt;&gt;&gt; 

&gt;&gt;&gt; <span class="org-variable-name">fun1_xs</span> = strict_map_c(fun1)
&gt;&gt;&gt; fun1_xs ([1, 2, 3, 4])
[9, 12, 15, 18]
&gt;&gt;&gt;
</pre>
</div>
</div>
</li>

<li><a id="sec-1-10-2-0-4" name="sec-1-10-2-0-4"></a>Map in Dynamic Typed Languages<br  /><div class="outline-text-6" id="text-1-10-2-0-4">
<p>
In dynamic typed languages like Python, Clojure and Scheme the function map
can take multiple arguments. In typed languages the function 
takes only one argument.
</p>

<p>
Map in Python:
</p>

<div class="org-src-container">

<pre class="src src-python">&gt;&gt;&gt; <span class="org-builtin">list</span>(<span class="org-builtin">map</span> (<span class="org-keyword">lambda</span> a, b, c: 100 * a + 10 * b + c, [1, 2, 3, 4, 5], [8, 9, 10, 11, 12], [3, 4, 7, 8, 10]))
[183, 294, 407, 518, 630]
&gt;&gt;&gt;
</pre>
</div>


<p>
Map in Scheme: 
</p>

<div class="org-src-container">

<pre class="src src-scheme"><span class="org-rainbow-delimiters-depth-1">(</span><span class="org-keyword">map</span> <span class="org-rainbow-delimiters-depth-2">(</span><span class="org-keyword">lambda</span> <span class="org-rainbow-delimiters-depth-3">(</span>a b c<span class="org-rainbow-delimiters-depth-3">)</span> <span class="org-rainbow-delimiters-depth-3">(</span>+ <span class="org-rainbow-delimiters-depth-4">(</span>* 100 a<span class="org-rainbow-delimiters-depth-4">)</span> <span class="org-rainbow-delimiters-depth-4">(</span>* 10 b<span class="org-rainbow-delimiters-depth-4">)</span> c<span class="org-rainbow-delimiters-depth-3">)</span><span class="org-rainbow-delimiters-depth-2">)</span> 
      '<span class="org-rainbow-delimiters-depth-2">(</span>1 2 3 4 5<span class="org-rainbow-delimiters-depth-2">)</span> 
      '<span class="org-rainbow-delimiters-depth-2">(</span>8 9 10 11 12<span class="org-rainbow-delimiters-depth-2">)</span> 
      '<span class="org-rainbow-delimiters-depth-2">(</span>3 4 7 8 10<span class="org-rainbow-delimiters-depth-2">)</span><span class="org-rainbow-delimiters-depth-1">)</span>

$1 = <span class="org-rainbow-delimiters-depth-1">(</span>183 294 407 518 630<span class="org-rainbow-delimiters-depth-1">)</span>
</pre>
</div>

<p>
Map in Clojure:
</p>

<div class="org-src-container">

<pre class="src src-clojure"><span class="org-comment-delimiter">;; </span><span class="org-comment">f a b c = 100 * a + 10 * b + c</span>
<span class="org-comment-delimiter">;; </span>
<span class="org-comment-delimiter">;; </span><span class="org-comment">183 = f 1 8 3 </span>
<span class="org-comment-delimiter">;; </span><span class="org-comment">294 = f 2 9 4 </span>
<span class="org-comment-delimiter">;; </span><span class="org-comment">...</span>
<span class="org-comment-delimiter">;; </span><span class="org-comment">630 = f 6 3 0</span>
<span class="org-comment-delimiter">;;</span>
user=&gt; <span class="org-rainbow-delimiters-depth-1">(</span>map <span class="org-rainbow-delimiters-depth-2">(</span><span class="org-keyword">fn</span> <span class="org-rainbow-delimiters-depth-3">[</span>a b c<span class="org-rainbow-delimiters-depth-3">]</span> <span class="org-rainbow-delimiters-depth-3">(</span>+ <span class="org-rainbow-delimiters-depth-4">(</span>* 100 a<span class="org-rainbow-delimiters-depth-4">)</span> <span class="org-rainbow-delimiters-depth-4">(</span>* 10 b<span class="org-rainbow-delimiters-depth-4">)</span> c<span class="org-rainbow-delimiters-depth-3">)</span><span class="org-rainbow-delimiters-depth-2">)</span> <span class="org-rainbow-delimiters-depth-2">[</span>1 2 3 4 5<span class="org-rainbow-delimiters-depth-2">]</span> <span class="org-rainbow-delimiters-depth-2">[</span>8 9 10 11 12<span class="org-rainbow-delimiters-depth-2">]</span> <span class="org-rainbow-delimiters-depth-2">[</span>3 4 7 8 10<span class="org-rainbow-delimiters-depth-2">]</span><span class="org-rainbow-delimiters-depth-1">)</span>
<span class="org-rainbow-delimiters-depth-1">(</span>183 294 407 518 630<span class="org-rainbow-delimiters-depth-1">)</span>
user=&gt; 

<span class="org-comment-delimiter">;;</span>
<span class="org-comment-delimiter">;; </span><span class="org-comment">The Clojure map is Polymorphic it can be applied to any collection </span>
<span class="org-comment-delimiter">;; </span><span class="org-comment">of seq abstraction like lists, vectors and hash maps.</span>
<span class="org-comment-delimiter">;;</span>

<span class="org-comment-delimiter">;; </span><span class="org-comment">Map applied to a list  </span>
<span class="org-comment-delimiter">;;</span>
user=&gt; <span class="org-rainbow-delimiters-depth-1">(</span>map inc '<span class="org-rainbow-delimiters-depth-2">(</span>1 2 3 4 5 6<span class="org-rainbow-delimiters-depth-2">)</span><span class="org-rainbow-delimiters-depth-1">)</span>
<span class="org-rainbow-delimiters-depth-1">(</span>2 3 4 5 6 7<span class="org-rainbow-delimiters-depth-1">)</span>
user=&gt; 

<span class="org-comment-delimiter">;; </span><span class="org-comment">Map applied to a vector </span>
<span class="org-comment-delimiter">;;</span>
user=&gt; <span class="org-rainbow-delimiters-depth-1">(</span>map inc <span class="org-rainbow-delimiters-depth-2">[</span>1 2 3 4 5 6<span class="org-rainbow-delimiters-depth-2">]</span><span class="org-rainbow-delimiters-depth-1">)</span>
<span class="org-rainbow-delimiters-depth-1">(</span>2 3 4 5 6 7<span class="org-rainbow-delimiters-depth-1">)</span>
user=&gt; 

<span class="org-comment-delimiter">;; </span><span class="org-comment">Map applied to a hash map </span>
<span class="org-comment-delimiter">;;</span>
user=&gt; <span class="org-rainbow-delimiters-depth-1">(</span>map identity <span class="org-rainbow-delimiters-depth-2">{</span><span class="org-clojure-keyword">:a</span> 10 <span class="org-clojure-keyword">:b</span> 20 <span class="org-clojure-keyword">:c</span> <span class="org-string">"hello world"</span><span class="org-rainbow-delimiters-depth-2">}</span><span class="org-rainbow-delimiters-depth-1">)</span>
<span class="org-rainbow-delimiters-depth-1">(</span><span class="org-rainbow-delimiters-depth-2">[</span><span class="org-clojure-keyword">:a</span> 10<span class="org-rainbow-delimiters-depth-2">]</span> <span class="org-rainbow-delimiters-depth-2">[</span><span class="org-clojure-keyword">:b</span> 20<span class="org-rainbow-delimiters-depth-2">]</span> <span class="org-rainbow-delimiters-depth-2">[</span><span class="org-clojure-keyword">:c</span> <span class="org-string">"hello world"</span><span class="org-rainbow-delimiters-depth-2">]</span><span class="org-rainbow-delimiters-depth-1">)</span>
user=&gt; 

<span class="org-comment-delimiter">;; </span><span class="org-comment">The function mapv is similar to map, but returns a vector: </span>
<span class="org-comment-delimiter">;;</span>
user=&gt; <span class="org-rainbow-delimiters-depth-1">(</span>mapv identity <span class="org-rainbow-delimiters-depth-2">{</span><span class="org-clojure-keyword">:a</span> 10 <span class="org-clojure-keyword">:b</span> 20 <span class="org-clojure-keyword">:c</span> <span class="org-string">"hello world"</span><span class="org-rainbow-delimiters-depth-2">}</span><span class="org-rainbow-delimiters-depth-1">)</span>
<span class="org-rainbow-delimiters-depth-1">[</span><span class="org-rainbow-delimiters-depth-2">[</span><span class="org-clojure-keyword">:a</span> 10<span class="org-rainbow-delimiters-depth-2">]</span> <span class="org-rainbow-delimiters-depth-2">[</span><span class="org-clojure-keyword">:b</span> 20<span class="org-rainbow-delimiters-depth-2">]</span> <span class="org-rainbow-delimiters-depth-2">[</span><span class="org-clojure-keyword">:c</span> <span class="org-string">"hello world"</span><span class="org-rainbow-delimiters-depth-2">]</span><span class="org-rainbow-delimiters-depth-1">]</span>
user=&gt; 


<span class="org-comment-delimiter">;; </span><span class="org-comment">Clojure also has destructuring </span>
<span class="org-comment-delimiter">;;</span>
user=&gt; <span class="org-rainbow-delimiters-depth-1">(</span>map <span class="org-rainbow-delimiters-depth-2">(</span><span class="org-keyword">fn</span> <span class="org-rainbow-delimiters-depth-3">[</span><span class="org-rainbow-delimiters-depth-4">[</span><span class="org-rainbow-delimiters-depth-5">[</span>a b<span class="org-rainbow-delimiters-depth-5">]</span> c<span class="org-rainbow-delimiters-depth-4">]</span><span class="org-rainbow-delimiters-depth-3">]</span> <span class="org-rainbow-delimiters-depth-3">(</span>+ <span class="org-rainbow-delimiters-depth-4">(</span>* 100 a <span class="org-rainbow-delimiters-depth-4">)</span> <span class="org-rainbow-delimiters-depth-4">(</span>* 10 b<span class="org-rainbow-delimiters-depth-4">)</span> c<span class="org-rainbow-delimiters-depth-3">)</span><span class="org-rainbow-delimiters-depth-2">)</span>  <span class="org-rainbow-delimiters-depth-2">[</span><span class="org-rainbow-delimiters-depth-3">[</span><span class="org-rainbow-delimiters-depth-4">[</span>1 2<span class="org-rainbow-delimiters-depth-4">]</span> 3<span class="org-rainbow-delimiters-depth-3">]</span> <span class="org-rainbow-delimiters-depth-3">[</span><span class="org-rainbow-delimiters-depth-4">[</span>3 4<span class="org-rainbow-delimiters-depth-4">]</span> 5<span class="org-rainbow-delimiters-depth-3">]</span> <span class="org-rainbow-delimiters-depth-3">[</span><span class="org-rainbow-delimiters-depth-4">[</span>1 2<span class="org-rainbow-delimiters-depth-4">]</span> 4<span class="org-rainbow-delimiters-depth-3">]</span><span class="org-rainbow-delimiters-depth-2">]</span><span class="org-rainbow-delimiters-depth-1">)</span>
<span class="org-rainbow-delimiters-depth-1">(</span>123 345 124<span class="org-rainbow-delimiters-depth-1">)</span>
user=&gt;
</pre>
</div>
</div>
</li></ol>
</div>

<div id="outline-container-sec-1-10-3" class="outline-4">
<h4 id="sec-1-10-3"><span class="section-number-4">1.10.3</span> Filter</h4>
<div class="outline-text-4" id="text-1-10-3">
<p>
<b>Python</b>
</p>

<div class="org-src-container">

<pre class="src src-python"> ;;; Filter returns by default a 
&gt;&gt;&gt; <span class="org-variable-name">g</span> = <span class="org-builtin">filter</span> (<span class="org-keyword">lambda</span> x: x &gt; 10, [1, 20, 3, 40, 4, 14, 8])
&gt;&gt;&gt; g
&lt;<span class="org-builtin">filter</span> <span class="org-builtin">object</span> at 0xb6b4a58c&gt;
&gt;&gt;&gt; [x <span class="org-keyword">for</span> x <span class="org-keyword">in</span> g]
[20, 40, 14]
&gt;&gt;&gt; [x <span class="org-keyword">for</span> x <span class="org-keyword">in</span> g]
[]
&gt;&gt;&gt; <span class="org-builtin">list</span>(<span class="org-builtin">filter</span> (<span class="org-keyword">lambda</span> x: x &gt; 10, [1, 20, 3, 40, 4, 14, 8]))
[20, 40, 14]
&gt;&gt;&gt; 

  <span class="org-comment-delimiter"># </span><span class="org-comment">Strict Version of the filter function</span>
  <span class="org-comment-delimiter">#</span>
&gt;&gt;&gt; <span class="org-variable-name">_filter</span> = <span class="org-keyword">lambda</span> f, xs: <span class="org-builtin">list</span>(<span class="org-builtin">filter</span>(f, xs))
&gt;&gt;&gt; 
&gt;&gt;&gt; _filter (<span class="org-keyword">lambda</span> x: x &gt; 10,  [1, 20, 3, 40, 4, 14, 8])
[20, 40, 14]
&gt;&gt;&gt; 

  <span class="org-comment-delimiter"># </span><span class="org-comment">Filter implementation without recursion:</span>
  <span class="org-comment-delimiter">#</span>

<span class="org-keyword">def</span> <span class="org-function-name">strict_filter</span> (f, xs):
    <span class="org-variable-name">result</span> = []
    <span class="org-keyword">for</span> x <span class="org-keyword">in</span> xs:
        <span class="org-keyword">if</span> f(x):
            result.append(x)
    <span class="org-keyword">return</span> result

<span class="org-keyword">def</span> <span class="org-function-name">lazy_filter</span> (f, xs):
    <span class="org-keyword">for</span> x <span class="org-keyword">in</span> xs:
        <span class="org-keyword">if</span> f(x):
            <span class="org-keyword">yield</span> x

&gt;&gt;&gt; strict_filter (<span class="org-keyword">lambda</span> x: x &gt; 10, [1, 20, 3, 40, 4, 14, 8])
[20, 40, 14]

&gt;&gt;&gt; lazy_filter (<span class="org-keyword">lambda</span> x: x &gt; 10, [1, 20, 3, 40, 4, 14, 8])
&lt;generator <span class="org-builtin">object</span> lazy_filter at 0xb6b0f1bc&gt;

&gt;&gt;&gt; <span class="org-variable-name">g</span> = lazy_filter (<span class="org-keyword">lambda</span> x: x &gt; 10, [1, 20, 3, 40, 4, 14, 8])
&gt;&gt;&gt; g
&lt;generator <span class="org-builtin">object</span> lazy_filter at 0xb6b0f194&gt;
&gt;&gt;&gt; <span class="org-builtin">next</span>(g)
20
&gt;&gt;&gt; <span class="org-builtin">next</span>(g)
40
&gt;&gt;&gt; <span class="org-builtin">next</span>(g)
14
&gt;&gt;&gt; <span class="org-builtin">next</span>(g)
Traceback (most recent call last):
  File <span class="org-string">"&lt;stdin&gt;"</span>, line 1, <span class="org-keyword">in</span> &lt;module&gt;
<span class="org-type">StopIteration</span>
&gt;&gt;&gt; 

&gt;&gt;&gt; <span class="org-builtin">list</span>(lazy_filter (<span class="org-keyword">lambda</span> x: x &gt; 10, [1, 20, 3, 40, 4, 14, 8]))
[20, 40, 14]
&gt;&gt;&gt;
</pre>
</div>
</div>
</div>

<div id="outline-container-sec-1-10-4" class="outline-4">
<h4 id="sec-1-10-4"><span class="section-number-4">1.10.4</span> Reduce or Fold</h4>
<div class="outline-text-4" id="text-1-10-4">
</div><div id="outline-container-sec-1-10-4-1" class="outline-5">
<h5 id="sec-1-10-4-1"><span class="section-number-5">1.10.4.1</span> Overview</h5>
<div class="outline-text-5" id="text-1-10-4-1">
<p>
<b>Fold Left</b>
</p>

<p>
The  function fold left is tail recursive, whereas the function fold
right is not. This functions is also known as reduce or inject (in
Ruby). The function fold left is often called just <span class="underline">fold</span> like in F#
or <span class="underline">reduce</span> (Python, Javascript, Clojure) and also Inject (Ruby).
</p>

<p>
<code>foldl :: (State -&gt; x -&gt; State) -&gt; State -&gt; [x] -&gt; State</code>
<code>foldl (f :: S -&gt; x -&gt; S)  S [x]</code>
</p>


<pre class="example">
Sn = foldl f S0 [x0, x1, x2, x3 ... xn-1]

S1   = f S0 x0
S2   = f S1 x1     = f (f S0 x0) x1
S3   = f S2 x2     = f (f (f S0 x0) x1) x2
S4   = f S3 x3     = f (f (f (f S0 x0) x1) x2) x3
...
Sn-1 = f Sn-2 Xn-2 = ...
Sn   = f Sn-1 Xn-1 = f ...(f (f (f (f S0 x0) x1) x2) x3 ... xn

  ;;; -&gt; Result
</pre>


<p>
<b>Fold Right</b>
</p>

<p>
<code>foldr :: (x -&gt; acc -&gt; acc) -&gt; acc -&gt; [x] -&gt; acc</code>
</p>

<pre class="example">
S1   = f xn-1 S0
S2   = f xn-2 S1     = f xn-2 (f xn-1 S0)
S3   = f xn-3 S2     = f xn-3 (f xn-2 (f xn-1 S0))
S4   = f xn-4 S3     = f xn-4 (f xn-3 (f xn-2 (f xn-1 S0)))
....
Sn-1 = f x1   Sn-2   = ...
Sn   = f x0   Sn-1   = f x0 (f x1 ... (f xn-2 (f xn-1 S0)))
</pre>
</div>
</div>

<div id="outline-container-sec-1-10-4-2" class="outline-5">
<h5 id="sec-1-10-4-2"><span class="section-number-5">1.10.4.2</span> Haskell</h5>
<div class="outline-text-5" id="text-1-10-4-2">
<p>
See also: 
</p>

<ul class="org-ul">
<li><a href="https://en.wikipedia.org/wiki/Fold_(higher-order_function">Fold (higher-order function) - Wikipedia, the free encyclopedia</a>)
</li>
<li><a href="http://www.cs.nott.ac.uk/~pszgmh/fold.pdf">A tutorial on the universality and expressiveness of fold. GRAHAM HUTTON</a>
</li>
<li><a href="http://www.cantab.net/users/antoni.diller/haskell/units/unit06.html">Haskell unit 6: The higher-order fold functions | Antoni Diller</a>
</li>
</ul>



<p>
Fold Left:
</p>

<pre class="example">
 foldl :: (acc -&gt; x -&gt; acc) -&gt; acc -&gt; [x] -&gt; acc
 
                  |             |      |       | 
                  |             |      |       |---&gt; Returns the accumulated 
                  |             |      |             value
                  |             |      |----- xs 
                  |             |                  
                  |             |     Inital Value of accumulator
                  |             |---  acc0
                  |
                  |-----------------  f :: acc -&gt; x -&gt; acc
                                                  |
                                                  |--- Element of list 

 foldl :: (b -&gt; a -&gt; b) -&gt; b -&gt; [a] -&gt; b
 foldl f z []     = z
 foldl f z (x:xs) = foldl f (f z x) xs
</pre>


<div class="org-src-container">

<pre class="src src-haskell"><span class="org-haskell-operator">&gt;</span> <span class="org-haskell-constructor">:</span>t foldl
<span class="org-function-name">foldl</span> <span class="org-haskell-operator">::</span> (a <span class="org-haskell-operator">-&gt;</span> b <span class="org-haskell-operator">-&gt;</span> a) <span class="org-haskell-operator">-&gt;</span> a <span class="org-haskell-operator">-&gt;</span> [b] <span class="org-haskell-operator">-&gt;</span> a
<span class="org-haskell-operator">&gt;</span> 
<span class="org-haskell-operator">&gt;</span> <span class="org-haskell-definition">foldl</span> (<span class="org-haskell-operator">\</span>acc x <span class="org-haskell-operator">-&gt;</span> 10 <span class="org-haskell-operator">*</span> acc <span class="org-haskell-operator">+</span> x) 0 [1<span class="org-haskell-operator">,</span> 2<span class="org-haskell-operator">,</span> 3<span class="org-haskell-operator">,</span> 4<span class="org-haskell-operator">,</span> 5] 
12345
<span class="org-haskell-operator">&gt;</span>
</pre>
</div>

<p>
It is equivalent to:
</p>

<div class="org-src-container">

<pre class="src src-haskell"><span class="org-haskell-operator">&gt;</span> <span class="org-haskell-keyword">let</span> f acc x <span class="org-haskell-operator">=</span> 10 <span class="org-haskell-operator">*</span> acc <span class="org-haskell-operator">+</span> x
<span class="org-haskell-operator">&gt;</span> 
<span class="org-haskell-operator">&gt;</span> (f 0 1)
1
<span class="org-haskell-operator">&gt;</span> (f (f 0 1) 2)
12
<span class="org-haskell-operator">&gt;</span> (f (f (f 0 1) 2) 3)
123
<span class="org-haskell-operator">&gt;</span> 
<span class="org-haskell-operator">&gt;</span> (f (f (f (f 0 1) 2) 3) 4)
1234
<span class="org-haskell-operator">&gt;</span> (f (f (f (f (f 0 1) 2) 3) 4) 5)
12345
<span class="org-haskell-operator">&gt;</span>
</pre>
</div>

<p>
Evaluation of Fold left:
</p>


<pre class="example">
&gt; foldl (\acc x -&gt; 10 * acc + x ) 0 [1, 2, 3, 4, 5]
12345

S0 = 0

f = \acc x -&gt; 10 * acc + x

                 x  acc
S1 = f S0 x0 = f 0   1 = 10 * 0  + 1 = 1
S2 = f S1 x1 = f 10  2 = 10 * 1    + 2 = 12
S3 = f S2 x2 = f 12  3 = 10 * 12   + 3 = 123
S4 = f S3 x3 = f 123 4 = 10 * 123  + 4 = 1234
S5 = f S3 x3 = f 123 4 = 10 * 1234 + 5 = 12345
</pre>



<p>
<b>Fold right</b>
</p>

<pre class="example">
 foldr :: (x -&gt; acc -&gt; acc) -&gt; acc -&gt; [x] -&gt; acc

 foldr :: (a -&gt; b -&gt; b) -&gt; b -&gt; [a] -&gt; b
 foldr f z []     = z
 foldr f z (x:xs) = f x (foldr f z xs)
</pre>

<div class="org-src-container">

<pre class="src src-haskell"><span class="org-haskell-operator">&gt;</span> <span class="org-haskell-definition">foldr</span> (<span class="org-haskell-operator">\</span>x acc <span class="org-haskell-operator">-&gt;</span> 10 <span class="org-haskell-operator">*</span> acc <span class="org-haskell-operator">+</span> x) 0 [1<span class="org-haskell-operator">,</span> 2<span class="org-haskell-operator">,</span> 3<span class="org-haskell-operator">,</span> 4<span class="org-haskell-operator">,</span> 5] 
54321

<span class="org-haskell-operator">&gt;</span> (f 0 5)
5
<span class="org-haskell-operator">&gt;</span> (f (f 0 5) 4)
54
<span class="org-haskell-operator">&gt;</span> (f (f (f 0 5) 4) 3)
543
<span class="org-haskell-operator">&gt;</span> (f (f (f (f 0 5) 4) 3) 2)
5432
<span class="org-haskell-operator">&gt;</span> (f (f (f (f (f 0 5) 4) 3) 2) 1)
54321
<span class="org-haskell-operator">&gt;</span> 

 <span class="org-comment-delimiter">--</span>
 <span class="org-comment-delimiter">-- </span><span class="org-comment">Derive fold_right from foldl (fold left)</span>
 <span class="org-comment-delimiter">-- </span>

<span class="org-haskell-operator">&gt;</span> <span class="org-haskell-keyword">let</span> fold_right f acc xs <span class="org-haskell-operator">=</span> foldl (<span class="org-haskell-operator">\</span>x acc <span class="org-haskell-operator">-&gt;</span> f acc x) acc (reverse xs)
<span class="org-haskell-operator">&gt;</span> 
<span class="org-haskell-operator">&gt;</span> <span class="org-haskell-constructor">:</span>t fold_right
<span class="org-function-name">fold_right</span> <span class="org-haskell-operator">::</span> (b <span class="org-haskell-operator">-&gt;</span> a <span class="org-haskell-operator">-&gt;</span> a) <span class="org-haskell-operator">-&gt;</span> a <span class="org-haskell-operator">-&gt;</span> [b] <span class="org-haskell-operator">-&gt;</span> a
<span class="org-haskell-operator">&gt;</span> 
<span class="org-haskell-operator">&gt;</span> 
<span class="org-haskell-operator">&gt;</span> <span class="org-haskell-definition">fold_right</span> (<span class="org-haskell-operator">\</span>x acc <span class="org-haskell-operator">-&gt;</span> 10 <span class="org-haskell-operator">*</span> acc <span class="org-haskell-operator">+</span> x) 0 [1<span class="org-haskell-operator">,</span> 2<span class="org-haskell-operator">,</span> 3<span class="org-haskell-operator">,</span> 4<span class="org-haskell-operator">,</span> 5]
54321
<span class="org-haskell-operator">&gt;</span>
</pre>
</div>

<p>
Evaluation of Fold Right:
</p>

<pre class="example">
Example:

&gt; foldr (\x acc -&gt; 10 * acc + x ) 0 [1, 2, 3, 4, 5]
54321
&gt;

f  = \x acc -&gt; 10 * acc + x
S0 = 0
n = 5
                       x acc
S1   = f x4 S0     = f 5  0    = 10 * 0    + 5 = 5
S2   = f x3 S1     = f 4  5    = 10 * 5    + 4 = 54
S3   = f x2 S2     = f 3  54   = 10 * 54   + 3 = 543
S4   = f x1 S3     = f 2  543  = 10 * 543  + 2 = 5432
S5   = f x0 S4     = f 1  5432 = 10 * 5432 + 1 = 54321
</pre>
</div>
</div>

<div id="outline-container-sec-1-10-4-3" class="outline-5">
<h5 id="sec-1-10-4-3"><span class="section-number-5">1.10.4.3</span> Python</h5>
<div class="outline-text-5" id="text-1-10-4-3">
<p>
In Python 3 the function reduce is not default anymore, however it can
be found in the native library functools, that has a lot of built-in
functions for functional programming. The function reduce is equivalent
to Haskell function foldl (fold left) which is tail recursive.
</p>

<pre class="example">
reduce(function, sequence[, initial]) -&gt; value

reduce :: (acc -&gt; x -&gt; acc) -&gt; [x] ?acc0  -&gt; acc
</pre>

<div class="org-src-container">

<pre class="src src-python">&gt;&gt;&gt; <span class="org-keyword">from</span> functools <span class="org-keyword">import</span> <span class="org-builtin">reduce</span>
&gt;&gt;&gt; 

&gt;&gt;&gt; <span class="org-builtin">reduce</span> (<span class="org-keyword">lambda</span> acc, x: 10 *  acc + x , [1, 2, 3, 4, 5], 0)
12345
&gt;&gt;&gt; 

&gt;&gt;&gt; <span class="org-variable-name">f</span> = <span class="org-keyword">lambda</span> acc, x: 10 *  acc + x
&gt;&gt;&gt; 
&gt;&gt;&gt; f(0, 1)
1
&gt;&gt;&gt; f( f(0, 1), 2)
12
&gt;&gt;&gt; f( f( f(0, 1), 2), 3)
123
&gt;&gt;&gt; f( f( f( f(0, 1), 2), 3), 4)
1234
&gt;&gt;&gt; f( f( f( f( f(0, 1), 2), 3), 4), 5)
12345
&gt;&gt;&gt; 

<span class="org-keyword">def</span> <span class="org-function-name">my_reduce</span> (f, xs, acc0=<span class="org-constant">None</span>):
    <span class="org-string">"Non recursive implementation of reduce (fold_left)</span>
<span class="org-string">     with optional initial accumulator value.</span>
<span class="org-string">    "</span>

    <span class="org-keyword">if</span> acc0 <span class="org-keyword">is</span> <span class="org-constant">None</span>:
        <span class="org-variable-name">acc</span> = xs[0]   
        <span class="org-variable-name">xss</span> = xs[1:]
    <span class="org-keyword">else</span>:
        <span class="org-variable-name">acc</span> = acc0
        <span class="org-variable-name">xss</span> = xs
        
    <span class="org-keyword">for</span> x <span class="org-keyword">in</span> xss:
        <span class="org-variable-name">acc</span> = f (acc, x)
        
    <span class="org-keyword">return</span> acc


&gt;&gt;&gt; 
&gt;&gt;&gt; my_reduce(<span class="org-keyword">lambda</span> acc, x: 10 * acc + x, [1, 2, 3, 4, 5], 0)
12345
&gt;&gt;&gt; my_reduce(<span class="org-keyword">lambda</span> acc, x: 10 * acc + x, [1, 2, 3, 4, 5])
12345
&gt;&gt;&gt; my_reduce(<span class="org-keyword">lambda</span> acc, x:  acc + x, [1, 2, 3, 4, 5], 0)
15
&gt;&gt;&gt; my_reduce(<span class="org-keyword">lambda</span> acc, x:  acc * x, [1, 2, 3, 4, 5], 1)
120
&gt;&gt;&gt; 
 
 <span class="org-comment-delimiter">#</span>
 <span class="org-comment-delimiter"># </span><span class="org-comment">Implementation without recursion.</span>
 <span class="org-comment-delimiter">#</span>

<span class="org-keyword">def</span> <span class="org-function-name">fold_left</span> (f_acc_x_to_acc, acc0, xs):
    <span class="org-string">"Haskell-like fold left function</span>
<span class="org-string">    </span>
<span class="org-string">    fold_left :: (acc -&gt; x -&gt; acc) -&gt; acc -&gt; [x]</span>
<span class="org-string">    "</span>
    <span class="org-variable-name">acc</span> = acc0
    
    <span class="org-keyword">for</span> x <span class="org-keyword">in</span> xs:
        <span class="org-variable-name">acc</span> = f_acc_x_to_acc (acc, x)
        
    <span class="org-keyword">return</span> acc
      
&gt;&gt;&gt; fold_left (<span class="org-keyword">lambda</span> acc, x: 10 * acc + x, 0, [1, 2, 3, 4, 5])
12345
&gt;&gt;&gt;       


<span class="org-keyword">def</span> <span class="org-function-name">fold_right</span> (f, acc0, xs):
    <span class="org-keyword">return</span> fold_left ((<span class="org-keyword">lambda</span> acc, x: f(x, acc)), acc0, <span class="org-builtin">reversed</span>(xs))

&gt;&gt;&gt; fold_right (<span class="org-keyword">lambda</span> x, acc: 10 * acc + x, 0, [1, 2, 3, 4, 5])
54321
&gt;&gt;&gt;

<span class="org-keyword">def</span> <span class="org-function-name">fold_right2</span> (f, acc0, xs):
    <span class="org-variable-name">acc</span> = acc0
    
    <span class="org-keyword">for</span> x <span class="org-keyword">in</span> <span class="org-builtin">reversed</span>(xs):
        <span class="org-variable-name">acc</span> = f(x, acc)
        
    <span class="org-keyword">return</span> acc

&gt;&gt;&gt; fold_right2 (<span class="org-keyword">lambda</span> x, acc: 10 * acc + x, 0, [1, 2, 3, 4, 5])
54321
&gt;&gt;&gt;
</pre>
</div>

<p>
<b>Usefulness of Fold</b>
</p>

<p>
Many functions and recursive algorithms can be implemented using the
fold function, including map, filter, sum, product and others.
</p>

<p>
It is based in the paper:  
</p>

<ul class="org-ul">
<li><a href="http://www.cs.nott.ac.uk/~pszgmh/fold.pdf">A tutorial on the universality and expressiveness of fold. GRAHAM HUTTON</a>
</li>
</ul>

<p>
In the paper was used fold right, here was used fold left. 
</p>

<div class="org-src-container">

<pre class="src src-python"><span class="org-keyword">def</span> <span class="org-function-name">fold_left</span> (f_acc_x_to_acc, acc0, xs):
    <span class="org-string">"Haskell-like fold left function</span>
<span class="org-string">    </span>
<span class="org-string">    fold_left :: (acc -&gt; x -&gt; acc) -&gt; acc -&gt; [x]</span>
<span class="org-string">    "</span>
    <span class="org-variable-name">acc</span> = acc0
    
    <span class="org-keyword">for</span> x <span class="org-keyword">in</span> xs:
        <span class="org-variable-name">acc</span> = f_acc_x_to_acc (acc, x)
        
    <span class="org-keyword">return</span> acc
    
    
    ;;; Function fold <span class="org-keyword">in</span> curried form 
    
<span class="org-variable-name">curry3</span> = <span class="org-keyword">lambda</span> f: <span class="org-keyword">lambda</span> x: <span class="org-keyword">lambda</span> y: <span class="org-keyword">lambda</span> z: f(x, y, z)

<span class="org-variable-name">fold</span> = curry3(fold_left)

&gt;&gt;&gt; <span class="org-variable-name">summation</span> = fold(<span class="org-keyword">lambda</span> acc, x: acc + x)(0)
&gt;&gt;&gt; 
&gt;&gt;&gt; summation([1, 2, 3, 4, 5, 6])
21
&gt;&gt;&gt; 

&gt;&gt;&gt; <span class="org-variable-name">product</span> = fold(<span class="org-keyword">lambda</span> acc, x: acc * x)(1)
&gt;&gt;&gt; product([1, 2, 3, 4, 5])
120
&gt;&gt;&gt; 

&gt;&gt;&gt; <span class="org-variable-name">f_or</span> = fold(<span class="org-keyword">lambda</span> acc, x: acc <span class="org-keyword">or</span> x)(<span class="org-constant">False</span>)
&gt;&gt;&gt; f_or([<span class="org-constant">False</span>, <span class="org-constant">False</span>, <span class="org-constant">False</span>])
<span class="org-constant">False</span>
&gt;&gt;&gt; 
&gt;&gt;&gt; f_or([<span class="org-constant">False</span>, <span class="org-constant">False</span>, <span class="org-constant">True</span>])
<span class="org-constant">True</span>
&gt;&gt;&gt; 

&gt;&gt;&gt; <span class="org-variable-name">f_and</span> = fold(<span class="org-keyword">lambda</span> acc, x: acc <span class="org-keyword">and</span> x)(<span class="org-constant">True</span>)
&gt;&gt;&gt; 
&gt;&gt;&gt; f_and([<span class="org-constant">False</span>, <span class="org-constant">True</span>, <span class="org-constant">True</span>])
<span class="org-constant">False</span>
&gt;&gt;&gt; f_and([<span class="org-constant">True</span>, <span class="org-constant">True</span>, <span class="org-constant">True</span>])
<span class="org-constant">True</span>
&gt;&gt;&gt; 

&gt;&gt;&gt; <span class="org-variable-name">length</span> = fold(<span class="org-keyword">lambda</span> acc, x: acc + 1)(0)
&gt;&gt;&gt; length ([1, 2, 3, 4, 5])
5

&gt;&gt;&gt; <span class="org-variable-name">_map</span> = <span class="org-keyword">lambda</span> f, xs: fold(<span class="org-keyword">lambda</span> acc, x: acc + [f(x)] )([])(xs)
&gt;&gt;&gt; _map (<span class="org-keyword">lambda</span> x: x * 3, [1, 2, 3, 4])
[3, 6, 9, 12]
&gt;&gt;&gt; 

&gt;&gt;&gt; <span class="org-variable-name">_filter</span> = <span class="org-keyword">lambda</span> p, xs: fold(<span class="org-keyword">lambda</span> acc, x: (acc + [x]) <span class="org-keyword">if</span> p(x) <span class="org-keyword">else</span>  acc )([])(xs)
&gt;&gt;&gt; 
&gt;&gt;&gt; _filter(<span class="org-keyword">lambda</span> x: x &gt; 10, [10, 3, 8, 2, 20, 30])
[20, 30]
&gt;&gt;&gt; 


 <span class="org-comment-delimiter">#</span>
 <span class="org-comment-delimiter"># </span><span class="org-comment">Function composition</span>
 <span class="org-comment-delimiter"># </span>
 <span class="org-comment-delimiter">#  </span><span class="org-comment">(f3 (f2 (f1 (f0 x))))</span>
 <span class="org-comment-delimiter">#</span>
 <span class="org-comment-delimiter">#  </span><span class="org-comment">(f3 . f2 . f1 . f0) x</span>
 <span class="org-comment-delimiter">#</span>
 <span class="org-comment-delimiter">#  </span><span class="org-comment">or using, forward composition:</span>
 <span class="org-comment-delimiter"># </span>
 <span class="org-comment-delimiter">#  </span><span class="org-comment">(f0 &gt;&gt; f2 &gt;&gt; f1 &gt;&gt; f0) x</span>
 <span class="org-comment-delimiter">#</span>
 
&gt;&gt;&gt; <span class="org-variable-name">f1</span> = <span class="org-keyword">lambda</span> x: 3 * x
&gt;&gt;&gt; <span class="org-variable-name">f2</span> = <span class="org-keyword">lambda</span> x: 5 + x
&gt;&gt;&gt; <span class="org-variable-name">f3</span> = <span class="org-keyword">lambda</span> x: 2 ** x


&gt;&gt;&gt; <span class="org-variable-name">_fcomp</span> = <span class="org-keyword">lambda</span> functions: <span class="org-keyword">lambda</span> x: fold(<span class="org-keyword">lambda</span> acc, f: f(acc)) (x) (functions)

&gt;&gt;&gt; _fcomp([f1, f2, f3])(3)
16384

&gt;&gt;&gt; (f3 (f2 (f1 (3))))
16384
&gt;&gt;&gt;
</pre>
</div>
</div>
</div>

<div id="outline-container-sec-1-10-4-4" class="outline-5">
<h5 id="sec-1-10-4-4"><span class="section-number-5">1.10.4.4</span> Clojure</h5>
<div class="outline-text-5" id="text-1-10-4-4">
<p>
The function reduce is similar to Haskell <span class="underline">fold left</span> and Python
reduce. This function is Polymorphic. It works on any collection of
seq abstraction: lists, vectors and hash maps. 
</p>

<p>
Signature:
</p>

<pre class="example">
(reduce f coll)      -&gt; reduce :: (f :: acc -&gt; x -&gt; acc) -&gt; [x]

Or 

(reduce f val coll)  -&gt; reduce :: (f :: acc -&gt; x -&gt; acc) -&gt; acc -&gt; [x] 

f :: acc -&gt; x -&gt; acc
</pre>


<div class="org-src-container">

<pre class="src src-clojure"><span class="org-comment-delimiter">;; </span><span class="org-comment">Applying fold/reduce to a list </span>
<span class="org-comment-delimiter">;;</span>
<span class="org-comment-delimiter">;;</span>
user=&gt; <span class="org-rainbow-delimiters-depth-1">(</span>reduce <span class="org-rainbow-delimiters-depth-2">(</span><span class="org-keyword">fn</span> <span class="org-rainbow-delimiters-depth-3">[</span>acc x<span class="org-rainbow-delimiters-depth-3">]</span> <span class="org-rainbow-delimiters-depth-3">(</span>+ <span class="org-rainbow-delimiters-depth-4">(</span>* 10 acc<span class="org-rainbow-delimiters-depth-4">)</span> x<span class="org-rainbow-delimiters-depth-3">)</span><span class="org-rainbow-delimiters-depth-2">)</span> 0 '<span class="org-rainbow-delimiters-depth-2">(</span>1 2 3 4 5<span class="org-rainbow-delimiters-depth-2">)</span><span class="org-rainbow-delimiters-depth-1">)</span>
12345


<span class="org-comment-delimiter">;; </span><span class="org-comment">Applying fold/reduce to a vector </span>
<span class="org-comment-delimiter">;;</span>
user=&gt; <span class="org-rainbow-delimiters-depth-1">(</span>reduce <span class="org-rainbow-delimiters-depth-2">(</span><span class="org-keyword">fn</span> <span class="org-rainbow-delimiters-depth-3">[</span>acc x<span class="org-rainbow-delimiters-depth-3">]</span> <span class="org-rainbow-delimiters-depth-3">(</span>+ <span class="org-rainbow-delimiters-depth-4">(</span>* 10 acc<span class="org-rainbow-delimiters-depth-4">)</span> x<span class="org-rainbow-delimiters-depth-3">)</span><span class="org-rainbow-delimiters-depth-2">)</span>  0 <span class="org-rainbow-delimiters-depth-2">[</span>1 2 3 4 5<span class="org-rainbow-delimiters-depth-2">]</span><span class="org-rainbow-delimiters-depth-1">)</span>
12345
user=&gt; 

user=&gt; <span class="org-rainbow-delimiters-depth-1">(</span>reduce <span class="org-rainbow-delimiters-depth-2">(</span><span class="org-keyword">fn</span> <span class="org-rainbow-delimiters-depth-3">[</span>acc x<span class="org-rainbow-delimiters-depth-3">]</span> <span class="org-rainbow-delimiters-depth-3">(</span>+ <span class="org-rainbow-delimiters-depth-4">(</span>* 10 acc<span class="org-rainbow-delimiters-depth-4">)</span> x<span class="org-rainbow-delimiters-depth-3">)</span><span class="org-rainbow-delimiters-depth-2">)</span> 0 <span class="org-rainbow-delimiters-depth-2">[]</span><span class="org-rainbow-delimiters-depth-1">)</span>
0

<span class="org-comment-delimiter">;; </span><span class="org-comment">Applyind fold/reduce to a Hash map </span>
<span class="org-comment-delimiter">;;</span>
user=&gt; <span class="org-rainbow-delimiters-depth-1">(</span>reduce <span class="org-rainbow-delimiters-depth-2">(</span><span class="org-keyword">fn</span> <span class="org-rainbow-delimiters-depth-3">[</span>acc x<span class="org-rainbow-delimiters-depth-3">]</span> <span class="org-rainbow-delimiters-depth-3">(</span>cons x  acc <span class="org-rainbow-delimiters-depth-3">)</span><span class="org-rainbow-delimiters-depth-2">)</span> '<span class="org-rainbow-delimiters-depth-2">()</span>  <span class="org-rainbow-delimiters-depth-2">{</span> <span class="org-clojure-keyword">:a</span> 10 <span class="org-clojure-keyword">:b</span> 20 <span class="org-clojure-keyword">:c</span> 30 <span class="org-rainbow-delimiters-depth-2">}</span><span class="org-rainbow-delimiters-depth-1">)</span>
<span class="org-rainbow-delimiters-depth-1">(</span><span class="org-rainbow-delimiters-depth-2">[</span><span class="org-clojure-keyword">:c</span> 30<span class="org-rainbow-delimiters-depth-2">]</span> <span class="org-rainbow-delimiters-depth-2">[</span><span class="org-clojure-keyword">:b</span> 20<span class="org-rainbow-delimiters-depth-2">]</span> <span class="org-rainbow-delimiters-depth-2">[</span><span class="org-clojure-keyword">:a</span> 10<span class="org-rainbow-delimiters-depth-2">]</span><span class="org-rainbow-delimiters-depth-1">)</span>
user=&gt;

<span class="org-comment-delimiter">;; </span><span class="org-comment">Without Initial value of accumulator it will fail on a empty list. </span>
<span class="org-comment-delimiter">;; </span>
user=&gt; <span class="org-rainbow-delimiters-depth-1">(</span>reduce <span class="org-rainbow-delimiters-depth-2">(</span><span class="org-keyword">fn</span> <span class="org-rainbow-delimiters-depth-3">[</span>acc x<span class="org-rainbow-delimiters-depth-3">]</span> <span class="org-rainbow-delimiters-depth-3">(</span>+ <span class="org-rainbow-delimiters-depth-4">(</span>* 10 acc<span class="org-rainbow-delimiters-depth-4">)</span> x<span class="org-rainbow-delimiters-depth-3">)</span><span class="org-rainbow-delimiters-depth-2">)</span> <span class="org-rainbow-delimiters-depth-2">[</span>1 2 3 4 5<span class="org-rainbow-delimiters-depth-2">]</span><span class="org-rainbow-delimiters-depth-1">)</span>
12345

user=&gt; <span class="org-rainbow-delimiters-depth-1">(</span>reduce <span class="org-rainbow-delimiters-depth-2">(</span><span class="org-keyword">fn</span> <span class="org-rainbow-delimiters-depth-3">[</span>acc x<span class="org-rainbow-delimiters-depth-3">]</span> <span class="org-rainbow-delimiters-depth-3">(</span>+ <span class="org-rainbow-delimiters-depth-4">(</span>* 10 acc<span class="org-rainbow-delimiters-depth-4">)</span> x<span class="org-rainbow-delimiters-depth-3">)</span><span class="org-rainbow-delimiters-depth-2">)</span> <span class="org-rainbow-delimiters-depth-2">[]</span><span class="org-rainbow-delimiters-depth-1">)</span>
<span class="org-type">ArityException</span> <span class="org-type">Wrong</span> number of args <span class="org-rainbow-delimiters-depth-1">(</span>0<span class="org-rainbow-delimiters-depth-1">)</span> passed to: <span class="org-type">user</span><span class="org-default">/</span>eval44/fn--45  <span class="org-type">clojure.lang.</span>AFn.throwArity <span class="org-rainbow-delimiters-depth-1">(</span>AFn.java:429<span class="org-rainbow-delimiters-depth-1">)</span>
user=&gt; 

<span class="org-comment-delimiter">;; </span><span class="org-comment">Implementing fold right  </span>
<span class="org-comment-delimiter">;;</span>
<span class="org-rainbow-delimiters-depth-1">(</span><span class="org-keyword">defn</span> <span class="org-function-name">foldr</span> 
   <span class="org-rainbow-delimiters-depth-2">(</span><span class="org-rainbow-delimiters-depth-3">[</span>f xs<span class="org-rainbow-delimiters-depth-3">]</span>       <span class="org-rainbow-delimiters-depth-3">(</span>reduce <span class="org-rainbow-delimiters-depth-4">(</span><span class="org-keyword">fn</span> <span class="org-rainbow-delimiters-depth-5">[</span>acc x<span class="org-rainbow-delimiters-depth-5">]</span> <span class="org-rainbow-delimiters-depth-5">(</span>f x acc<span class="org-rainbow-delimiters-depth-5">)</span><span class="org-rainbow-delimiters-depth-4">)</span>     <span class="org-rainbow-delimiters-depth-4">(</span>reverse xs<span class="org-rainbow-delimiters-depth-4">)</span><span class="org-rainbow-delimiters-depth-3">)</span><span class="org-rainbow-delimiters-depth-2">)</span>
   <span class="org-rainbow-delimiters-depth-2">(</span><span class="org-rainbow-delimiters-depth-3">[</span>f acc xs<span class="org-rainbow-delimiters-depth-3">]</span>   <span class="org-rainbow-delimiters-depth-3">(</span>reduce <span class="org-rainbow-delimiters-depth-4">(</span><span class="org-keyword">fn</span> <span class="org-rainbow-delimiters-depth-5">[</span>acc x<span class="org-rainbow-delimiters-depth-5">]</span> <span class="org-rainbow-delimiters-depth-5">(</span>f x acc<span class="org-rainbow-delimiters-depth-5">)</span><span class="org-rainbow-delimiters-depth-4">)</span> acc <span class="org-rainbow-delimiters-depth-4">(</span>reverse xs<span class="org-rainbow-delimiters-depth-4">)</span><span class="org-rainbow-delimiters-depth-3">)</span><span class="org-rainbow-delimiters-depth-2">)</span>
  <span class="org-rainbow-delimiters-depth-1">)</span>

user=&gt; <span class="org-rainbow-delimiters-depth-1">(</span>foldr <span class="org-rainbow-delimiters-depth-2">(</span><span class="org-keyword">fn</span> <span class="org-rainbow-delimiters-depth-3">[</span>x acc<span class="org-rainbow-delimiters-depth-3">]</span> <span class="org-rainbow-delimiters-depth-3">(</span>+ <span class="org-rainbow-delimiters-depth-4">(</span>* 10 acc<span class="org-rainbow-delimiters-depth-4">)</span> x<span class="org-rainbow-delimiters-depth-3">)</span><span class="org-rainbow-delimiters-depth-2">)</span> 0 <span class="org-rainbow-delimiters-depth-2">[</span>1 2 3 4 5<span class="org-rainbow-delimiters-depth-2">]</span><span class="org-rainbow-delimiters-depth-1">)</span>
54321


<span class="org-comment-delimiter">;; </span><span class="org-comment">Clojure has destructuring </span>
<span class="org-comment-delimiter">;;</span>
user=&gt; <span class="org-rainbow-delimiters-depth-1">(</span>reduce <span class="org-rainbow-delimiters-depth-2">(</span><span class="org-keyword">fn</span> <span class="org-rainbow-delimiters-depth-3">[</span>acc <span class="org-rainbow-delimiters-depth-4">[</span>a b<span class="org-rainbow-delimiters-depth-4">]</span><span class="org-rainbow-delimiters-depth-3">]</span> <span class="org-rainbow-delimiters-depth-3">(</span>conj acc <span class="org-rainbow-delimiters-depth-4">(</span>+ <span class="org-rainbow-delimiters-depth-5">(</span>* 10 a<span class="org-rainbow-delimiters-depth-5">)</span> b<span class="org-rainbow-delimiters-depth-4">)</span> <span class="org-rainbow-delimiters-depth-3">)</span><span class="org-rainbow-delimiters-depth-2">)</span> '<span class="org-rainbow-delimiters-depth-2">[]</span> <span class="org-rainbow-delimiters-depth-2">[</span><span class="org-rainbow-delimiters-depth-3">[</span>1 2<span class="org-rainbow-delimiters-depth-3">]</span> <span class="org-rainbow-delimiters-depth-3">[</span>3 4<span class="org-rainbow-delimiters-depth-3">]</span> <span class="org-rainbow-delimiters-depth-3">[</span>5 8<span class="org-rainbow-delimiters-depth-3">]</span><span class="org-rainbow-delimiters-depth-2">]</span> <span class="org-rainbow-delimiters-depth-1">)</span>
<span class="org-rainbow-delimiters-depth-1">[</span>12 34 58<span class="org-rainbow-delimiters-depth-1">]</span>
user=&gt; 

<span class="org-comment-delimiter">;; </span><span class="org-comment">Implementing map with fold left (reduce)</span>
<span class="org-comment-delimiter">;;</span>
user=&gt; <span class="org-rainbow-delimiters-depth-1">(</span><span class="org-keyword">defn</span> <span class="org-function-name">map2</span> <span class="org-rainbow-delimiters-depth-2">[</span>f xs<span class="org-rainbow-delimiters-depth-2">]</span> 
          <span class="org-rainbow-delimiters-depth-2">(</span>reverse <span class="org-rainbow-delimiters-depth-3">(</span>reduce <span class="org-rainbow-delimiters-depth-4">(</span><span class="org-keyword">fn</span> <span class="org-rainbow-delimiters-depth-5">[</span>acc x<span class="org-rainbow-delimiters-depth-5">]</span> <span class="org-rainbow-delimiters-depth-5">(</span>cons <span class="org-rainbow-delimiters-depth-6">(</span>f x<span class="org-rainbow-delimiters-depth-6">)</span> acc<span class="org-rainbow-delimiters-depth-5">)</span><span class="org-rainbow-delimiters-depth-4">)</span> 
                        <span class="org-rainbow-delimiters-depth-4">()</span> 
                        xs<span class="org-rainbow-delimiters-depth-3">)</span><span class="org-rainbow-delimiters-depth-2">)</span><span class="org-rainbow-delimiters-depth-1">)</span>
#'<span class="org-type">user</span><span class="org-default">/</span>map2
user=&gt; 
user=&gt; <span class="org-rainbow-delimiters-depth-1">(</span>map2 inc '<span class="org-rainbow-delimiters-depth-2">(</span>1 2 3 3 4 5<span class="org-rainbow-delimiters-depth-2">)</span><span class="org-rainbow-delimiters-depth-1">)</span>
<span class="org-rainbow-delimiters-depth-1">(</span>2 3 4 4 5 6<span class="org-rainbow-delimiters-depth-1">)</span>
user=&gt; 

<span class="org-comment-delimiter">;; </span><span class="org-comment">Implementing map with fold right </span>
<span class="org-comment-delimiter">;;</span>
<span class="org-comment-delimiter">;;</span>

<span class="org-rainbow-delimiters-depth-1">(</span><span class="org-keyword">defn</span> <span class="org-function-name">map2</span> <span class="org-rainbow-delimiters-depth-2">[</span>f xs<span class="org-rainbow-delimiters-depth-2">]</span> 
   <span class="org-rainbow-delimiters-depth-2">(</span>foldr <span class="org-rainbow-delimiters-depth-3">(</span><span class="org-keyword">fn</span> <span class="org-rainbow-delimiters-depth-4">[</span>x acc<span class="org-rainbow-delimiters-depth-4">]</span> <span class="org-rainbow-delimiters-depth-4">(</span>cons <span class="org-rainbow-delimiters-depth-5">(</span>f x<span class="org-rainbow-delimiters-depth-5">)</span> acc<span class="org-rainbow-delimiters-depth-4">)</span><span class="org-rainbow-delimiters-depth-3">)</span> 
          <span class="org-rainbow-delimiters-depth-3">()</span>
          xs
   <span class="org-rainbow-delimiters-depth-2">)</span><span class="org-rainbow-delimiters-depth-1">)</span>

user=&gt; <span class="org-rainbow-delimiters-depth-1">(</span>map2 inc '<span class="org-rainbow-delimiters-depth-2">(</span>1 2 3 4 5 6<span class="org-rainbow-delimiters-depth-2">)</span><span class="org-rainbow-delimiters-depth-1">)</span>
<span class="org-rainbow-delimiters-depth-1">(</span>2 3 4 5 6 7<span class="org-rainbow-delimiters-depth-1">)</span>
user=&gt;
</pre>
</div>
</div>
</div>

<div id="outline-container-sec-1-10-4-5" class="outline-5">
<h5 id="sec-1-10-4-5"><span class="section-number-5">1.10.4.5</span> Fsharp</h5>
<div class="outline-text-5" id="text-1-10-4-5">
<div class="org-src-container">

<pre class="src src-fsharp"><span class="org-comment-delimiter">// </span><span class="org-comment">Fold left for Lists </span>
<span class="org-comment-delimiter">//</span>
<span class="org-comment-delimiter">//</span>

<span class="org-comment-delimiter">// </span><span class="org-comment">List.fold (acc -&gt; 'x -&gt; 'acc) -&gt; acc -&gt; 'x list -&gt; 'acc</span>
<span class="org-comment-delimiter">//</span>
- List.fold ;;  
<span class="org-keyword">val</span> it : (('a -&gt; 'b -&gt; 'a) -&gt; 'a -&gt; 'b list -&gt; 'a) 

- List.fold (<span class="org-keyword">fun</span> <span class="org-variable-name">acc</span> <span class="org-variable-name">x</span> -&gt; 10 * acc + x) 0 [1; 2; 3; 4; 5]  ;;
<span class="org-keyword">val</span> <span class="org-variable-name">it</span> : <span class="org-type">int </span>= 12345
&gt;

<span class="org-comment-delimiter">// </span><span class="org-comment">Array.fold </span>
<span class="org-comment-delimiter">// </span>
<span class="org-comment-delimiter">//</span>
- Array.fold ;;  
<span class="org-keyword">val</span> it : (('a -&gt; 'b -&gt; 'a) -&gt; 'a -&gt; 'b [] -&gt; 'a) 
&gt; 

- Array.fold (<span class="org-keyword">fun</span> <span class="org-variable-name">acc</span> <span class="org-variable-name">x</span> -&gt; 10 * acc + x) 0 [| 1; 2; 3; 4; 5 |]  ;;
<span class="org-keyword">val</span> <span class="org-variable-name">it</span> : <span class="org-type">int </span>= 12345
&gt; 

<span class="org-comment-delimiter">// </span><span class="org-comment">Fold left for Arrays</span>
</pre>
</div>


<p>
Example: Implementing Higher Order Functions and recursive functions
with fold.
</p>

<div class="org-src-container">

<pre class="src src-fsharp"><span class="org-comment-delimiter">// </span><span class="org-comment">Implementing fold_left for lists </span>
<span class="org-comment-delimiter">//</span>
<span class="org-keyword">let</span> <span class="org-keyword">rec</span> <span class="org-function-name">fold_left</span> <span class="org-variable-name">f</span> <span class="org-variable-name">xs</span> <span class="org-variable-name">acc</span> =
    <span class="org-keyword">match</span> xs <span class="org-keyword">with</span> 
    | []      -&gt;   acc 
    | hd::tl  -&gt;   fold_left f tl (f acc hd)
;;

<span class="org-keyword">val</span> <span class="org-variable-name">fold_left</span> : <span class="org-type">f:('a </span>-&gt; 'b -&gt; 'a) -&gt; xs:'b list -&gt; acc:'a -&gt; 'a

- fold_left (<span class="org-keyword">fun</span> <span class="org-variable-name">acc</span> <span class="org-variable-name">x</span> -&gt; 10 * acc + x) [1; 2; 3; 4 ; 5] 0 ;; 
<span class="org-keyword">val</span> <span class="org-variable-name">it</span> : <span class="org-type">int </span>= 12345
&gt; 

<span class="org-keyword">let</span> <span class="org-function-name">length</span> <span class="org-variable-name">xs</span> = fold_left (<span class="org-keyword">fun</span> <span class="org-variable-name">acc</span> <span class="org-variable-name">x</span> -&gt; acc + 1) xs 0

&gt; length [<span class="org-string">"a"</span>; <span class="org-string">"b"</span>; <span class="org-string">"c"</span>; <span class="org-string">"d"</span> ] ;;
<span class="org-keyword">val</span> <span class="org-variable-name">it</span> : <span class="org-type">int </span>= 4
&gt; length [ ] ;;                  
<span class="org-keyword">val</span> <span class="org-variable-name">it</span> : <span class="org-type">int </span>= 0
&gt; 

- <span class="org-keyword">let</span> <span class="org-function-name">sum</span> xs  = fold_left (<span class="org-keyword">fun</span> <span class="org-variable-name">acc</span> <span class="org-variable-name">x</span> -&gt; acc + x) xs 0 ;;

&gt; sum [1; 2; 3; 4; 5; 6] ;;                             
<span class="org-keyword">val</span> <span class="org-variable-name">it</span> : <span class="org-type">int </span>= 21
&gt; 

&gt; <span class="org-keyword">let</span> <span class="org-function-name">product</span> xs = fold_left (<span class="org-keyword">fun</span> <span class="org-variable-name">acc</span> <span class="org-variable-name">x</span> -&gt; acc * x) xs 1 ;;  

<span class="org-keyword">val</span> <span class="org-variable-name">product</span> : <span class="org-type">xs:int list </span>-&gt; int

&gt; product [1; 2; 3; 4; 5; 6] ;;
<span class="org-keyword">val</span> <span class="org-variable-name">it</span> : <span class="org-type">int </span>= 720
&gt; 

- <span class="org-keyword">let</span> <span class="org-function-name">reverse</span> xs = fold_left (<span class="org-keyword">fun</span> <span class="org-variable-name">acc</span> <span class="org-variable-name">x</span> -&gt; x :: acc) xs []
- ;;

<span class="org-keyword">val</span> <span class="org-variable-name">reverse</span> : <span class="org-type">xs:'a list </span>-&gt; 'a list

&gt; reverse [1; 2; 3; 4; 5 ] ;;
<span class="org-keyword">val</span> <span class="org-variable-name">it</span> : <span class="org-type">int list </span>= [5; 4; 3; 2; 1]
&gt; 

<span class="org-keyword">let</span> <span class="org-function-name">fold_right</span> <span class="org-variable-name">f</span> <span class="org-variable-name">xs</span> <span class="org-variable-name">acc</span> =
  fold_left (<span class="org-keyword">fun</span> <span class="org-variable-name">acc</span> <span class="org-variable-name">x</span> -&gt; f x acc) (reverse xs) acc
;;
     
<span class="org-keyword">val</span> <span class="org-variable-name">fold_right</span> : <span class="org-type">f:('a </span>-&gt; 'b -&gt; 'b) -&gt; xs:'a list -&gt; acc:'b -&gt; 'b

- fold_right (<span class="org-keyword">fun</span> <span class="org-variable-name">x</span> <span class="org-variable-name">acc</span> -&gt; 10 * acc + x) [1; 2; 3; 4; 5] 0 ;;
<span class="org-keyword">val</span> <span class="org-variable-name">it</span> : <span class="org-type">int </span>= 54321
&gt; 

<span class="org-comment-delimiter">// </span><span class="org-comment">Reverse map </span>
<span class="org-comment-delimiter">//</span>
- <span class="org-keyword">let</span> <span class="org-function-name">rev_map</span> f xs = fold_left (<span class="org-keyword">fun</span> <span class="org-variable-name">acc</span> <span class="org-variable-name">x</span> -&gt; (f x)::acc) xs [] ;;  

<span class="org-keyword">val</span> <span class="org-variable-name">rev_map</span> : <span class="org-type">f:('a </span>-&gt; 'b) -&gt; xs:'a list -&gt; 'b list

- rev_map (<span class="org-keyword">fun</span> <span class="org-variable-name">x</span> -&gt; x * 2) [1; 2; 3; 4; 5; 6] ;;
<span class="org-keyword">val</span> <span class="org-variable-name">it</span> : <span class="org-type">int list </span>= [12; 10; 8; 6; 4; 2]
&gt; 

- <span class="org-keyword">let</span> <span class="org-function-name">map</span> f xs = reverse ( fold_left (<span class="org-keyword">fun</span> <span class="org-variable-name">acc</span> <span class="org-variable-name">x</span> -&gt; (f x)::acc) xs [] ) ;;

<span class="org-keyword">val</span> <span class="org-variable-name">map</span> : <span class="org-type">f:('a </span>-&gt; 'b) -&gt; xs:'a list -&gt; 'b list

- map (<span class="org-keyword">fun</span> <span class="org-variable-name">x</span> -&gt; x * 2) [1; 2; 3; 4; 5; 6] ;;
<span class="org-keyword">val</span> <span class="org-variable-name">it</span> : <span class="org-type">int list </span>= [2; 4; 6; 8; 10; 12]
&gt; 

<span class="org-comment-delimiter">// </span><span class="org-comment">Or </span>
<span class="org-comment-delimiter">// </span>
<span class="org-keyword">let</span> <span class="org-function-name">rev_fold_left</span> <span class="org-variable-name">f</span>  <span class="org-variable-name">xs</span> <span class="org-variable-name">acc</span> = reverse (fold_left f xs acc) ;;

<span class="org-keyword">val</span> rev_fold_left :
  f:('a list -&gt; 'b -&gt; 'a list) -&gt; xs:'b list -&gt; acc:'a list -&gt; 'a list

<span class="org-comment-delimiter">// </span><span class="org-comment">Map with fold left and reverse </span>
<span class="org-comment-delimiter">//</span>
<span class="org-comment-delimiter">//</span>
&gt; <span class="org-keyword">let</span> <span class="org-function-name">map</span> f xs = rev_fold_left (<span class="org-keyword">fun</span> <span class="org-variable-name">acc</span> <span class="org-variable-name">x</span> -&gt; (f x)::acc) xs [] ;;

<span class="org-keyword">val</span> <span class="org-variable-name">map</span> : <span class="org-type">f:('a </span>-&gt; 'b) -&gt; xs:'b list -&gt; 'b list

- map (<span class="org-keyword">fun</span> <span class="org-variable-name">x</span> -&gt; x * 2) [1; 2; 3; 4; 5; 6] ;;
<span class="org-keyword">val</span> <span class="org-variable-name">it</span> : <span class="org-type">int list </span>= [2; 4; 6; 8; 10; 12]
&gt; 

<span class="org-comment-delimiter">// </span><span class="org-comment">Map with fold right </span>
<span class="org-comment-delimiter">//</span>
&gt; <span class="org-keyword">let</span> <span class="org-function-name">map</span> f xs = fold_right (<span class="org-keyword">fun</span> <span class="org-variable-name">x</span> <span class="org-variable-name">acc</span> -&gt; (f x)::acc) xs [] ;;

<span class="org-keyword">val</span> <span class="org-variable-name">map</span> : <span class="org-type">f:('a </span>-&gt; 'b) -&gt; xs:'a list -&gt; 'b list

&gt; map (<span class="org-keyword">fun</span> <span class="org-variable-name">x</span> -&gt; x * 2) [1; 2; 3; 4; 5; 6] ;;
<span class="org-keyword">val</span> <span class="org-variable-name">it</span> : <span class="org-type">int list </span>= [2; 4; 6; 8; 10; 12]
&gt; 

<span class="org-comment-delimiter">// </span><span class="org-comment">Filter with fold left and reverse</span>
<span class="org-comment-delimiter">//</span>
<span class="org-keyword">let</span> <span class="org-function-name">filter</span> <span class="org-variable-name">f</span> <span class="org-variable-name">xs</span> = rev_fold_left (<span class="org-keyword">fun</span> <span class="org-variable-name">acc</span> <span class="org-variable-name">x</span> -&gt; <span class="org-keyword">if</span> (f x) <span class="org-keyword">then</span> (x::acc) <span class="org-keyword">else</span> acc) xs [] ;;

<span class="org-keyword">val</span> <span class="org-variable-name">filter</span> : <span class="org-type">f:('a </span>-&gt; bool) -&gt; xs:'a list -&gt; 'a list

- filter (<span class="org-keyword">fun</span> <span class="org-variable-name">x</span> -&gt; x % 2 = 0) [1; 2; 3; 4; 5; 6; 7; 8; 9 ] ;; 
<span class="org-keyword">val</span> <span class="org-variable-name">it</span> : <span class="org-type">int list </span>= [2; 4; 6; 8]
&gt; 

<span class="org-comment-delimiter">// </span><span class="org-comment">Filter with fold right </span>
<span class="org-comment-delimiter">//</span>
<span class="org-keyword">let</span> <span class="org-function-name">filter</span> <span class="org-variable-name">f</span> <span class="org-variable-name">xs</span> =
  fold_right (<span class="org-keyword">fun</span> <span class="org-variable-name">x</span> <span class="org-variable-name">acc</span> -&gt;  <span class="org-keyword">if</span> (f x)
                            <span class="org-keyword">then</span> x::acc
                            <span class="org-keyword">else</span> acc
             )
             xs
             []
             ;;

-  filter (<span class="org-keyword">fun</span> <span class="org-variable-name">x</span> -&gt; x % 2 = 0) [1; 2; 3; 4; 5; 6; 7; 8; 9 ] ;; 
<span class="org-keyword">val</span> <span class="org-variable-name">it</span> : <span class="org-type">int list </span>= [2; 4; 6; 8]
&gt; 



<span class="org-keyword">let</span> <span class="org-function-name">take</span> <span class="org-variable-name">n</span> <span class="org-variable-name">xs</span> =
  <span class="org-keyword">let</span> <span class="org-variable-name">_</span>, <span class="org-variable-name">result</span> = 
    fold_left (<span class="org-keyword">fun</span> <span class="org-variable-name">acc</span> <span class="org-variable-name">x</span> -&gt; <span class="org-keyword">let</span> (c, xss) = acc <span class="org-keyword">in</span>
                            <span class="org-keyword">if</span> c = 0
                            <span class="org-keyword">then</span>  (0, xss)
                            <span class="org-keyword">else</span>  (c - 1, x::xss))
              xs
              (n, [])

  <span class="org-keyword">in</span> reverse result 

            ;;

- take ;;
<span class="org-keyword">val</span> it : (int -&gt; 'a list -&gt; 'a list) = &lt;<span class="org-keyword">fun</span>:<span class="org-type">clo@202</span>-3&gt;
&gt; 


&gt; <span class="org-variable-name">take</span> 3 [1; 2; 3 ; 4; 5; 6; 7; 8] ;;               
<span class="org-keyword">val</span> <span class="org-variable-name">it</span> : <span class="org-type">int list </span>= [1; 2; 3]
&gt; 

- <span class="org-variable-name">take</span> 18 [1; 2; 3 ; 4; 5; 6; 7; 8] ;;
<span class="org-keyword">val</span> <span class="org-variable-name">it</span> : <span class="org-type">int list </span>= [1; 2; 3; 4; 5; 6; 7; 8]
&gt; 

<span class="org-comment-delimiter">// </span><span class="org-comment">drop with fold left </span>
<span class="org-comment-delimiter">// </span>
<span class="org-keyword">let</span> <span class="org-function-name">drop</span> <span class="org-variable-name">n</span> <span class="org-variable-name">xs</span> =
  <span class="org-keyword">let</span> <span class="org-variable-name">_</span>, <span class="org-variable-name">result</span> = 
    <span class="org-variable-name">fold_left</span> (<span class="org-keyword">fun</span> <span class="org-variable-name">acc</span> <span class="org-variable-name">x</span> -&gt; <span class="org-keyword">let</span> (c, xss) = acc <span class="org-keyword">in</span>
                            <span class="org-keyword">if</span> c = 0
                            <span class="org-keyword">then</span>  (0, x::xss)
                            <span class="org-keyword">else</span>  (c - 1, xss))
              xs
              (n, [])

  <span class="org-keyword">in</span> reverse result 

            ;;

<span class="org-keyword">val</span> <span class="org-variable-name">drop</span> : <span class="org-type">n:int </span>-&gt; xs:'a list -&gt; 'a list


- drop 3 [1; 2; 3 ; 4; 5; 6; 7; 8] ;;              
<span class="org-keyword">val</span> <span class="org-variable-name">it</span> : <span class="org-type">int list </span>= [4; 5; 6; 7; 8]
&gt; 
- drop 13 [1; 2; 3 ; 4; 5; 6; 7; 8] ;;
<span class="org-keyword">val</span> <span class="org-variable-name">it</span> : <span class="org-type">int list </span>= []
&gt; 

<span class="org-keyword">let</span> <span class="org-function-name">take_while</span> <span class="org-variable-name">f</span> <span class="org-variable-name">xs</span> =
  fold_right   (<span class="org-keyword">fun</span> <span class="org-variable-name">x</span> <span class="org-variable-name">acc</span> -&gt;  <span class="org-keyword">if</span> (f x)
                              <span class="org-keyword">then</span>  x::acc
                              <span class="org-keyword">else</span>  acc )

               xs
               []
;;


<span class="org-keyword">let</span> <span class="org-function-name">take_while</span> <span class="org-variable-name">f</span> <span class="org-variable-name">xs</span> =
  fold_right   (<span class="org-keyword">fun</span> <span class="org-variable-name">x</span> <span class="org-variable-name">acc</span> -&gt;  <span class="org-keyword">if</span> (f x)
                              <span class="org-keyword">then</span>  x::acc
                              <span class="org-keyword">else</span>  <span class="org-keyword">match</span> acc <span class="org-keyword">with</span>
                                    |  []     -&gt; []
                                    |  _::tl -&gt; tl
               )

               xs
               []
;;
<span class="org-keyword">val</span> <span class="org-variable-name">take_while</span> : <span class="org-type">f:('a </span>-&gt; bool) -&gt; xs:'a list -&gt; 'a list

&gt; take_while (<span class="org-keyword">fun</span> <span class="org-variable-name">x</span> -&gt; x &lt; 10) [2; 8 ; 9 ; 26 ; 7; 10; 53] ;;
<span class="org-keyword">val</span> <span class="org-variable-name">it</span> : <span class="org-type">int list </span>= [2; 8; 9]
&gt; 



<span class="org-keyword">let</span> <span class="org-function-name">find</span> <span class="org-variable-name">f</span> <span class="org-variable-name">xs</span> =
  fold_left (<span class="org-keyword">fun</span> <span class="org-variable-name">acc</span> <span class="org-variable-name">x</span> -&gt; <span class="org-keyword">if</span> (f x)
                          <span class="org-keyword">then</span> Some x
                          <span class="org-keyword">else</span> None 
            )
            xs
            None
;;
  
<span class="org-keyword">val</span> <span class="org-variable-name">find</span> : <span class="org-type">f:('a </span>-&gt; bool) -&gt; xs:'a list -&gt; 'a option

- find (<span class="org-keyword">fun</span> <span class="org-variable-name">x</span> -&gt; x * x &gt; 40) [1; 2; 6; 5; 4; 8; 10; 20 ; 9 ] ;;
<span class="org-keyword">val</span> <span class="org-variable-name">it</span> : <span class="org-type">int option </span>= Some 9
&gt; 

- find (<span class="org-keyword">fun</span> <span class="org-variable-name">x</span> -&gt; x * x &gt; 400) [1; 2; 6; 5; 4; 8; 10; 20 ; 9 ] ;;
<span class="org-keyword">val</span> <span class="org-variable-name">it</span> : <span class="org-type">int option </span>= None
&gt; 


<span class="org-comment-delimiter">// </span><span class="org-comment">Map with side-effect </span>
<span class="org-comment-delimiter">//</span>
<span class="org-keyword">let</span> <span class="org-function-name">for_each</span> <span class="org-variable-name">f</span> <span class="org-variable-name">xs</span> =
  fold_left (<span class="org-keyword">fun</span> <span class="org-variable-name">acc</span> <span class="org-variable-name">x</span> -&gt; f x)
            xs
            ()
            ;;

<span class="org-keyword">val</span> <span class="org-variable-name">for_each</span> : <span class="org-type">f:('a </span>-&gt; unit) -&gt; xs:'a list -&gt; unit

&gt; for_each (<span class="org-keyword">fun</span> <span class="org-variable-name">x</span> -&gt; printfn <span class="org-string">"x = %d"</span> x) [2; 3; 4; 5; 6] ;;
x = 2
x = 3
x = 4
x = 5
x = 6
<span class="org-keyword">val</span> <span class="org-variable-name">it</span> : <span class="org-type">unit </span>= ()
&gt; 

<span class="org-comment-delimiter">// </span><span class="org-comment">Filter map - fusion / optimization  </span>
<span class="org-comment-delimiter">//</span>
<span class="org-comment-delimiter">// </span><span class="org-comment">(Eliminate intermediate data structure )</span>
<span class="org-comment-delimiter">//</span>

<span class="org-keyword">let</span> <span class="org-function-name">filter_map</span> <span class="org-variable-name">f_filter</span> <span class="org-variable-name">f_map</span> <span class="org-variable-name">xs</span> = 
  fold_right (<span class="org-keyword">fun</span> <span class="org-variable-name">x</span> <span class="org-variable-name">acc</span> -&gt;  <span class="org-keyword">if</span> (f_filter x)
                            <span class="org-keyword">then</span> (f_map x)::acc
                            <span class="org-keyword">else</span> acc
             )
             xs
             []
;;
             
<span class="org-keyword">val</span> filter_map :
  f_filter:('a -&gt; bool) -&gt; f_map:('a -&gt; 'b) -&gt; xs:'a list -&gt; 'b list

- filter_map (<span class="org-keyword">fun</span> <span class="org-variable-name">x</span> -&gt; x % 2 = 0) (<span class="org-keyword">fun</span> <span class="org-variable-name">x</span> -&gt; x + 3) [1; 5; 2; 6; 8; 7]
- ;;             
<span class="org-keyword">val</span> <span class="org-variable-name">it</span> : <span class="org-type">int list </span>= [5; 9; 11]
&gt; 


 <span class="org-comment-delimiter">// </span><span class="org-comment">Without optimization</span>
- map (<span class="org-keyword">fun</span> <span class="org-variable-name">x</span> -&gt; x + 3) (filter (<span class="org-keyword">fun</span> <span class="org-variable-name">x</span> -&gt; x % 2 = 0) [1; 5; 2; 6; 8; 7]) ;;
<span class="org-keyword">val</span> <span class="org-variable-name">it</span> : <span class="org-type">int list </span>= [5; 9; 11]
&gt; 
-
</pre>
</div>
</div>
</div>
</div>

<div id="outline-container-sec-1-10-5" class="outline-4">
<h4 id="sec-1-10-5"><span class="section-number-4">1.10.5</span> For Each, Impure map</h4>
<div class="outline-text-4" id="text-1-10-5">
<p>
For each is an <span class="underline">impure higher order function</span> which performs
side-effect on each element of a list, array or sequence. Unlike map
this function neither have a standard name or return anything.
</p>

<p>
<b>Scheme</b>
</p>

<div class="org-src-container">

<pre class="src src-scheme">&gt; <span class="org-rainbow-delimiters-depth-1">(</span><span class="org-keyword">for-each</span> <span class="org-rainbow-delimiters-depth-2">(</span><span class="org-keyword">lambda</span> <span class="org-rainbow-delimiters-depth-3">(</span>i<span class="org-rainbow-delimiters-depth-3">)</span> <span class="org-rainbow-delimiters-depth-3">(</span>display i<span class="org-rainbow-delimiters-depth-3">)</span> <span class="org-rainbow-delimiters-depth-3">(</span>newline<span class="org-rainbow-delimiters-depth-3">)</span><span class="org-rainbow-delimiters-depth-2">)</span>  '<span class="org-rainbow-delimiters-depth-2">(</span>1 2 3 4 5 6<span class="org-rainbow-delimiters-depth-2">)</span><span class="org-rainbow-delimiters-depth-1">)</span>
1
2
3
4
5
6
&gt;

&gt; <span class="org-rainbow-delimiters-depth-1">(</span><span class="org-keyword">for-each</span>
   <span class="org-rainbow-delimiters-depth-2">(</span><span class="org-keyword">lambda</span> <span class="org-rainbow-delimiters-depth-3">(</span>a b c<span class="org-rainbow-delimiters-depth-3">)</span>
      <span class="org-rainbow-delimiters-depth-3">(</span>display a<span class="org-rainbow-delimiters-depth-3">)</span> <span class="org-rainbow-delimiters-depth-3">(</span>display b<span class="org-rainbow-delimiters-depth-3">)</span> <span class="org-rainbow-delimiters-depth-3">(</span>display c<span class="org-rainbow-delimiters-depth-3">)</span>
      <span class="org-rainbow-delimiters-depth-3">(</span>newline<span class="org-rainbow-delimiters-depth-3">)</span>
    <span class="org-rainbow-delimiters-depth-2">)</span>
   '<span class="org-rainbow-delimiters-depth-2">(</span>a b c d e f<span class="org-rainbow-delimiters-depth-2">)</span>
   '<span class="org-rainbow-delimiters-depth-2">(</span>1 2 3 4 5 6<span class="org-rainbow-delimiters-depth-2">)</span>
   '<span class="org-rainbow-delimiters-depth-2">(</span><span class="org-string">"x"</span> <span class="org-string">"y"</span> <span class="org-string">"z"</span> <span class="org-string">"w"</span> <span class="org-string">"h"</span> <span class="org-string">"k"</span><span class="org-rainbow-delimiters-depth-2">)</span><span class="org-rainbow-delimiters-depth-1">)</span>
a1x
b2y
c3z
d4w
e5h
f6k
</pre>
</div>

<p>
<b>Haskell</b>
</p>

<div class="org-src-container">

<pre class="src src-haskell"><span class="org-haskell-operator">&gt;</span> <span class="org-haskell-keyword">import</span> <span class="org-haskell-keyword">qualified</span> <span class="org-haskell-constructor">Control.Monad</span> <span class="org-haskell-keyword">as</span> <span class="org-haskell-constructor">M</span>


<span class="org-haskell-operator">&gt;</span> <span class="org-haskell-constructor">:</span>t <span class="org-haskell-constructor">M</span><span class="org-haskell-operator">.</span>mapM_
<span class="org-function-name">M.mapM_</span> <span class="org-haskell-operator">::</span> <span class="org-haskell-constructor">Monad</span> m <span class="org-haskell-operator">=&gt;</span> (a <span class="org-haskell-operator">-&gt;</span> m b) <span class="org-haskell-operator">-&gt;</span> [a] <span class="org-haskell-operator">-&gt;</span> m <span class="org-haskell-constructor">()</span>
<span class="org-haskell-operator">&gt;</span> 

<span class="org-haskell-operator">&gt;</span> <span class="org-haskell-constructor">:</span>t putStrLn
<span class="org-function-name">putStrLn</span> <span class="org-haskell-operator">::</span> <span class="org-haskell-constructor">String</span> <span class="org-haskell-operator">-&gt;</span> <span class="org-haskell-constructor">IO</span> <span class="org-haskell-constructor">()</span>
<span class="org-haskell-operator">&gt;</span> 

<span class="org-haskell-operator">&gt;</span> <span class="org-haskell-constructor">M</span><span class="org-haskell-definition">.</span>mapM_ putStrLn [<span class="org-string">"string 0"</span><span class="org-haskell-operator">,</span> <span class="org-string">"string 1"</span><span class="org-haskell-operator">,</span> <span class="org-string">"string 2"</span><span class="org-haskell-operator">,</span> <span class="org-string">"string 3"</span>]
<span class="org-haskell-definition">string</span> 0
<span class="org-haskell-definition">string</span> 1
<span class="org-haskell-definition">string</span> 2
<span class="org-haskell-definition">string</span> 3
<span class="org-haskell-operator">&gt;</span> 

<span class="org-haskell-operator">&gt;</span> <span class="org-haskell-constructor">M</span><span class="org-haskell-definition">.</span>mapM_ (<span class="org-haskell-operator">\</span> x <span class="org-haskell-operator">-&gt;</span> putStrLn (show x))  [1<span class="org-haskell-operator">,</span> 2<span class="org-haskell-operator">,</span> 3<span class="org-haskell-operator">,</span> 4<span class="org-haskell-operator">,</span> 5]
1
2
3
4
5
</pre>
</div>

<p>
<b>Common Lisp</b>
</p>

<div class="org-src-container">

<pre class="src src-lisp">&gt; (mapc #'print '(1 2 3 3 4))

1
2
3
3
4
</pre>
</div>

<p>
<b>Scala</b>
</p>

<div class="org-src-container">

<pre class="src src-scala">scala&gt; <span class="org-keyword">var</span> <span class="org-scala-font-lockXvar">xs</span> <span class="org-keyword">=</span> <span class="org-constant">List</span>(<span class="org-constant">1.0</span>, <span class="org-constant">2.0</span>, <span class="org-constant">3.0</span>, <span class="org-constant">4.0</span>, <span class="org-constant">5.0</span>, <span class="org-constant">6.0</span>)
<span class="org-function-name">xs</span><span class="org-keyword">:</span> <span class="org-type">List</span>[<span class="org-constant">Double</span>] <span class="org-keyword">=</span> <span class="org-constant">List</span>(<span class="org-constant">1.0</span>, <span class="org-constant">2.0</span>, <span class="org-constant">3.0</span>, <span class="org-constant">4.0</span>, <span class="org-constant">5.0</span>, <span class="org-constant">6.0</span>)

scala&gt; xs.foreach(println)
<span class="org-constant">1.0</span>
<span class="org-constant">2.0</span>
<span class="org-constant">3.0</span>
<span class="org-constant">4.0</span>
<span class="org-constant">5.0</span>
<span class="org-constant">6.0</span>

scala&gt; xs.foreach(x <span class="org-keyword">=&gt;</span> println( <span class="org-string">"x = %.3f"</span>.format(x)))
x <span class="org-keyword">=</span> <span class="org-constant">1</span>,<span class="org-constant">000</span>
x <span class="org-keyword">=</span> <span class="org-constant">2</span>,<span class="org-constant">000</span>
x <span class="org-keyword">=</span> <span class="org-constant">3</span>,<span class="org-constant">000</span>
x <span class="org-keyword">=</span> <span class="org-constant">4</span>,<span class="org-constant">000</span>
x <span class="org-keyword">=</span> <span class="org-constant">5</span>,<span class="org-constant">000</span>
x <span class="org-keyword">=</span> <span class="org-constant">6</span>,<span class="org-constant">000</span>
</pre>
</div>

<p>
<b>Ocaml</b>
</p>

<pre class="example">
&gt; List.iter ;;
- : ('a -&gt; unit) -&gt; 'a list -&gt; unit = &lt;fun&gt;

&gt; List.iter (fun x -&gt; print_int x ; print_string "\n") [1 ; 2; 3; 4; 5] ;;
1
2
3
4
5
- : unit = ()
</pre>


<p>
<b>F#</b>
</p>

<pre class="example">
&gt; List.iter ;;
val it : (('a -&gt; unit) -&gt; 'a list -&gt; unit) = &lt;fun:clo@1&gt;

&gt; List.iter (fun x -&gt; printfn "x = %d" x) [1; 2; 3; 4; 5] ;;
x = 1
x = 2
x = 3
x = 4
x = 5
val it : unit = ()
&gt;

&gt; List.iter2 ;;
val it : (('a -&gt; 'b -&gt; unit) -&gt; 'a list -&gt; 'b list -&gt; unit) = &lt;fun:clo@1&gt;
&gt; 

- List.iter2 (fun a b -&gt; printfn "a = %d b = %d" a b) [2; 3; 4; 5] [1; 2; 3; 4] - ;;
a = 2 b = 1
a = 3 b = 2
a = 4 b = 3
a = 5 b = 4
val it : unit = ()
&gt; 

- Array.iter ;; 
val it : (('a -&gt; unit) -&gt; 'a [] -&gt; unit) = &lt;fun:it@6-4&gt;
&gt; 
- 

- Array.iter (fun x -&gt; printfn "x = %d" x) [| 1; 2; 3; 4 |] ;;
x = 1
x = 2
x = 3
x = 4
val it : unit = ()
&gt;
</pre>

<p>
<b>Python</b>
</p>

<p>
This function is not in Python standard library however, it can be
defined as this.
</p>

<div class="org-src-container">

<pre class="src src-python"><span class="org-keyword">def</span> <span class="org-function-name">for_each</span>(f, * xss):
    <span class="org-keyword">for</span> xs <span class="org-keyword">in</span> <span class="org-builtin">zip</span>(* xss):
        f(*xs)

&gt;&gt;&gt; for_each (<span class="org-keyword">print</span>, [1, 2, 4, 5, 6])
1
2
4
5
6

&gt;&gt;&gt; for_each (<span class="org-keyword">lambda</span> a, b: <span class="org-keyword">print</span> (a, b), [1, 2, 3, 4, 5, 6], [<span class="org-string">"a"</span>, <span class="org-string">"b"</span>, <span class="org-string">"c"</span>, <span class="org-string">"d"</span>, <span class="org-string">"e"</span>, <span class="org-string">"f"</span>])
1 a
2 b
3 c
4 d
5 e
6 f
</pre>
</div>

<p>
<b>Clojure</b> 
</p>

<div class="org-src-container">

<pre class="src src-clojure">user=&gt; <span class="org-rainbow-delimiters-depth-1">(</span><span class="org-keyword">defn</span> <span class="org-function-name">f</span> <span class="org-rainbow-delimiters-depth-2">[</span>a b<span class="org-rainbow-delimiters-depth-2">]</span> <span class="org-rainbow-delimiters-depth-2">(</span>println <span class="org-rainbow-delimiters-depth-3">(</span>format <span class="org-string">"a = %s , b = %s"</span> a b<span class="org-rainbow-delimiters-depth-3">)</span><span class="org-rainbow-delimiters-depth-2">)</span><span class="org-rainbow-delimiters-depth-1">)</span>
#'<span class="org-type">user</span><span class="org-default">/</span>f


<span class="org-rainbow-delimiters-depth-1">(</span><span class="org-keyword">defn</span> <span class="org-function-name">for-each</span> <span class="org-rainbow-delimiters-depth-2">[</span>f &amp; xss<span class="org-rainbow-delimiters-depth-2">]</span>
   <span class="org-rainbow-delimiters-depth-2">(</span><span class="org-keyword">doseq</span> <span class="org-rainbow-delimiters-depth-3">[</span>args <span class="org-rainbow-delimiters-depth-4">(</span>apply map vector xss<span class="org-rainbow-delimiters-depth-4">)</span><span class="org-rainbow-delimiters-depth-3">]</span>  <span class="org-rainbow-delimiters-depth-3">(</span>apply f args<span class="org-rainbow-delimiters-depth-3">)</span><span class="org-rainbow-delimiters-depth-2">)</span><span class="org-rainbow-delimiters-depth-1">)</span>


user=&gt; <span class="org-rainbow-delimiters-depth-1">(</span>for-each println <span class="org-rainbow-delimiters-depth-2">[</span>1 2 3 4<span class="org-rainbow-delimiters-depth-2">]</span><span class="org-rainbow-delimiters-depth-1">)</span>
1
2
3
4
<span class="org-constant">nil</span>


user=&gt; <span class="org-rainbow-delimiters-depth-1">(</span>for-each f <span class="org-rainbow-delimiters-depth-2">[</span>1 2 3 4<span class="org-rainbow-delimiters-depth-2">]</span> <span class="org-rainbow-delimiters-depth-2">[</span>3 4 5 6<span class="org-rainbow-delimiters-depth-2">]</span><span class="org-rainbow-delimiters-depth-1">)</span>
a = 1 , b = 3
a = 2 , b = 4
a = 3 , b = 5
a = 4 , b = 6
<span class="org-constant">nil</span>
user=&gt;
</pre>
</div>
</div>
</div>

<div id="outline-container-sec-1-10-6" class="outline-4">
<h4 id="sec-1-10-6"><span class="section-number-4">1.10.6</span> Apply</h4>
<div class="outline-text-4" id="text-1-10-6">
<p>
The function <span class="underline">apply</span> applies a function to a list or array of
arguments. It is common in dynamic languages like Lisp, Scheme,
Clojure, Javascript and Python.
</p>

<p>
See also: <a href="https://en.wikipedia.org/w/index.php?title=Apply&oldid=674998740">Apply Higher Oder Function - Wikipedia</a>
</p>

<p>
Example:
</p>

<p>
<b>Scheme</b>
</p>

<div class="org-src-container">

<pre class="src src-scheme">&gt; <span class="org-rainbow-delimiters-depth-1">(</span><span class="org-keyword">define</span> <span class="org-rainbow-delimiters-depth-2">(</span><span class="org-function-name">f1</span> x y z<span class="org-rainbow-delimiters-depth-2">)</span> <span class="org-rainbow-delimiters-depth-2">(</span>+ <span class="org-rainbow-delimiters-depth-3">(</span>* 2 x<span class="org-rainbow-delimiters-depth-3">)</span> <span class="org-rainbow-delimiters-depth-3">(</span>* 3 y<span class="org-rainbow-delimiters-depth-3">)</span> z<span class="org-rainbow-delimiters-depth-2">)</span><span class="org-rainbow-delimiters-depth-1">)</span>

&gt; <span class="org-rainbow-delimiters-depth-1">(</span>apply f1 '<span class="org-rainbow-delimiters-depth-2">(</span>1 2 3<span class="org-rainbow-delimiters-depth-2">)</span><span class="org-rainbow-delimiters-depth-1">)</span>
$1 = 11

&gt; <span class="org-rainbow-delimiters-depth-1">(</span>apply f1 1 2 '<span class="org-rainbow-delimiters-depth-2">(</span>3<span class="org-rainbow-delimiters-depth-2">)</span><span class="org-rainbow-delimiters-depth-1">)</span>
$2 = 11

&gt; <span class="org-rainbow-delimiters-depth-1">(</span>apply f1 1 '<span class="org-rainbow-delimiters-depth-2">(</span>2 3<span class="org-rainbow-delimiters-depth-2">)</span><span class="org-rainbow-delimiters-depth-1">)</span>
$3 = 11

&gt; <span class="org-rainbow-delimiters-depth-1">(</span>apply + '<span class="org-rainbow-delimiters-depth-2">(</span>1 2 3 4 5<span class="org-rainbow-delimiters-depth-2">)</span><span class="org-rainbow-delimiters-depth-1">)</span>
$1 = 15

<span class="org-comment-delimiter">;;; </span><span class="org-comment">The function apply can be used to transform a function of</span>
<span class="org-comment-delimiter">;;; </span><span class="org-comment">multiple arguments into a function of a single argument that</span>
<span class="org-comment-delimiter">;;; </span><span class="org-comment">takes a list of arguments</span>
<span class="org-comment-delimiter">;;;</span>

<span class="org-rainbow-delimiters-depth-1">(</span><span class="org-keyword">define</span> <span class="org-rainbow-delimiters-depth-2">(</span><span class="org-function-name">f-apply</span> f<span class="org-rainbow-delimiters-depth-2">)</span> 
   <span class="org-rainbow-delimiters-depth-2">(</span><span class="org-keyword">lambda</span> <span class="org-rainbow-delimiters-depth-3">(</span>xs<span class="org-rainbow-delimiters-depth-3">)</span> <span class="org-rainbow-delimiters-depth-3">(</span>apply f xs<span class="org-rainbow-delimiters-depth-3">)</span><span class="org-rainbow-delimiters-depth-2">)</span><span class="org-rainbow-delimiters-depth-1">)</span>

&gt; <span class="org-rainbow-delimiters-depth-1">(</span><span class="org-keyword">map</span> <span class="org-rainbow-delimiters-depth-2">(</span>f-apply f1<span class="org-rainbow-delimiters-depth-2">)</span> '<span class="org-rainbow-delimiters-depth-2">(</span><span class="org-rainbow-delimiters-depth-3">(</span>1 2 3<span class="org-rainbow-delimiters-depth-3">)</span> <span class="org-rainbow-delimiters-depth-3">(</span>3 4 5<span class="org-rainbow-delimiters-depth-3">)</span> <span class="org-rainbow-delimiters-depth-3">(</span>6 7 8<span class="org-rainbow-delimiters-depth-3">)</span><span class="org-rainbow-delimiters-depth-2">)</span> <span class="org-rainbow-delimiters-depth-1">)</span>
$2 = <span class="org-rainbow-delimiters-depth-1">(</span>11 23 41<span class="org-rainbow-delimiters-depth-1">)</span>

<span class="org-comment-delimiter">;;  </span><span class="org-comment">It can be also used to create a function that  maps a function </span>
<span class="org-comment-delimiter">;;  </span><span class="org-comment">of multiple arguments over a list of arguments.</span>
<span class="org-comment-delimiter">;;</span>
<span class="org-rainbow-delimiters-depth-1">(</span><span class="org-keyword">define</span> <span class="org-rainbow-delimiters-depth-2">(</span><span class="org-function-name">map-apply</span> f xss<span class="org-rainbow-delimiters-depth-2">)</span>
   <span class="org-rainbow-delimiters-depth-2">(</span><span class="org-keyword">map</span> <span class="org-rainbow-delimiters-depth-3">(</span><span class="org-keyword">lambda</span> <span class="org-rainbow-delimiters-depth-4">(</span>xs<span class="org-rainbow-delimiters-depth-4">)</span> <span class="org-rainbow-delimiters-depth-4">(</span>apply f xs<span class="org-rainbow-delimiters-depth-4">)</span><span class="org-rainbow-delimiters-depth-3">)</span> xss<span class="org-rainbow-delimiters-depth-2">)</span><span class="org-rainbow-delimiters-depth-1">)</span>

&gt; <span class="org-rainbow-delimiters-depth-1">(</span>map-apply f1  '<span class="org-rainbow-delimiters-depth-2">(</span><span class="org-rainbow-delimiters-depth-3">(</span>1 2 3<span class="org-rainbow-delimiters-depth-3">)</span> <span class="org-rainbow-delimiters-depth-3">(</span>3 4 5<span class="org-rainbow-delimiters-depth-3">)</span> <span class="org-rainbow-delimiters-depth-3">(</span>6 7 8<span class="org-rainbow-delimiters-depth-3">)</span><span class="org-rainbow-delimiters-depth-2">)</span><span class="org-rainbow-delimiters-depth-1">)</span>
$1 = <span class="org-rainbow-delimiters-depth-1">(</span>11 23 41<span class="org-rainbow-delimiters-depth-1">)</span>
</pre>
</div>

<p>
<b>Clojure</b>
</p>

<div class="org-src-container">

<pre class="src src-clojure">user=&gt; <span class="org-rainbow-delimiters-depth-1">(</span><span class="org-keyword">defn</span> <span class="org-function-name">f1</span> <span class="org-rainbow-delimiters-depth-2">[</span>x y z<span class="org-rainbow-delimiters-depth-2">]</span> <span class="org-rainbow-delimiters-depth-2">(</span>+ <span class="org-rainbow-delimiters-depth-3">(</span>* 2 x<span class="org-rainbow-delimiters-depth-3">)</span> <span class="org-rainbow-delimiters-depth-3">(</span>* 3 y<span class="org-rainbow-delimiters-depth-3">)</span> z<span class="org-rainbow-delimiters-depth-2">)</span><span class="org-rainbow-delimiters-depth-1">)</span>
#'<span class="org-type">user</span><span class="org-default">/</span>f1
user=&gt; 

<span class="org-comment-delimiter">;; </span><span class="org-comment">The higher order function apply is polymorphic.</span>
<span class="org-comment-delimiter">;;</span>
user=&gt; <span class="org-rainbow-delimiters-depth-1">(</span>apply f1 '<span class="org-rainbow-delimiters-depth-2">(</span>1 2 3<span class="org-rainbow-delimiters-depth-2">)</span><span class="org-rainbow-delimiters-depth-1">)</span>
11
user=&gt; <span class="org-rainbow-delimiters-depth-1">(</span>apply f1 <span class="org-rainbow-delimiters-depth-2">[</span>1 2 3<span class="org-rainbow-delimiters-depth-2">]</span><span class="org-rainbow-delimiters-depth-1">)</span>
11
user=&gt; <span class="org-rainbow-delimiters-depth-1">(</span>apply f1 1 <span class="org-rainbow-delimiters-depth-2">[</span>2 3<span class="org-rainbow-delimiters-depth-2">]</span><span class="org-rainbow-delimiters-depth-1">)</span>
11
user=&gt; <span class="org-rainbow-delimiters-depth-1">(</span>apply f1 1 2 <span class="org-rainbow-delimiters-depth-2">[</span> 3<span class="org-rainbow-delimiters-depth-2">]</span><span class="org-rainbow-delimiters-depth-1">)</span>
11
user=&gt; <span class="org-rainbow-delimiters-depth-1">(</span>apply f1 1 2 3 <span class="org-rainbow-delimiters-depth-2">[</span> <span class="org-rainbow-delimiters-depth-2">]</span><span class="org-rainbow-delimiters-depth-1">)</span>
11

user=&gt; <span class="org-rainbow-delimiters-depth-1">(</span>apply + <span class="org-rainbow-delimiters-depth-2">[</span>1 2 3 4 5<span class="org-rainbow-delimiters-depth-2">]</span><span class="org-rainbow-delimiters-depth-1">)</span>
15

user=&gt; <span class="org-rainbow-delimiters-depth-1">(</span><span class="org-keyword">defn</span> <span class="org-function-name">map-apply</span> <span class="org-rainbow-delimiters-depth-2">[</span>f xss<span class="org-rainbow-delimiters-depth-2">]</span>
              <span class="org-rainbow-delimiters-depth-2">(</span>map <span class="org-rainbow-delimiters-depth-3">(</span><span class="org-keyword">fn</span> <span class="org-rainbow-delimiters-depth-4">[</span>xs<span class="org-rainbow-delimiters-depth-4">]</span> <span class="org-rainbow-delimiters-depth-4">(</span>apply f xs<span class="org-rainbow-delimiters-depth-4">)</span><span class="org-rainbow-delimiters-depth-3">)</span> xss<span class="org-rainbow-delimiters-depth-2">)</span><span class="org-rainbow-delimiters-depth-1">)</span>
#'<span class="org-type">user</span><span class="org-default">/</span>map-apply
user=&gt; 


user=&gt; <span class="org-rainbow-delimiters-depth-1">(</span>map-apply f1 <span class="org-rainbow-delimiters-depth-2">[</span><span class="org-rainbow-delimiters-depth-3">[</span>1 2 3<span class="org-rainbow-delimiters-depth-3">]</span> <span class="org-rainbow-delimiters-depth-3">[</span>3 4 5<span class="org-rainbow-delimiters-depth-3">]</span> <span class="org-rainbow-delimiters-depth-3">[</span>6 7 8<span class="org-rainbow-delimiters-depth-3">]</span><span class="org-rainbow-delimiters-depth-2">]</span><span class="org-rainbow-delimiters-depth-1">)</span>
<span class="org-rainbow-delimiters-depth-1">(</span>11 23 41<span class="org-rainbow-delimiters-depth-1">)</span>
user=&gt;
</pre>
</div>

<p>
<b>Python</b>
</p>

<div class="org-src-container">

<pre class="src src-python"><span class="org-comment-delimiter"># </span><span class="org-comment">In Python the * asterisk notation is used to expand</span>
<span class="org-comment-delimiter"># </span><span class="org-comment">a list into function arguments.</span>
<span class="org-comment-delimiter">#</span>
&gt;&gt;&gt; <span class="org-variable-name">f1</span> = <span class="org-keyword">lambda</span> x, y, z: 2 * x + 3 * y + z
&gt;&gt;&gt; 
&gt;&gt;&gt; f1(1, 2, 3)
11
&gt;&gt;&gt; f1(*[1, 2, 3])
11
&gt;&gt;&gt; 

&gt;&gt;&gt; <span class="org-keyword">def</span> <span class="org-function-name">apply</span> (f, xs): <span class="org-keyword">return</span> f(*xs)
... 
&gt;&gt;&gt; 

&gt;&gt;&gt; <span class="org-builtin">apply</span> (f1, [1, 2, 3])
11


<span class="org-comment-delimiter">#</span>
<span class="org-comment-delimiter"># </span><span class="org-comment">The function apply can also be defined  as:</span>
<span class="org-comment-delimiter">#</span>

<span class="org-keyword">def</span> <span class="org-function-name">apply2</span> (f, * args):    
    <span class="org-keyword">return</span> f(*(<span class="org-builtin">tuple</span>(args[:-1]) + <span class="org-builtin">tuple</span>(args[-1])))
    
&gt;&gt;&gt; apply2 (f1, [1, 2, 3])
11
&gt;&gt;&gt; apply2 (f1, 1, [2, 3])
11
&gt;&gt;&gt; apply2 (f1, 1, 2, [3])
11
&gt;&gt;&gt; apply2 (f1, 1, 2, 3, [])
11
&gt;&gt;&gt; 

&gt;&gt;&gt; <span class="org-variable-name">f_apply</span> = <span class="org-keyword">lambda</span> f: <span class="org-keyword">lambda</span> xs: f(*xs)
&gt;&gt;&gt; 

&gt;&gt;&gt; <span class="org-builtin">list</span>(<span class="org-builtin">map</span> (f_apply(f1), [[1, 2, 3], [3, 4, 5], [6, 7, 8]]))
[11, 23, 41]
&gt;&gt;&gt; 

<span class="org-keyword">def</span> <span class="org-function-name">map_apply</span> (f, xss):
    <span class="org-keyword">return</span> <span class="org-builtin">map</span>(<span class="org-keyword">lambda</span> xs: f(*xs), xss)

&gt;&gt;&gt; map_apply(f1, [[1, 2, 3], [3, 4, 5], [6, 7, 8]])
&lt;<span class="org-builtin">map</span> <span class="org-builtin">object</span> at 0xb6daaaac&gt;
&gt;&gt;&gt; 
&gt;&gt;&gt; <span class="org-builtin">list</span>(map_apply(f1, [[1, 2, 3], [3, 4, 5], [6, 7, 8]]))
[11, 23, 41]
&gt;&gt;&gt;
</pre>
</div>
</div>
</div>
</div>
<div id="outline-container-sec-1-11" class="outline-3">
<h3 id="sec-1-11"><span class="section-number-3">1.11</span> Special Functions</h3>
<div class="outline-text-3" id="text-1-11">
</div><div id="outline-container-sec-1-11-1" class="outline-4">
<h4 id="sec-1-11-1"><span class="section-number-4">1.11.1</span> Identity Function</h4>
<div class="outline-text-4" id="text-1-11-1">
<p>
The identity function is a polymorphic function which returns the
value of its argument.
</p>

<div class="org-src-container">

<pre class="src src-haskell"> <span class="org-comment-delimiter">-- </span><span class="org-comment">This is a built-in Haskell function </span>
<span class="org-haskell-operator">&gt;</span> <span class="org-haskell-constructor">:</span>t id
<span class="org-function-name">id</span> <span class="org-haskell-operator">::</span> a <span class="org-haskell-operator">-&gt;</span> a
<span class="org-haskell-operator">&gt;</span> 

<span class="org-haskell-operator">&gt;</span> <span class="org-haskell-definition">id</span> 10 
10
<span class="org-haskell-operator">&gt;</span> <span class="org-haskell-definition">id</span> (<span class="org-haskell-constructor">Just</span> 100)
<span class="org-haskell-constructor">Just</span> 100
<span class="org-haskell-operator">&gt;</span> 
<span class="org-haskell-operator">&gt;</span> <span class="org-haskell-keyword">let</span> identity x <span class="org-haskell-operator">=</span> x
<span class="org-haskell-operator">&gt;</span> <span class="org-haskell-definition">identity</span> 200 
200
<span class="org-haskell-operator">&gt;</span>
</pre>
</div>
</div>
</div>

<div id="outline-container-sec-1-11-2" class="outline-4">
<h4 id="sec-1-11-2"><span class="section-number-4">1.11.2</span> Constant Function</h4>
<div class="outline-text-4" id="text-1-11-2">
<p>
The constant function returns the value of the first argument (the
constant) regardless of the value of second argument.
</p>

<div class="org-src-container">

<pre class="src src-haskell"><span class="org-haskell-operator">&gt;</span> <span class="org-haskell-constructor">:</span>t const
<span class="org-function-name">const</span> <span class="org-haskell-operator">::</span> a <span class="org-haskell-operator">-&gt;</span> b <span class="org-haskell-operator">-&gt;</span> a

<span class="org-haskell-operator">&gt;</span> <span class="org-haskell-keyword">let</span> const10 <span class="org-haskell-operator">=</span> const 10 
<span class="org-haskell-operator">&gt;</span> <span class="org-haskell-definition">const10</span> 100 
10
<span class="org-haskell-operator">&gt;</span> <span class="org-haskell-definition">const10</span> 300
10
<span class="org-haskell-operator">&gt;</span> <span class="org-haskell-definition">map</span> const10 [<span class="org-string">"a"</span><span class="org-haskell-operator">,</span> <span class="org-string">"b"</span><span class="org-haskell-operator">,</span> <span class="org-string">"c"</span><span class="org-haskell-operator">,</span> <span class="org-string">"d"</span>]
[10<span class="org-haskell-operator">,</span>10<span class="org-haskell-operator">,</span>10<span class="org-haskell-operator">,</span>10]
<span class="org-haskell-operator">&gt;</span>
</pre>
</div>

<p>
Python Implementation:
</p>

<div class="org-src-container">

<pre class="src src-python">&gt;&gt;&gt; <span class="org-variable-name">constant</span> = <span class="org-keyword">lambda</span> const: <span class="org-keyword">lambda</span> x: const
&gt;&gt;&gt; 

&gt;&gt;&gt; <span class="org-variable-name">const10</span> = constant(10)
&gt;&gt;&gt; 
&gt;&gt;&gt; const10(100)
10
&gt;&gt;&gt; const10(<span class="org-string">"hello world"</span>)
10
&gt;&gt;&gt;
</pre>
</div>
</div>
</div>

<div id="outline-container-sec-1-11-3" class="outline-4">
<h4 id="sec-1-11-3"><span class="section-number-4">1.11.3</span> List Constructor (Cons)</h4>
<div class="outline-text-4" id="text-1-11-3">
<p>
The cons operator is widely used in list recursive functions and
higher order functions that operates on lists. 
</p>

<p>
Scheme: 
</p>

<div class="org-src-container">

<pre class="src src-scheme">&gt; <span class="org-rainbow-delimiters-depth-1">(</span>cons 1 <span class="org-rainbow-delimiters-depth-2">(</span>cons 2 <span class="org-rainbow-delimiters-depth-3">(</span>cons 3 <span class="org-rainbow-delimiters-depth-4">(</span>cons 4 '<span class="org-rainbow-delimiters-depth-5">()</span><span class="org-rainbow-delimiters-depth-4">)</span><span class="org-rainbow-delimiters-depth-3">)</span><span class="org-rainbow-delimiters-depth-2">)</span><span class="org-rainbow-delimiters-depth-1">)</span>
<span class="org-rainbow-delimiters-depth-1">(</span>1 2 3 4<span class="org-rainbow-delimiters-depth-1">)</span>
</pre>
</div>


<p>
Haskell:
</p>

<div class="org-src-container">

<pre class="src src-haskell"> <span class="org-comment-delimiter">-- </span><span class="org-comment">Cons Operator </span>
 <span class="org-comment-delimiter">-- </span>
<span class="org-haskell-operator">&gt;</span> <span class="org-haskell-constructor">:</span>t (<span class="org-haskell-constructor">:</span>)
(<span class="org-haskell-definition">:</span>) <span class="org-haskell-operator">::</span> a <span class="org-haskell-operator">-&gt;</span> [a] <span class="org-haskell-operator">-&gt;</span> [a]

<span class="org-haskell-operator">&gt;</span> 1<span class="org-haskell-constructor">:[]</span>
[1]

<span class="org-haskell-operator">&gt;</span> 1<span class="org-haskell-constructor">:</span>2<span class="org-haskell-constructor">:</span>3<span class="org-haskell-constructor">:</span>4<span class="org-haskell-constructor">:[]</span>
[1<span class="org-haskell-operator">,</span>2<span class="org-haskell-operator">,</span>3<span class="org-haskell-operator">,</span>4]

<span class="org-haskell-operator">&gt;</span> <span class="org-haskell-keyword">let</span> cons <span class="org-haskell-operator">=</span> (<span class="org-haskell-constructor">:</span>)

<span class="org-haskell-operator">&gt;</span> (cons 1 (cons 2 (cons 3 (cons 4 <span class="org-haskell-constructor">[]</span>))))
[1<span class="org-haskell-operator">,</span>2<span class="org-haskell-operator">,</span>3<span class="org-haskell-operator">,</span>4]
</pre>
</div>

<p>
Ocaml and F#
</p>

<div class="org-src-container">

<pre class="src src-ocaml"><span class="org-tuareg-font-lock-operator">&gt;</span> 1<span class="org-tuareg-font-lock-operator">::[]</span> <span class="org-tuareg-font-lock-operator">;;</span>
<span class="org-tuareg-font-lock-governing">val</span> <span class="org-function-name">it</span> <span class="org-tuareg-font-lock-operator">:</span> int list <span class="org-tuareg-font-lock-operator">=</span> <span class="org-tuareg-font-lock-operator">[</span>1<span class="org-tuareg-font-lock-operator">]</span>
<span class="org-tuareg-font-lock-operator">&gt;</span> 
<span class="org-tuareg-font-lock-operator">-</span> 1<span class="org-tuareg-font-lock-operator">::</span>2<span class="org-tuareg-font-lock-operator">::</span>3<span class="org-tuareg-font-lock-operator">::[]</span> <span class="org-tuareg-font-lock-operator">;;</span>
<span class="org-tuareg-font-lock-governing">val</span> <span class="org-function-name">it</span> <span class="org-tuareg-font-lock-operator">:</span> int list <span class="org-tuareg-font-lock-operator">=</span> <span class="org-tuareg-font-lock-operator">[</span>1<span class="org-tuareg-font-lock-operator">;</span> 2<span class="org-tuareg-font-lock-operator">;</span> 3<span class="org-tuareg-font-lock-operator">]</span>
<span class="org-tuareg-font-lock-operator">&gt;</span> 

<span class="org-tuareg-font-lock-operator">-</span> <span class="org-tuareg-font-lock-governing">let</span> <span class="org-function-name">cons</span><span class="org-variable-name"> x xs</span> <span class="org-tuareg-font-lock-operator">=</span> x<span class="org-tuareg-font-lock-operator">::</span>xs <span class="org-tuareg-font-lock-operator">;;</span>

<span class="org-tuareg-font-lock-governing">val</span> <span class="org-function-name">cons</span> <span class="org-tuareg-font-lock-operator">:</span> <span class="org-constant">x</span><span class="org-tuareg-font-lock-operator">:</span>'a <span class="org-tuareg-font-lock-operator">-&gt;</span> <span class="org-constant">xs</span><span class="org-tuareg-font-lock-operator">:</span>'a list <span class="org-tuareg-font-lock-operator">-&gt;</span> 'a list

cons 1 <span class="org-tuareg-font-lock-operator">(</span>cons 2 <span class="org-tuareg-font-lock-operator">(</span>cons 3 <span class="org-tuareg-font-lock-operator">(</span>cons 4 <span class="org-tuareg-font-lock-operator">[])))</span> <span class="org-tuareg-font-lock-operator">;;</span>

<span class="org-tuareg-font-lock-operator">&gt;</span> cons 1 <span class="org-tuareg-font-lock-operator">(</span>cons 2 <span class="org-tuareg-font-lock-operator">(</span>cons 3 <span class="org-tuareg-font-lock-operator">(</span>cons 4 <span class="org-tuareg-font-lock-operator">[])))</span> <span class="org-tuareg-font-lock-operator">;;</span>  
<span class="org-tuareg-font-lock-governing">val</span> <span class="org-function-name">it</span> <span class="org-tuareg-font-lock-operator">:</span> int list <span class="org-tuareg-font-lock-operator">=</span> <span class="org-tuareg-font-lock-operator">[</span>1<span class="org-tuareg-font-lock-operator">;</span> 2<span class="org-tuareg-font-lock-operator">;</span> 3<span class="org-tuareg-font-lock-operator">;</span> 4<span class="org-tuareg-font-lock-operator">]</span>
<span class="org-tuareg-font-lock-operator">&gt;</span>
</pre>
</div>
</div>
</div>

<div id="outline-container-sec-1-11-4" class="outline-4">
<h4 id="sec-1-11-4"><span class="section-number-4">1.11.4</span> Zip</h4>
<div class="outline-text-4" id="text-1-11-4">
</div><div id="outline-container-sec-1-11-4-1" class="outline-5">
<h5 id="sec-1-11-4-1"><span class="section-number-5">1.11.4.1</span> Overview</h5>
<div class="outline-text-5" id="text-1-11-4-1">
<p>
The function zip and its variants combine two or more sequence into one sequence.
</p>

<p>
See also: <a href="https://en.wikipedia.org/wiki/Convolution_(computer_science)">Convolution (computer science)</a>
</p>
</div>
</div>

<div id="outline-container-sec-1-11-4-2" class="outline-5">
<h5 id="sec-1-11-4-2"><span class="section-number-5">1.11.4.2</span> Zip in Haskell</h5>
<div class="outline-text-5" id="text-1-11-4-2">
<div class="org-src-container">

<pre class="src src-haskell"><span class="org-haskell-operator">&gt;</span> <span class="org-haskell-constructor">:</span>t zip
<span class="org-function-name">zip</span> <span class="org-haskell-operator">::</span> [a] <span class="org-haskell-operator">-&gt;</span> [b] <span class="org-haskell-operator">-&gt;</span> [(a<span class="org-haskell-operator">,</span> b)]

<span class="org-haskell-operator">&gt;</span> <span class="org-haskell-definition">zip</span> [1<span class="org-haskell-operator">,</span> 2<span class="org-haskell-operator">,</span> 3<span class="org-haskell-operator">,</span> 4] [<span class="org-string">"a"</span><span class="org-haskell-operator">,</span> <span class="org-string">"b"</span><span class="org-haskell-operator">,</span> <span class="org-string">"c"</span>]
[(1<span class="org-haskell-operator">,</span><span class="org-string">"a"</span>)<span class="org-haskell-operator">,</span>(2<span class="org-haskell-operator">,</span><span class="org-string">"b"</span>)<span class="org-haskell-operator">,</span>(3<span class="org-haskell-operator">,</span><span class="org-string">"c"</span>)]
<span class="org-haskell-operator">&gt;</span> 

<span class="org-haskell-operator">&gt;</span> <span class="org-haskell-definition">zip</span> [1<span class="org-haskell-operator">,</span> 2<span class="org-haskell-operator">,</span> 3<span class="org-haskell-operator">,</span> 4] [<span class="org-string">"a"</span><span class="org-haskell-operator">,</span> <span class="org-string">"b"</span><span class="org-haskell-operator">,</span> <span class="org-string">"c"</span>]
[(1<span class="org-haskell-operator">,</span><span class="org-string">"a"</span>)<span class="org-haskell-operator">,</span>(2<span class="org-haskell-operator">,</span><span class="org-string">"b"</span>)<span class="org-haskell-operator">,</span>(3<span class="org-haskell-operator">,</span><span class="org-string">"c"</span>)]
<span class="org-haskell-operator">&gt;</span>

 <span class="org-comment-delimiter">-- </span><span class="org-comment">Zip a list and a infinite list </span>

<span class="org-haskell-operator">&gt;</span> <span class="org-haskell-definition">zip</span> [<span class="org-string">"a"</span><span class="org-haskell-operator">,</span> <span class="org-string">"b"</span><span class="org-haskell-operator">,</span> <span class="org-string">"c"</span>] [1 <span class="org-haskell-operator">..</span>]
[(<span class="org-string">"a"</span><span class="org-haskell-operator">,</span>1)<span class="org-haskell-operator">,</span>(<span class="org-string">"b"</span><span class="org-haskell-operator">,</span>2)<span class="org-haskell-operator">,</span>(<span class="org-string">"c"</span><span class="org-haskell-operator">,</span>3)]
<span class="org-haskell-operator">&gt;</span> 
<span class="org-haskell-operator">&gt;</span> 

<span class="org-haskell-operator">&gt;</span> <span class="org-haskell-definition">zip</span> [<span class="org-string">"a"</span><span class="org-haskell-operator">,</span> <span class="org-string">"b"</span><span class="org-haskell-operator">,</span> <span class="org-string">"c"</span><span class="org-haskell-operator">,</span> <span class="org-string">"d"</span>] [1<span class="org-haskell-operator">,</span> 2<span class="org-haskell-operator">,</span> 3]
[(<span class="org-string">"a"</span><span class="org-haskell-operator">,</span>1)<span class="org-haskell-operator">,</span>(<span class="org-string">"b"</span><span class="org-haskell-operator">,</span>2)<span class="org-haskell-operator">,</span>(<span class="org-string">"c"</span><span class="org-haskell-operator">,</span>3)]
<span class="org-haskell-operator">&gt;</span> 


<span class="org-haskell-operator">&gt;</span> <span class="org-haskell-constructor">:</span>t zip3
<span class="org-function-name">zip3</span> <span class="org-haskell-operator">::</span> [a] <span class="org-haskell-operator">-&gt;</span> [b] <span class="org-haskell-operator">-&gt;</span> [c] <span class="org-haskell-operator">-&gt;</span> [(a<span class="org-haskell-operator">,</span> b<span class="org-haskell-operator">,</span> c)]
<span class="org-haskell-operator">&gt;</span> 

<span class="org-haskell-operator">&gt;</span> <span class="org-haskell-definition">zip3</span> [<span class="org-string">"a"</span><span class="org-haskell-operator">,</span> <span class="org-string">"b"</span><span class="org-haskell-operator">,</span> <span class="org-string">"c"</span><span class="org-haskell-operator">,</span> <span class="org-string">"d"</span>] [1<span class="org-haskell-operator">,</span> 2<span class="org-haskell-operator">,</span> 3<span class="org-haskell-operator">,</span> 4<span class="org-haskell-operator">,</span> 5<span class="org-haskell-operator">,</span> 6] [<span class="org-haskell-constructor">Just</span> 10<span class="org-haskell-operator">,</span> <span class="org-haskell-constructor">Just</span> 100<span class="org-haskell-operator">,</span> <span class="org-haskell-constructor">Nothing</span>]
[(<span class="org-string">"a"</span><span class="org-haskell-operator">,</span>1<span class="org-haskell-operator">,</span><span class="org-haskell-constructor">Just</span> 10)<span class="org-haskell-operator">,</span>(<span class="org-string">"b"</span><span class="org-haskell-operator">,</span>2<span class="org-haskell-operator">,</span><span class="org-haskell-constructor">Just</span> 100)<span class="org-haskell-operator">,</span>(<span class="org-string">"c"</span><span class="org-haskell-operator">,</span>3<span class="org-haskell-operator">,</span><span class="org-haskell-constructor">Nothing</span>)]
<span class="org-haskell-operator">&gt;</span> 

 <span class="org-comment-delimiter">-- </span><span class="org-comment">There is more zip functions in the module Data.List</span>
 <span class="org-comment-delimiter">--</span>
<span class="org-haskell-operator">&gt;</span> <span class="org-haskell-keyword">import</span> <span class="org-haskell-constructor">Data.List</span> (zip4<span class="org-haskell-operator">,</span> zip5<span class="org-haskell-operator">,</span> zip6)
<span class="org-haskell-operator">&gt;</span> 

<span class="org-haskell-operator">&gt;</span> <span class="org-haskell-constructor">:</span>t zip4
<span class="org-function-name">zip4</span> <span class="org-haskell-operator">::</span> [a] <span class="org-haskell-operator">-&gt;</span> [b] <span class="org-haskell-operator">-&gt;</span> [c] <span class="org-haskell-operator">-&gt;</span> [d] <span class="org-haskell-operator">-&gt;</span> [(a<span class="org-haskell-operator">,</span> b<span class="org-haskell-operator">,</span> c<span class="org-haskell-operator">,</span> d)]
<span class="org-haskell-operator">&gt;</span> 
<span class="org-haskell-operator">&gt;</span> <span class="org-haskell-constructor">:</span>t zip5
<span class="org-function-name">zip5</span> <span class="org-haskell-operator">::</span> [a] <span class="org-haskell-operator">-&gt;</span> [b] <span class="org-haskell-operator">-&gt;</span> [c] <span class="org-haskell-operator">-&gt;</span> [d] <span class="org-haskell-operator">-&gt;</span> [e] <span class="org-haskell-operator">-&gt;</span> [(a<span class="org-haskell-operator">,</span> b<span class="org-haskell-operator">,</span> c<span class="org-haskell-operator">,</span> d<span class="org-haskell-operator">,</span> e)]
<span class="org-haskell-operator">&gt;</span>
</pre>
</div>
</div>
</div>

<div id="outline-container-sec-1-11-4-3" class="outline-5">
<h5 id="sec-1-11-4-3"><span class="section-number-5">1.11.4.3</span> Zip in Python</h5>
<div class="outline-text-5" id="text-1-11-4-3">
<p>
The Python zip function is inspired by Haskell. The Python zip
functions can take a variable number of arguments.
</p>


<p>
Python 2: In python2 this function is evaluated eagerly. 
</p>

<div class="org-src-container">

<pre class="src src-python">&gt;&gt;&gt; <span class="org-builtin">zip</span>([1, 2, 3], [<span class="org-string">"a"</span>, <span class="org-string">"b"</span>, <span class="org-string">"c"</span>, <span class="org-string">"d"</span>, <span class="org-string">"e"</span>])
[(1, <span class="org-string">'a'</span>), (2, <span class="org-string">'b'</span>), (3, <span class="org-string">'c'</span>)]
&gt;&gt;&gt;

&gt;&gt;&gt; <span class="org-builtin">zip</span>([1, 2, 3], [<span class="org-string">"a"</span>, <span class="org-string">"b"</span>, <span class="org-string">"c"</span>, <span class="org-string">"d"</span>, <span class="org-string">"e"</span>], [<span class="org-string">"x"</span>, <span class="org-string">"y"</span>, <span class="org-string">"z"</span>])
[(1, <span class="org-string">'a'</span>, <span class="org-string">'x'</span>), (2, <span class="org-string">'b'</span>, <span class="org-string">'y'</span>), (3, <span class="org-string">'c'</span>, <span class="org-string">'z'</span>)]
&gt;&gt;&gt;

&gt;&gt;&gt; <span class="org-builtin">zip</span>([1, 2, 3], [<span class="org-string">"a"</span>, <span class="org-string">"b"</span>, <span class="org-string">"c"</span>, <span class="org-string">"d"</span>, <span class="org-string">"e"</span>], [<span class="org-string">"x"</span>, <span class="org-string">"y"</span>, <span class="org-string">"z"</span>], <span class="org-builtin">range</span>(1, 20))
[(1, <span class="org-string">'a'</span>, <span class="org-string">'x'</span>, 1), (2, <span class="org-string">'b'</span>, <span class="org-string">'y'</span>, 2), (3, <span class="org-string">'c'</span>, <span class="org-string">'z'</span>, 3)]
&gt;&gt;&gt; 

&gt;&gt;&gt; <span class="org-keyword">for</span> x, y <span class="org-keyword">in</span> <span class="org-builtin">zip</span>([1, 2, 3, 4, 5], [<span class="org-string">"a"</span>, <span class="org-string">"b"</span>, <span class="org-string">"c"</span>, <span class="org-string">"d"</span>, <span class="org-string">"e"</span>]):
...   <span class="org-keyword">print</span> <span class="org-string">"x = "</span>, x, <span class="org-string">"y = "</span>, y
... 
<span class="org-variable-name">x</span> =  1 <span class="org-variable-name">y</span> =  a
<span class="org-variable-name">x</span> =  2 <span class="org-variable-name">y</span> =  b
<span class="org-variable-name">x</span> =  3 <span class="org-variable-name">y</span> =  c
<span class="org-variable-name">x</span> =  4 <span class="org-variable-name">y</span> =  d
<span class="org-variable-name">x</span> =  5 <span class="org-variable-name">y</span> =  e
</pre>
</div>

<p>
Python 3: In python3 this function returns a generator. It is evaluated lazily.
</p>

<div class="org-src-container">

<pre class="src src-python">&gt;&gt;&gt; <span class="org-builtin">zip</span>([1, 2, 3, 4, 5], [<span class="org-string">"a"</span>, <span class="org-string">"b"</span>, <span class="org-string">"c"</span>, <span class="org-string">"d"</span>, <span class="org-string">"e"</span>])
&lt;<span class="org-builtin">zip</span> <span class="org-builtin">object</span> at 0xb6d01ecc&gt;
&gt;&gt;&gt; 

&gt;&gt;&gt; <span class="org-builtin">list</span>(<span class="org-builtin">zip</span>([1, 2, 3, 4, 5], [<span class="org-string">"a"</span>, <span class="org-string">"b"</span>, <span class="org-string">"c"</span>, <span class="org-string">"d"</span>, <span class="org-string">"e"</span>]))
[(1, <span class="org-string">'a'</span>), (2, <span class="org-string">'b'</span>), (3, <span class="org-string">'c'</span>), (4, <span class="org-string">'d'</span>), (5, <span class="org-string">'e'</span>)]
&gt;&gt;&gt; 

&gt;&gt;&gt; <span class="org-variable-name">g</span> = <span class="org-builtin">zip</span>([1, 2, 3, 4, 5], [<span class="org-string">"a"</span>, <span class="org-string">"b"</span>, <span class="org-string">"c"</span>, <span class="org-string">"d"</span>, <span class="org-string">"e"</span>])
&gt;&gt;&gt; g
&lt;<span class="org-builtin">zip</span> <span class="org-builtin">object</span> at 0xb6747e8c&gt;
&gt;&gt;&gt; <span class="org-builtin">next</span>(g)
(1, <span class="org-string">'a'</span>)
&gt;&gt;&gt; <span class="org-builtin">next</span>(g)
(2, <span class="org-string">'b'</span>)
&gt;&gt;&gt; <span class="org-builtin">next</span>(g)
(3, <span class="org-string">'c'</span>)
&gt;&gt;&gt; <span class="org-builtin">next</span>(g)
(4, <span class="org-string">'d'</span>)
&gt;&gt;&gt; <span class="org-builtin">next</span>(g)
(5, <span class="org-string">'e'</span>)
&gt;&gt;&gt; <span class="org-builtin">next</span>(g)
Traceback (most recent call last):
  File <span class="org-string">"&lt;stdin&gt;"</span>, line 1, <span class="org-keyword">in</span> &lt;module&gt;
<span class="org-type">StopIteration</span>
&gt;&gt;&gt; 

&gt;&gt;&gt; <span class="org-variable-name">g</span> = <span class="org-builtin">zip</span>([1, 2, 3, 4, 5], [<span class="org-string">"a"</span>, <span class="org-string">"b"</span>, <span class="org-string">"c"</span>, <span class="org-string">"d"</span>, <span class="org-string">"e"</span>], <span class="org-builtin">range</span>(1, 1000000000))
&gt;&gt;&gt; g
&lt;<span class="org-builtin">zip</span> <span class="org-builtin">object</span> at 0xb6747f2c&gt;
&gt;&gt;&gt; <span class="org-builtin">list</span>(g)
[(1, <span class="org-string">'a'</span>, 1), (2, <span class="org-string">'b'</span>, 2), (3, <span class="org-string">'c'</span>, 3), (4, <span class="org-string">'d'</span>, 4), (5, <span class="org-string">'e'</span>, 5)]
&gt;&gt;&gt; <span class="org-builtin">list</span>(g)
[]
&gt;&gt;&gt; 

&gt;&gt;&gt; <span class="org-keyword">for</span> x, y <span class="org-keyword">in</span> <span class="org-builtin">zip</span>([1, 2, 3, 4, 5], [<span class="org-string">"a"</span>, <span class="org-string">"b"</span>, <span class="org-string">"c"</span>, <span class="org-string">"d"</span>, <span class="org-string">"e"</span>]):
...    <span class="org-keyword">print</span> (<span class="org-string">"x = "</span>, x, <span class="org-string">"y = "</span>, y)
... 
<span class="org-variable-name">x</span> =  1 <span class="org-variable-name">y</span> =  a
<span class="org-variable-name">x</span> =  2 <span class="org-variable-name">y</span> =  b
<span class="org-variable-name">x</span> =  3 <span class="org-variable-name">y</span> =  c
<span class="org-variable-name">x</span> =  4 <span class="org-variable-name">y</span> =  d
<span class="org-variable-name">x</span> =  5 <span class="org-variable-name">y</span> =  e
</pre>
</div>
</div>
</div>

<div id="outline-container-sec-1-11-4-4" class="outline-5">
<h5 id="sec-1-11-4-4"><span class="section-number-5">1.11.4.4</span> Zip in Scheme</h5>
<div class="outline-text-5" id="text-1-11-4-4">
<p>
It can be defined as:
</p>

<div class="org-src-container">

<pre class="src src-scheme"><span class="org-rainbow-delimiters-depth-1">(</span><span class="org-keyword">define</span> <span class="org-rainbow-delimiters-depth-2">(</span><span class="org-function-name">zip</span> . lists<span class="org-rainbow-delimiters-depth-2">)</span>
   <span class="org-rainbow-delimiters-depth-2">(</span>apply map  vector lists<span class="org-rainbow-delimiters-depth-2">)</span><span class="org-rainbow-delimiters-depth-1">)</span>

&gt; <span class="org-rainbow-delimiters-depth-1">(</span>zip '<span class="org-rainbow-delimiters-depth-2">(</span>1 2 3 4<span class="org-rainbow-delimiters-depth-2">)</span> '<span class="org-rainbow-delimiters-depth-2">(</span><span class="org-string">"a"</span> <span class="org-string">"b"</span> <span class="org-string">"c"</span> <span class="org-string">"d"</span><span class="org-rainbow-delimiters-depth-2">)</span><span class="org-rainbow-delimiters-depth-1">)</span>       
<span class="org-rainbow-delimiters-depth-1">(</span>#<span class="org-rainbow-delimiters-depth-2">(</span>1 <span class="org-string">"a"</span><span class="org-rainbow-delimiters-depth-2">)</span> #<span class="org-rainbow-delimiters-depth-2">(</span>2 <span class="org-string">"b"</span><span class="org-rainbow-delimiters-depth-2">)</span> #<span class="org-rainbow-delimiters-depth-2">(</span>3 <span class="org-string">"c"</span><span class="org-rainbow-delimiters-depth-2">)</span> #<span class="org-rainbow-delimiters-depth-2">(</span>4 <span class="org-string">"d"</span><span class="org-rainbow-delimiters-depth-2">)</span><span class="org-rainbow-delimiters-depth-1">)</span>
&gt; 

<span class="org-comment-delimiter">;; </span><span class="org-comment">Or </span>

<span class="org-rainbow-delimiters-depth-1">(</span><span class="org-keyword">define</span> <span class="org-rainbow-delimiters-depth-2">(</span><span class="org-function-name">zip</span> . lists<span class="org-rainbow-delimiters-depth-2">)</span>
   <span class="org-rainbow-delimiters-depth-2">(</span>apply map  list lists<span class="org-rainbow-delimiters-depth-2">)</span><span class="org-rainbow-delimiters-depth-1">)</span>

&gt; <span class="org-rainbow-delimiters-depth-1">(</span>zip '<span class="org-rainbow-delimiters-depth-2">(</span>1 2 3 4<span class="org-rainbow-delimiters-depth-2">)</span> '<span class="org-rainbow-delimiters-depth-2">(</span><span class="org-string">"a"</span> <span class="org-string">"b"</span> <span class="org-string">"c"</span> <span class="org-string">"d"</span><span class="org-rainbow-delimiters-depth-2">)</span><span class="org-rainbow-delimiters-depth-1">)</span>
<span class="org-rainbow-delimiters-depth-1">(</span><span class="org-rainbow-delimiters-depth-2">(</span>1 <span class="org-string">"a"</span><span class="org-rainbow-delimiters-depth-2">)</span> <span class="org-rainbow-delimiters-depth-2">(</span>2 <span class="org-string">"b"</span><span class="org-rainbow-delimiters-depth-2">)</span> <span class="org-rainbow-delimiters-depth-2">(</span>3 <span class="org-string">"c"</span><span class="org-rainbow-delimiters-depth-2">)</span> <span class="org-rainbow-delimiters-depth-2">(</span>4 <span class="org-string">"d"</span><span class="org-rainbow-delimiters-depth-2">)</span><span class="org-rainbow-delimiters-depth-1">)</span>
&gt; 

&gt; <span class="org-rainbow-delimiters-depth-1">(</span>zip '<span class="org-rainbow-delimiters-depth-2">(</span>1 2 3 4<span class="org-rainbow-delimiters-depth-2">)</span> '<span class="org-rainbow-delimiters-depth-2">(</span><span class="org-string">"a"</span> <span class="org-string">"b"</span> <span class="org-string">"c"</span> <span class="org-string">"d"</span><span class="org-rainbow-delimiters-depth-2">)</span> '<span class="org-rainbow-delimiters-depth-2">(</span>89 199 100 43<span class="org-rainbow-delimiters-depth-2">)</span><span class="org-rainbow-delimiters-depth-1">)</span>
<span class="org-rainbow-delimiters-depth-1">(</span><span class="org-rainbow-delimiters-depth-2">(</span>1 <span class="org-string">"a"</span> 89<span class="org-rainbow-delimiters-depth-2">)</span> <span class="org-rainbow-delimiters-depth-2">(</span>2 <span class="org-string">"b"</span> 199<span class="org-rainbow-delimiters-depth-2">)</span> <span class="org-rainbow-delimiters-depth-2">(</span>3 <span class="org-string">"c"</span> 100<span class="org-rainbow-delimiters-depth-2">)</span> <span class="org-rainbow-delimiters-depth-2">(</span>4 <span class="org-string">"d"</span> 43<span class="org-rainbow-delimiters-depth-2">)</span><span class="org-rainbow-delimiters-depth-1">)</span>
&gt;
</pre>
</div>
</div>
</div>

<div id="outline-container-sec-1-11-4-5" class="outline-5">
<h5 id="sec-1-11-4-5"><span class="section-number-5">1.11.4.5</span> Zip in Clojure</h5>
<div class="outline-text-5" id="text-1-11-4-5">
<div class="org-src-container">

<pre class="src src-clojure"><span class="org-comment-delimiter">;; </span><span class="org-comment">Zip returning list</span>
<span class="org-comment-delimiter">;;</span>
<span class="org-rainbow-delimiters-depth-1">(</span><span class="org-keyword">defn</span> <span class="org-function-name">zip</span> <span class="org-rainbow-delimiters-depth-2">[</span>&amp; seqs<span class="org-rainbow-delimiters-depth-2">]</span> 
  <span class="org-rainbow-delimiters-depth-2">(</span>apply map list seqs<span class="org-rainbow-delimiters-depth-2">)</span><span class="org-rainbow-delimiters-depth-1">)</span>

user=&gt; <span class="org-rainbow-delimiters-depth-1">(</span>zip '<span class="org-rainbow-delimiters-depth-2">(</span>1 2 3 4 5<span class="org-rainbow-delimiters-depth-2">)</span> '<span class="org-rainbow-delimiters-depth-2">(</span>x y z w k m n<span class="org-rainbow-delimiters-depth-2">)</span><span class="org-rainbow-delimiters-depth-1">)</span>
<span class="org-rainbow-delimiters-depth-1">(</span><span class="org-rainbow-delimiters-depth-2">(</span>1 x<span class="org-rainbow-delimiters-depth-2">)</span> <span class="org-rainbow-delimiters-depth-2">(</span>2 y<span class="org-rainbow-delimiters-depth-2">)</span> <span class="org-rainbow-delimiters-depth-2">(</span>3 z<span class="org-rainbow-delimiters-depth-2">)</span> <span class="org-rainbow-delimiters-depth-2">(</span>4 w<span class="org-rainbow-delimiters-depth-2">)</span> <span class="org-rainbow-delimiters-depth-2">(</span>5 k<span class="org-rainbow-delimiters-depth-2">)</span><span class="org-rainbow-delimiters-depth-1">)</span>

user=&gt; <span class="org-rainbow-delimiters-depth-1">(</span>zip '<span class="org-rainbow-delimiters-depth-2">(</span>1 2 3 4 5<span class="org-rainbow-delimiters-depth-2">)</span> '<span class="org-rainbow-delimiters-depth-2">(</span>x y z w k m n<span class="org-rainbow-delimiters-depth-2">)</span> <span class="org-rainbow-delimiters-depth-2">(</span>range 10 1000000<span class="org-rainbow-delimiters-depth-2">)</span><span class="org-rainbow-delimiters-depth-1">)</span>
<span class="org-rainbow-delimiters-depth-1">(</span><span class="org-rainbow-delimiters-depth-2">(</span>1 x 10<span class="org-rainbow-delimiters-depth-2">)</span> <span class="org-rainbow-delimiters-depth-2">(</span>2 y 11<span class="org-rainbow-delimiters-depth-2">)</span> <span class="org-rainbow-delimiters-depth-2">(</span>3 z 12<span class="org-rainbow-delimiters-depth-2">)</span> <span class="org-rainbow-delimiters-depth-2">(</span>4 w 13<span class="org-rainbow-delimiters-depth-2">)</span> <span class="org-rainbow-delimiters-depth-2">(</span>5 k 14<span class="org-rainbow-delimiters-depth-2">)</span><span class="org-rainbow-delimiters-depth-1">)</span>

user=&gt; <span class="org-rainbow-delimiters-depth-1">(</span>zip '<span class="org-rainbow-delimiters-depth-2">[</span>1 2 3 4 5<span class="org-rainbow-delimiters-depth-2">]</span> '<span class="org-rainbow-delimiters-depth-2">(</span>x y z w k m n<span class="org-rainbow-delimiters-depth-2">)</span> <span class="org-rainbow-delimiters-depth-2">(</span>range 10 1000000<span class="org-rainbow-delimiters-depth-2">)</span><span class="org-rainbow-delimiters-depth-1">)</span>
<span class="org-rainbow-delimiters-depth-1">(</span><span class="org-rainbow-delimiters-depth-2">(</span>1 x 10<span class="org-rainbow-delimiters-depth-2">)</span> <span class="org-rainbow-delimiters-depth-2">(</span>2 y 11<span class="org-rainbow-delimiters-depth-2">)</span> <span class="org-rainbow-delimiters-depth-2">(</span>3 z 12<span class="org-rainbow-delimiters-depth-2">)</span> <span class="org-rainbow-delimiters-depth-2">(</span>4 w 13<span class="org-rainbow-delimiters-depth-2">)</span> <span class="org-rainbow-delimiters-depth-2">(</span>5 k 14<span class="org-rainbow-delimiters-depth-2">)</span><span class="org-rainbow-delimiters-depth-1">)</span>

user=&gt; <span class="org-rainbow-delimiters-depth-1">(</span>zip '<span class="org-rainbow-delimiters-depth-2">[</span>1 2 3 4 5<span class="org-rainbow-delimiters-depth-2">]</span> '<span class="org-rainbow-delimiters-depth-2">(</span>x y z w k m n<span class="org-rainbow-delimiters-depth-2">)</span> <span class="org-rainbow-delimiters-depth-2">{</span><span class="org-clojure-keyword">:key_x</span> <span class="org-string">"hello"</span> <span class="org-clojure-keyword">:key_y</span> <span class="org-string">"world"</span> <span class="org-clojure-keyword">:key_z</span> <span class="org-string">"clojure"</span><span class="org-rainbow-delimiters-depth-2">}</span><span class="org-rainbow-delimiters-depth-1">)</span>
<span class="org-rainbow-delimiters-depth-1">(</span><span class="org-rainbow-delimiters-depth-2">(</span>1 x <span class="org-rainbow-delimiters-depth-3">[</span><span class="org-clojure-keyword">:key_x</span> <span class="org-string">"hello"</span><span class="org-rainbow-delimiters-depth-3">]</span><span class="org-rainbow-delimiters-depth-2">)</span> <span class="org-rainbow-delimiters-depth-2">(</span>2 y <span class="org-rainbow-delimiters-depth-3">[</span><span class="org-clojure-keyword">:key_y</span> <span class="org-string">"world"</span><span class="org-rainbow-delimiters-depth-3">]</span><span class="org-rainbow-delimiters-depth-2">)</span> <span class="org-rainbow-delimiters-depth-2">(</span>3 z <span class="org-rainbow-delimiters-depth-3">[</span><span class="org-clojure-keyword">:key_z</span> <span class="org-string">"clojure"</span><span class="org-rainbow-delimiters-depth-3">]</span><span class="org-rainbow-delimiters-depth-2">)</span><span class="org-rainbow-delimiters-depth-1">)</span>
user=&gt; 


<span class="org-comment-delimiter">;; </span><span class="org-comment">Zip returning vector </span>
<span class="org-comment-delimiter">;;</span>
<span class="org-rainbow-delimiters-depth-1">(</span><span class="org-keyword">defn</span> <span class="org-function-name">zipv</span> <span class="org-rainbow-delimiters-depth-2">[</span>&amp; seqs<span class="org-rainbow-delimiters-depth-2">]</span> 
  <span class="org-rainbow-delimiters-depth-2">(</span>apply mapv vector seqs<span class="org-rainbow-delimiters-depth-2">)</span><span class="org-rainbow-delimiters-depth-1">)</span>

user=&gt; <span class="org-rainbow-delimiters-depth-1">(</span>zipv '<span class="org-rainbow-delimiters-depth-2">(</span>1 2 3 4 5<span class="org-rainbow-delimiters-depth-2">)</span> '<span class="org-rainbow-delimiters-depth-2">(</span>x y z w k m n<span class="org-rainbow-delimiters-depth-2">)</span><span class="org-rainbow-delimiters-depth-1">)</span>
<span class="org-rainbow-delimiters-depth-1">[</span><span class="org-rainbow-delimiters-depth-2">[</span>1 x<span class="org-rainbow-delimiters-depth-2">]</span> <span class="org-rainbow-delimiters-depth-2">[</span>2 y<span class="org-rainbow-delimiters-depth-2">]</span> <span class="org-rainbow-delimiters-depth-2">[</span>3 z<span class="org-rainbow-delimiters-depth-2">]</span> <span class="org-rainbow-delimiters-depth-2">[</span>4 w<span class="org-rainbow-delimiters-depth-2">]</span> <span class="org-rainbow-delimiters-depth-2">[</span>5 k<span class="org-rainbow-delimiters-depth-2">]</span><span class="org-rainbow-delimiters-depth-1">]</span>
user=&gt; 

user=&gt;  <span class="org-rainbow-delimiters-depth-1">(</span>zipv '<span class="org-rainbow-delimiters-depth-2">[</span>1 2 3 4 5<span class="org-rainbow-delimiters-depth-2">]</span> '<span class="org-rainbow-delimiters-depth-2">(</span>x y z w k m n<span class="org-rainbow-delimiters-depth-2">)</span> <span class="org-rainbow-delimiters-depth-2">(</span>range 10 1000000<span class="org-rainbow-delimiters-depth-2">)</span><span class="org-rainbow-delimiters-depth-1">)</span>
<span class="org-rainbow-delimiters-depth-1">[</span><span class="org-rainbow-delimiters-depth-2">[</span>1 x 10<span class="org-rainbow-delimiters-depth-2">]</span> <span class="org-rainbow-delimiters-depth-2">[</span>2 y 11<span class="org-rainbow-delimiters-depth-2">]</span> <span class="org-rainbow-delimiters-depth-2">[</span>3 z 12<span class="org-rainbow-delimiters-depth-2">]</span> <span class="org-rainbow-delimiters-depth-2">[</span>4 w 13<span class="org-rainbow-delimiters-depth-2">]</span> <span class="org-rainbow-delimiters-depth-2">[</span>5 k 14<span class="org-rainbow-delimiters-depth-2">]</span><span class="org-rainbow-delimiters-depth-1">]</span>
user=&gt;
</pre>
</div>
</div>
</div>
</div>
</div>

<div id="outline-container-sec-1-12" class="outline-3">
<h3 id="sec-1-12"><span class="section-number-3">1.12</span> Function Composition</h3>
<div class="outline-text-3" id="text-1-12">
</div><div id="outline-container-sec-1-12-1" class="outline-4">
<h4 id="sec-1-12-1"><span class="section-number-4">1.12.1</span> Overview</h4>
<div class="outline-text-4" id="text-1-12-1">
<p>
Function composition promotes shorter code, code reuse and higher
modularity by creating new functions from previous defined ones. They
also allow optimization of functional code when there is many
maps. Only pure functions can be composed, function composition works
like math functions, the output of one function is the input of
another function.  Haskell, ML, Ocaml and F# has features that makes
easier to use function composition, like a lightweight syntax,
currying, partially applied functions, static typing and composition
operators that are built in to the language.  In Haskell the operator
(.) dot is used for composing functions.
</p>

<p>
See also: <a href="http://en.wikipedia.org/wiki/Function_composition_(computer_science)">Function composition (computer science)</a>
</p>
</div>
</div>

<div id="outline-container-sec-1-12-2" class="outline-4">
<h4 id="sec-1-12-2"><span class="section-number-4">1.12.2</span> Function Composition in Haskell</h4>
<div class="outline-text-4" id="text-1-12-2">
<pre class="example">
(.) :: (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c

Given:
    
    f :: b -&gt; c
    g :: a -&gt; b

(f . g ) x = f (g x)

    h = f . g
    h :: a -&gt; c
</pre>

<p>
Function Composition Block Diagram
</p>

<div class="org-src-container">

<pre class="src src-haskell">                f <span class="org-haskell-operator">.</span> g
        <span class="org-haskell-operator">................................</span>
        <span class="org-haskell-operator">.</span> <span class="org-haskell-operator">/------\</span>        <span class="org-haskell-operator">/------\</span>     <span class="org-haskell-operator">.</span> 
a <span class="org-haskell-definition">--&gt;</span>   <span class="org-haskell-operator">.</span> <span class="org-haskell-operator">|</span>  g   <span class="org-haskell-operator">|</span>  <span class="org-haskell-operator">--&gt;</span>   <span class="org-haskell-operator">|</span>  f   <span class="org-haskell-operator">|</span> <span class="org-haskell-operator">--&gt;</span> <span class="org-haskell-operator">.---&gt;</span> c
        <span class="org-haskell-operator">.</span> <span class="org-haskell-operator">\------/</span>   b    <span class="org-haskell-operator">\------/</span>  c  <span class="org-haskell-operator">.</span> 
        <span class="org-haskell-operator">................................</span>
           g <span class="org-haskell-operator">::</span> a <span class="org-haskell-operator">-&gt;</span> b   f <span class="org-haskell-operator">::</span> b <span class="org-haskell-operator">-&gt;</span> c
    
    (<span class="org-haskell-operator">.</span>) <span class="org-haskell-operator">::</span> (b <span class="org-haskell-operator">-&gt;</span> c) <span class="org-haskell-operator">-&gt;</span> (a <span class="org-haskell-operator">-&gt;</span> b) <span class="org-haskell-operator">-&gt;</span> a <span class="org-haskell-operator">-&gt;</span> c
</pre>
</div>


<p>
Composition Law
</p>

<pre class="example">
id . f = f                  Left  identity law
f . id = f                  Right identity law
(f . g) . h = f . (g . h)   Associativity


Constant Function Composition
f       . const a = const (f a)
const a . f       = const a

dentity function            --&gt;  id x = x 
const - Constant Function   --&gt; const a b =  a
</pre>

<p>
Simplifying Code with function composition:
</p>

<pre class="example">
    h( f ( g( x)))  ==&gt;  (h . f . g ) x   OR  h . f . g  $ x 
OR   
    h $ f $ g x     ==&gt;   h . f . g $ x    

                                 Point Free Style
composed x = h . f . g $ x ==&gt;   composed = h . f . g
</pre>

<p>
Function Composition with Map
</p>


<pre class="example">
    (map g (map f xs) == (map g . map f) xs = (map g . f) xs

OR
    map g . map f  == map (g . f)
        
Generalizing
    
    map f1 (map f2 (map f3 (map f4 xs))) 
    = (map f1)
    =  map (f1 . f2 . f3 . f4)  xs     
    =  f xs
    
Where f = map $ f1 . f2 . f3 . f4

Example:

    &gt; map  (+3) [1, 2, 3, 4]
    [4,5,6,7]
    &gt; map  (*2) [4, 5, 6, 7]
    [8,10,12,14]
    &gt; 
    &gt; map  (*2) (map (+3)  [1, 2, 3, 4])
    [8,10,12,14]
    &gt; 
    &gt; map  (*2) . map (+3) $  [1, 2, 3, 4]
    [8,10,12,14]
    &gt; 

    &gt; map ((*2) . (+3)) [1, 2, 3, 4]
    [8,10,12,14]

    &gt; let f = map $ (*2) . (+3)
    &gt; f [1, 2, 3, 4]
    [8,10,12,14]
</pre>


<pre class="example">
h :: c -&gt; [a]
f :: a -&gt; b

map :: (a -&gt; b) -&gt; [a] -&gt; [b]
filter :: (a -&gt; Bool) -&gt; [a] -&gt; [a]


map     f (h c) = map    f . h $ c
filter  f (h c) = filter f . h $ c
</pre>

<p>
Inverting Predicate Functions
</p>

<pre class="example">
inverted_predicate == not . predicate
</pre>

<div class="org-src-container">

<pre class="src src-haskell"><span class="org-haskell-operator">&gt;</span> <span class="org-haskell-definition">not</span> <span class="org-haskell-constructor">True</span>
<span class="org-haskell-constructor">False</span>
<span class="org-haskell-operator">&gt;</span> <span class="org-haskell-definition">not</span> <span class="org-haskell-constructor">False</span>
<span class="org-haskell-constructor">True</span>
<span class="org-haskell-operator">&gt;</span> 

<span class="org-haskell-operator">&gt;</span> (<span class="org-haskell-operator">&gt;</span>5) 10
<span class="org-haskell-constructor">True</span>
<span class="org-haskell-operator">&gt;</span> (<span class="org-haskell-operator">&gt;</span>5) 3
<span class="org-haskell-constructor">False</span>

<span class="org-haskell-operator">&gt;</span> not <span class="org-haskell-definition">.</span> (<span class="org-haskell-operator">&gt;</span>5) <span class="org-haskell-operator">$</span> 10
<span class="org-haskell-constructor">False</span>
<span class="org-haskell-operator">&gt;</span> not <span class="org-haskell-definition">.</span> (<span class="org-haskell-operator">&gt;</span>5) <span class="org-haskell-operator">$</span> 3
<span class="org-haskell-constructor">True</span>
<span class="org-haskell-operator">&gt;</span> 

<span class="org-haskell-operator">&gt;</span> <span class="org-haskell-keyword">let</span> f <span class="org-haskell-operator">=</span> not <span class="org-haskell-operator">.</span> (<span class="org-haskell-operator">&gt;</span>5)
<span class="org-haskell-operator">&gt;</span> <span class="org-haskell-definition">f</span> 10
<span class="org-haskell-constructor">False</span>
<span class="org-haskell-operator">&gt;</span> <span class="org-haskell-definition">f</span> 5
<span class="org-haskell-constructor">True</span>

<span class="org-haskell-operator">&gt;</span> <span class="org-haskell-keyword">import</span> <span class="org-haskell-constructor">Data.List</span>
<span class="org-haskell-operator">&gt;</span> 
<span class="org-haskell-operator">&gt;</span> <span class="org-haskell-definition">filter</span> ( isPrefixOf <span class="org-string">"a"</span> ) [<span class="org-string">"a"</span><span class="org-haskell-operator">,</span><span class="org-string">"ab"</span><span class="org-haskell-operator">,</span><span class="org-string">"cd"</span><span class="org-haskell-operator">,</span><span class="org-string">"abcd"</span><span class="org-haskell-operator">,</span><span class="org-string">"xyz"</span>]
[<span class="org-string">"a"</span><span class="org-haskell-operator">,</span><span class="org-string">"ab"</span><span class="org-haskell-operator">,</span><span class="org-string">"abcd"</span>]
<span class="org-haskell-operator">&gt;</span> 
<span class="org-haskell-operator">&gt;</span> <span class="org-haskell-definition">filter</span> ( not <span class="org-haskell-operator">.</span> isPrefixOf <span class="org-string">"a"</span> ) [<span class="org-string">"a"</span><span class="org-haskell-operator">,</span><span class="org-string">"ab"</span><span class="org-haskell-operator">,</span><span class="org-string">"cd"</span><span class="org-haskell-operator">,</span><span class="org-string">"abcd"</span><span class="org-haskell-operator">,</span><span class="org-string">"xyz"</span>]
[<span class="org-string">"cd"</span><span class="org-haskell-operator">,</span><span class="org-string">"xyz"</span>]
<span class="org-haskell-operator">&gt;</span>
</pre>
</div>


<p>
Example:
</p>

<div class="org-src-container">

<pre class="src src-haskell"><span class="org-haskell-operator">&gt;</span> <span class="org-haskell-keyword">let</span> f <span class="org-haskell-operator">=</span> (<span class="org-haskell-operator">+</span>4)
<span class="org-haskell-operator">&gt;</span> <span class="org-haskell-keyword">let</span> g <span class="org-haskell-operator">=</span> (<span class="org-haskell-operator">*</span>3)
<span class="org-haskell-operator">&gt;</span> 
<span class="org-haskell-operator">&gt;</span> 
<span class="org-haskell-operator">&gt;</span> <span class="org-haskell-definition">f</span> (g 6) <span class="org-comment-delimiter">-- </span><span class="org-comment">(+4) ((*3) 6) = (+4) 18 = 22</span>
22
<span class="org-haskell-operator">&gt;</span> 
<span class="org-haskell-operator">&gt;</span> (f <span class="org-haskell-operator">.</span> g) 6
22
<span class="org-haskell-operator">&gt;</span> 
<span class="org-haskell-operator">&gt;</span> (<span class="org-haskell-definition">.</span>) f g 6
22
<span class="org-haskell-operator">&gt;</span> 
<span class="org-haskell-operator">&gt;</span> <span class="org-haskell-keyword">let</span> h <span class="org-haskell-operator">=</span> f <span class="org-haskell-operator">.</span> g
<span class="org-haskell-operator">&gt;</span> 
<span class="org-haskell-operator">&gt;</span> <span class="org-haskell-definition">h</span> 6
22
<span class="org-haskell-operator">&gt;</span>  

<span class="org-haskell-operator">&gt;</span> <span class="org-haskell-definition">id</span> 10
10
<span class="org-haskell-operator">&gt;</span> <span class="org-haskell-definition">id</span> 3
3
<span class="org-haskell-operator">&gt;</span> 
<span class="org-haskell-operator">&gt;</span> <span class="org-haskell-definition">id</span> <span class="org-haskell-constructor">Nothing</span>
<span class="org-haskell-constructor">Nothing</span>
<span class="org-haskell-operator">&gt;</span> <span class="org-haskell-definition">id</span> <span class="org-string">'a'</span>
<span class="org-string">'a'</span>
<span class="org-haskell-operator">&gt;</span> <span class="org-haskell-definition">id</span> (<span class="org-haskell-constructor">Just</span> 10)
<span class="org-haskell-constructor">Just</span> 10
<span class="org-haskell-operator">&gt;</span> 


<span class="org-haskell-operator">&gt;</span> (f <span class="org-haskell-operator">.</span> id) 10
14
<span class="org-haskell-operator">&gt;</span> (id <span class="org-haskell-operator">.</span> f) 10
14
<span class="org-haskell-operator">&gt;</span> 

<span class="org-haskell-operator">&gt;</span> <span class="org-haskell-definition">const</span> 10 20
10
<span class="org-haskell-operator">&gt;</span> <span class="org-haskell-definition">const</span> 10 3
10
<span class="org-haskell-operator">&gt;</span> 

<span class="org-haskell-operator">&gt;</span> (f <span class="org-haskell-operator">.</span> (const 10)) 4
14
<span class="org-haskell-operator">&gt;</span> (f <span class="org-haskell-operator">.</span> (const 10)) 3
14
<span class="org-haskell-operator">&gt;</span> <span class="org-haskell-definition">const</span> 10 <span class="org-haskell-operator">.</span> f <span class="org-haskell-operator">$</span> 7
10
<span class="org-haskell-operator">&gt;</span> <span class="org-haskell-definition">const</span> 10 <span class="org-haskell-operator">.</span> f <span class="org-haskell-operator">$</span> 3
10
<span class="org-haskell-operator">&gt;</span> 

<span class="org-comment-delimiter">{- </span><span class="org-comment">Avoiding Parenthesis with composition -}</span>
<span class="org-haskell-operator">&gt;</span> <span class="org-haskell-keyword">let</span> g x <span class="org-haskell-operator">=</span> x <span class="org-haskell-operator">*</span> 2
<span class="org-haskell-operator">&gt;</span> <span class="org-haskell-keyword">let</span> f x <span class="org-haskell-operator">=</span> x <span class="org-haskell-operator">+</span> 10
<span class="org-haskell-operator">&gt;</span> <span class="org-haskell-keyword">let</span> h x <span class="org-haskell-operator">=</span> x <span class="org-haskell-operator">-</span> 5
<span class="org-haskell-operator">&gt;</span> 
<span class="org-haskell-operator">&gt;</span> <span class="org-haskell-definition">h</span> (f (g 3))
11
<span class="org-haskell-operator">&gt;</span> h <span class="org-haskell-definition">$</span> f <span class="org-haskell-operator">$</span> g 3
11
<span class="org-haskell-operator">&gt;</span> 
<span class="org-haskell-operator">&gt;</span> (h <span class="org-haskell-operator">.</span> f <span class="org-haskell-operator">.</span> g ) 3
11
<span class="org-haskell-operator">&gt;</span> h <span class="org-haskell-definition">.</span> f <span class="org-haskell-operator">.</span> g <span class="org-haskell-operator">$</span> 3
11
<span class="org-haskell-operator">&gt;</span> 

<span class="org-comment-delimiter">{- </span><span class="org-comment">Function Composition with curried functions -}</span>

<span class="org-haskell-operator">&gt;</span> <span class="org-haskell-keyword">let</span> f1 x y <span class="org-haskell-operator">=</span> 10<span class="org-haskell-operator">*</span>x <span class="org-haskell-operator">+</span> 4<span class="org-haskell-operator">*</span>y
<span class="org-haskell-operator">&gt;</span> <span class="org-haskell-keyword">let</span> f2 a b c <span class="org-haskell-operator">=</span> 4<span class="org-haskell-operator">*</span>a <span class="org-haskell-operator">-</span>3<span class="org-haskell-operator">*</span>b <span class="org-haskell-operator">+</span> 2<span class="org-haskell-operator">*</span>c
<span class="org-haskell-operator">&gt;</span> <span class="org-haskell-keyword">let</span> f3 x <span class="org-haskell-operator">=</span> 3<span class="org-haskell-operator">*</span>x

<span class="org-haskell-operator">&gt;</span> (f1 3 ( f3 5))
90
<span class="org-haskell-operator">&gt;</span> 
<span class="org-haskell-operator">&gt;</span> <span class="org-haskell-definition">f1</span> 3 <span class="org-haskell-operator">$</span> f3 5
90
<span class="org-haskell-operator">&gt;</span> 
<span class="org-haskell-operator">&gt;</span> <span class="org-haskell-definition">f1</span> 3 <span class="org-haskell-operator">.</span> f3 <span class="org-haskell-operator">$</span> 5
90
<span class="org-haskell-operator">&gt;</span> 
<span class="org-haskell-operator">&gt;</span> <span class="org-haskell-keyword">let</span> f <span class="org-haskell-operator">=</span> f1 3 <span class="org-haskell-operator">.</span> f3 
<span class="org-haskell-operator">&gt;</span> 
<span class="org-haskell-operator">&gt;</span> <span class="org-haskell-definition">f</span> 5
90
<span class="org-haskell-operator">&gt;</span> <span class="org-haskell-definition">f</span> 8
126
<span class="org-haskell-operator">&gt;</span> 


<span class="org-haskell-operator">&gt;</span> (f1 4 (f2 5 6 (f3 5)))
168
<span class="org-haskell-operator">&gt;</span> 
<span class="org-haskell-operator">&gt;</span> <span class="org-haskell-definition">f1</span> 4 <span class="org-haskell-operator">$</span> f2 5 6 <span class="org-haskell-operator">$</span> f3 5
168
<span class="org-haskell-operator">&gt;</span> 
<span class="org-haskell-operator">&gt;</span> <span class="org-haskell-definition">f1</span> 4 <span class="org-haskell-operator">.</span> f2 5 6 <span class="org-haskell-operator">.</span> f3 <span class="org-haskell-operator">$</span> 5
168
<span class="org-haskell-operator">&gt;</span> 
<span class="org-haskell-operator">&gt;</span> <span class="org-haskell-keyword">let</span> g <span class="org-haskell-operator">=</span> f1 4 <span class="org-haskell-operator">.</span> f2 5 6 <span class="org-haskell-operator">.</span> f3 <span class="org-comment-delimiter">{- </span><span class="org-comment">You can also create new functions -}</span>
<span class="org-haskell-operator">&gt;</span> <span class="org-haskell-constructor">:</span>t g
<span class="org-function-name">g</span> <span class="org-haskell-operator">::</span> <span class="org-haskell-constructor">Integer</span> <span class="org-haskell-operator">-&gt;</span> <span class="org-haskell-constructor">Integer</span>
<span class="org-haskell-operator">&gt;</span> <span class="org-haskell-definition">g</span> 5
168
<span class="org-haskell-operator">&gt;</span> <span class="org-haskell-definition">g</span> 10
288
<span class="org-haskell-operator">&gt;</span> 

<span class="org-comment-delimiter">{- </span><span class="org-comment">Function Composition with Map and Filter -}</span>

<span class="org-haskell-operator">&gt;</span> <span class="org-haskell-keyword">import</span> <span class="org-haskell-constructor">Data.Char</span>

<span class="org-haskell-operator">&gt;</span> <span class="org-haskell-constructor">:</span>t ord
<span class="org-function-name">ord</span> <span class="org-haskell-operator">::</span> <span class="org-haskell-constructor">Char</span> <span class="org-haskell-operator">-&gt;</span> <span class="org-haskell-constructor">Int</span>

<span class="org-haskell-operator">&gt;</span> <span class="org-haskell-constructor">:</span>t ordStr
<span class="org-function-name">ordStr</span> <span class="org-haskell-operator">::</span> [<span class="org-haskell-constructor">Char</span>] <span class="org-haskell-operator">-&gt;</span> [<span class="org-haskell-constructor">Int</span>]
<span class="org-haskell-operator">&gt;</span> 

<span class="org-haskell-operator">&gt;</span> <span class="org-haskell-definition">ordStr</span> <span class="org-string">"curry"</span>
[99<span class="org-haskell-operator">,</span>117<span class="org-haskell-operator">,</span>114<span class="org-haskell-operator">,</span>114<span class="org-haskell-operator">,</span>121]
<span class="org-haskell-operator">&gt;</span> 
<span class="org-haskell-operator">&gt;</span> <span class="org-haskell-keyword">let</span> r x<span class="org-haskell-operator">=</span> x <span class="org-haskell-operator">+</span> 30
<span class="org-haskell-operator">&gt;</span> 
<span class="org-haskell-operator">&gt;</span> <span class="org-haskell-definition">map</span> r (ordStr <span class="org-string">"curry"</span>)
[129<span class="org-haskell-operator">,</span>147<span class="org-haskell-operator">,</span>144<span class="org-haskell-operator">,</span>144<span class="org-haskell-operator">,</span>151]
<span class="org-haskell-operator">&gt;</span> 
<span class="org-haskell-operator">&gt;</span> <span class="org-haskell-definition">map</span> r <span class="org-haskell-operator">$</span> ordStr <span class="org-string">"curry"</span>
[129<span class="org-haskell-operator">,</span>147<span class="org-haskell-operator">,</span>144<span class="org-haskell-operator">,</span>144<span class="org-haskell-operator">,</span>151]
<span class="org-haskell-operator">&gt;</span> 
<span class="org-haskell-operator">&gt;</span> <span class="org-haskell-definition">map</span> r <span class="org-haskell-operator">.</span> ordStr <span class="org-haskell-operator">$</span> <span class="org-string">"curry"</span>
[129<span class="org-haskell-operator">,</span>147<span class="org-haskell-operator">,</span>144<span class="org-haskell-operator">,</span>144<span class="org-haskell-operator">,</span>151]
<span class="org-haskell-operator">&gt;</span> 
<span class="org-haskell-operator">&gt;</span> sum <span class="org-haskell-definition">.</span> map r <span class="org-haskell-operator">.</span> ordStr <span class="org-haskell-operator">$</span> <span class="org-string">"curry"</span>
715
<span class="org-haskell-operator">&gt;</span> 

<span class="org-haskell-operator">&gt;</span> <span class="org-haskell-keyword">let</span> s <span class="org-haskell-operator">=</span>  map r <span class="org-haskell-operator">.</span> ordStr
<span class="org-haskell-operator">&gt;</span> <span class="org-haskell-definition">s</span> <span class="org-string">"curry"</span>
[129<span class="org-haskell-operator">,</span>147<span class="org-haskell-operator">,</span>144<span class="org-haskell-operator">,</span>144<span class="org-haskell-operator">,</span>151]
<span class="org-haskell-operator">&gt;</span> <span class="org-haskell-definition">s</span> <span class="org-string">"haskell"</span>
[134<span class="org-haskell-operator">,</span>127<span class="org-haskell-operator">,</span>145<span class="org-haskell-operator">,</span>137<span class="org-haskell-operator">,</span>131<span class="org-haskell-operator">,</span>138<span class="org-haskell-operator">,</span>138]
<span class="org-haskell-operator">&gt;</span> 

<span class="org-haskell-keyword">let</span> sum_ord <span class="org-haskell-operator">=</span> sum <span class="org-haskell-operator">.</span> map r <span class="org-haskell-operator">.</span> ordStr 

<span class="org-haskell-operator">&gt;</span> <span class="org-haskell-definition">sum_s</span> <span class="org-string">"curry"</span>
715
<span class="org-haskell-operator">&gt;</span> <span class="org-haskell-definition">sum_s</span> <span class="org-string">"haskell"</span>
950
<span class="org-haskell-operator">&gt;</span> 
<span class="org-haskell-operator">&gt;</span> <span class="org-haskell-definition">sum_ord</span> <span class="org-string">"curry"</span>
715
<span class="org-haskell-operator">&gt;</span> <span class="org-haskell-definition">sum_ord</span> <span class="org-string">"haskell"</span>
950
<span class="org-haskell-operator">&gt;</span> 


<span class="org-haskell-operator">&gt;</span> <span class="org-haskell-definition">map</span> ord (map toUpper <span class="org-string">"haskell"</span>)
[72<span class="org-haskell-operator">,</span>65<span class="org-haskell-operator">,</span>83<span class="org-haskell-operator">,</span>75<span class="org-haskell-operator">,</span>69<span class="org-haskell-operator">,</span>76<span class="org-haskell-operator">,</span>76]
<span class="org-haskell-operator">&gt;</span> 
<span class="org-haskell-operator">&gt;</span> <span class="org-haskell-definition">map</span> ord <span class="org-haskell-operator">.</span> map toUpper <span class="org-haskell-operator">$</span> <span class="org-string">"haskell"</span>
[72<span class="org-haskell-operator">,</span>65<span class="org-haskell-operator">,</span>83<span class="org-haskell-operator">,</span>75<span class="org-haskell-operator">,</span>69<span class="org-haskell-operator">,</span>76<span class="org-haskell-operator">,</span>76]
<span class="org-haskell-operator">&gt;</span> 

<span class="org-haskell-operator">&gt;</span> <span class="org-haskell-definition">map</span> (flip (<span class="org-haskell-operator">-</span>) 10) <span class="org-haskell-operator">.</span> map ord <span class="org-haskell-operator">.</span> map toUpper <span class="org-haskell-operator">$</span> <span class="org-string">"haskell"</span>
[62<span class="org-haskell-operator">,</span>55<span class="org-haskell-operator">,</span>73<span class="org-haskell-operator">,</span>65<span class="org-haskell-operator">,</span>59<span class="org-haskell-operator">,</span>66<span class="org-haskell-operator">,</span>66]
<span class="org-haskell-operator">&gt;</span> 

<span class="org-haskell-operator">&gt;</span> <span class="org-haskell-definition">map</span> chr <span class="org-haskell-operator">.</span> map (flip (<span class="org-haskell-operator">-</span>) 10) <span class="org-haskell-operator">.</span> map ord <span class="org-haskell-operator">.</span> map toUpper <span class="org-haskell-operator">$</span> <span class="org-string">"haskell"</span>
<span class="org-string">"&gt;7IA;BB"</span>
<span class="org-haskell-operator">&gt;</span> 

<span class="org-comment-delimiter">{- </span><span class="org-comment">The function f is in point free style -}</span>

<span class="org-haskell-operator">&gt;</span> <span class="org-haskell-keyword">let</span> f <span class="org-haskell-operator">=</span> map chr <span class="org-haskell-operator">.</span> map (flip (<span class="org-haskell-operator">-</span>) 10) <span class="org-haskell-operator">.</span> map ord <span class="org-haskell-operator">.</span> map toUpper
<span class="org-haskell-operator">&gt;</span> 
<span class="org-haskell-operator">&gt;</span> <span class="org-haskell-definition">f</span> <span class="org-string">"haskell"</span>
<span class="org-string">"&gt;7IA;BB"</span>
<span class="org-haskell-operator">&gt;</span>
</pre>
</div>
</div>
</div>

<div id="outline-container-sec-1-12-3" class="outline-4">
<h4 id="sec-1-12-3"><span class="section-number-4">1.12.3</span> Function Composition in Python</h4>
<div class="outline-text-4" id="text-1-12-3">
<div class="org-src-container">

<pre class="src src-python"><span class="org-keyword">def</span> <span class="org-function-name">compose</span>(funclist):   
    
    <span class="org-keyword">def</span> <span class="org-function-name">_</span>(x):
        <span class="org-variable-name">y</span> = x 
        
        <span class="org-keyword">for</span> f <span class="org-keyword">in</span> <span class="org-builtin">reversed</span>(funclist):
            <span class="org-variable-name">y</span> = f(y)
        <span class="org-keyword">return</span> y
    
    <span class="org-keyword">return</span> _

&gt;&gt;&gt; <span class="org-variable-name">add10</span> = <span class="org-keyword">lambda</span> x: x + 10

&gt;&gt;&gt; <span class="org-variable-name">mul3</span> = <span class="org-keyword">lambda</span> x: x * 3

&gt;&gt;&gt; <span class="org-variable-name">x</span> = 3
&gt;&gt;&gt; <span class="org-variable-name">a</span> = add10(x)
&gt;&gt;&gt; a
    13
&gt;&gt;&gt; <span class="org-variable-name">b</span> = mul3(a)
&gt;&gt;&gt; b
    39


&gt;&gt;&gt; <span class="org-keyword">def</span> <span class="org-function-name">f_without_composition</span> (x):
 ...    <span class="org-variable-name">a</span> = add10(x)
 ...    <span class="org-variable-name">b</span> = mul3(a)
 ...    <span class="org-keyword">return</span> b
 ...

&gt;&gt;&gt; f_without_composition(3)
    39

&gt;&gt;&gt; f_without_composition(4)
    42

 <span class="org-comment-delimiter"># </span><span class="org-comment">It will create the function f = (mul3 &#176; add10)(x)</span>
 <span class="org-comment-delimiter"># </span><span class="org-comment">The flow is from right to left</span>
 <span class="org-comment-delimiter">#</span>
 <span class="org-comment-delimiter">#                   </span>
 <span class="org-comment-delimiter">#     </span><span class="org-comment">(mul3 . add10) 3 </span>
 <span class="org-comment-delimiter">#   </span><span class="org-comment">=  mul3 (add10 3) </span>
 <span class="org-comment-delimiter">#   </span><span class="org-comment">=  mul3 13 </span>
 <span class="org-comment-delimiter">#   </span><span class="org-comment">=  39 </span>
 <span class="org-comment-delimiter">#</span>
&gt;&gt;&gt; <span class="org-variable-name">f</span> = compose ([mul3, add10])  

&gt;&gt;&gt; f(3)
    39

&gt;&gt;&gt; f(4)
    42

&gt;&gt;&gt; f
    &lt;function __main__.compose.&lt;<span class="org-builtin">locals</span>&gt;._&gt;

&gt;&gt;&gt; compose ([add10, mul3])(3)
    39

&gt;&gt;&gt; compose ([add10, mul3])(4)
    42

 <span class="org-comment-delimiter">#</span>
 <span class="org-comment-delimiter"># </span><span class="org-comment">Composition is more intuitive when the flow is from</span>
 <span class="org-comment-delimiter"># </span><span class="org-comment">left to right, the functions in the left side are</span>
 <span class="org-comment-delimiter"># </span><span class="org-comment">executed first. </span>
 <span class="org-comment-delimiter">#</span>
 <span class="org-comment-delimiter">#</span>

 <span class="org-comment-delimiter"># </span><span class="org-comment">Compose Forward</span>
<span class="org-keyword">def</span> <span class="org-function-name">composef</span> (funclist):   
    
    <span class="org-keyword">def</span> <span class="org-function-name">_</span>(x):
        <span class="org-variable-name">y</span> = x         
        <span class="org-keyword">for</span> f <span class="org-keyword">in</span> funclist:
            <span class="org-variable-name">y</span> = f(y)
        <span class="org-keyword">return</span> y
    
    <span class="org-keyword">return</span> _

 <span class="org-comment-delimiter">#</span>
 <span class="org-comment-delimiter">#   </span><span class="org-comment">The symbol (&gt;&gt;) from F# will be used to mean forward composition</span>
 <span class="org-comment-delimiter">#   </span><span class="org-comment">here</span>
 <span class="org-comment-delimiter">#</span>
 <span class="org-comment-delimiter">#      </span><span class="org-comment">(add10 &gt;&gt; mul3) 3 </span>
 <span class="org-comment-delimiter">#    </span><span class="org-comment">= mul3 (add10 3) </span>
 <span class="org-comment-delimiter">#    </span><span class="org-comment">= mul3 13 </span>
 <span class="org-comment-delimiter">#    </span><span class="org-comment">= 39</span>
 <span class="org-comment-delimiter">#                          </span><span class="org-comment">add10 &gt;&gt; mul3</span>
 <span class="org-comment-delimiter">#    </span><span class="org-comment">Input  .................................................  Output</span>
 <span class="org-comment-delimiter">#           </span><span class="org-comment">.    |----------|           |---------|         .   39</span>
 <span class="org-comment-delimiter">#   </span><span class="org-comment">3  ---&gt; .--&gt; |  add10   | --------&gt; |   mul3  | -------&gt;.  -------&gt;  </span>
 <span class="org-comment-delimiter">#           </span><span class="org-comment">.  3 |----------| 13 =(10+3)|---------|  39     .</span>
 <span class="org-comment-delimiter">#           </span><span class="org-comment">.                                39 = 3 * 13    .</span>
 <span class="org-comment-delimiter">#           </span><span class="org-comment">.................................................        </span>
 <span class="org-comment-delimiter">#       </span>
 <span class="org-comment-delimiter">#  </span><span class="org-comment">The execution flow is from left to right, in the same order as the</span>
 <span class="org-comment-delimiter">#  </span><span class="org-comment">functions are written in the code.</span>
 <span class="org-comment-delimiter">#</span>
 
&gt;&gt;&gt; <span class="org-variable-name">g</span> = composef ([add10, mul3])

&gt;&gt;&gt; g(3)
    39

&gt;&gt;&gt; g(4)
    42


&gt;&gt;&gt; <span class="org-comment-delimiter">### </span><span class="org-comment">A more useful example: parse the following table:</span>

<span class="org-variable-name">text</span> = <span class="org-string">"""</span>
<span class="org-string"> 12.23,30.23,892.2323</span>
<span class="org-string"> 23.23,90.23,1000.23</span>
<span class="org-string"> 3563.23,100.23,45.23</span>

<span class="org-string">"""</span>



 <span class="org-comment-delimiter"># </span><span class="org-comment">Unfortunately Python, don't have a favorable syntax to function </span>
 <span class="org-comment-delimiter"># </span><span class="org-comment">composition like: composition operator, lightweight lambda and function</span>
 <span class="org-comment-delimiter"># </span><span class="org-comment">application without parenthesis.</span>
 <span class="org-comment-delimiter">#</span>

&gt;&gt;&gt; <span class="org-variable-name">mapl</span> = <span class="org-keyword">lambda</span> f: <span class="org-keyword">lambda</span> xs: <span class="org-builtin">list</span>(<span class="org-builtin">map</span>(f, xs))
&gt;&gt;&gt; <span class="org-variable-name">filterl</span> = <span class="org-keyword">lambda</span> f: <span class="org-keyword">lambda</span> xs: <span class="org-builtin">list</span>(<span class="org-builtin">filter</span>(f, xs))


&gt;&gt;&gt; <span class="org-variable-name">splitlines</span> = <span class="org-keyword">lambda</span> s: s.splitlines()
&gt;&gt;&gt; <span class="org-variable-name">reject_empty</span> = <span class="org-keyword">lambda</span> xs: <span class="org-builtin">list</span>(<span class="org-builtin">filter</span>(<span class="org-keyword">lambda</span> x: x, xs))
&gt;&gt;&gt; <span class="org-variable-name">strip</span> = <span class="org-keyword">lambda</span> s: s.strip()
&gt;&gt;&gt; <span class="org-variable-name">split</span> = <span class="org-keyword">lambda</span> sep: <span class="org-keyword">lambda</span> s: s.split(sep)


&gt;&gt;&gt; composef([splitlines])(text)
    [<span class="org-string">''</span>,
 <span class="org-string">' 12.23,30.23,892.2323'</span>,
 <span class="org-string">' 23.23,90.23,1000.23'</span>,
 <span class="org-string">' 3563.23,100.23,45.23'</span>,
 <span class="org-string">''</span>]
 
 
&gt;&gt;&gt; composef([splitlines, reject_empty])(text)
    [<span class="org-string">' 12.23,30.23,892.2323'</span>, 
    <span class="org-string">' 23.23,90.23,1000.23'</span>, 
    <span class="org-string">' 3563.23,100.23,45.23'</span>]

    
&gt;&gt;&gt; composef([splitlines, reject_empty, mapl(strip)])(text)
    [<span class="org-string">'12.23,30.23,892.2323'</span>, <span class="org-string">'23.23,90.23,1000.23'</span>, 
    <span class="org-string">'3563.23,100.23,45.23'</span>]


&gt;&gt;&gt; composef([splitlines, reject_empty, mapl(strip), mapl(split(<span class="org-string">","</span>))])(text)
    [[<span class="org-string">'12.23'</span>, <span class="org-string">'30.23'</span>, <span class="org-string">'892.2323'</span>],
 [<span class="org-string">'23.23'</span>, <span class="org-string">'90.23'</span>, <span class="org-string">'1000.23'</span>],
 [<span class="org-string">'3563.23'</span>, <span class="org-string">'100.23'</span>, <span class="org-string">'45.23'</span>]]

&gt;&gt;&gt; composef([splitlines, reject_empty, mapl(strip), mapl(split(<span class="org-string">","</span>)), mapl(mapl(<span class="org-builtin">float</span>))])(text)
    [[12.23000, 30.23000, 892.23230],
 [23.23000, 90.23000, 1000.23000],
 [3563.23000, 100.23000, 45.23000]]

<span class="org-variable-name">parse_csvtable</span> =  composef(
    [splitlines, 
    reject_empty, 
    mapl(strip), 
    mapl(split(<span class="org-string">","</span>)), 
    mapl(mapl(<span class="org-builtin">float</span>))]
    )


&gt;&gt;&gt; parse_csvtable(text)
    [[12.23000, 30.23000, 892.23230],
 [23.23000, 90.23000, 1000.23000],
 [3563.23000, 100.23000, 45.23000]]

    <span class="org-comment-delimiter">#  </span><span class="org-comment">Notice there is three maps together, so that it can be optimized </span>
    <span class="org-comment-delimiter">#  </span><span class="org-comment">each map is like a for loop, by composing the functions in map1,  </span>
    <span class="org-comment-delimiter">#  </span><span class="org-comment">map2 and map3 the code can be more faster.</span>
    <span class="org-comment-delimiter">#</span>
    <span class="org-comment-delimiter"># </span><span class="org-comment">parse_csvtable =  composef(</span>
    <span class="org-comment-delimiter"># </span><span class="org-comment">[splitlines, </span>
    <span class="org-comment-delimiter"># </span><span class="org-comment">reject_empty, </span>
    <span class="org-comment-delimiter"># </span><span class="org-comment">mapl(strip),          ---&gt; map1</span>
    <span class="org-comment-delimiter"># </span><span class="org-comment">mapl(split(",")),     ---&gt; map2</span>
    <span class="org-comment-delimiter"># </span><span class="org-comment">mapl(mapl(float))]    ---&gt; map3</span>
    <span class="org-comment-delimiter"># </span><span class="org-comment">)</span>


<span class="org-variable-name">parse_csvtable_optmized</span> =  composef(
    [splitlines, 
    reject_empty, 
    mapl(composef([strip, split(<span class="org-string">","</span>), mapl(<span class="org-builtin">float</span>)]))
    ])
    
&gt;&gt;&gt; parse_csvtable_optmized(text)
    [[12.23000, 30.23000, 892.23230],
 [23.23000, 90.23000, 1000.23000],
 [3563.23000, 100.23000, 45.23000]]
</pre>
</div>
</div>
</div>
<div id="outline-container-sec-1-12-4" class="outline-4">
<h4 id="sec-1-12-4"><span class="section-number-4">1.12.4</span> Function Composition in F#</h4>
<div class="outline-text-4" id="text-1-12-4">
<p>
F# uses the operator (&lt;&lt;) for composition which is similar to Haskell
composition operator (.) dot. It also uses the operator (&gt;&gt;) for forward
composition that performs the operation in the inverse order of
operator (&lt;&lt;).
</p>

<p>
Composition Operator (&lt;&lt;):
</p>

<div class="org-src-container">

<pre class="src src-fsharp">- (&lt;&lt;) ;;
<span class="org-keyword">val</span> it : (('a -&gt; 'b) -&gt; ('c -&gt; 'a) -&gt; 'c -&gt; 'b) 
&gt; 

&gt; <span class="org-keyword">let</span> <span class="org-function-name">h</span> x = x + 3 ;;         

<span class="org-keyword">val</span> <span class="org-variable-name">h</span> : <span class="org-type">x:int </span>-&gt; int

&gt; <span class="org-keyword">let</span> <span class="org-function-name">g</span> x = x * 5 ;;

<span class="org-keyword">val</span> <span class="org-variable-name">g</span> : <span class="org-type">x:int </span>-&gt; int

- <span class="org-keyword">let</span> <span class="org-function-name">m</span> x = x - 4 ;;

<span class="org-keyword">val</span> <span class="org-variable-name">m</span> : <span class="org-type">x:int </span>-&gt; int

<span class="org-comment-delimiter">// </span><span class="org-comment">The composition is performed in the same way as math composition </span>
<span class="org-comment-delimiter">// </span><span class="org-comment">from right to left. </span>
<span class="org-comment-delimiter">//</span>
- h (g 4) ;;
<span class="org-keyword">val</span> <span class="org-variable-name">it</span> : <span class="org-type">int </span>= 23
&gt; 
- 
- (h &lt;&lt; g) 4 ;;
<span class="org-keyword">val</span> <span class="org-variable-name">it</span> : <span class="org-type">int </span>= 23
&gt; 



&gt; m (h (g 4)) ;;
<span class="org-keyword">val</span> <span class="org-variable-name">it</span> : <span class="org-type">int </span>= 19
&gt; 
- (m &lt;&lt; h &lt;&lt; g) 4 ;;
<span class="org-keyword">val</span> <span class="org-variable-name">it</span> : <span class="org-type">int </span>= 19
&gt; 

<span class="org-comment-delimiter">// </span><span class="org-comment">It is the same as math composition: f(x) = m &#176; h &#176; g</span>
<span class="org-comment-delimiter">//</span>
- <span class="org-keyword">let</span> f = m &lt;&lt; h &lt;&lt; g ;;

<span class="org-keyword">val</span> f : (int -&gt; int)

&gt; f 4 ;;
<span class="org-keyword">val</span> <span class="org-variable-name">it</span> : <span class="org-type">int </span>= 19
&gt;
</pre>
</div>

<p>
Forward Composition Operator (&gt;&gt;):
</p>

<div class="org-src-container">

<pre class="src src-fsharp">&gt; (&gt;&gt;) ;;
<span class="org-keyword">val</span> it : (('a -&gt; 'b) -&gt; ('b -&gt; 'c) -&gt; 'a -&gt; 'c) 

&gt; <span class="org-keyword">let</span> <span class="org-function-name">h</span> x = x + 3 ;;         

<span class="org-keyword">val</span> <span class="org-variable-name">h</span> : <span class="org-type">x:int </span>-&gt; int

&gt; <span class="org-keyword">let</span> <span class="org-function-name">g</span> x = x * 5 ;;

<span class="org-keyword">val</span> <span class="org-variable-name">g</span> : <span class="org-type">x:int </span>-&gt; int

- <span class="org-keyword">let</span> <span class="org-function-name">m</span> x = x - 4 ;;

<span class="org-keyword">val</span> <span class="org-variable-name">m</span> : <span class="org-type">x:int </span>-&gt; int


- h (g 4) ;;
<span class="org-keyword">val</span> <span class="org-variable-name">it</span> : <span class="org-type">int </span>= 23
&gt; 

- (g &gt;&gt; h) 4 ;;
<span class="org-keyword">val</span> <span class="org-variable-name">it</span> : <span class="org-type">int </span>= 23
&gt; 
- <span class="org-keyword">let</span> f = g &gt;&gt; h ;;

<span class="org-keyword">val</span> f : (int -&gt; int)

&gt; f 4 ;;
<span class="org-keyword">val</span> <span class="org-variable-name">it</span> : <span class="org-type">int </span>= 23
&gt; 


- m (h (g 4)) ;;
<span class="org-keyword">val</span> <span class="org-variable-name">it</span> : <span class="org-type">int </span>= 19
&gt; 
- 

- (g &gt;&gt; h &gt;&gt; m ) 4 ;;
<span class="org-keyword">val</span> <span class="org-variable-name">it</span> : <span class="org-type">int </span>= 19
&gt; 
- 

<span class="org-comment-delimiter">// </span><span class="org-comment">The argument is seen flowing from left to right, in the inverse</span>
<span class="org-comment-delimiter">// </span><span class="org-comment">order of math composition and Haskell composition operator (.) dot,</span>
<span class="org-comment-delimiter">// </span><span class="org-comment">which is more easier to read.  </span>
<span class="org-comment-delimiter">//</span>
<span class="org-comment-delimiter">//  </span><span class="org-comment">(g &gt;&gt; h &gt;&gt; m) 4 =&gt; It is seen as passing through each function </span>
<span class="org-comment-delimiter">//</span>
<span class="org-comment-delimiter">//   </span><span class="org-comment">Evaluating:  g &gt;&gt; h &gt;&gt; m                    </span>
<span class="org-comment-delimiter">//</span>
<span class="org-comment-delimiter">//  </span><span class="org-comment">Input              f =  g &gt;&gt; h &gt;&gt; m                          Output </span>
<span class="org-comment-delimiter">//       </span><span class="org-comment">.........................................................</span>
<span class="org-comment-delimiter">//       </span><span class="org-comment">.                                                       .         </span>
<span class="org-comment-delimiter">//       </span><span class="org-comment">.   |-----------|      |-----------|     |-----------|  .</span>
<span class="org-comment-delimiter">//     </span><span class="org-comment">----&gt; |g = x * 5  ||----&gt;| h = x + 3 |----&gt;| m = x - 4 |-----&gt;</span>
<span class="org-comment-delimiter">//   </span><span class="org-comment">4   .   |-----------|  20  |-----------| 23  |-----------|  .  19 </span>
<span class="org-comment-delimiter">//       </span><span class="org-comment">.       = 4 * 5 = 20    = 20 + 3 = 23    = 23 - 4 = 19  . </span>
<span class="org-comment-delimiter">//       </span><span class="org-comment">.........................................................</span>
<span class="org-comment-delimiter">//</span>

- <span class="org-keyword">let</span> f = g &gt;&gt; h &gt;&gt; m ;;

<span class="org-keyword">val</span> f : (int -&gt; int)

&gt; f 4 ;;
<span class="org-keyword">val</span> <span class="org-variable-name">it</span> : <span class="org-type">int </span>= 19
&gt;
</pre>
</div>

<p>
F# Argument Piping operator (|&gt;) 
</p>

<div class="org-src-container">

<pre class="src src-fsharp">- <span class="org-keyword">let</span> <span class="org-function-name">h</span> x = x + 3 ;; 

<span class="org-keyword">val</span> <span class="org-variable-name">h</span> : <span class="org-type">x:int </span>-&gt; int

&gt; <span class="org-keyword">let</span> <span class="org-function-name">g</span> x = x * 5 ;;

<span class="org-keyword">val</span> <span class="org-variable-name">g</span> : <span class="org-type">x:int </span>-&gt; int

&gt;  <span class="org-keyword">let</span> <span class="org-function-name">m</span> x = x - 4 ;;

<span class="org-keyword">val</span> <span class="org-variable-name">m</span> : <span class="org-type">x:int </span>-&gt; int

&gt; 

<span class="org-comment-delimiter">// </span><span class="org-comment">The piping operator feeds the function input forward. </span>
<span class="org-comment-delimiter">//</span>
- (|&gt;) ;;
<span class="org-keyword">val</span> it : ('a -&gt; ('a -&gt; 'b) -&gt; 'b) 
&gt; 

- (g 4) ;;
<span class="org-keyword">val</span> <span class="org-variable-name">it</span> : <span class="org-type">int </span>= 20
&gt; 
- 4 |&gt; g ;;
<span class="org-keyword">val</span> <span class="org-variable-name">it</span> : <span class="org-type">int </span>= 20
&gt; 

<span class="org-comment-delimiter">// </span><span class="org-comment">It is the same as:  4 |&gt; g |&gt; h </span>
<span class="org-comment-delimiter">//</span>
- h (g 4) ;;
<span class="org-keyword">val</span> <span class="org-variable-name">it</span> : <span class="org-type">int </span>= 23
&gt;

- 4 |&gt; g |&gt; h ;;
<span class="org-keyword">val</span> <span class="org-variable-name">it</span> : <span class="org-type">int </span>= 23
&gt; 

<span class="org-comment-delimiter">// </span><span class="org-comment">It is the same as:  4 |&gt; g |&gt; h |&gt; m ;; </span>
<span class="org-comment-delimiter">//</span>
- m (h (g 4)) ;;
<span class="org-keyword">val</span> <span class="org-variable-name">it</span> : <span class="org-type">int </span>= 19
&gt; 

- 4 |&gt; g |&gt; h |&gt; m ;; 
<span class="org-keyword">val</span> <span class="org-variable-name">it</span> : <span class="org-type">int </span>= 19
&gt;
</pre>
</div>

<p>
Example of a non-trivial function composition.
</p>

<div class="org-src-container">

<pre class="src src-fsharp"><span class="org-keyword">let</span> <span class="org-variable-name">text</span> = <span class="org-string">"</span>
<span class="org-string"> 12.23,30.23,892.2323</span>
<span class="org-string"> 23.23,90.23,1000.23</span>
<span class="org-string"> 3563.23,100.23,45.23</span>

<span class="org-string">"</span>
;;

<span class="org-comment-delimiter">// </span><span class="org-comment">Negate predicate. Invert a predicate function. </span>
<span class="org-comment-delimiter">//</span>
&gt; <span class="org-keyword">let</span> <span class="org-function-name">neg</span> pred = <span class="org-keyword">fun</span> <span class="org-variable-name">x</span> -&gt; <span class="org-keyword">not</span> (pred x) ;;

<span class="org-keyword">val</span> <span class="org-variable-name">neg</span> : <span class="org-type">pred:('a </span>-&gt; bool) -&gt; x:'a -&gt; bool



<span class="org-keyword">let</span> <span class="org-function-name">split_string</span> <span class="org-variable-name">sep</span> <span class="org-variable-name">str</span> =                                
    List.ofArray  (System.Text.RegularExpressions.Regex.Split (str, sep))

&gt; <span class="org-keyword">let</span> split_lines = split_string <span class="org-string">"\n"</span> ;;

<span class="org-keyword">val</span> split_lines : (string -&gt; string list)

&gt; <span class="org-keyword">let</span> <span class="org-function-name">trim_string</span> (s: <span class="org-type">string</span>) = s.Trim() ;;              

<span class="org-keyword">val</span> <span class="org-variable-name">trim_string</span> : <span class="org-type">s:string </span>-&gt; string

- <span class="org-keyword">let</span> <span class="org-function-name">is_string_empty</span> (s: <span class="org-type">string</span>) = s.Length = 0 
- ;;

<span class="org-keyword">val</span> <span class="org-variable-name">is_string_emtpy</span> : <span class="org-type">s:string </span>-&gt; bool

- text |&gt; split_lines ;;       
<span class="org-keyword">val</span> <span class="org-variable-name">it</span> : <span class="org-type">string list </span>=
  [<span class="org-string">""</span>; <span class="org-string">" 12.23,30.23,892.2323"</span>; <span class="org-string">" 23.23,90.23,1000.23"</span>;
   <span class="org-string">" 3563.23,100.23,45.23"</span>; <span class="org-string">""</span>; <span class="org-string">""</span>]
&gt; 

- text |&gt; split_lines |&gt; List.filter (neg is_string_empty) ;;
<span class="org-keyword">val</span> <span class="org-variable-name">it</span> : <span class="org-type">string list </span>=
  [<span class="org-string">" 12.23,30.23,892.2323"</span>; <span class="org-string">" 23.23,90.23,1000.23"</span>; <span class="org-string">" 3563.23,100.23,45.23"</span>]
&gt; 

- text |&gt; split_lines |&gt; List.filter (neg is_string_empty) |&gt; List.map trim_stri- ng ;;
<span class="org-keyword">val</span> <span class="org-variable-name">it</span> : <span class="org-type">string list </span>=
  [<span class="org-string">"12.23,30.23,892.2323"</span>; <span class="org-string">"23.23,90.23,1000.23"</span>; <span class="org-string">"3563.23,100.23,45.23"</span>]
&gt; 
- 

- text |&gt; split_lines |&gt; List.filter (neg is_string_empty) |&gt; List.map trim_stri- ng |&gt; List.map (split_string <span class="org-string">","</span>) ;;
<span class="org-keyword">val</span> <span class="org-variable-name">it</span> : <span class="org-type">string list list </span>=
  [[<span class="org-string">"12.23"</span>; <span class="org-string">"30.23"</span>; <span class="org-string">"892.2323"</span>]; [<span class="org-string">"23.23"</span>; <span class="org-string">"90.23"</span>; <span class="org-string">"1000.23"</span>];
   [<span class="org-string">"3563.23"</span>; <span class="org-string">"100.23"</span>; <span class="org-string">"45.23"</span>]]
&gt; 
- 

- text |&gt; split_lines |&gt; List.filter (neg is_string_empty) |&gt; List.map trim_stri- ng |&gt; List.map (split_string <span class="org-string">","</span>) |&gt; List.map (List.map float) ;;
<span class="org-keyword">val</span> <span class="org-variable-name">it</span> : <span class="org-type">float list list </span>=
  [[12.23; 30.23; 892.2323]; [23.23; 90.23; 1000.23]; [3563.23; 100.23; 45.23]]
&gt; 

<span class="org-comment-delimiter">// </span><span class="org-comment">Or in multiple lines:</span>

text 
|&gt; split_lines 
|&gt; List.filter (neg is_string_empty) 
|&gt; List.map trim_string 
|&gt; List.map (split_string <span class="org-string">","</span>) 
|&gt; List.map (List.map float) 
;;

<span class="org-keyword">val</span> <span class="org-variable-name">it</span> : <span class="org-type">float list list </span>=
  [[12.23; 30.23; 892.2323]; [23.23; 90.23; 1000.23]; [3563.23; 100.23; 45.23]]
&gt; 

<span class="org-comment-delimiter">// </span><span class="org-comment">Then transformed into a function: </span>
<span class="org-comment-delimiter">//</span>
<span class="org-keyword">let</span> <span class="org-function-name">parse_csv</span> <span class="org-variable-name">text</span> =
   text
   |&gt; split_lines 
   |&gt; List.filter (neg is_string_empty) 
   |&gt; List.map trim_string 
   |&gt; List.map (split_string <span class="org-string">","</span>) 
   |&gt; List.map (List.map float) 
;;

<span class="org-keyword">val</span> <span class="org-variable-name">parse_csv</span> : <span class="org-type">text:string </span>-&gt; float list list

&gt; parse_csv text ;;
<span class="org-keyword">val</span> <span class="org-variable-name">it</span> : <span class="org-type">float list list </span>=
  [[12.23; 30.23; 892.2323]; [23.23; 90.23; 1000.23]; [3563.23; 100.23; 45.23]]
&gt; 
- 

<span class="org-comment-delimiter">// </span><span class="org-comment">This operation can be optimized with function (forward) composition.</span>
<span class="org-comment-delimiter">// </span>
<span class="org-keyword">let</span> <span class="org-function-name">parse_csv2</span> <span class="org-variable-name">text</span> =
   text
   |&gt; split_lines 
   |&gt; List.filter (neg is_string_empty) 
   |&gt; List.map (trim_string &gt;&gt; (split_string <span class="org-string">","</span>) &gt;&gt; (List.map float)) 
;;

<span class="org-keyword">val</span> <span class="org-variable-name">parse_csv2</span> : <span class="org-type">text:string </span>-&gt; float list list

&gt; parse_csv2 text ;;
<span class="org-keyword">val</span> <span class="org-variable-name">it</span> : <span class="org-type">float list list </span>=
  [[12.23; 30.23; 892.2323]; [23.23; 90.23; 1000.23]; [3563.23; 100.23; 45.23]]
&gt; 

<span class="org-comment-delimiter">// </span><span class="org-comment">It could be implemented using the math compostion (&lt;&lt;) operator.</span>
<span class="org-comment-delimiter">// </span><span class="org-comment">in the same as in Haskell.  </span>
<span class="org-comment-delimiter">// </span>
<span class="org-keyword">let</span> <span class="org-function-name">parse_csv3</span> <span class="org-variable-name">text</span> =
   text
   |&gt; split_lines 
   |&gt; List.filter (neg is_string_empty) 
   |&gt; List.map ((List.map float) &lt;&lt; (split_string <span class="org-string">","</span>) &lt;&lt; trim_string) 
;;

<span class="org-keyword">val</span> <span class="org-variable-name">parse_csv3</span> : <span class="org-type">text:string </span>-&gt; float list list

- parse_csv3 text ;;
<span class="org-keyword">val</span> <span class="org-variable-name">it</span> : <span class="org-type">float list list </span>=
  [[12.23; 30.23; 892.2323]; [23.23; 90.23; 1000.23]; [3563.23; 100.23; 45.23]]
&gt; 

<span class="org-comment-delimiter">//  </span><span class="org-comment">934.6923 = 12.23 + 30.23 + 892.2323</span>
<span class="org-comment-delimiter">//</span>
- parse_csv3 text |&gt; List.map List.sum ;;            
<span class="org-keyword">val</span> <span class="org-variable-name">it</span> : <span class="org-type">float list </span>= [934.6923; 1113.69; 3708.69]
&gt; 
- 

- parse_csv3 text |&gt; List.map List.sum |&gt; List.sum ;;
<span class="org-keyword">val</span> <span class="org-variable-name">it</span> : <span class="org-type">float </span>= 5757.0723
&gt; 

<span class="org-comment-delimiter">// </span><span class="org-comment">This function can also be written in point-free style. </span>
<span class="org-comment-delimiter">// </span><span class="org-comment">It means only with function forward-composition.</span>
<span class="org-comment-delimiter">//</span>
<span class="org-keyword">let</span> <span class="org-variable-name">parse_csv4</span> =
       split_lines 
    &gt;&gt; List.filter (neg is_string_empty) 
    &gt;&gt; List.map (trim_string
                 &gt;&gt; (split_string <span class="org-string">","</span>)
                 &gt;&gt; (List.map float)) 
;;

<span class="org-keyword">val</span> parse_csv4 : (string -&gt; float list list)


&gt; parse_csv4 text ;;
<span class="org-keyword">val</span> <span class="org-variable-name">it</span> : <span class="org-type">float list list </span>=
  [[12.23; 30.23; 892.2323]; [23.23; 90.23; 1000.23]; [3563.23; 100.23; 45.23]]
&gt; 

<span class="org-comment-delimiter">// </span><span class="org-comment">With math composition (&lt;&lt;) or Haskell composition order.</span>
<span class="org-comment-delimiter">//</span>
<span class="org-keyword">let</span> <span class="org-variable-name">parse_csv5</span> =
    List.map ((List.map float) &lt;&lt; (split_string <span class="org-string">","</span>) &lt;&lt; trim_string) 
    &lt;&lt;  List.filter (neg is_string_empty)
    &lt;&lt;  split_lines    
;;

<span class="org-keyword">val</span> parse_csv5 : (string -&gt; float list list)

&gt; parse_csv5 text ;;                                                       
<span class="org-keyword">val</span> <span class="org-variable-name">it</span> : <span class="org-type">float list list </span>=
  [[12.23; 30.23; 892.2323]; [23.23; 90.23; 1000.23]; [3563.23; 100.23; 45.23]]
&gt;
</pre>
</div>
</div>
</div>
</div>

<div id="outline-container-sec-1-13" class="outline-3">
<h3 id="sec-1-13"><span class="section-number-3">1.13</span> Functors</h3>
<div class="outline-text-3" id="text-1-13">
</div><div id="outline-container-sec-1-13-1" class="outline-4">
<h4 id="sec-1-13-1"><span class="section-number-4">1.13.1</span> Overview</h4>
<div class="outline-text-4" id="text-1-13-1">
<p>
Functors are type constructors that can be mapped over like lists are
mapped with <span class="underline">map</span> function. This concept from category theory and
like many mathematical abstractions it is defined by the laws that it must
satisfies, in this case Functor's laws.
</p>

<p>
In Haskell functors are instances of the type class Functor that must
implement the function fmap for each functor implementation.
</p>

<p>
Note: Haskell functors must not be confused with <span class="underline">C++ functor</span> and
<span class="underline">ML-module functor (Higher order module)</span>. 
</p>

<div class="org-src-container">

<pre class="src src-haskell"><span class="org-haskell-keyword">class</span>  <span class="org-haskell-constructor">Functor</span> f  <span class="org-haskell-keyword">where</span>
  fmap <span class="org-haskell-operator">::</span> (a <span class="org-haskell-operator">-&gt;</span> b) <span class="org-haskell-operator">-&gt;</span> f a <span class="org-haskell-operator">-&gt;</span> f b
</pre>
</div>


<pre class="example">
Map Diagram                                Functor Diagram 


          f :: a -&gt; b             =====&gt;        f :: a -&gt; b
  a   ----------------------&gt; b           a ------------------------&gt; b
             
         map f :: [a] -&gt; [b]                   fmap f :: F a -&gt; F b 
  [a] ----------------------&gt; [b]       F a ----------------------&gt; F b

Where F is a type constructor.
</pre>
<p>
A functor must satisfy the laws:
</p>

<ul class="org-ul">
<li>Identity Law.  
</li>
</ul>

<p>
fmap id == id   
</p>

<p>
Where id is the identity function. 
</p>

<ul class="org-ul">
<li>Composition Law 
</li>
</ul>

<p>
fmap (f . g) == fmap f . fmap g
</p>

<p>
The composition law can be generalized to:
</p>

<p>
fmap (f1 . f2 . f3 &#x2026; fn) = fmap f1 . fmap f2 . fmap f3 &#x2026; fmap fn 
</p>
</div>
</div>

<div id="outline-container-sec-1-13-2" class="outline-4">
<h4 id="sec-1-13-2"><span class="section-number-4">1.13.2</span> Show all Functor instances</h4>
<div class="outline-text-4" id="text-1-13-2">
<div class="org-src-container">

<pre class="src src-haskell"><span class="org-haskell-operator">&gt;</span> <span class="org-haskell-constructor">:</span>info <span class="org-haskell-constructor">Functor</span> 
<span class="org-haskell-keyword">class</span> <span class="org-haskell-constructor">Functor</span> f <span class="org-haskell-keyword">where</span>
  fmap <span class="org-haskell-operator">::</span> (a <span class="org-haskell-operator">-&gt;</span> b) <span class="org-haskell-operator">-&gt;</span> f a <span class="org-haskell-operator">-&gt;</span> f b
  (<span class="org-haskell-operator">&lt;$</span>) <span class="org-haskell-operator">::</span> a <span class="org-haskell-operator">-&gt;</span> f b <span class="org-haskell-operator">-&gt;</span> f a
        <span class="org-comment-delimiter">-- </span><span class="org-comment">Defined in `GHC.Base'</span>
<span class="org-haskell-keyword">instance</span> <span class="org-haskell-constructor">Functor</span> (<span class="org-haskell-constructor">Either</span> a) <span class="org-comment-delimiter">-- </span><span class="org-comment">Defined in `Data.Either'</span>
<span class="org-haskell-keyword">instance</span> <span class="org-haskell-constructor">Functor</span> <span class="org-haskell-constructor">Maybe</span> <span class="org-comment-delimiter">-- </span><span class="org-comment">Defined in `Data.Maybe'</span>
<span class="org-haskell-keyword">instance</span> <span class="org-haskell-constructor">Functor</span> <span class="org-haskell-constructor">ZipList</span> <span class="org-comment-delimiter">-- </span><span class="org-comment">Defined in `Control.Applicative'</span>
<span class="org-haskell-keyword">instance</span> <span class="org-haskell-constructor">Monad</span> m <span class="org-haskell-operator">=&gt;</span> <span class="org-haskell-constructor">Functor</span> (<span class="org-haskell-constructor">WrappedMonad</span> m)
  <span class="org-comment-delimiter">-- </span><span class="org-comment">Defined in `Control.Applicative'</span>
<span class="org-haskell-keyword">instance</span> <span class="org-haskell-constructor">Functor</span> (<span class="org-haskell-constructor">Const</span> m) <span class="org-comment-delimiter">-- </span><span class="org-comment">Defined in `Control.Applicative'</span>
<span class="org-haskell-keyword">instance</span> <span class="org-haskell-constructor">Functor</span> <span class="org-haskell-constructor">[]</span> <span class="org-comment-delimiter">-- </span><span class="org-comment">Defined in `GHC.Base'</span>
<span class="org-haskell-keyword">instance</span> <span class="org-haskell-constructor">Functor</span> <span class="org-haskell-constructor">IO</span> <span class="org-comment-delimiter">-- </span><span class="org-comment">Defined in `GHC.Base'</span>
<span class="org-haskell-keyword">instance</span> <span class="org-haskell-constructor">Functor</span> (<span class="org-haskell-constructor">(-&gt;)</span> r) <span class="org-comment-delimiter">-- </span><span class="org-comment">Defined in `GHC.Base'</span>
<span class="org-haskell-keyword">instance</span> <span class="org-haskell-constructor">Functor</span> (<span class="org-haskell-constructor">(,)</span> a) <span class="org-comment-delimiter">-- </span><span class="org-comment">Defined in `GHC.Base'</span>
<span class="org-haskell-operator">&gt;</span>

<span class="org-haskell-operator">&gt;</span> <span class="org-haskell-constructor">:</span>info <span class="org-haskell-constructor">IO</span>
<span class="org-haskell-keyword">newtype</span> <span class="org-haskell-constructor">IO</span> a
  <span class="org-haskell-operator">=</span> <span class="org-haskell-constructor">GHC.Types.IO</span> (<span class="org-haskell-constructor">GHC.Prim.State</span><span class="org-haskell-operator">#</span> <span class="org-haskell-constructor">GHC.Prim.RealWorld</span>
                  <span class="org-haskell-operator">-&gt;</span> (<span class="org-haskell-operator">#</span> <span class="org-haskell-constructor">GHC.Prim.State</span><span class="org-haskell-operator">#</span> <span class="org-haskell-constructor">GHC.Prim.RealWorld</span><span class="org-haskell-operator">,</span> a <span class="org-haskell-operator">#</span>))
        <span class="org-comment-delimiter">-- </span><span class="org-comment">Defined in `GHC.Types'</span>
<span class="org-haskell-keyword">instance</span> <span class="org-haskell-constructor">Monad</span> <span class="org-haskell-constructor">IO</span> <span class="org-comment-delimiter">-- </span><span class="org-comment">Defined in `GHC.Base'</span>
<span class="org-haskell-keyword">instance</span> <span class="org-haskell-constructor">Functor</span> <span class="org-haskell-constructor">IO</span> <span class="org-comment-delimiter">-- </span><span class="org-comment">Defined in `GHC.Base'</span>
<span class="org-haskell-keyword">instance</span> <span class="org-haskell-constructor">Applicative</span> <span class="org-haskell-constructor">IO</span> <span class="org-comment-delimiter">-- </span><span class="org-comment">Defined in `Control.Applicative'</span>
<span class="org-haskell-operator">&gt;</span> 
<span class="org-haskell-operator">&gt;</span> <span class="org-haskell-constructor">:</span>info <span class="org-haskell-constructor">Maybe</span>
<span class="org-haskell-keyword">data</span> <span class="org-haskell-constructor">Maybe</span> a <span class="org-haskell-operator">=</span> <span class="org-haskell-constructor">Nothing</span> <span class="org-haskell-operator">|</span> <span class="org-haskell-constructor">Just</span> a         <span class="org-comment-delimiter">-- </span><span class="org-comment">Defined in `Data.Maybe'</span>
<span class="org-haskell-keyword">instance</span> <span class="org-haskell-constructor">Eq</span> a <span class="org-haskell-operator">=&gt;</span> <span class="org-haskell-constructor">Eq</span> (<span class="org-haskell-constructor">Maybe</span> a) <span class="org-comment-delimiter">-- </span><span class="org-comment">Defined in `Data.Maybe'</span>
<span class="org-haskell-keyword">instance</span> <span class="org-haskell-constructor">Monad</span> <span class="org-haskell-constructor">Maybe</span> <span class="org-comment-delimiter">-- </span><span class="org-comment">Defined in `Data.Maybe'</span>
<span class="org-haskell-keyword">instance</span> <span class="org-haskell-constructor">Functor</span> <span class="org-haskell-constructor">Maybe</span> <span class="org-comment-delimiter">-- </span><span class="org-comment">Defined in `Data.Maybe'</span>
<span class="org-haskell-keyword">instance</span> <span class="org-haskell-constructor">Ord</span> a <span class="org-haskell-operator">=&gt;</span> <span class="org-haskell-constructor">Ord</span> (<span class="org-haskell-constructor">Maybe</span> a) <span class="org-comment-delimiter">-- </span><span class="org-comment">Defined in `Data.Maybe'</span>
<span class="org-haskell-keyword">instance</span> <span class="org-haskell-constructor">Read</span> a <span class="org-haskell-operator">=&gt;</span> <span class="org-haskell-constructor">Read</span> (<span class="org-haskell-constructor">Maybe</span> a) <span class="org-comment-delimiter">-- </span><span class="org-comment">Defined in `GHC.Read'</span>
<span class="org-haskell-keyword">instance</span> <span class="org-haskell-constructor">Show</span> a <span class="org-haskell-operator">=&gt;</span> <span class="org-haskell-constructor">Show</span> (<span class="org-haskell-constructor">Maybe</span> a) <span class="org-comment-delimiter">-- </span><span class="org-comment">Defined in `GHC.Show'</span>
<span class="org-haskell-keyword">instance</span> <span class="org-haskell-constructor">MonadPlus</span> <span class="org-haskell-constructor">Maybe</span> <span class="org-comment-delimiter">-- </span><span class="org-comment">Defined in `Control.Monad'</span>
<span class="org-haskell-keyword">instance</span> <span class="org-haskell-constructor">Applicative</span> <span class="org-haskell-constructor">Maybe</span> <span class="org-comment-delimiter">-- </span><span class="org-comment">Defined in `Control.Applicative'</span>
<span class="org-haskell-keyword">instance</span> <span class="org-haskell-constructor">Alternative</span> <span class="org-haskell-constructor">Maybe</span> <span class="org-comment-delimiter">-- </span><span class="org-comment">Defined in `Control.Applicative'</span>
<span class="org-haskell-operator">&gt;</span>
</pre>
</div>
</div>
</div>

<div id="outline-container-sec-1-13-3" class="outline-4">
<h4 id="sec-1-13-3"><span class="section-number-4">1.13.3</span> Functor Implementations</h4>
<div class="outline-text-4" id="text-1-13-3">
</div><div id="outline-container-sec-1-13-3-1" class="outline-5">
<h5 id="sec-1-13-3-1"><span class="section-number-5">1.13.3.1</span> Identity</h5>
<div class="outline-text-5" id="text-1-13-3-1">
<div class="org-src-container">

<pre class="src src-haskell"><span class="org-comment-delimiter">-- </span><span class="org-comment">File: identity.hs </span>
<span class="org-comment-delimiter">--</span>
<span class="org-haskell-keyword">data</span> <span class="org-haskell-constructor">Id</span> a <span class="org-haskell-operator">=</span> <span class="org-haskell-constructor">Id</span> a  <span class="org-haskell-keyword">deriving</span> (<span class="org-haskell-constructor">Show</span><span class="org-haskell-operator">,</span> <span class="org-haskell-constructor">Eq</span>)

<span class="org-haskell-keyword">instance</span> <span class="org-haskell-constructor">Functor</span> <span class="org-haskell-constructor">Id</span> <span class="org-haskell-keyword">where</span>
  fmap f (<span class="org-haskell-constructor">Id</span> a) <span class="org-haskell-operator">=</span> <span class="org-haskell-constructor">Id</span> (f a)

 <span class="org-comment-delimiter">-- </span><span class="org-comment">Specialized version of fmap </span>
 <span class="org-comment-delimiter">--</span>
<span class="org-function-name">fmap_id</span> <span class="org-haskell-operator">::</span> (a <span class="org-haskell-operator">-&gt;</span> b) <span class="org-haskell-operator">-&gt;</span> (<span class="org-haskell-constructor">Id</span> a <span class="org-haskell-operator">-&gt;</span> <span class="org-haskell-constructor">Id</span> b)
<span class="org-haskell-definition">fmap_id</span> f <span class="org-haskell-operator">=</span> fmap f 

<span class="org-comment-delimiter">-- </span><span class="org-comment">-- End of file identity.hs ------</span>
<span class="org-comment-delimiter">--</span><span class="org-comment">----------------------------------</span>

<span class="org-haskell-operator">&gt;</span> <span class="org-haskell-constructor">:</span>load <span class="org-haskell-operator">/</span>tmp<span class="org-haskell-operator">/</span>identity<span class="org-haskell-operator">.</span>hs

<span class="org-haskell-operator">&gt;</span> <span class="org-haskell-constructor">Id</span> 10
<span class="org-haskell-constructor">Id</span> 10

<span class="org-haskell-operator">&gt;</span> <span class="org-haskell-definition">fmap</span> (<span class="org-haskell-operator">\</span>x <span class="org-haskell-operator">-&gt;</span> x <span class="org-haskell-operator">+</span> 3) (<span class="org-haskell-constructor">Id</span> 30)
<span class="org-haskell-constructor">Id</span> 33
<span class="org-haskell-operator">&gt;</span> 

<span class="org-haskell-operator">&gt;</span> <span class="org-haskell-keyword">let</span> plus5 <span class="org-haskell-operator">=</span>  <span class="org-haskell-operator">\</span>x <span class="org-haskell-operator">-&gt;</span> x <span class="org-haskell-operator">+</span> 5
<span class="org-haskell-operator">&gt;</span> <span class="org-haskell-constructor">:</span>t plus5
<span class="org-function-name">plus5</span> <span class="org-haskell-operator">::</span> <span class="org-haskell-constructor">Integer</span> <span class="org-haskell-operator">-&gt;</span> <span class="org-haskell-constructor">Integer</span>
<span class="org-haskell-operator">&gt;</span> 

<span class="org-haskell-operator">&gt;</span> <span class="org-haskell-definition">plus5</span> 10
15
<span class="org-haskell-operator">&gt;</span> 

<span class="org-haskell-operator">&gt;</span> <span class="org-haskell-definition">fmap</span> plus5 (<span class="org-haskell-constructor">Id</span> 30)
<span class="org-haskell-constructor">Id</span> 35
<span class="org-haskell-operator">&gt;</span> 

<span class="org-haskell-operator">&gt;</span> <span class="org-haskell-keyword">let</span> fmap_plus5 <span class="org-haskell-operator">=</span> fmap plus5

<span class="org-haskell-operator">&lt;</span>interactive<span class="org-haskell-operator">&gt;:</span>68<span class="org-haskell-constructor">:</span>18<span class="org-haskell-constructor">:</span>
    <span class="org-haskell-constructor">No</span> <span class="org-haskell-keyword">instance</span> for (<span class="org-haskell-constructor">Functor</span> f0) arising from a use <span class="org-haskell-keyword">of</span> `fmap'
    <span class="org-haskell-constructor">The</span> <span class="org-haskell-keyword">type</span> variable `f0' is ambiguous
 
 <span class="org-comment-delimiter">-- </span><span class="org-comment">Solution:</span>
 
 
<span class="org-haskell-operator">&gt;</span> <span class="org-haskell-keyword">let</span> fmap_plus5 <span class="org-haskell-operator">=</span> fmap plus5 <span class="org-haskell-operator">::</span> <span class="org-haskell-constructor">Id</span> <span class="org-haskell-constructor">Integer</span> <span class="org-haskell-operator">-&gt;</span> <span class="org-haskell-constructor">Id</span> <span class="org-haskell-constructor">Integer</span> 
<span class="org-haskell-operator">&gt;</span> <span class="org-haskell-constructor">:</span>t fmap_plus5
<span class="org-function-name">fmap_plus5</span> <span class="org-haskell-operator">::</span> <span class="org-haskell-constructor">Id</span> <span class="org-haskell-constructor">Integer</span> <span class="org-haskell-operator">-&gt;</span> <span class="org-haskell-constructor">Id</span> <span class="org-haskell-constructor">Integer</span>
<span class="org-haskell-operator">&gt;</span> 

<span class="org-haskell-operator">&gt;</span> <span class="org-haskell-definition">fmap_plus5</span> (<span class="org-haskell-constructor">Id</span> 30)
<span class="org-haskell-constructor">Id</span> 35
<span class="org-haskell-operator">&gt;</span> 


<span class="org-haskell-operator">&gt;</span> <span class="org-haskell-constructor">:</span>t fmap_id
<span class="org-function-name">fmap_id</span> <span class="org-haskell-operator">::</span> (a <span class="org-haskell-operator">-&gt;</span> b) <span class="org-haskell-operator">-&gt;</span> <span class="org-haskell-constructor">Id</span> a <span class="org-haskell-operator">-&gt;</span> <span class="org-haskell-constructor">Id</span> b
<span class="org-haskell-operator">&gt;</span> 

<span class="org-haskell-operator">&gt;</span> <span class="org-haskell-definition">fmap_id</span> sqrt (<span class="org-haskell-constructor">Id</span> 100.0)
<span class="org-haskell-constructor">Id</span> 10.0
<span class="org-haskell-operator">&gt;</span> 
 
<span class="org-haskell-operator">&gt;</span> <span class="org-haskell-keyword">let</span> sqrt_id <span class="org-haskell-operator">=</span> fmap_id sqrt
<span class="org-haskell-operator">&gt;</span> <span class="org-haskell-constructor">:</span>t sqrt_id
<span class="org-function-name">sqrt_id</span> <span class="org-haskell-operator">::</span> <span class="org-haskell-constructor">Id</span> <span class="org-haskell-constructor">Double</span> <span class="org-haskell-operator">-&gt;</span> <span class="org-haskell-constructor">Id</span> <span class="org-haskell-constructor">Double</span>
<span class="org-haskell-operator">&gt;</span> 

<span class="org-haskell-operator">&gt;</span> <span class="org-haskell-definition">sqrt_id</span> (<span class="org-haskell-constructor">Id</span> 100.0)
<span class="org-haskell-constructor">Id</span> 10.0
<span class="org-haskell-operator">&gt;</span>
</pre>
</div>
</div>
</div>

<div id="outline-container-sec-1-13-3-2" class="outline-5">
<h5 id="sec-1-13-3-2"><span class="section-number-5">1.13.3.2</span> List</h5>
<div class="outline-text-5" id="text-1-13-3-2">
<p>
For lists the function fmap is equal to map. 
</p>

<div class="org-src-container">

<pre class="src src-haskell"><span class="org-haskell-keyword">instance</span> <span class="org-haskell-constructor">Functor</span> <span class="org-haskell-constructor">[]</span> <span class="org-haskell-keyword">where</span>
  fmap <span class="org-haskell-operator">=</span> map

<span class="org-haskell-operator">&gt;</span> <span class="org-haskell-definition">map</span> (<span class="org-haskell-operator">\</span>x <span class="org-haskell-operator">-&gt;</span> x <span class="org-haskell-operator">+</span> 3) [1<span class="org-haskell-operator">,</span> 2<span class="org-haskell-operator">,</span> 3]
[4<span class="org-haskell-operator">,</span>5<span class="org-haskell-operator">,</span>6]
<span class="org-haskell-operator">&gt;</span> <span class="org-haskell-definition">fmap</span> (<span class="org-haskell-operator">\</span>x <span class="org-haskell-operator">-&gt;</span> x <span class="org-haskell-operator">+</span> 3) [1<span class="org-haskell-operator">,</span> 2<span class="org-haskell-operator">,</span> 3]
[4<span class="org-haskell-operator">,</span>5<span class="org-haskell-operator">,</span>6]
<span class="org-haskell-operator">&gt;</span> 

<span class="org-haskell-operator">&gt;</span> <span class="org-haskell-keyword">let</span> f <span class="org-haskell-operator">=</span> fmap (<span class="org-haskell-operator">\</span>x <span class="org-haskell-operator">-&gt;</span> x <span class="org-haskell-operator">+</span> 3) <span class="org-haskell-operator">::</span> [<span class="org-haskell-constructor">Int</span>] <span class="org-haskell-operator">-&gt;</span> [<span class="org-haskell-constructor">Int</span>]
<span class="org-haskell-operator">&gt;</span> <span class="org-haskell-constructor">:</span>t f
<span class="org-function-name">f</span> <span class="org-haskell-operator">::</span> [<span class="org-haskell-constructor">Int</span>] <span class="org-haskell-operator">-&gt;</span> [<span class="org-haskell-constructor">Int</span>]

<span class="org-haskell-operator">&gt;</span> <span class="org-haskell-definition">f</span> [1<span class="org-haskell-operator">,</span> 2<span class="org-haskell-operator">,</span> 3<span class="org-haskell-operator">,</span> 4]
[4<span class="org-haskell-operator">,</span>5<span class="org-haskell-operator">,</span>6<span class="org-haskell-operator">,</span>7]
<span class="org-haskell-operator">&gt;</span>
</pre>
</div>


<p>
Alternative Implementation of list functor:
</p>

<div class="org-src-container">

<pre class="src src-haskell"><span class="org-comment-delimiter">-- </span><span class="org-comment">File: list_functor.hs </span>
<span class="org-comment-delimiter">--</span>

<span class="org-haskell-keyword">data</span> <span class="org-haskell-constructor">List</span> a  <span class="org-haskell-operator">=</span> <span class="org-haskell-constructor">Cons</span> a (<span class="org-haskell-constructor">List</span> a)  <span class="org-haskell-operator">|</span> <span class="org-haskell-constructor">Nil</span> 
  <span class="org-haskell-keyword">deriving</span> (<span class="org-haskell-constructor">Show</span><span class="org-haskell-operator">,</span> <span class="org-haskell-constructor">Eq</span>)

           
<span class="org-haskell-keyword">instance</span> <span class="org-haskell-constructor">Functor</span> <span class="org-haskell-constructor">List</span> <span class="org-haskell-keyword">where</span>
  
  fmap f xss <span class="org-haskell-operator">=</span> <span class="org-haskell-keyword">case</span> xss <span class="org-haskell-keyword">of</span>
               <span class="org-haskell-constructor">Nil</span>          <span class="org-haskell-operator">-&gt;</span> <span class="org-haskell-constructor">Nil</span>
               <span class="org-haskell-constructor">Cons</span> x xs    <span class="org-haskell-operator">-&gt;</span> <span class="org-haskell-constructor">Cons</span> (f x) (fmap f xs)


<span class="org-comment-delimiter">-- </span><span class="org-comment">End of file -------------</span>
<span class="org-comment-delimiter">--</span><span class="org-comment">-------------------------</span>

<span class="org-haskell-operator">&gt;</span> <span class="org-haskell-constructor">:</span>load <span class="org-haskell-operator">/</span>tmp<span class="org-haskell-operator">/</span>list_functor<span class="org-haskell-operator">.</span>hs

<span class="org-haskell-operator">&gt;</span> <span class="org-haskell-constructor">Cons</span> 10 (<span class="org-haskell-constructor">Cons</span> 20 (<span class="org-haskell-constructor">Cons</span> 30 <span class="org-haskell-constructor">Nil</span>))
<span class="org-haskell-constructor">Cons</span> 10 (<span class="org-haskell-constructor">Cons</span> 20 (<span class="org-haskell-constructor">Cons</span> 30 <span class="org-haskell-constructor">Nil</span>))
<span class="org-haskell-operator">&gt;</span> 

<span class="org-haskell-operator">&gt;</span> <span class="org-haskell-keyword">let</span> xs <span class="org-haskell-operator">=</span> <span class="org-haskell-constructor">Cons</span> 10 (<span class="org-haskell-constructor">Cons</span> 20 (<span class="org-haskell-constructor">Cons</span> 30 <span class="org-haskell-constructor">Nil</span>))
<span class="org-haskell-operator">&gt;</span> xs
<span class="org-haskell-constructor">Cons</span> 10 (<span class="org-haskell-constructor">Cons</span> 20 (<span class="org-haskell-constructor">Cons</span> 30 <span class="org-haskell-constructor">Nil</span>))
<span class="org-haskell-operator">&gt;</span> <span class="org-haskell-constructor">:</span>t xs
<span class="org-function-name">xs</span> <span class="org-haskell-operator">::</span> <span class="org-haskell-constructor">List</span> <span class="org-haskell-constructor">Integer</span>
<span class="org-haskell-operator">&gt;</span> 

<span class="org-haskell-operator">&gt;</span> <span class="org-haskell-definition">fmap</span> (<span class="org-haskell-operator">\</span>x <span class="org-haskell-operator">-&gt;</span> x <span class="org-haskell-operator">+</span> 5) xs 
<span class="org-haskell-constructor">Cons</span> 15 (<span class="org-haskell-constructor">Cons</span> 25 (<span class="org-haskell-constructor">Cons</span> 35 <span class="org-haskell-constructor">Nil</span>))
<span class="org-haskell-operator">&gt;</span> 

<span class="org-haskell-operator">&gt;</span> <span class="org-haskell-keyword">let</span> fm <span class="org-haskell-operator">=</span> fmap (<span class="org-haskell-operator">\</span>x <span class="org-haskell-operator">-&gt;</span> x <span class="org-haskell-operator">+</span> 5) <span class="org-haskell-operator">::</span> <span class="org-haskell-constructor">List</span> <span class="org-haskell-constructor">Integer</span> <span class="org-haskell-operator">-&gt;</span> <span class="org-haskell-constructor">List</span> <span class="org-haskell-constructor">Integer</span>

<span class="org-haskell-operator">&gt;</span> <span class="org-haskell-definition">fm</span>  xs
<span class="org-haskell-constructor">Cons</span> 15 (<span class="org-haskell-constructor">Cons</span> 25 (<span class="org-haskell-constructor">Cons</span> 35 <span class="org-haskell-constructor">Nil</span>))
<span class="org-haskell-operator">&gt;</span>
</pre>
</div>
</div>
</div>

<div id="outline-container-sec-1-13-3-3" class="outline-5">
<h5 id="sec-1-13-3-3"><span class="section-number-5">1.13.3.3</span> Maybe / Option</h5>
<div class="outline-text-5" id="text-1-13-3-3">
<div class="org-src-container">

<pre class="src src-haskell"><span class="org-haskell-keyword">data</span> <span class="org-haskell-constructor">Maybe</span> a <span class="org-haskell-operator">=</span> <span class="org-haskell-constructor">Just</span> a <span class="org-haskell-operator">|</span> <span class="org-haskell-constructor">Nothing</span> <span class="org-haskell-keyword">deriving</span> (<span class="org-haskell-constructor">Eq</span><span class="org-haskell-operator">,</span> <span class="org-haskell-constructor">Show</span>)

<span class="org-haskell-keyword">instance</span> <span class="org-haskell-constructor">Functor</span> <span class="org-haskell-constructor">Maybe</span> <span class="org-haskell-keyword">where</span>  
    fmap f (<span class="org-haskell-constructor">Just</span> x) <span class="org-haskell-operator">=</span> <span class="org-haskell-constructor">Just</span> (f x)  
    fmap f <span class="org-haskell-constructor">Nothing</span> <span class="org-haskell-operator">=</span> <span class="org-haskell-constructor">Nothing</span>
</pre>
</div>

<p>
Example: 
</p>

<div class="org-src-container">

<pre class="src src-haskell"><span class="org-haskell-operator">&gt;</span> <span class="org-haskell-definition">fmap</span> (<span class="org-haskell-operator">\</span>x <span class="org-haskell-operator">-&gt;</span> x <span class="org-haskell-operator">+</span> 10) (<span class="org-haskell-constructor">Just</span> 5)
<span class="org-haskell-constructor">Just</span> 15
<span class="org-haskell-operator">&gt;</span> 
<span class="org-haskell-operator">&gt;</span> <span class="org-haskell-definition">fmap</span> (<span class="org-haskell-operator">\</span>x <span class="org-haskell-operator">-&gt;</span> x <span class="org-haskell-operator">+</span> 10) <span class="org-haskell-constructor">Nothing</span>
<span class="org-haskell-constructor">Nothing</span>
<span class="org-haskell-operator">&gt;</span> 

<span class="org-haskell-operator">&gt;</span> <span class="org-haskell-keyword">let</span> f <span class="org-haskell-operator">=</span> <span class="org-haskell-operator">\</span>x <span class="org-haskell-operator">-&gt;</span> x <span class="org-haskell-operator">+</span> 10
<span class="org-haskell-operator">&gt;</span> <span class="org-haskell-constructor">:</span>t f
<span class="org-function-name">f</span> <span class="org-haskell-operator">::</span> <span class="org-haskell-constructor">Integer</span> <span class="org-haskell-operator">-&gt;</span> <span class="org-haskell-constructor">Integer</span>
<span class="org-haskell-operator">&gt;</span> 

<span class="org-haskell-operator">&gt;</span> <span class="org-haskell-keyword">let</span> fmap_f <span class="org-haskell-operator">=</span> fmap f <span class="org-haskell-operator">::</span> <span class="org-haskell-constructor">Maybe</span> <span class="org-haskell-constructor">Integer</span> <span class="org-haskell-operator">-&gt;</span> <span class="org-haskell-constructor">Maybe</span> <span class="org-haskell-constructor">Integer</span>
<span class="org-haskell-operator">&gt;</span> <span class="org-haskell-definition">fmap_f</span> (<span class="org-haskell-constructor">Just</span> 20)
<span class="org-haskell-constructor">Just</span> 30
<span class="org-haskell-operator">&gt;</span> 

<span class="org-haskell-operator">&gt;</span> <span class="org-haskell-definition">fmap_f</span> <span class="org-haskell-constructor">Nothing</span>
<span class="org-haskell-constructor">Nothing</span>
<span class="org-haskell-operator">&gt;</span> 

<span class="org-haskell-operator">&gt;</span> <span class="org-haskell-keyword">import</span> <span class="org-haskell-constructor">Text.Read</span> (readMaybe)


<span class="org-haskell-operator">&gt;</span> <span class="org-haskell-definition">readMaybe</span> <span class="org-string">"100"</span> <span class="org-haskell-operator">::</span> <span class="org-haskell-constructor">Maybe</span> <span class="org-haskell-constructor">Integer</span>
<span class="org-haskell-constructor">Just</span> 100
<span class="org-haskell-operator">&gt;</span> 
<span class="org-haskell-operator">&gt;</span> <span class="org-haskell-definition">readMaybe</span> <span class="org-string">"asd100"</span> <span class="org-haskell-operator">::</span> <span class="org-haskell-constructor">Maybe</span> <span class="org-haskell-constructor">Integer</span>
<span class="org-haskell-constructor">Nothing</span>
<span class="org-haskell-operator">&gt;</span> 

<span class="org-haskell-operator">&gt;</span> <span class="org-haskell-keyword">let</span> parseInteger str <span class="org-haskell-operator">=</span> readMaybe str <span class="org-haskell-operator">::</span> <span class="org-haskell-constructor">Maybe</span> <span class="org-haskell-constructor">Integer</span>
<span class="org-haskell-operator">&gt;</span> 
<span class="org-haskell-operator">&gt;</span> <span class="org-haskell-constructor">:</span>t parseInteger 
<span class="org-function-name">parseInteger</span> <span class="org-haskell-operator">::</span> <span class="org-haskell-constructor">String</span> <span class="org-haskell-operator">-&gt;</span> <span class="org-haskell-constructor">Maybe</span> <span class="org-haskell-constructor">Integer</span>
<span class="org-haskell-operator">&gt;</span> 

<span class="org-haskell-operator">&gt;</span> <span class="org-haskell-definition">parseInteger</span> <span class="org-string">"100"</span> 
<span class="org-haskell-constructor">Just</span> 100
<span class="org-haskell-operator">&gt;</span> 
<span class="org-haskell-operator">&gt;</span> <span class="org-haskell-definition">parseInteger</span> <span class="org-string">"Not a number"</span> 
<span class="org-haskell-constructor">Nothing</span>
<span class="org-haskell-operator">&gt;</span>

<span class="org-haskell-operator">&gt;</span> <span class="org-haskell-definition">fmap</span> (<span class="org-haskell-operator">\</span>x <span class="org-haskell-operator">-&gt;</span> x <span class="org-haskell-operator">+</span> 10) (parseInteger <span class="org-string">"200"</span>)
<span class="org-haskell-constructor">Just</span> 210
<span class="org-haskell-operator">&gt;</span> 
<span class="org-haskell-operator">&gt;</span> <span class="org-haskell-definition">fmap</span> (<span class="org-haskell-operator">\</span>x <span class="org-haskell-operator">-&gt;</span> x <span class="org-haskell-operator">+</span> 10) (parseInteger <span class="org-string">"2sadas00"</span>)
<span class="org-haskell-constructor">Nothing</span>
<span class="org-haskell-operator">&gt;</span> 

 <span class="org-comment-delimiter">-- </span><span class="org-comment">Specialized version of fmap </span>
 <span class="org-comment-delimiter">-- </span>
<span class="org-function-name">fmap_maybe</span> <span class="org-haskell-operator">::</span> (a <span class="org-haskell-operator">-&gt;</span> b) <span class="org-haskell-operator">-&gt;</span> (<span class="org-haskell-constructor">Maybe</span> a <span class="org-haskell-operator">-&gt;</span> <span class="org-haskell-constructor">Maybe</span> b)
<span class="org-haskell-definition">fmap_maybe</span> func <span class="org-haskell-operator">=</span> fmap func 

<span class="org-haskell-operator">&gt;</span> <span class="org-haskell-definition">fmap_maybe</span> (<span class="org-haskell-operator">\</span>x <span class="org-haskell-operator">-&gt;</span> x <span class="org-haskell-operator">+</span> 10) (<span class="org-haskell-constructor">Just</span> 10)
<span class="org-haskell-constructor">Just</span> 20
<span class="org-haskell-operator">&gt;</span> 

<span class="org-haskell-operator">&gt;</span> <span class="org-haskell-definition">fmap_maybe</span> (<span class="org-haskell-operator">\</span>x <span class="org-haskell-operator">-&gt;</span> x <span class="org-haskell-operator">+</span> 10) <span class="org-haskell-constructor">Nothing</span>
<span class="org-haskell-constructor">Nothing</span>
<span class="org-haskell-operator">&gt;</span>
</pre>
</div>
</div>
</div>

<div id="outline-container-sec-1-13-3-4" class="outline-5">
<h5 id="sec-1-13-3-4"><span class="section-number-5">1.13.3.4</span> Either</h5>
<div class="outline-text-5" id="text-1-13-3-4">
<p>
The type constructor Either is similar to Maybe and it can short
circuit a computation in the similar way to Maybe, however it allows
to attach an error value. 
</p>

<div class="org-src-container">

<pre class="src src-haskell"><span class="org-haskell-keyword">data</span> <span class="org-haskell-constructor">Either</span> a b <span class="org-haskell-operator">=</span> <span class="org-haskell-constructor">Left</span> a <span class="org-haskell-operator">|</span> <span class="org-haskell-constructor">Right</span> b 

<span class="org-haskell-keyword">instance</span> <span class="org-haskell-constructor">Functor</span> (<span class="org-haskell-constructor">Either</span> a) <span class="org-haskell-keyword">where</span>  
    fmap f (<span class="org-haskell-constructor">Right</span> x) <span class="org-haskell-operator">=</span> <span class="org-haskell-constructor">Right</span> (f x)  
    fmap f (<span class="org-haskell-constructor">Left</span> x) <span class="org-haskell-operator">=</span> <span class="org-haskell-constructor">Left</span> x
</pre>
</div>

<p>
Example:
</p>

<div class="org-src-container">

<pre class="src src-haskell"><span class="org-comment-delimiter">--</span>
<span class="org-comment-delimiter">-- </span><span class="org-comment">File: either_functor.hs </span>
<span class="org-comment-delimiter">--</span><span class="org-comment">-----------------------</span>

 
 <span class="org-comment-delimiter">--  </span><span class="org-comment">Specialized version of fmap to Either type </span>
 <span class="org-comment-delimiter">--  </span><span class="org-comment">constructor like map is specialized for lists.</span>
 <span class="org-comment-delimiter">--</span>
<span class="org-function-name">fmap_either</span> <span class="org-haskell-operator">::</span> (a <span class="org-haskell-operator">-&gt;</span> b) <span class="org-haskell-operator">-&gt;</span> (<span class="org-haskell-constructor">Either</span> s a <span class="org-haskell-operator">-&gt;</span> <span class="org-haskell-constructor">Either</span> s b)
<span class="org-haskell-definition">fmap_either</span> f <span class="org-haskell-operator">=</span> fmap f

<span class="org-haskell-keyword">import</span> <span class="org-haskell-constructor">Text.Read</span> (readMaybe)

<span class="org-haskell-keyword">data</span> <span class="org-haskell-constructor">ErrorCode</span> <span class="org-haskell-operator">=</span> 
        <span class="org-haskell-constructor">ParserError</span> 
      <span class="org-haskell-operator">|</span> <span class="org-haskell-constructor">InvalidInput</span> 
      <span class="org-haskell-keyword">deriving</span> (<span class="org-haskell-constructor">Eq</span><span class="org-haskell-operator">,</span> <span class="org-haskell-constructor">Show</span>)

<span class="org-haskell-definition">describeErrorCode</span> <span class="org-haskell-constructor">ParserError</span>  <span class="org-haskell-operator">=</span> <span class="org-string">"The parser failed."</span> 
<span class="org-haskell-definition">describeErrorCode</span> <span class="org-haskell-constructor">InvalidInput</span> <span class="org-haskell-operator">=</span> <span class="org-string">"Input out function domain."</span>

<span class="org-haskell-definition">describeError</span> (<span class="org-haskell-constructor">Right</span> x)    <span class="org-haskell-operator">=</span> <span class="org-haskell-constructor">Right</span> x 
<span class="org-haskell-definition">describeError</span> (<span class="org-haskell-constructor">Left</span>  code) <span class="org-haskell-operator">=</span> <span class="org-haskell-constructor">Left</span> (describeErrorCode code)

<span class="org-function-name">parseDouble</span> <span class="org-haskell-operator">::</span> <span class="org-haskell-constructor">String</span> <span class="org-haskell-operator">-&gt;</span> <span class="org-haskell-constructor">Either</span> <span class="org-haskell-constructor">String</span> <span class="org-haskell-constructor">Double</span> 
<span class="org-haskell-definition">parseDouble</span>  str <span class="org-haskell-operator">=</span> 
    <span class="org-haskell-keyword">case</span> (readMaybe str <span class="org-haskell-operator">::</span> <span class="org-haskell-constructor">Maybe</span> <span class="org-haskell-constructor">Double</span>) <span class="org-haskell-keyword">of</span>
    <span class="org-haskell-constructor">Just</span> x  <span class="org-haskell-operator">-&gt;</span>  <span class="org-haskell-constructor">Right</span> x 
    <span class="org-haskell-constructor">Nothing</span> <span class="org-haskell-operator">-&gt;</span>  <span class="org-haskell-constructor">Left</span>  <span class="org-string">"Error: Not a Double"</span> 

<span class="org-function-name">sqrt_safe</span> <span class="org-haskell-operator">::</span> <span class="org-haskell-constructor">Double</span> <span class="org-haskell-operator">-&gt;</span> <span class="org-haskell-constructor">Either</span> <span class="org-haskell-constructor">String</span> <span class="org-haskell-constructor">Double</span> 
<span class="org-haskell-definition">sqrt_safe</span> x <span class="org-haskell-operator">=</span> 
    <span class="org-haskell-keyword">if</span> x <span class="org-haskell-operator">&gt;=</span> 0 
    <span class="org-haskell-keyword">then</span> (<span class="org-haskell-constructor">Right</span> x)
    <span class="org-haskell-keyword">else</span> (<span class="org-haskell-constructor">Left</span> <span class="org-string">"Error: Square root of negative number"</span>)


<span class="org-function-name">parseDouble2</span> <span class="org-haskell-operator">::</span> <span class="org-haskell-constructor">String</span> <span class="org-haskell-operator">-&gt;</span> <span class="org-haskell-constructor">Either</span> <span class="org-haskell-constructor">ErrorCode</span> <span class="org-haskell-constructor">Double</span> 
<span class="org-haskell-definition">parseDouble2</span>  str <span class="org-haskell-operator">=</span> 
    <span class="org-haskell-keyword">case</span> (readMaybe str <span class="org-haskell-operator">::</span> <span class="org-haskell-constructor">Maybe</span> <span class="org-haskell-constructor">Double</span>) <span class="org-haskell-keyword">of</span>
    <span class="org-haskell-constructor">Just</span> x  <span class="org-haskell-operator">-&gt;</span>  <span class="org-haskell-constructor">Right</span> x 
    <span class="org-haskell-constructor">Nothing</span> <span class="org-haskell-operator">-&gt;</span>  <span class="org-haskell-constructor">Left</span>  <span class="org-haskell-constructor">ParserError</span>

<span class="org-function-name">sqrt_safe2</span> <span class="org-haskell-operator">::</span> <span class="org-haskell-constructor">Double</span> <span class="org-haskell-operator">-&gt;</span> <span class="org-haskell-constructor">Either</span> <span class="org-haskell-constructor">ErrorCode</span> <span class="org-haskell-constructor">Double</span> 
<span class="org-haskell-definition">sqrt_safe2</span> x <span class="org-haskell-operator">=</span> 
    <span class="org-haskell-keyword">if</span> x <span class="org-haskell-operator">&gt;=</span> 0 
    <span class="org-haskell-keyword">then</span> (<span class="org-haskell-constructor">Right</span> x)
    <span class="org-haskell-keyword">else</span> (<span class="org-haskell-constructor">Left</span> <span class="org-haskell-constructor">InvalidInput</span>)

<span class="org-comment-delimiter">--</span><span class="org-comment">-------------------------------------</span>
<span class="org-comment-delimiter">--             </span><span class="org-comment">End of file            -</span>
<span class="org-comment-delimiter">--</span><span class="org-comment">-------------------------------------</span>

<span class="org-haskell-operator">&gt;</span> <span class="org-haskell-constructor">:</span>load <span class="org-haskell-operator">/</span>tmp<span class="org-haskell-operator">/</span>either_functor<span class="org-haskell-operator">.</span>hs  

<span class="org-haskell-operator">&gt;</span> <span class="org-haskell-definition">sqrt_safe</span> 100
<span class="org-haskell-constructor">Right</span> 100.0
<span class="org-haskell-operator">&gt;</span> 
<span class="org-haskell-operator">&gt;</span> <span class="org-haskell-definition">sqrt_safe</span> (<span class="org-haskell-operator">-</span>100)
<span class="org-haskell-constructor">Left</span> <span class="org-string">"Error: Square root of negative number"</span>
<span class="org-haskell-operator">&gt;</span> 

<span class="org-haskell-operator">&gt;</span> <span class="org-haskell-definition">sqrt_safe2</span> 100
<span class="org-haskell-constructor">Right</span> 100.0
<span class="org-haskell-operator">&gt;</span> 
<span class="org-haskell-operator">&gt;</span> <span class="org-haskell-definition">sqrt_safe2</span> (<span class="org-haskell-operator">-</span>100)
<span class="org-haskell-constructor">Left</span> <span class="org-haskell-constructor">InvalidInput</span>
<span class="org-haskell-operator">&gt;</span> 


<span class="org-haskell-operator">&gt;</span> <span class="org-haskell-definition">parseDouble</span> <span class="org-string">"100.25e3"</span>
<span class="org-haskell-constructor">Right</span> 100250.0
<span class="org-haskell-operator">&gt;</span> 

<span class="org-haskell-operator">&gt;</span> <span class="org-haskell-definition">parseDouble</span> <span class="org-string">"not a double"</span>
<span class="org-haskell-constructor">Left</span> <span class="org-string">"Error: Not a Double"</span>
<span class="org-haskell-operator">&gt;</span> 

<span class="org-haskell-operator">&gt;</span> <span class="org-haskell-definition">parseDouble2</span> <span class="org-string">"-200.3"</span>
<span class="org-haskell-constructor">Right</span> (<span class="org-haskell-operator">-</span>200.3)
<span class="org-haskell-operator">&gt;</span> 

<span class="org-haskell-operator">&gt;</span> <span class="org-haskell-definition">parseDouble2</span> <span class="org-string">"Not a double"</span>
<span class="org-haskell-constructor">Left</span> <span class="org-haskell-constructor">ParserError</span>
<span class="org-haskell-operator">&gt;</span> 

<span class="org-haskell-operator">&gt;</span> <span class="org-haskell-definition">fmap</span> sqrt (<span class="org-haskell-constructor">Right</span> 100.0)
<span class="org-haskell-constructor">Right</span> 10.0
<span class="org-haskell-operator">&gt;</span> 
<span class="org-haskell-operator">&gt;</span> <span class="org-haskell-definition">fmap</span> sqrt (<span class="org-haskell-constructor">Left</span> <span class="org-string">"Error not found"</span>)
<span class="org-haskell-constructor">Left</span> <span class="org-string">"Error not found"</span>
<span class="org-haskell-operator">&gt;</span>

<span class="org-haskell-operator">&gt;</span> <span class="org-haskell-keyword">let</span> fmap_sqrt <span class="org-haskell-operator">=</span> fmap sqrt <span class="org-haskell-operator">::</span> <span class="org-haskell-constructor">Either</span> <span class="org-haskell-constructor">String</span> <span class="org-haskell-constructor">Double</span> <span class="org-haskell-operator">-&gt;</span> <span class="org-haskell-constructor">Either</span> <span class="org-haskell-constructor">String</span> <span class="org-haskell-constructor">Double</span>
<span class="org-haskell-operator">&gt;</span> <span class="org-haskell-definition">fmap_sqrt</span> (parseDouble <span class="org-string">"400.0"</span>)
<span class="org-haskell-constructor">Right</span> 20.0
<span class="org-haskell-operator">&gt;</span> 
<span class="org-haskell-operator">&gt;</span> <span class="org-haskell-definition">fmap_sqrt</span> (parseDouble <span class="org-string">"4adsfdas00.0"</span>)
<span class="org-haskell-constructor">Left</span> <span class="org-string">"Error: Not a Double"</span>
<span class="org-haskell-operator">&gt;</span> 


<span class="org-haskell-operator">&gt;</span> <span class="org-haskell-definition">describeError</span> (sqrt_safe2 100)
<span class="org-haskell-constructor">Right</span> 100.0
<span class="org-haskell-operator">&gt;</span> 
<span class="org-haskell-operator">&gt;</span> <span class="org-haskell-definition">describeError</span> (sqrt_safe2 (<span class="org-haskell-operator">-</span>100))
<span class="org-haskell-constructor">Left</span> <span class="org-string">"Input out function domain."</span>
<span class="org-haskell-operator">&gt;</span> 

<span class="org-haskell-operator">&gt;</span> <span class="org-haskell-definition">describeError</span> (parseDouble2 <span class="org-string">"200.23"</span>)
<span class="org-haskell-constructor">Right</span> 200.23
<span class="org-haskell-operator">&gt;</span> 

<span class="org-haskell-operator">&gt;</span> <span class="org-haskell-definition">describeError</span> (parseDouble2 <span class="org-string">"2dsfsd00.23"</span>)
<span class="org-haskell-constructor">Left</span> <span class="org-string">"The parser failed."</span>
<span class="org-haskell-operator">&gt;</span>

<span class="org-haskell-operator">&gt;</span> <span class="org-haskell-definition">fmap_either</span> (<span class="org-haskell-operator">\</span>x <span class="org-haskell-operator">-&gt;</span> x <span class="org-haskell-operator">+</span> 10) (<span class="org-haskell-constructor">Right</span> 200)
<span class="org-haskell-constructor">Right</span> 210
<span class="org-haskell-operator">&gt;</span> 

<span class="org-haskell-operator">&gt;</span> <span class="org-haskell-keyword">let</span> sqrt_either <span class="org-haskell-operator">=</span> fmap_either sqrt
<span class="org-haskell-operator">&gt;</span>
<span class="org-haskell-operator">&gt;</span> <span class="org-haskell-constructor">:</span>t sqrt_either 
<span class="org-function-name">sqrt_either</span> <span class="org-haskell-operator">::</span> <span class="org-haskell-constructor">Either</span> s <span class="org-haskell-constructor">Double</span> <span class="org-haskell-operator">-&gt;</span> <span class="org-haskell-constructor">Either</span> s <span class="org-haskell-constructor">Double</span>
<span class="org-haskell-operator">&gt;</span>

<span class="org-haskell-operator">&gt;</span> <span class="org-haskell-definition">sqrt_either</span> (<span class="org-haskell-constructor">Right</span> 100.0)
<span class="org-haskell-constructor">Right</span> 10.0
<span class="org-haskell-operator">&gt;</span> 
<span class="org-haskell-operator">&gt;</span> <span class="org-haskell-definition">sqrt_either</span> (<span class="org-haskell-constructor">Left</span> <span class="org-string">"Failed to fetch data"</span>)
<span class="org-haskell-constructor">Left</span> <span class="org-string">"Failed to fetch data"</span>
<span class="org-haskell-operator">&gt;</span>
</pre>
</div>
</div>
</div>

<div id="outline-container-sec-1-13-3-5" class="outline-5">
<h5 id="sec-1-13-3-5"><span class="section-number-5">1.13.3.5</span> IO</h5>
<div class="outline-text-5" id="text-1-13-3-5">
<p>
Source: Book <a href="http://learnyouahaskell.com/functors-applicative-functors-and-monoids">learnyouahaskell</a> 
</p>

<div class="org-src-container">

<pre class="src src-haskell"><span class="org-haskell-keyword">instance</span> <span class="org-haskell-constructor">Functor</span> <span class="org-haskell-constructor">IO</span> <span class="org-haskell-keyword">where</span>  
    fmap f action <span class="org-haskell-operator">=</span> <span class="org-haskell-keyword">do</span>  
        result <span class="org-haskell-operator">&lt;-</span> action  
        return (f result)
</pre>
</div>

<div class="org-src-container">

<pre class="src src-haskell"><span class="org-comment-delimiter">-- </span><span class="org-comment">File: fmap_io.hs </span>
<span class="org-comment-delimiter">--</span>

<span class="org-function-name">fmap_io</span> <span class="org-haskell-operator">::</span> (a <span class="org-haskell-operator">-&gt;</span> b) <span class="org-haskell-operator">-&gt;</span> (<span class="org-haskell-constructor">IO</span> a <span class="org-haskell-operator">-&gt;</span> <span class="org-haskell-constructor">IO</span> b)
<span class="org-haskell-definition">fmap_io</span> f <span class="org-haskell-operator">=</span> fmap f 

<span class="org-comment-delimiter">--</span>
<span class="org-comment-delimiter">--</span><span class="org-comment">----------------</span>

<span class="org-haskell-operator">&gt;</span> <span class="org-haskell-constructor">:</span>load <span class="org-haskell-operator">/</span>tmp<span class="org-haskell-operator">/</span>fmap_io<span class="org-haskell-operator">.</span>hs 

<span class="org-haskell-operator">&gt;</span> <span class="org-haskell-keyword">import</span> <span class="org-haskell-constructor">System.Directory</span> (getDirectoryContents)
<span class="org-haskell-operator">&gt;</span> 

<span class="org-haskell-operator">&gt;</span> <span class="org-haskell-constructor">:</span>t getDirectoryContents <span class="org-string">"/etc/R"</span>
<span class="org-haskell-definition">getDirectoryContents</span> <span class="org-string">"/etc/R"</span> <span class="org-haskell-operator">::</span> <span class="org-haskell-constructor">IO</span> [<span class="org-haskell-constructor">FilePath</span>]
<span class="org-haskell-operator">&gt;</span> 

<span class="org-haskell-operator">&gt;</span> <span class="org-haskell-definition">getDirectoryContents</span> <span class="org-string">"/etc/R"</span>
[<span class="org-string">"Renviron"</span><span class="org-haskell-operator">,</span><span class="org-string">"."</span><span class="org-haskell-operator">,</span><span class="org-string">"ldpaths"</span><span class="org-haskell-operator">,</span><span class="org-string">".."</span><span class="org-haskell-operator">,</span><span class="org-string">"repositories"</span><span class="org-haskell-operator">,</span><span class="org-string">"Makeconf"</span><span class="org-haskell-operator">,</span><span class="org-string">"Renviron.site"</span><span class="org-haskell-operator">,</span><span class="org-string">"Rprofile.site"</span>]
<span class="org-haskell-operator">&gt;</span> 

 <span class="org-comment-delimiter">-- </span><span class="org-comment">It will fail because the data is inside an IO container </span>
 <span class="org-comment-delimiter">-- </span><span class="org-comment">and can only be extracted inside another IO container </span>
 <span class="org-comment-delimiter">-- </span><span class="org-comment">or IO Monad. </span>
 <span class="org-comment-delimiter">-- </span>
<span class="org-haskell-operator">&gt;</span> <span class="org-haskell-definition">length</span> (getDirectoryContents <span class="org-string">"/etc/R"</span>)

<span class="org-haskell-operator">&lt;</span>interactive<span class="org-haskell-operator">&gt;:</span>165<span class="org-haskell-constructor">:</span>9<span class="org-haskell-constructor">:</span>
    <span class="org-haskell-constructor">Couldn't</span> match expected <span class="org-haskell-keyword">type</span> `[a0]'
                with actual <span class="org-haskell-keyword">type</span> `<span class="org-haskell-constructor">IO</span> [<span class="org-haskell-constructor">FilePath</span>]'
    <span class="org-haskell-constructor">In</span> the return <span class="org-haskell-keyword">type</span> <span class="org-haskell-keyword">of</span> a call <span class="org-haskell-keyword">of</span> `getDirectoryContents'
    <span class="org-haskell-constructor">In</span> the first argument <span class="org-haskell-keyword">of</span> `length'<span class="org-haskell-operator">,</span> namely
      `(getDirectoryContents <span class="org-string">"/etc/R"</span>)'
    <span class="org-haskell-constructor">In</span> the expression<span class="org-haskell-constructor">:</span> length (getDirectoryContents <span class="org-string">"/etc/R"</span>)


<span class="org-haskell-operator">&gt;</span> <span class="org-haskell-definition">fmap</span> length (getDirectoryContents <span class="org-string">"/etc/R"</span>)
8
<span class="org-haskell-operator">&gt;</span> <span class="org-haskell-constructor">:</span>t fmap length (getDirectoryContents <span class="org-string">"/etc/R"</span>)
<span class="org-haskell-definition">fmap</span> length (getDirectoryContents <span class="org-string">"/etc/R"</span>) <span class="org-haskell-operator">::</span> <span class="org-haskell-constructor">IO</span> <span class="org-haskell-constructor">Int</span>
<span class="org-haskell-operator">&gt;</span> 


<span class="org-haskell-operator">&gt;</span> <span class="org-haskell-definition">fmap_io</span> length (getDirectoryContents <span class="org-string">"/etc/R"</span>)
8
<span class="org-haskell-operator">&gt;</span> 

<span class="org-haskell-operator">&gt;</span> <span class="org-haskell-constructor">:</span>t length
<span class="org-function-name">length</span> <span class="org-haskell-operator">::</span> [a] <span class="org-haskell-operator">-&gt;</span> <span class="org-haskell-constructor">Int</span>
<span class="org-haskell-operator">&gt;</span> 

<span class="org-haskell-operator">&gt;</span> <span class="org-haskell-keyword">let</span> length_io <span class="org-haskell-operator">=</span> fmap_io length
<span class="org-haskell-operator">&gt;</span> 

<span class="org-haskell-operator">&gt;</span> <span class="org-haskell-constructor">:</span>t length_io 
<span class="org-function-name">length_io</span> <span class="org-haskell-operator">::</span> <span class="org-haskell-constructor">IO</span> [a] <span class="org-haskell-operator">-&gt;</span> <span class="org-haskell-constructor">IO</span> <span class="org-haskell-constructor">Int</span>
<span class="org-haskell-operator">&gt;</span>

<span class="org-haskell-operator">&gt;</span> <span class="org-haskell-definition">fmap_io</span> length (getDirectoryContents <span class="org-string">"/etc/R"</span>)
8


<span class="org-comment-delimiter">-- </span><span class="org-comment">In the REPL is possible to extract the data wrapped inside an IO </span>
<span class="org-comment-delimiter">-- </span><span class="org-comment">type constructor.</span>
<span class="org-comment-delimiter">--</span>

<span class="org-haskell-operator">&gt;</span> dirlist <span class="org-haskell-operator">&lt;-</span> getDirectoryContents <span class="org-string">"/etc/R"</span>
<span class="org-haskell-operator">&gt;</span> <span class="org-haskell-constructor">:</span>t dirlist
<span class="org-function-name">dirlist</span> <span class="org-haskell-operator">::</span> [<span class="org-haskell-constructor">FilePath</span>]
<span class="org-haskell-operator">&gt;</span> 
<span class="org-haskell-operator">&gt;</span> dirlist
[<span class="org-string">"Renviron"</span><span class="org-haskell-operator">,</span><span class="org-string">"."</span><span class="org-haskell-operator">,</span><span class="org-string">"ldpaths"</span><span class="org-haskell-operator">,</span><span class="org-string">".."</span><span class="org-haskell-operator">,</span><span class="org-string">"repositories"</span><span class="org-haskell-operator">,</span><span class="org-string">"Makeconf"</span><span class="org-haskell-operator">,</span><span class="org-string">"Renviron.site"</span><span class="org-haskell-operator">,</span><span class="org-string">"Rprofile.site"</span>]
<span class="org-haskell-operator">&gt;</span> 
<span class="org-haskell-operator">&gt;</span> <span class="org-haskell-definition">length</span> dirlist
8
<span class="org-haskell-operator">&gt;</span>

<span class="org-haskell-operator">&gt;</span> <span class="org-haskell-constructor">:</span>t length dirlist
<span class="org-haskell-definition">length</span> dirlist <span class="org-haskell-operator">::</span> <span class="org-haskell-constructor">Int</span>
<span class="org-haskell-operator">&gt;</span>
</pre>
</div>
</div>
</div>
</div>
</div>

<div id="outline-container-sec-1-14" class="outline-3">
<h3 id="sec-1-14"><span class="section-number-3">1.14</span> Monads</h3>
<div class="outline-text-3" id="text-1-14">
</div><div id="outline-container-sec-1-14-1" class="outline-4">
<h4 id="sec-1-14-1"><span class="section-number-4">1.14.1</span> Overview</h4>
<div class="outline-text-4" id="text-1-14-1">
<p>
A monad is a concept from <span class="underline">Category Theory</span>, which is defined by three
things:
</p>

<ul class="org-ul">
<li>a type constructor m that wraps a, parameter a;
</li>

<li>a return (unit) function: takes a value from a plain type and puts it
into a monadic container using the constructor, creating a monadic
value. The return operator must not be confused with the "return"
from a function in a imperative language. This operator is also
known as unit, lift, pure and point. It is a polymorphic
constructor.
</li>

<li>a bind operator (&gt;&gt;=). It takes as its arguments a monadic value
and a function from a plain type to a monadic value, and returns a
new monadic value.
</li>
</ul>

<p>
In Haskell the type class Monad specifies the type signature of all
its instances. Each Monad implementation must have the type signature
that matches the Monad type class. 
</p>


<div class="org-src-container">

<pre class="src src-haskell"><span class="org-haskell-keyword">class</span> <span class="org-haskell-constructor">Monad</span> m <span class="org-haskell-keyword">where</span>

    <span class="org-comment-delimiter">-- </span><span class="org-comment">Constructor (aka unit or lift)</span>
    <span class="org-comment-delimiter">-- </span>
    return <span class="org-haskell-operator">::</span> a <span class="org-haskell-operator">-&gt;</span> m a      

    <span class="org-comment-delimiter">-- </span><span class="org-comment">Bind operator</span>
    <span class="org-comment-delimiter">--</span>
    (<span class="org-haskell-operator">&gt;&gt;=</span>)  <span class="org-haskell-operator">::</span> m a <span class="org-haskell-operator">-&gt;</span> (a <span class="org-haskell-operator">-&gt;</span> m b) <span class="org-haskell-operator">-&gt;</span> m b   

    (<span class="org-haskell-operator">&gt;&gt;</span>)   <span class="org-haskell-operator">::</span> m a <span class="org-haskell-operator">-&gt;</span> m b <span class="org-haskell-operator">-&gt;</span> m b

    fail   <span class="org-haskell-operator">::</span> <span class="org-haskell-constructor">String</span> <span class="org-haskell-operator">-&gt;</span> m a
</pre>
</div>
</div>
</div>

<div id="outline-container-sec-1-14-2" class="outline-4">
<h4 id="sec-1-14-2"><span class="section-number-4">1.14.2</span> Identity Monad</h4>
<div class="outline-text-4" id="text-1-14-2">
<p>
The identity monad is the simplest monad. 
</p>

<div class="org-src-container">

<pre class="src src-haskell"><span class="org-haskell-keyword">newtype</span> <span class="org-haskell-constructor">Identity</span> a <span class="org-haskell-operator">=</span> <span class="org-haskell-constructor">Identity</span> { runIdentity <span class="org-haskell-operator">::</span> a }
    <span class="org-haskell-keyword">deriving</span> (<span class="org-haskell-constructor">Eq</span><span class="org-haskell-operator">,</span> <span class="org-haskell-constructor">Ord</span><span class="org-haskell-operator">,</span> <span class="org-haskell-constructor">Data</span><span class="org-haskell-operator">,</span> <span class="org-haskell-constructor">Traversable</span><span class="org-haskell-operator">,</span> <span class="org-haskell-constructor">Generic</span><span class="org-haskell-operator">,</span> <span class="org-haskell-constructor">Generic1</span>)


<span class="org-haskell-keyword">instance</span> <span class="org-haskell-constructor">Monad</span> <span class="org-haskell-constructor">Identity</span> <span class="org-haskell-keyword">where</span>
    return   <span class="org-haskell-operator">=</span> <span class="org-haskell-constructor">Identity</span>
    m <span class="org-haskell-operator">&gt;&gt;=</span> k  <span class="org-haskell-operator">=</span> k (runIdentity m)

<span class="org-haskell-keyword">instance</span> <span class="org-haskell-constructor">Functor</span> <span class="org-haskell-constructor">Identity</span> <span class="org-haskell-keyword">where</span>
    fmap     <span class="org-haskell-operator">=</span> coerce

<span class="org-haskell-keyword">instance</span> <span class="org-haskell-constructor">Applicative</span> <span class="org-haskell-constructor">Identity</span> <span class="org-haskell-keyword">where</span>
    pure     <span class="org-haskell-operator">=</span> <span class="org-haskell-constructor">Identity</span>
    (<span class="org-haskell-operator">&lt;*&gt;</span>)    <span class="org-haskell-operator">=</span> coerce
</pre>
</div>

<p>
Example: 
</p>

<div class="org-src-container">

<pre class="src src-haskell"><span class="org-haskell-operator">&gt;&gt;&gt;</span> <span class="org-haskell-constructor">:</span>info <span class="org-haskell-constructor">Identity</span>
<span class="org-haskell-keyword">newtype</span> <span class="org-haskell-constructor">Identity</span> a <span class="org-haskell-operator">=</span> <span class="org-haskell-constructor">Identity</span> {runIdentity <span class="org-haskell-operator">::</span> a}
        <span class="org-comment-delimiter">-- </span><span class="org-comment">Defined in &#8216;Data.Functor.Identity&#8217;</span>
<span class="org-haskell-keyword">instance</span> <span class="org-haskell-constructor">Eq</span> a <span class="org-haskell-operator">=&gt;</span> <span class="org-haskell-constructor">Eq</span> (<span class="org-haskell-constructor">Identity</span> a)
  <span class="org-comment-delimiter">-- </span><span class="org-comment">Defined in &#8216;Data.Functor.Identity&#8217;</span>
<span class="org-haskell-keyword">instance</span> <span class="org-haskell-constructor">Monad</span> <span class="org-haskell-constructor">Identity</span> <span class="org-comment-delimiter">-- </span><span class="org-comment">Defined in &#8216;Data.Functor.Identity&#8217;</span>
<span class="org-haskell-keyword">instance</span> <span class="org-haskell-constructor">Functor</span> <span class="org-haskell-constructor">Identity</span> <span class="org-comment-delimiter">-- </span><span class="org-comment">Defined in &#8216;Data.Functor.Identity&#8217;</span>
<span class="org-haskell-keyword">instance</span> <span class="org-haskell-constructor">Ord</span> a <span class="org-haskell-operator">=&gt;</span> <span class="org-haskell-constructor">Ord</span> (<span class="org-haskell-constructor">Identity</span> a)
  <span class="org-comment-delimiter">-- </span><span class="org-comment">Defined in &#8216;Data.Functor.Identity&#8217;</span>
<span class="org-haskell-keyword">instance</span> <span class="org-haskell-constructor">Read</span> a <span class="org-haskell-operator">=&gt;</span> <span class="org-haskell-constructor">Read</span> (<span class="org-haskell-constructor">Identity</span> a)
  <span class="org-comment-delimiter">-- </span><span class="org-comment">Defined in &#8216;Data.Functor.Identity&#8217;</span>
<span class="org-haskell-keyword">instance</span> <span class="org-haskell-constructor">Show</span> a <span class="org-haskell-operator">=&gt;</span> <span class="org-haskell-constructor">Show</span> (<span class="org-haskell-constructor">Identity</span> a)
  <span class="org-comment-delimiter">-- </span><span class="org-comment">Defined in &#8216;Data.Functor.Identity&#8217;</span>
<span class="org-haskell-keyword">instance</span> <span class="org-haskell-constructor">MonadFix</span> <span class="org-haskell-constructor">Identity</span> <span class="org-comment-delimiter">-- </span><span class="org-comment">Defined in &#8216;Data.Functor.Identity&#8217;</span>
<span class="org-haskell-keyword">instance</span> <span class="org-haskell-constructor">Applicative</span> <span class="org-haskell-constructor">Identity</span> <span class="org-comment-delimiter">-- </span><span class="org-comment">Defined in &#8216;Data.Functor.Identity&#8217;</span>
<span class="org-haskell-keyword">instance</span> <span class="org-haskell-constructor">Foldable</span> <span class="org-haskell-constructor">Identity</span> <span class="org-comment-delimiter">-- </span><span class="org-comment">Defined in &#8216;Data.Functor.Identity&#8217;</span>
<span class="org-haskell-keyword">instance</span> <span class="org-haskell-constructor">Traversable</span> <span class="org-haskell-constructor">Identity</span> <span class="org-comment-delimiter">-- </span><span class="org-comment">Defined in &#8216;Data.Functor.Identity&#8217;</span>
<span class="org-haskell-operator">&gt;&gt;&gt;</span> 

<span class="org-haskell-operator">&gt;&gt;&gt;</span> <span class="org-haskell-constructor">:</span>t <span class="org-haskell-constructor">Identity</span>
<span class="org-function-name">Identity</span> <span class="org-haskell-operator">::</span> a <span class="org-haskell-operator">-&gt;</span> <span class="org-haskell-constructor">Identity</span> a
<span class="org-haskell-operator">&gt;&gt;&gt;</span> 

<span class="org-haskell-operator">&gt;&gt;&gt;</span> <span class="org-haskell-constructor">Identity</span> 10
<span class="org-haskell-constructor">Identity</span> 10
<span class="org-haskell-operator">&gt;&gt;&gt;</span> <span class="org-haskell-constructor">:</span>t <span class="org-haskell-constructor">Identity</span> 10
<span class="org-haskell-constructor">Identity</span> 10 <span class="org-haskell-operator">::</span> <span class="org-haskell-constructor">Num</span> a <span class="org-haskell-operator">=&gt;</span> <span class="org-haskell-constructor">Identity</span> a
<span class="org-haskell-operator">&gt;&gt;&gt;</span> 

<span class="org-haskell-operator">&gt;&gt;&gt;</span> <span class="org-haskell-constructor">:</span>t runIdentity 
<span class="org-function-name">runIdentity</span> <span class="org-haskell-operator">::</span> <span class="org-haskell-constructor">Identity</span> a <span class="org-haskell-operator">-&gt;</span> a
<span class="org-haskell-operator">&gt;&gt;&gt;</span> 

<span class="org-haskell-operator">&gt;&gt;&gt;</span> runIdentity <span class="org-haskell-operator">$</span> <span class="org-haskell-constructor">Identity</span> 10
10
<span class="org-haskell-operator">&gt;&gt;&gt;</span> runIdentity <span class="org-haskell-operator">$</span> <span class="org-haskell-constructor">Identity</span> 20
20
<span class="org-haskell-operator">&gt;&gt;&gt;</span> 


<span class="org-haskell-operator">&gt;&gt;&gt;</span> return 10 <span class="org-haskell-operator">::</span> <span class="org-haskell-constructor">Identity</span> <span class="org-haskell-constructor">Int</span>
<span class="org-haskell-constructor">Identity</span> 10
<span class="org-haskell-operator">&gt;&gt;&gt;</span> 

<span class="org-haskell-operator">&gt;&gt;&gt;</span> runIdentity <span class="org-haskell-operator">$</span> (return 10 <span class="org-haskell-operator">::</span> <span class="org-haskell-constructor">Identity</span> <span class="org-haskell-constructor">Int</span>)
10


<span class="org-haskell-operator">&gt;&gt;&gt;</span> return [1<span class="org-haskell-operator">,</span> 2<span class="org-haskell-operator">,</span> 3<span class="org-haskell-operator">,</span> 4] <span class="org-haskell-operator">::</span> <span class="org-haskell-constructor">Identity</span> [<span class="org-haskell-constructor">Int</span>]
<span class="org-haskell-constructor">Identity</span> [1<span class="org-haskell-operator">,</span>2<span class="org-haskell-operator">,</span>3<span class="org-haskell-operator">,</span>4]
<span class="org-haskell-operator">&gt;&gt;&gt;</span> 

<span class="org-haskell-operator">&gt;&gt;&gt;</span> fmap (<span class="org-haskell-operator">\</span>x <span class="org-haskell-operator">-&gt;</span> x <span class="org-haskell-operator">+</span> 5) <span class="org-haskell-operator">$</span> <span class="org-haskell-constructor">Identity</span> 10
<span class="org-haskell-constructor">Identity</span> 15
<span class="org-haskell-operator">&gt;&gt;&gt;</span> 

<span class="org-haskell-operator">&gt;&gt;&gt;</span> fmap (<span class="org-haskell-operator">\</span>x <span class="org-haskell-operator">-&gt;</span> x <span class="org-haskell-operator">*</span> 4) <span class="org-haskell-operator">$</span> fmap (<span class="org-haskell-operator">\</span>x <span class="org-haskell-operator">-&gt;</span> x <span class="org-haskell-operator">+</span> 5) <span class="org-haskell-operator">$</span> <span class="org-haskell-constructor">Identity</span> 10
<span class="org-haskell-constructor">Identity</span> 60
<span class="org-haskell-operator">&gt;&gt;&gt;</span> 

<span class="org-haskell-operator">&gt;&gt;&gt;</span> fmap  ((<span class="org-haskell-operator">\</span>x <span class="org-haskell-operator">-&gt;</span> x <span class="org-haskell-operator">*</span> 4) <span class="org-haskell-operator">.</span> (<span class="org-haskell-operator">\</span>x <span class="org-haskell-operator">-&gt;</span> x <span class="org-haskell-operator">+</span> 5)) <span class="org-haskell-operator">$</span> <span class="org-haskell-constructor">Identity</span> 10
<span class="org-haskell-constructor">Identity</span> 60
<span class="org-haskell-operator">&gt;&gt;&gt;</span>


<span class="org-haskell-operator">&gt;&gt;&gt;</span> (return 10 <span class="org-haskell-operator">::</span> <span class="org-haskell-constructor">Identity</span> <span class="org-haskell-constructor">Int</span>) <span class="org-haskell-operator">&gt;&gt;=</span> <span class="org-haskell-operator">\</span>x <span class="org-haskell-operator">-&gt;</span> return <span class="org-haskell-operator">$</span> x <span class="org-haskell-operator">*</span> 4 
<span class="org-haskell-constructor">Identity</span> 40
<span class="org-haskell-operator">&gt;&gt;&gt;</span> 

<span class="org-haskell-operator">&gt;&gt;&gt;</span> <span class="org-haskell-constructor">Identity</span> 10 <span class="org-haskell-operator">&gt;&gt;=</span> <span class="org-haskell-operator">\</span>x <span class="org-haskell-operator">-&gt;</span> return (x <span class="org-haskell-operator">*</span> 4)  <span class="org-haskell-operator">&gt;&gt;=</span> <span class="org-haskell-operator">\</span>a <span class="org-haskell-operator">-&gt;</span> return ( a <span class="org-haskell-operator">+</span> 5)
<span class="org-haskell-constructor">Identity</span> 45
<span class="org-haskell-operator">&gt;&gt;&gt;</span> 

<span class="org-function-name">testidentityDO</span> <span class="org-haskell-operator">::</span> <span class="org-haskell-constructor">Identity</span> <span class="org-haskell-constructor">Int</span> <span class="org-haskell-operator">-&gt;</span> <span class="org-haskell-constructor">Identity</span> <span class="org-haskell-constructor">Int</span> <span class="org-haskell-operator">-&gt;</span> <span class="org-haskell-constructor">Identity</span> <span class="org-haskell-constructor">Int</span> 
<span class="org-haskell-definition">testIdentityDO</span> ma mb <span class="org-haskell-operator">=</span> <span class="org-haskell-keyword">do</span>
  a <span class="org-haskell-operator">&lt;-</span> ma
  b <span class="org-haskell-operator">&lt;-</span> mb
  return <span class="org-haskell-operator">$</span> a <span class="org-haskell-operator">*</span> b 


<span class="org-comment-delimiter">{- </span><span class="org-comment">Repl friendly version -}</span>

<span class="org-haskell-constructor">:</span>set <span class="org-haskell-operator">+</span>m

<span class="org-haskell-constructor">:</span>{

<span class="org-haskell-keyword">let</span> testIdentityDO <span class="org-haskell-operator">::</span> <span class="org-haskell-constructor">Identity</span> <span class="org-haskell-constructor">Int</span> <span class="org-haskell-operator">-&gt;</span> <span class="org-haskell-constructor">Identity</span> <span class="org-haskell-constructor">Int</span> <span class="org-haskell-operator">-&gt;</span> <span class="org-haskell-constructor">Identity</span> <span class="org-haskell-constructor">Int</span> 
    testIdentityDO ma mb <span class="org-haskell-operator">=</span> <span class="org-haskell-keyword">do</span>
      a <span class="org-haskell-operator">&lt;-</span> ma
      b <span class="org-haskell-operator">&lt;-</span> mb
      return <span class="org-haskell-operator">$</span> a <span class="org-haskell-operator">*</span> b 
<span class="org-haskell-constructor">:</span>}

<span class="org-haskell-operator">&gt;&gt;&gt;</span> testIdentityDO (<span class="org-haskell-constructor">Identity</span> 10) (<span class="org-haskell-constructor">Identity</span> 20)
<span class="org-haskell-constructor">Identity</span> 200
<span class="org-haskell-operator">&gt;&gt;&gt;</span> testIdentityDO (<span class="org-haskell-constructor">Identity</span> 4) (<span class="org-haskell-constructor">Identity</span> 5)
<span class="org-haskell-constructor">Identity</span> 20
<span class="org-haskell-operator">&gt;&gt;&gt;</span>

<span class="org-comment-delimiter">{- </span><span class="org-comment">It show how fmap can be derived from a monad. -}</span>
<span class="org-haskell-constructor">:</span>{
<span class="org-haskell-keyword">let</span> fmapIdentity <span class="org-haskell-operator">::</span> (a <span class="org-haskell-operator">-&gt;</span> b) <span class="org-haskell-operator">-&gt;</span> <span class="org-haskell-constructor">Identity</span> a <span class="org-haskell-operator">-&gt;</span> <span class="org-haskell-constructor">Identity</span> b
    fmapIdentity fn ma <span class="org-haskell-operator">=</span> <span class="org-haskell-keyword">do</span>
      a <span class="org-haskell-operator">&lt;-</span> ma
      return <span class="org-haskell-operator">$</span> fn a           
<span class="org-haskell-constructor">:</span>}

<span class="org-haskell-operator">&gt;&gt;&gt;</span> <span class="org-haskell-constructor">:</span>t fmapIdentity 
<span class="org-function-name">fmapIdentity</span> <span class="org-haskell-operator">::</span> (a <span class="org-haskell-operator">-&gt;</span> b) <span class="org-haskell-operator">-&gt;</span> <span class="org-haskell-constructor">Identity</span> a <span class="org-haskell-operator">-&gt;</span> <span class="org-haskell-constructor">Identity</span> b
<span class="org-haskell-operator">&gt;&gt;&gt;</span> 

<span class="org-haskell-operator">&gt;&gt;&gt;</span> fmapIdentity (<span class="org-haskell-operator">\</span>x <span class="org-haskell-operator">-&gt;</span> x <span class="org-haskell-operator">+</span> 5) (<span class="org-haskell-constructor">Identity</span> 10)
<span class="org-haskell-constructor">Identity</span> 15
<span class="org-haskell-operator">&gt;&gt;&gt;</span>

<span class="org-haskell-constructor">:</span>{
<span class="org-haskell-keyword">let</span> fmapIdentity2 <span class="org-haskell-operator">::</span> (a <span class="org-haskell-operator">-&gt;</span> b) <span class="org-haskell-operator">-&gt;</span> <span class="org-haskell-constructor">Identity</span> a <span class="org-haskell-operator">-&gt;</span> <span class="org-haskell-constructor">Identity</span> b
    fmapIdentity2 fn ma <span class="org-haskell-operator">=</span>
      ma <span class="org-haskell-operator">&gt;&gt;=</span> <span class="org-haskell-operator">\</span>a <span class="org-haskell-operator">-&gt;</span>
        return <span class="org-haskell-operator">$</span> fn a           
<span class="org-haskell-constructor">:</span>}

<span class="org-haskell-operator">&gt;&gt;&gt;</span> <span class="org-haskell-constructor">:</span>t fmapIdentity2
<span class="org-function-name">fmapIdentity2</span> <span class="org-haskell-operator">::</span> (a <span class="org-haskell-operator">-&gt;</span> b) <span class="org-haskell-operator">-&gt;</span> <span class="org-haskell-constructor">Identity</span> a <span class="org-haskell-operator">-&gt;</span> <span class="org-haskell-constructor">Identity</span> b
<span class="org-haskell-operator">&gt;&gt;&gt;</span>

<span class="org-haskell-operator">&gt;&gt;&gt;</span> fmapIdentity2 (<span class="org-haskell-operator">\</span>x <span class="org-haskell-operator">-&gt;</span> x <span class="org-haskell-operator">+</span> 5) (<span class="org-haskell-constructor">Identity</span> 10)
<span class="org-haskell-constructor">Identity</span> 15
<span class="org-haskell-operator">&gt;&gt;&gt;</span> 

<span class="org-haskell-operator">&gt;&gt;&gt;</span> <span class="org-haskell-keyword">import</span> <span class="org-haskell-constructor">Control.Monad</span> (liftM2<span class="org-haskell-operator">,</span> liftM3<span class="org-haskell-operator">,</span> mapM)
<span class="org-haskell-operator">&gt;&gt;&gt;</span>

<span class="org-haskell-operator">&gt;&gt;&gt;</span> <span class="org-haskell-keyword">import</span> <span class="org-haskell-constructor">Control.Monad</span> (liftM2<span class="org-haskell-operator">,</span> liftM3<span class="org-haskell-operator">,</span> mapM)
<span class="org-haskell-operator">&gt;&gt;&gt;</span> 
<span class="org-haskell-operator">&gt;&gt;&gt;</span> <span class="org-haskell-constructor">:</span>t liftM2
<span class="org-function-name">liftM2</span> <span class="org-haskell-operator">::</span> <span class="org-haskell-constructor">Monad</span> m <span class="org-haskell-operator">=&gt;</span> (a1 <span class="org-haskell-operator">-&gt;</span> a2 <span class="org-haskell-operator">-&gt;</span> r) <span class="org-haskell-operator">-&gt;</span> m a1 <span class="org-haskell-operator">-&gt;</span> m a2 <span class="org-haskell-operator">-&gt;</span> m r
<span class="org-haskell-operator">&gt;&gt;&gt;</span>

<span class="org-haskell-operator">&gt;&gt;&gt;</span> liftM2 (<span class="org-haskell-operator">+</span>)  (<span class="org-haskell-constructor">Identity</span> 10) (<span class="org-haskell-constructor">Identity</span> 30)
<span class="org-haskell-constructor">Identity</span> 40
<span class="org-haskell-operator">&gt;&gt;&gt;</span> 

<span class="org-haskell-operator">&gt;&gt;&gt;</span> <span class="org-haskell-keyword">let</span> addIdentity <span class="org-haskell-operator">=</span> liftM2 (<span class="org-haskell-operator">+</span>)

<span class="org-haskell-operator">&gt;&gt;&gt;</span> addIdentity (<span class="org-haskell-constructor">Identity</span> 10) (<span class="org-haskell-constructor">Identity</span> 20)
<span class="org-haskell-constructor">Identity</span> 30
<span class="org-haskell-operator">&gt;&gt;&gt;</span> 

<span class="org-haskell-operator">&gt;&gt;</span> <span class="org-haskell-constructor">:</span>t liftM3
<span class="org-haskell-definition">liftM3</span>
  <span class="org-haskell-operator">::</span> <span class="org-haskell-constructor">Monad</span> m <span class="org-haskell-operator">=&gt;</span> (a1 <span class="org-haskell-operator">-&gt;</span> a2 <span class="org-haskell-operator">-&gt;</span> a3 <span class="org-haskell-operator">-&gt;</span> r) <span class="org-haskell-operator">-&gt;</span> m a1 <span class="org-haskell-operator">-&gt;</span> m a2 <span class="org-haskell-operator">-&gt;</span> m a3 <span class="org-haskell-operator">-&gt;</span> m r
<span class="org-haskell-operator">&gt;&gt;&gt;</span>

<span class="org-haskell-operator">&gt;&gt;&gt;</span> <span class="org-haskell-keyword">let</span> cubeVolume a b c <span class="org-haskell-operator">=</span> a <span class="org-haskell-operator">*</span> b <span class="org-haskell-operator">*</span> c

<span class="org-haskell-operator">&gt;&gt;&gt;</span> liftM3 cubeVolume  (<span class="org-haskell-constructor">Identity</span> 2) (<span class="org-haskell-constructor">Identity</span> 4) (<span class="org-haskell-constructor">Identity</span> 5)
<span class="org-haskell-constructor">Identity</span> 40
<span class="org-haskell-operator">&gt;&gt;&gt;</span>

<span class="org-haskell-operator">&gt;&gt;&gt;</span> <span class="org-haskell-keyword">let</span> idCubeVolume <span class="org-haskell-operator">=</span> liftM3 cubeVolume

<span class="org-haskell-operator">&gt;&gt;&gt;</span> idCubeVolume (<span class="org-haskell-constructor">Identity</span> 2) (<span class="org-haskell-constructor">Identity</span> 4) (<span class="org-haskell-constructor">Identity</span> 5)
<span class="org-haskell-constructor">Identity</span> 40
<span class="org-haskell-operator">&gt;&gt;&gt;</span> 

<span class="org-haskell-operator">&gt;&gt;&gt;</span> <span class="org-haskell-constructor">:</span>t mapM
<span class="org-function-name">mapM</span> <span class="org-haskell-operator">::</span> (<span class="org-haskell-constructor">Monad</span> m<span class="org-haskell-operator">,</span> <span class="org-haskell-constructor">Traversable</span> t) <span class="org-haskell-operator">=&gt;</span> (a <span class="org-haskell-operator">-&gt;</span> m b) <span class="org-haskell-operator">-&gt;</span> t a <span class="org-haskell-operator">-&gt;</span> m (t b)
<span class="org-haskell-operator">&gt;&gt;&gt;</span>

<span class="org-haskell-operator">&gt;&gt;&gt;</span> mapM (<span class="org-haskell-operator">\</span>x <span class="org-haskell-operator">-&gt;</span> <span class="org-haskell-constructor">Identity</span> <span class="org-haskell-operator">$</span> x <span class="org-haskell-operator">+</span> 4) [1<span class="org-haskell-operator">,</span> 2<span class="org-haskell-operator">,</span> 3<span class="org-haskell-operator">,</span> 4<span class="org-haskell-operator">,</span> 5]
<span class="org-haskell-constructor">Identity</span> [5<span class="org-haskell-operator">,</span>6<span class="org-haskell-operator">,</span>7<span class="org-haskell-operator">,</span>8<span class="org-haskell-operator">,</span>9]
<span class="org-haskell-operator">&gt;&gt;&gt;</span>
</pre>
</div>


<p>
Documentation: 
</p>

<ul class="org-ul">
<li><a href="https://hackage.haskell.org/package/base-4.8.0.0/docs/Data-Functor-Identity.html#t:Identity">Module - Data.Functor.Identity</a>
</li>

<li><a href="https://hackage.haskell.org/package/mtl-2.2.1/docs/Control-Monad-Identity.html">Module - Control.Monad.Identity</a>
</li>
</ul>
</div>
</div>

<div id="outline-container-sec-1-14-3" class="outline-4">
<h4 id="sec-1-14-3"><span class="section-number-4">1.14.3</span> List Monad</h4>
<div class="outline-text-4" id="text-1-14-3">
</div><div id="outline-container-sec-1-14-3-1" class="outline-5">
<h5 id="sec-1-14-3-1"><span class="section-number-5">1.14.3.1</span> List Monad in Haskell</h5>
<div class="outline-text-5" id="text-1-14-3-1">
<p>
The list Monad is used for non-deterministic computations where there
is a unknown number of results. It is useful for constraint solving:
solve a problem by trying all possibilities by brute force. It is
equivalent to List comprehension. 
</p>

<p>
In Haskell it is defined as an instance of Monad type class:
</p>

<div class="org-src-container">

<pre class="src src-haskell"><span class="org-haskell-keyword">instance</span>  <span class="org-haskell-constructor">Monad</span> <span class="org-haskell-constructor">[]</span>  <span class="org-haskell-keyword">where</span>
    m <span class="org-haskell-operator">&gt;&gt;=</span> k          <span class="org-haskell-operator">=</span> concat (map k m)
    return x         <span class="org-haskell-operator">=</span> [x]
    fail s           <span class="org-haskell-operator">=</span> <span class="org-haskell-constructor">[]</span>
</pre>
</div>

<p>
Examples: 
</p>

<ul class="org-ul">
<li>return wraps a value into a list 
</li>
</ul>

<div class="org-src-container">

<pre class="src src-haskell"><span class="org-haskell-operator">&gt;</span> <span class="org-haskell-constructor">:</span>t return
<span class="org-function-name">return</span> <span class="org-haskell-operator">::</span> <span class="org-haskell-constructor">Monad</span> m <span class="org-haskell-operator">=&gt;</span> a <span class="org-haskell-operator">-&gt;</span> m a
<span class="org-haskell-operator">&gt;</span> 
 <span class="org-comment-delimiter">-- </span><span class="org-comment">Wraps a value into a list </span>
 <span class="org-comment-delimiter">-- </span>
<span class="org-haskell-operator">&gt;</span> <span class="org-haskell-definition">return</span> 10 <span class="org-haskell-operator">::</span> [<span class="org-haskell-constructor">Int</span>]
[10]
<span class="org-haskell-operator">&gt;</span>
</pre>
</div>


<p>
Bind operator for list monad: 
</p>

<div class="org-src-container">

<pre class="src src-haskell"><span class="org-haskell-operator">&gt;</span> <span class="org-haskell-constructor">:</span>t (<span class="org-haskell-operator">&gt;&gt;=</span>)
(<span class="org-haskell-definition">&gt;&gt;=</span>) <span class="org-haskell-operator">::</span> <span class="org-haskell-constructor">Monad</span> m <span class="org-haskell-operator">=&gt;</span> m a <span class="org-haskell-operator">-&gt;</span> (a <span class="org-haskell-operator">-&gt;</span> m b) <span class="org-haskell-operator">-&gt;</span> m b
<span class="org-haskell-operator">&gt;</span> 

 

<span class="org-haskell-operator">&gt;</span>  [10<span class="org-haskell-operator">,</span>20<span class="org-haskell-operator">,</span>30] <span class="org-haskell-operator">&gt;&gt;=</span> <span class="org-haskell-operator">\</span>x <span class="org-haskell-operator">-&gt;</span> [2<span class="org-haskell-operator">*</span>x<span class="org-haskell-operator">,</span> x<span class="org-haskell-operator">+</span>5] 
[20<span class="org-haskell-operator">,</span>15<span class="org-haskell-operator">,</span>40<span class="org-haskell-operator">,</span>25<span class="org-haskell-operator">,</span>60<span class="org-haskell-operator">,</span>35]
<span class="org-haskell-operator">&gt;</span> 

<span class="org-comment-delimiter">-- </span><span class="org-comment">It is equivalent to: </span>
<span class="org-comment-delimiter">--</span>
<span class="org-comment-delimiter">--  </span>

<span class="org-haskell-operator">&gt;</span> <span class="org-haskell-definition">map</span> ( <span class="org-haskell-operator">\</span>x <span class="org-haskell-operator">-&gt;</span> [2<span class="org-haskell-operator">*</span>x<span class="org-haskell-operator">,</span> x<span class="org-haskell-operator">+</span>5] ) [10<span class="org-haskell-operator">,</span> 20<span class="org-haskell-operator">,</span> 30]
[[20<span class="org-haskell-operator">,</span>15]<span class="org-haskell-operator">,</span>[40<span class="org-haskell-operator">,</span>25]<span class="org-haskell-operator">,</span>[60<span class="org-haskell-operator">,</span>35]]
<span class="org-haskell-operator">&gt;</span> 
<span class="org-haskell-operator">&gt;</span> <span class="org-haskell-definition">concat</span> (map ( <span class="org-haskell-operator">\</span>x <span class="org-haskell-operator">-&gt;</span> [2<span class="org-haskell-operator">*</span>x<span class="org-haskell-operator">,</span> x<span class="org-haskell-operator">+</span>5] ) [10<span class="org-haskell-operator">,</span> 20<span class="org-haskell-operator">,</span> 30])
[20<span class="org-haskell-operator">,</span>15<span class="org-haskell-operator">,</span>40<span class="org-haskell-operator">,</span>25<span class="org-haskell-operator">,</span>60<span class="org-haskell-operator">,</span>35]
<span class="org-haskell-operator">&gt;</span>
</pre>
</div>

<p>
Do notation:
</p>

<pre class="example">
  The do notation is a syntax sugar to -&gt; 
 
Do Notation:                   Do Notation Dessugarized: 

cartesianProduct  = do         cartesianProduct = 
   x &lt;- [1, 2, 3, 4]             [1, 2, 3, 4] &gt;&gt;= \x -&gt;
   y &lt;- ["a", "b"]               ["a", "b"]   &gt;&gt;= \y -&gt;
   return (x, y)                 return (x, y) 

                               Or 

                               cartesianProduct = 
                                 bind [1 2, 3, 4]  (\x -&gt; 
                                 bind ["a", "b"]   (\y -&gt; 
                                 unit (x, y)))
</pre>


<p>
Do notation examples for List monad: 
</p>

<div class="org-src-container">

<pre class="src src-haskell"><span class="org-comment-delimiter">-- </span><span class="org-comment">file cartesian.hs </span>
<span class="org-comment-delimiter">--</span>
<span class="org-comment-delimiter">-- </span><span class="org-comment">Run in the repl:  </span>
<span class="org-comment-delimiter">--                  </span><span class="org-comment">:load cartesian.hs  </span>
<span class="org-comment-delimiter">--                  </span>

<span class="org-haskell-definition">cartesianProduct</span> <span class="org-haskell-operator">=</span> <span class="org-haskell-keyword">do</span> 
    x <span class="org-haskell-operator">&lt;-</span> [1<span class="org-haskell-operator">,</span> 2<span class="org-haskell-operator">,</span> 3<span class="org-haskell-operator">,</span> 4] 
    y <span class="org-haskell-operator">&lt;-</span> [<span class="org-string">"a"</span><span class="org-haskell-operator">,</span> <span class="org-string">"b"</span>]
    return (x<span class="org-haskell-operator">,</span> y)

<span class="org-comment-delimiter">--  </span><span class="org-comment">End of file: cartesian.hs </span>
<span class="org-comment-delimiter">-- </span><span class="org-comment">-----------------</span>

<span class="org-haskell-operator">&gt;</span> cartesianProduct 
[(1<span class="org-haskell-operator">,</span><span class="org-string">"a"</span>)<span class="org-haskell-operator">,</span>(1<span class="org-haskell-operator">,</span><span class="org-string">"b"</span>)<span class="org-haskell-operator">,</span>(2<span class="org-haskell-operator">,</span><span class="org-string">"a"</span>)<span class="org-haskell-operator">,</span>(2<span class="org-haskell-operator">,</span><span class="org-string">"b"</span>)<span class="org-haskell-operator">,</span>(3<span class="org-haskell-operator">,</span><span class="org-string">"a"</span>)<span class="org-haskell-operator">,</span>(3<span class="org-haskell-operator">,</span><span class="org-string">"b"</span>)<span class="org-haskell-operator">,</span>(4<span class="org-haskell-operator">,</span><span class="org-string">"a"</span>)<span class="org-haskell-operator">,</span>(4<span class="org-haskell-operator">,</span><span class="org-string">"b"</span>)]
<span class="org-haskell-operator">&gt;</span> 

 <span class="org-comment-delimiter">-- </span><span class="org-comment">Or it can be typed in the repl directly:</span>
 <span class="org-comment-delimiter">--</span>

 
<span class="org-haskell-operator">&gt;</span> <span class="org-haskell-constructor">:</span>set <span class="org-haskell-operator">+</span>m  <span class="org-comment-delimiter">-- </span><span class="org-comment">Enable multiline paste </span>
<span class="org-haskell-operator">&gt;</span> 
 
<span class="org-comment-delimiter">--  </span><span class="org-comment">Or copy the following code in the repl </span>
<span class="org-comment-delimiter">--  </span><span class="org-comment">by typing :set +m to enable multiline paste </span>
<span class="org-comment-delimiter">--</span>
<span class="org-haskell-constructor">:</span>{

<span class="org-haskell-keyword">let</span> cartesianProduct <span class="org-haskell-operator">=</span> <span class="org-haskell-keyword">do</span> 
    x <span class="org-haskell-operator">&lt;-</span> [1<span class="org-haskell-operator">,</span> 2<span class="org-haskell-operator">,</span> 3<span class="org-haskell-operator">,</span> 4] 
    y <span class="org-haskell-operator">&lt;-</span> [<span class="org-string">"a"</span><span class="org-haskell-operator">,</span> <span class="org-string">"b"</span>]
    return (x<span class="org-haskell-operator">,</span> y)
<span class="org-haskell-constructor">:</span>}


<span class="org-haskell-operator">&gt;</span> <span class="org-haskell-constructor">:</span>set <span class="org-haskell-operator">+</span>m  <span class="org-comment-delimiter">-- </span><span class="org-comment">paste </span>
<span class="org-haskell-operator">&gt;</span> 
<span class="org-haskell-operator">&gt;</span> <span class="org-haskell-keyword">let</span> cartesianProduct <span class="org-haskell-operator">=</span> <span class="org-haskell-keyword">do</span> 
<span class="org-haskell-operator">*</span><span class="org-haskell-constructor">Main</span> <span class="org-haskell-constructor">Control.Exception</span> <span class="org-haskell-constructor">E</span> <span class="org-haskell-constructor">Text.Read</span><span class="org-haskell-operator">|</span>     x <span class="org-haskell-operator">&lt;-</span> [1<span class="org-haskell-operator">,</span> 2<span class="org-haskell-operator">,</span> 3<span class="org-haskell-operator">,</span> 4] 
<span class="org-haskell-operator">*</span><span class="org-haskell-constructor">Main</span> <span class="org-haskell-constructor">Control.Exception</span> <span class="org-haskell-constructor">E</span> <span class="org-haskell-constructor">Text.Read</span><span class="org-haskell-operator">|</span>     y <span class="org-haskell-operator">&lt;-</span> [<span class="org-string">"a"</span><span class="org-haskell-operator">,</span> <span class="org-string">"b"</span>]
<span class="org-haskell-operator">*</span><span class="org-haskell-constructor">Main</span> <span class="org-haskell-constructor">Control.Exception</span> <span class="org-haskell-constructor">E</span> <span class="org-haskell-constructor">Text.Read</span><span class="org-haskell-operator">|</span>     return (x<span class="org-haskell-operator">,</span> y)
<span class="org-haskell-operator">*</span><span class="org-haskell-constructor">Main</span> <span class="org-haskell-constructor">Control.Exception</span> <span class="org-haskell-constructor">E</span> <span class="org-haskell-constructor">Text.Read</span><span class="org-haskell-operator">|</span> 
<span class="org-haskell-operator">&gt;</span> 

 <span class="org-comment-delimiter">-- </span>
 <span class="org-comment-delimiter">-- </span><span class="org-comment">Or: Dessugarizing </span>

<span class="org-haskell-operator">&gt;</span> [1<span class="org-haskell-operator">,</span> 2<span class="org-haskell-operator">,</span> 3<span class="org-haskell-operator">,</span> 4] <span class="org-haskell-operator">&gt;&gt;=</span> <span class="org-haskell-operator">\</span>x <span class="org-haskell-operator">-&gt;</span> [<span class="org-string">"a"</span><span class="org-haskell-operator">,</span> <span class="org-string">"b"</span>] <span class="org-haskell-operator">&gt;&gt;=</span> <span class="org-haskell-operator">\</span>y <span class="org-haskell-operator">-&gt;</span> return (x<span class="org-haskell-operator">,</span> y)
[(1<span class="org-haskell-operator">,</span><span class="org-string">"a"</span>)<span class="org-haskell-operator">,</span>(1<span class="org-haskell-operator">,</span><span class="org-string">"b"</span>)<span class="org-haskell-operator">,</span>(2<span class="org-haskell-operator">,</span><span class="org-string">"a"</span>)<span class="org-haskell-operator">,</span>(2<span class="org-haskell-operator">,</span><span class="org-string">"b"</span>)<span class="org-haskell-operator">,</span>(3<span class="org-haskell-operator">,</span><span class="org-string">"a"</span>)<span class="org-haskell-operator">,</span>(3<span class="org-haskell-operator">,</span><span class="org-string">"b"</span>)<span class="org-haskell-operator">,</span>(4<span class="org-haskell-operator">,</span><span class="org-string">"a"</span>)<span class="org-haskell-operator">,</span>(4<span class="org-haskell-operator">,</span><span class="org-string">"b"</span>)]
<span class="org-haskell-operator">&gt;</span> 
  
<span class="org-function-name">cartesian</span> <span class="org-haskell-operator">::</span> [a] <span class="org-haskell-operator">-&gt;</span> [b] <span class="org-haskell-operator">-&gt;</span> [(a<span class="org-haskell-operator">,</span> b)]
<span class="org-haskell-definition">cartesian</span> xs ys <span class="org-haskell-operator">=</span> <span class="org-haskell-keyword">do</span>
    x <span class="org-haskell-operator">&lt;-</span> xs 
    y <span class="org-haskell-operator">&lt;-</span> ys 
    return (x<span class="org-haskell-operator">,</span> y)

<span class="org-haskell-operator">&gt;</span> <span class="org-haskell-definition">cartesian</span> [1<span class="org-haskell-operator">,</span> 2<span class="org-haskell-operator">,</span> 3<span class="org-haskell-operator">,</span> 4] [<span class="org-string">"a"</span><span class="org-haskell-operator">,</span> <span class="org-string">"b"</span>]
[(1<span class="org-haskell-operator">,</span><span class="org-string">"a"</span>)<span class="org-haskell-operator">,</span>(1<span class="org-haskell-operator">,</span><span class="org-string">"b"</span>)<span class="org-haskell-operator">,</span>(2<span class="org-haskell-operator">,</span><span class="org-string">"a"</span>)<span class="org-haskell-operator">,</span>(2<span class="org-haskell-operator">,</span><span class="org-string">"b"</span>)<span class="org-haskell-operator">,</span>(3<span class="org-haskell-operator">,</span><span class="org-string">"a"</span>)<span class="org-haskell-operator">,</span>(3<span class="org-haskell-operator">,</span><span class="org-string">"b"</span>)<span class="org-haskell-operator">,</span>(4<span class="org-haskell-operator">,</span><span class="org-string">"a"</span>)<span class="org-haskell-operator">,</span>(4<span class="org-haskell-operator">,</span><span class="org-string">"b"</span>)]
<span class="org-haskell-operator">&gt;</span> 

<span class="org-haskell-operator">&gt;&gt;&gt;</span> <span class="org-haskell-keyword">let</span> cartesian2 xs ys <span class="org-haskell-operator">=</span> [(x<span class="org-haskell-operator">,</span> y) <span class="org-haskell-operator">|</span> x <span class="org-haskell-operator">&lt;-</span> xs<span class="org-haskell-operator">,</span> y <span class="org-haskell-operator">&lt;-</span> ys]

<span class="org-haskell-operator">&gt;&gt;&gt;</span> cartesian2 [1<span class="org-haskell-operator">,</span> 2<span class="org-haskell-operator">,</span> 3<span class="org-haskell-operator">,</span> 4] [<span class="org-string">"a"</span><span class="org-haskell-operator">,</span> <span class="org-string">"b"</span>]
[(1<span class="org-haskell-operator">,</span><span class="org-string">"a"</span>)<span class="org-haskell-operator">,</span>(1<span class="org-haskell-operator">,</span><span class="org-string">"b"</span>)<span class="org-haskell-operator">,</span>(2<span class="org-haskell-operator">,</span><span class="org-string">"a"</span>)<span class="org-haskell-operator">,</span>(2<span class="org-haskell-operator">,</span><span class="org-string">"b"</span>)<span class="org-haskell-operator">,</span>(3<span class="org-haskell-operator">,</span><span class="org-string">"a"</span>)<span class="org-haskell-operator">,</span>(3<span class="org-haskell-operator">,</span><span class="org-string">"b"</span>)<span class="org-haskell-operator">,</span>(4<span class="org-haskell-operator">,</span><span class="org-string">"a"</span>)<span class="org-haskell-operator">,</span>(4<span class="org-haskell-operator">,</span><span class="org-string">"b"</span>)]
<span class="org-haskell-operator">&gt;&gt;&gt;</span> 


<span class="org-comment-delimiter">-- </span><span class="org-comment">Returns all possible combinations between a, b and c</span>
<span class="org-comment-delimiter">--</span>
<span class="org-comment-delimiter">--</span>
<span class="org-function-name">triples</span> <span class="org-haskell-operator">::</span> [a] <span class="org-haskell-operator">-&gt;</span> [b] <span class="org-haskell-operator">-&gt;</span> [c] <span class="org-haskell-operator">-&gt;</span> [(a<span class="org-haskell-operator">,</span> b<span class="org-haskell-operator">,</span> c)]
<span class="org-haskell-definition">triples</span>  xs ys zs <span class="org-haskell-operator">=</span> <span class="org-haskell-keyword">do</span> 
  x <span class="org-haskell-operator">&lt;-</span> xs 
  y <span class="org-haskell-operator">&lt;-</span> ys 
  z <span class="org-haskell-operator">&lt;-</span> zs 
  return (x<span class="org-haskell-operator">,</span> y<span class="org-haskell-operator">,</span> z)


<span class="org-comment-delimiter">--   </span><span class="org-comment">The triples have 24 results </span>
<span class="org-comment-delimiter">--</span>
<span class="org-comment-delimiter">--   </span><span class="org-comment">x -&gt; 2 possibilities</span>
<span class="org-comment-delimiter">--   </span><span class="org-comment">y -&gt; 3 possibilities</span>
<span class="org-comment-delimiter">--   </span><span class="org-comment">z -&gt; 4 possibilities </span>
<span class="org-comment-delimiter">--</span>
<span class="org-comment-delimiter">--  </span><span class="org-comment">Total of possibilities:  2 * 3 * 4 = 24</span>
<span class="org-comment-delimiter">--  </span><span class="org-comment">the computation will return 24 results </span>
<span class="org-comment-delimiter">-- </span>
<span class="org-comment-delimiter">--</span>
<span class="org-haskell-operator">&gt;</span> <span class="org-haskell-definition">triples</span> [1<span class="org-haskell-operator">,</span> 2] [<span class="org-string">"a"</span><span class="org-haskell-operator">,</span> <span class="org-string">"b"</span><span class="org-haskell-operator">,</span> <span class="org-string">"c"</span>] [<span class="org-string">"x"</span><span class="org-haskell-operator">,</span> <span class="org-string">"y"</span><span class="org-haskell-operator">,</span> <span class="org-string">"z"</span><span class="org-haskell-operator">,</span> <span class="org-string">"w"</span>]
[(1<span class="org-haskell-operator">,</span><span class="org-string">"a"</span><span class="org-haskell-operator">,</span><span class="org-string">"x"</span>)<span class="org-haskell-operator">,</span>(1<span class="org-haskell-operator">,</span><span class="org-string">"a"</span><span class="org-haskell-operator">,</span><span class="org-string">"y"</span>)<span class="org-haskell-operator">,</span>(1<span class="org-haskell-operator">,</span><span class="org-string">"a"</span><span class="org-haskell-operator">,</span><span class="org-string">"z"</span>)<span class="org-haskell-operator">,</span>(1<span class="org-haskell-operator">,</span><span class="org-string">"a"</span><span class="org-haskell-operator">,</span><span class="org-string">"w"</span>)<span class="org-haskell-operator">,</span>(1<span class="org-haskell-operator">,</span><span class="org-string">"b"</span><span class="org-haskell-operator">,</span><span class="org-string">"x"</span>)<span class="org-haskell-operator">,</span>
(1<span class="org-haskell-operator">,</span><span class="org-string">"b"</span><span class="org-haskell-operator">,</span><span class="org-string">"y"</span>)<span class="org-haskell-operator">,</span>(1<span class="org-haskell-operator">,</span><span class="org-string">"b"</span><span class="org-haskell-operator">,</span><span class="org-string">"z"</span>)<span class="org-haskell-operator">,</span>(1<span class="org-haskell-operator">,</span><span class="org-string">"b"</span><span class="org-haskell-operator">,</span><span class="org-string">"w"</span>)<span class="org-haskell-operator">,</span>(1<span class="org-haskell-operator">,</span><span class="org-string">"c"</span><span class="org-haskell-operator">,</span><span class="org-string">"x"</span>)<span class="org-haskell-operator">,</span>(1<span class="org-haskell-operator">,</span><span class="org-string">"c"</span><span class="org-haskell-operator">,</span><span class="org-string">"y"</span>)<span class="org-haskell-operator">,</span>
(1<span class="org-haskell-operator">,</span><span class="org-string">"c"</span><span class="org-haskell-operator">,</span><span class="org-string">"z"</span>)<span class="org-haskell-operator">,</span>(1<span class="org-haskell-operator">,</span><span class="org-string">"c"</span><span class="org-haskell-operator">,</span><span class="org-string">"w"</span>)<span class="org-haskell-operator">,</span>(2<span class="org-haskell-operator">,</span><span class="org-string">"a"</span><span class="org-haskell-operator">,</span><span class="org-string">"x"</span>)<span class="org-haskell-operator">,</span>(2<span class="org-haskell-operator">,</span><span class="org-string">"a"</span><span class="org-haskell-operator">,</span><span class="org-string">"y"</span>)<span class="org-haskell-operator">,</span>(2<span class="org-haskell-operator">,</span><span class="org-string">"a"</span><span class="org-haskell-operator">,</span><span class="org-string">"z"</span>)<span class="org-haskell-operator">,</span>
(2<span class="org-haskell-operator">,</span><span class="org-string">"a"</span><span class="org-haskell-operator">,</span><span class="org-string">"w"</span>)<span class="org-haskell-operator">,</span>(2<span class="org-haskell-operator">,</span><span class="org-string">"b"</span><span class="org-haskell-operator">,</span><span class="org-string">"x"</span>)<span class="org-haskell-operator">,</span>(2<span class="org-haskell-operator">,</span><span class="org-string">"b"</span><span class="org-haskell-operator">,</span><span class="org-string">"y"</span>)<span class="org-haskell-operator">,</span>(2<span class="org-haskell-operator">,</span><span class="org-string">"b"</span><span class="org-haskell-operator">,</span><span class="org-string">"z"</span>)<span class="org-haskell-operator">,</span>(2<span class="org-haskell-operator">,</span><span class="org-string">"b"</span><span class="org-haskell-operator">,</span><span class="org-string">"w"</span>)<span class="org-haskell-operator">,</span>
(2<span class="org-haskell-operator">,</span><span class="org-string">"c"</span><span class="org-haskell-operator">,</span><span class="org-string">"x"</span>)<span class="org-haskell-operator">,</span>(2<span class="org-haskell-operator">,</span><span class="org-string">"c"</span><span class="org-haskell-operator">,</span><span class="org-string">"y"</span>)<span class="org-haskell-operator">,</span>(2<span class="org-haskell-operator">,</span><span class="org-string">"c"</span><span class="org-haskell-operator">,</span><span class="org-string">"z"</span>)<span class="org-haskell-operator">,</span>(2<span class="org-haskell-operator">,</span><span class="org-string">"c"</span><span class="org-haskell-operator">,</span><span class="org-string">"w"</span>)]

<span class="org-haskell-operator">&gt;</span> <span class="org-haskell-definition">length</span> ( triples [1<span class="org-haskell-operator">,</span> 2] [<span class="org-string">"a"</span><span class="org-haskell-operator">,</span> <span class="org-string">"b"</span><span class="org-haskell-operator">,</span> <span class="org-string">"c"</span>] [<span class="org-string">"x"</span><span class="org-haskell-operator">,</span> <span class="org-string">"y"</span><span class="org-haskell-operator">,</span> <span class="org-string">"z"</span><span class="org-haskell-operator">,</span> <span class="org-string">"w"</span>] )
24
<span class="org-haskell-operator">&gt;</span> 

<span class="org-haskell-operator">&gt;&gt;&gt;</span> <span class="org-haskell-keyword">let</span> triples2 xs ys zs <span class="org-haskell-operator">=</span> [(x<span class="org-haskell-operator">,</span> y<span class="org-haskell-operator">,</span> z) <span class="org-haskell-operator">|</span> x <span class="org-haskell-operator">&lt;-</span> xs<span class="org-haskell-operator">,</span> y <span class="org-haskell-operator">&lt;-</span> ys<span class="org-haskell-operator">,</span> z <span class="org-haskell-operator">&lt;-</span> zs]
<span class="org-haskell-operator">&gt;&gt;&gt;</span> <span class="org-haskell-constructor">:</span>t triples2 
<span class="org-function-name">triples2</span> <span class="org-haskell-operator">::</span> [t] <span class="org-haskell-operator">-&gt;</span> [t1] <span class="org-haskell-operator">-&gt;</span> [t2] <span class="org-haskell-operator">-&gt;</span> [(t<span class="org-haskell-operator">,</span> t1<span class="org-haskell-operator">,</span> t2)]
<span class="org-haskell-operator">&gt;&gt;&gt;</span> 
<span class="org-haskell-operator">&gt;&gt;&gt;</span> take 3 <span class="org-haskell-operator">$</span> triples2 [1<span class="org-haskell-operator">,</span> 2] [<span class="org-string">"a"</span><span class="org-haskell-operator">,</span> <span class="org-string">"b"</span><span class="org-haskell-operator">,</span> <span class="org-string">"c"</span>] [<span class="org-string">"x"</span><span class="org-haskell-operator">,</span> <span class="org-string">"y"</span><span class="org-haskell-operator">,</span> <span class="org-string">"z"</span><span class="org-haskell-operator">,</span> <span class="org-string">"w"</span>]
[(1<span class="org-haskell-operator">,</span><span class="org-string">"a"</span><span class="org-haskell-operator">,</span><span class="org-string">"x"</span>)<span class="org-haskell-operator">,</span>(1<span class="org-haskell-operator">,</span><span class="org-string">"a"</span><span class="org-haskell-operator">,</span><span class="org-string">"y"</span>)<span class="org-haskell-operator">,</span>(1<span class="org-haskell-operator">,</span><span class="org-string">"a"</span><span class="org-haskell-operator">,</span><span class="org-string">"z"</span>)]
<span class="org-haskell-operator">&gt;&gt;&gt;</span> 

<span class="org-comment-delimiter">--</span>
<span class="org-comment-delimiter">--  </span><span class="org-comment">Find all numbers for which a ^ 2 + b ^ 2 = c ^ 2 </span>
<span class="org-comment-delimiter">--  </span><span class="org-comment">up to 100:</span>
<span class="org-comment-delimiter">--</span>
<span class="org-comment-delimiter">--  </span><span class="org-comment">There is 100 x 100 x 100 = 1,000,000 of combinations </span>
<span class="org-comment-delimiter">--  </span><span class="org-comment">to be tested:</span>
<span class="org-comment-delimiter">--</span>
<span class="org-haskell-definition">pthytriples</span> <span class="org-haskell-operator">=</span> <span class="org-haskell-keyword">do</span> 
    a <span class="org-haskell-operator">&lt;-</span> [1 <span class="org-haskell-operator">..</span> 100]
    b <span class="org-haskell-operator">&lt;-</span> [1 <span class="org-haskell-operator">..</span> 100]
    c <span class="org-haskell-operator">&lt;-</span> [1 <span class="org-haskell-operator">..</span> 100]

    <span class="org-haskell-keyword">if</span> (a <span class="org-haskell-operator">^</span> 2 <span class="org-haskell-operator">+</span> b <span class="org-haskell-operator">^</span> 2 <span class="org-haskell-operator">==</span> c <span class="org-haskell-operator">^</span> 2)
      <span class="org-haskell-keyword">then</span> (return (<span class="org-haskell-constructor">Just</span> (a<span class="org-haskell-operator">,</span> b<span class="org-haskell-operator">,</span> c)))
      <span class="org-haskell-keyword">else</span> (return <span class="org-haskell-constructor">Nothing</span>)

<span class="org-haskell-operator">&gt;</span> <span class="org-haskell-keyword">import</span> <span class="org-haskell-constructor">Data.Maybe</span> (catMaybes)

<span class="org-haskell-operator">&gt;</span> <span class="org-haskell-definition">take</span> 10 (catMaybes pthytriples)
[(3<span class="org-haskell-operator">,</span>4<span class="org-haskell-operator">,</span>5)<span class="org-haskell-operator">,</span>(4<span class="org-haskell-operator">,</span>3<span class="org-haskell-operator">,</span>5)<span class="org-haskell-operator">,</span>(5<span class="org-haskell-operator">,</span>12<span class="org-haskell-operator">,</span>13)<span class="org-haskell-operator">,</span>(6<span class="org-haskell-operator">,</span>8<span class="org-haskell-operator">,</span>10)<span class="org-haskell-operator">,</span>(7<span class="org-haskell-operator">,</span>24<span class="org-haskell-operator">,</span>25)<span class="org-haskell-operator">,</span>(8<span class="org-haskell-operator">,</span>6<span class="org-haskell-operator">,</span>10)<span class="org-haskell-operator">,</span>(8<span class="org-haskell-operator">,</span>15<span class="org-haskell-operator">,</span>17)<span class="org-haskell-operator">,</span>(9<span class="org-haskell-operator">,</span>12<span class="org-haskell-operator">,</span>15)<span class="org-haskell-operator">,</span>(9<span class="org-haskell-operator">,</span>40<span class="org-haskell-operator">,</span>41)<span class="org-haskell-operator">,</span>(10<span class="org-haskell-operator">,</span>24<span class="org-haskell-operator">,</span>26)]
<span class="org-haskell-operator">&gt;</span> 

<span class="org-comment-delimiter">-- </span><span class="org-comment">Example: Find all possible values of a functions applied </span>
<span class="org-comment-delimiter">--          </span><span class="org-comment">to all combinations possible of 3 lists:</span>
<span class="org-comment-delimiter">--</span>
<span class="org-haskell-definition">applyComb3</span> <span class="org-haskell-operator">=</span> <span class="org-haskell-keyword">do</span> 
   x <span class="org-haskell-operator">&lt;-</span> [1<span class="org-haskell-operator">,</span> 2<span class="org-haskell-operator">,</span> 3]
   y <span class="org-haskell-operator">&lt;-</span> [9<span class="org-haskell-operator">,</span> 8]
   z <span class="org-haskell-operator">&lt;-</span> [3<span class="org-haskell-operator">,</span> 8<span class="org-haskell-operator">,</span> 7<span class="org-haskell-operator">,</span> 4]
   return ([x<span class="org-haskell-operator">,</span> y<span class="org-haskell-operator">,</span> z]<span class="org-haskell-operator">,</span> 100 <span class="org-haskell-operator">*</span> x <span class="org-haskell-operator">+</span> 10 <span class="org-haskell-operator">*</span>  y <span class="org-haskell-operator">+</span> z)

<span class="org-haskell-operator">&gt;</span> applyComb3 
[([1<span class="org-haskell-operator">,</span>9<span class="org-haskell-operator">,</span>3]<span class="org-haskell-operator">,</span>193)<span class="org-haskell-operator">,</span>([1<span class="org-haskell-operator">,</span>9<span class="org-haskell-operator">,</span>8]<span class="org-haskell-operator">,</span>198)<span class="org-haskell-operator">,</span>([1<span class="org-haskell-operator">,</span>9<span class="org-haskell-operator">,</span>7]<span class="org-haskell-operator">,</span>197)<span class="org-haskell-operator">,</span>([1<span class="org-haskell-operator">,</span>9<span class="org-haskell-operator">,</span>4]<span class="org-haskell-operator">,</span>194) <span class="org-haskell-operator">...</span>]


<span class="org-comment-delimiter">-- </span><span class="org-comment">Example: Break a 4 letter password using brute force </span>
<span class="org-comment-delimiter">--</span>
<span class="org-comment-delimiter">--</span>


<span class="org-haskell-keyword">import</span> <span class="org-haskell-constructor">Data.List</span> (find)
<span class="org-haskell-keyword">import</span> <span class="org-haskell-constructor">Data.Maybe</span> (isJust)

<span class="org-haskell-definition">alphabet</span> <span class="org-haskell-operator">=</span> <span class="org-string">"abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789"</span>

<span class="org-function-name">make_password</span> <span class="org-haskell-operator">::</span> <span class="org-haskell-constructor">String</span> <span class="org-haskell-operator">-&gt;</span> <span class="org-haskell-constructor">String</span> <span class="org-haskell-operator">-&gt;</span> <span class="org-haskell-constructor">Bool</span> 
<span class="org-haskell-definition">make_password</span> password input <span class="org-haskell-operator">=</span> password <span class="org-haskell-operator">==</span> input 

<span class="org-comment-delimiter">-- </span><span class="org-comment">It will try 62 combinations for each letter</span>
<span class="org-comment-delimiter">-- </span><span class="org-comment">wich means it will try up to 62 x 62 x 62 x 62 = 14,776,336 </span>
<span class="org-comment-delimiter">-- </span><span class="org-comment">(=~ 15 millions) combinations at the worst case.</span>
<span class="org-comment-delimiter">--</span>
<span class="org-comment-delimiter">-- </span>
<span class="org-haskell-definition">crack_4pass</span>  pass_function <span class="org-haskell-operator">=</span> <span class="org-haskell-keyword">do</span>
    ch0 <span class="org-haskell-operator">&lt;-</span> alphabet 
    ch1 <span class="org-haskell-operator">&lt;-</span> alphabet 
    ch2 <span class="org-haskell-operator">&lt;-</span> alphabet 
    ch3 <span class="org-haskell-operator">&lt;-</span> alphabet 
    <span class="org-haskell-keyword">let</span> trial <span class="org-haskell-operator">=</span> [ch0<span class="org-haskell-operator">,</span> ch1<span class="org-haskell-operator">,</span> ch2<span class="org-haskell-operator">,</span> ch3] <span class="org-haskell-keyword">in</span>
      <span class="org-haskell-keyword">if</span>   pass_function trial
      <span class="org-haskell-keyword">then</span> return (<span class="org-haskell-constructor">Just</span> trial)
      <span class="org-haskell-keyword">else</span> return <span class="org-haskell-constructor">Nothing</span> 
    
<span class="org-haskell-definition">crackpass</span> pass_function <span class="org-haskell-operator">=</span> 
   find isJust (crack_4pass pass_function)

<span class="org-haskell-definition">passwd1</span> <span class="org-haskell-operator">=</span> make_password <span class="org-string">"fX87"</span> 


<span class="org-haskell-operator">&gt;</span> <span class="org-haskell-constructor">:</span>set <span class="org-haskell-operator">+</span>s

<span class="org-haskell-operator">&gt;</span> <span class="org-haskell-definition">crackpass</span> passwd1 
<span class="org-haskell-constructor">Just</span> (<span class="org-haskell-constructor">Just</span> <span class="org-string">"fX87"</span>)
(2.00 secs<span class="org-haskell-operator">,</span> 434045068 bytes)
<span class="org-haskell-operator">&gt;</span> 

<span class="org-haskell-operator">&gt;</span> <span class="org-haskell-definition">crackpass</span> (make_password <span class="org-string">"2f8z"</span>)
<span class="org-haskell-constructor">Just</span> (<span class="org-haskell-constructor">Just</span> <span class="org-string">"2f8z"</span>)
(18.19 secs<span class="org-haskell-operator">,</span> 4038359812 bytes)
<span class="org-haskell-operator">&gt;</span>
</pre>
</div>
</div>
</div>

<div id="outline-container-sec-1-14-3-2" class="outline-5">
<h5 id="sec-1-14-3-2"><span class="section-number-5">1.14.3.2</span> List Monad in OCaml</h5>
<div class="outline-text-5" id="text-1-14-3-2">
<div class="org-src-container">

<pre class="src src-ocaml"><span class="org-tuareg-font-lock-governing">module</span> <span class="org-tuareg-font-lock-module">ListM</span> <span class="org-tuareg-font-lock-operator">=</span>
  <span class="org-tuareg-font-lock-governing">struct</span> 
  <span class="org-tuareg-font-lock-governing">let</span> <span class="org-function-name">bind</span><span class="org-variable-name"> ma f</span> <span class="org-tuareg-font-lock-operator">=</span> <span class="org-tuareg-font-lock-module">List.</span>concat <span class="org-tuareg-font-lock-operator">(</span><span class="org-tuareg-font-lock-module">List.</span>map f ma<span class="org-tuareg-font-lock-operator">)</span>

  <span class="org-tuareg-font-lock-governing">let</span> <span class="org-tuareg-font-lock-operator">(&gt;&gt;=)</span> <span class="org-tuareg-font-lock-operator">=</span> bind 

  <span class="org-comment-delimiter">(* </span><span class="org-comment">return  </span><span class="org-comment-delimiter">*)</span>
  <span class="org-tuareg-font-lock-governing">let</span> <span class="org-function-name">unit</span><span class="org-variable-name"> a</span>  <span class="org-tuareg-font-lock-operator">=</span> <span class="org-tuareg-font-lock-operator">[</span>a<span class="org-tuareg-font-lock-operator">]</span>

<span class="org-tuareg-font-lock-governing">end</span>
<span class="org-tuareg-font-lock-operator">;;</span>


<span class="org-tuareg-font-lock-governing">module</span> <span class="org-tuareg-font-lock-module">ListM</span> <span class="org-tuareg-font-lock-operator">:</span>
  <span class="org-tuareg-font-lock-governing">sig</span>
    <span class="org-tuareg-font-lock-governing">val</span> <span class="org-function-name">bind</span> <span class="org-tuareg-font-lock-operator">:</span> 'a list <span class="org-tuareg-font-lock-operator">-&gt;</span> <span class="org-tuareg-font-lock-operator">(</span>'a <span class="org-tuareg-font-lock-operator">-&gt;</span> 'b list<span class="org-tuareg-font-lock-operator">)</span> <span class="org-tuareg-font-lock-operator">-&gt;</span> 'b list
    <span class="org-tuareg-font-lock-governing">val</span> <span class="org-tuareg-font-lock-operator">(</span> <span class="org-tuareg-font-lock-operator">&gt;&gt;=</span> <span class="org-tuareg-font-lock-operator">)</span> <span class="org-tuareg-font-lock-operator">:</span> 'a list <span class="org-tuareg-font-lock-operator">-&gt;</span> <span class="org-tuareg-font-lock-operator">(</span>'a <span class="org-tuareg-font-lock-operator">-&gt;</span> 'b list<span class="org-tuareg-font-lock-operator">)</span> <span class="org-tuareg-font-lock-operator">-&gt;</span> 'b list
    <span class="org-tuareg-font-lock-governing">val</span> <span class="org-function-name">unit</span> <span class="org-tuareg-font-lock-operator">:</span> 'a <span class="org-tuareg-font-lock-operator">-&gt;</span> 'a list
  <span class="org-tuareg-font-lock-governing">end</span>

<span class="org-comment-delimiter">(*</span>
<span class="org-comment"> Haskel Code:</span>

<span class="org-comment"> cartesian :: [a] -&gt; [b] -&gt; [(a, b)]              cartesian :: [a] -&gt; [b] -&gt; [(a, b)]   </span>
<span class="org-comment"> cartesian xs ys = do                             carteasian xs ys = </span>
<span class="org-comment">    x &lt;- xs                              ==&gt;&gt;        xs &gt;&gt;= \x -&gt;    </span>
<span class="org-comment">    y &lt;- ys                                          ys &gt;&gt;= \y -&gt; </span>
<span class="org-comment">    return (x, y)                                    return (x, y)</span>


<span class="org-comment"> cartesian :: [a] -&gt; [b] -&gt; [(a, b)] </span>
<span class="org-comment"> carteasian xs ys = </span>
<span class="org-comment">   bind xs (\x -&gt; </span>
<span class="org-comment">   bind ys (\y -&gt; </span>
<span class="org-comment">   return (x, y)))</span>

<span class="org-comment-delimiter">*)</span>


<span class="org-tuareg-font-lock-governing">let</span> <span class="org-function-name">cartesian</span><span class="org-variable-name"> xs ys</span> <span class="org-tuareg-font-lock-operator">=</span> 
    <span class="org-tuareg-font-lock-governing">let</span> <span class="org-tuareg-font-lock-governing">open </span><span class="org-tuareg-font-lock-module">ListM</span> <span class="org-tuareg-font-lock-governing">in</span> 
    xs <span class="org-tuareg-font-lock-operator">&gt;&gt;=</span> <span class="org-keyword">fun</span> <span class="org-variable-name">x</span> <span class="org-tuareg-font-lock-operator">-&gt;</span> 
    ys <span class="org-tuareg-font-lock-operator">&gt;&gt;=</span> <span class="org-keyword">fun</span> <span class="org-variable-name">y</span> <span class="org-tuareg-font-lock-operator">-&gt;</span>
    unit <span class="org-tuareg-font-lock-operator">(</span>x<span class="org-tuareg-font-lock-operator">,</span> y<span class="org-tuareg-font-lock-operator">)</span>
<span class="org-tuareg-font-lock-operator">;;</span>

<span class="org-tuareg-font-lock-governing">val</span> <span class="org-function-name">cartesian</span> <span class="org-tuareg-font-lock-operator">:</span> 'a list <span class="org-tuareg-font-lock-operator">-&gt;</span> 'b list <span class="org-tuareg-font-lock-operator">-&gt;</span> <span class="org-tuareg-font-lock-operator">(</span>'a <span class="org-tuareg-font-lock-operator">*</span> 'b<span class="org-tuareg-font-lock-operator">)</span> list <span class="org-tuareg-font-lock-operator">=</span> <span class="org-tuareg-font-lock-operator">&lt;</span><span class="org-keyword">fun</span><span class="org-tuareg-font-lock-operator">&gt;</span>


<span class="org-tuareg-font-lock-operator">&gt;</span>   cartesian <span class="org-tuareg-font-lock-operator">[</span>1<span class="org-tuareg-font-lock-operator">;</span> 2<span class="org-tuareg-font-lock-operator">;</span> 3<span class="org-tuareg-font-lock-operator">;</span> 4<span class="org-tuareg-font-lock-operator">;</span> <span class="org-tuareg-font-lock-operator">]</span> <span class="org-tuareg-font-lock-operator">[</span><span class="org-string">"a"</span><span class="org-tuareg-font-lock-operator">;</span> <span class="org-string">"b"</span><span class="org-tuareg-font-lock-operator">;</span> <span class="org-string">"c"</span><span class="org-tuareg-font-lock-operator">]</span>  <span class="org-tuareg-font-lock-operator">;;</span>
<span class="org-function-name">-</span> <span class="org-tuareg-font-lock-operator">:</span> <span class="org-tuareg-font-lock-operator">(</span>int <span class="org-tuareg-font-lock-operator">*</span> string<span class="org-tuareg-font-lock-operator">)</span> list <span class="org-tuareg-font-lock-operator">=</span>
<span class="org-tuareg-font-lock-operator">[(</span>1<span class="org-tuareg-font-lock-operator">,</span> <span class="org-string">"a"</span><span class="org-tuareg-font-lock-operator">);</span> <span class="org-tuareg-font-lock-operator">(</span>1<span class="org-tuareg-font-lock-operator">,</span> <span class="org-string">"b"</span><span class="org-tuareg-font-lock-operator">);</span> <span class="org-tuareg-font-lock-operator">(</span>1<span class="org-tuareg-font-lock-operator">,</span> <span class="org-string">"c"</span><span class="org-tuareg-font-lock-operator">);</span> <span class="org-tuareg-font-lock-operator">(</span>2<span class="org-tuareg-font-lock-operator">,</span> <span class="org-string">"a"</span><span class="org-tuareg-font-lock-operator">);</span> <span class="org-tuareg-font-lock-operator">(</span>2<span class="org-tuareg-font-lock-operator">,</span> <span class="org-string">"b"</span><span class="org-tuareg-font-lock-operator">);</span> <span class="org-tuareg-font-lock-operator">(</span>2<span class="org-tuareg-font-lock-operator">,</span> <span class="org-string">"c"</span><span class="org-tuareg-font-lock-operator">);</span> <span class="org-tuareg-font-lock-operator">(</span>3<span class="org-tuareg-font-lock-operator">,</span> <span class="org-string">"a"</span><span class="org-tuareg-font-lock-operator">);</span>
 <span class="org-tuareg-font-lock-operator">(</span>3<span class="org-tuareg-font-lock-operator">,</span> <span class="org-string">"b"</span><span class="org-tuareg-font-lock-operator">);</span> <span class="org-tuareg-font-lock-operator">(</span>3<span class="org-tuareg-font-lock-operator">,</span> <span class="org-string">"c"</span><span class="org-tuareg-font-lock-operator">);</span> <span class="org-tuareg-font-lock-operator">(</span>4<span class="org-tuareg-font-lock-operator">,</span> <span class="org-string">"a"</span><span class="org-tuareg-font-lock-operator">);</span> <span class="org-tuareg-font-lock-operator">(</span>4<span class="org-tuareg-font-lock-operator">,</span> <span class="org-string">"b"</span><span class="org-tuareg-font-lock-operator">);</span> <span class="org-tuareg-font-lock-operator">(</span>4<span class="org-tuareg-font-lock-operator">,</span> <span class="org-string">"c"</span><span class="org-tuareg-font-lock-operator">)]</span>


<span class="org-comment-delimiter">(*</span>

<span class="org-comment">Haskel Code                               Do-natation Dessugarized</span>
<span class="org-comment">                                                       </span>
<span class="org-comment">triples :: [a] [b] [c] -&gt; [(a, b, c)]     triples :: [a] [b] [c] -&gt; [(a, b, c)]</span>
<span class="org-comment">triples xs ys zs = do                     tripes xs ys zs = </span>
<span class="org-comment">    x &lt;- xs                                   xs &gt;&gt;= \x -&gt;</span>
<span class="org-comment">    y &lt;- ys                     ==&gt;           ys &gt;&gt;= \y -&gt;</span>
<span class="org-comment">    z &lt;- zs                                   zs &gt;&gt;= \z -&gt;</span>
<span class="org-comment">    return (x, y, z)                          return (x, y, z)  </span>

<span class="org-comment-delimiter">*)</span>

<span class="org-tuareg-font-lock-governing">let</span> <span class="org-function-name">triples</span><span class="org-variable-name"> </span><span class="org-tuareg-font-lock-operator">(</span><span class="org-variable-name">xs</span><span class="org-tuareg-font-lock-operator">:</span><span class="org-type"> 'a list</span><span class="org-tuareg-font-lock-operator">)</span><span class="org-variable-name"> </span><span class="org-tuareg-font-lock-operator">(</span><span class="org-variable-name">ys</span><span class="org-tuareg-font-lock-operator">:</span><span class="org-type"> 'b list</span><span class="org-tuareg-font-lock-operator">)</span><span class="org-variable-name"> </span><span class="org-tuareg-font-lock-operator">(</span><span class="org-variable-name">zs</span><span class="org-tuareg-font-lock-operator">:</span><span class="org-type"> 'c list</span><span class="org-tuareg-font-lock-operator">)</span> <span class="org-tuareg-font-lock-operator">:</span> <span class="org-tuareg-font-lock-operator">(</span><span class="org-type">'a </span><span class="org-tuareg-font-lock-operator">*</span><span class="org-type"> 'b </span><span class="org-tuareg-font-lock-operator">*</span><span class="org-type"> 'c</span><span class="org-tuareg-font-lock-operator">)</span><span class="org-type"> list</span> <span class="org-tuareg-font-lock-operator">=</span>
    <span class="org-tuareg-font-lock-governing">let</span> <span class="org-tuareg-font-lock-governing">open </span><span class="org-tuareg-font-lock-module">ListM</span> <span class="org-tuareg-font-lock-governing">in</span> 
    xs <span class="org-tuareg-font-lock-operator">&gt;&gt;=</span> <span class="org-keyword">fun</span> <span class="org-variable-name">x</span> <span class="org-tuareg-font-lock-operator">-&gt;</span>
    ys <span class="org-tuareg-font-lock-operator">&gt;&gt;=</span> <span class="org-keyword">fun</span> <span class="org-variable-name">y</span> <span class="org-tuareg-font-lock-operator">-&gt;</span>
    zs <span class="org-tuareg-font-lock-operator">&gt;&gt;=</span> <span class="org-keyword">fun</span> <span class="org-variable-name">z</span> <span class="org-tuareg-font-lock-operator">-&gt;</span> 
    unit <span class="org-tuareg-font-lock-operator">(</span>x<span class="org-tuareg-font-lock-operator">,</span> y<span class="org-tuareg-font-lock-operator">,</span> z<span class="org-tuareg-font-lock-operator">)</span>
<span class="org-tuareg-font-lock-operator">;;</span>

<span class="org-tuareg-font-lock-governing">val</span> <span class="org-function-name">triples</span> <span class="org-tuareg-font-lock-operator">:</span> 'a list <span class="org-tuareg-font-lock-operator">-&gt;</span> 'b list <span class="org-tuareg-font-lock-operator">-&gt;</span> 'c list <span class="org-tuareg-font-lock-operator">-&gt;</span> <span class="org-tuareg-font-lock-operator">(</span>'a <span class="org-tuareg-font-lock-operator">*</span> 'b <span class="org-tuareg-font-lock-operator">*</span> 'c<span class="org-tuareg-font-lock-operator">)</span> list <span class="org-tuareg-font-lock-operator">=</span> <span class="org-tuareg-font-lock-operator">&lt;</span><span class="org-keyword">fun</span><span class="org-tuareg-font-lock-operator">&gt;</span>


<span class="org-tuareg-font-lock-operator">&gt;</span>  triples <span class="org-tuareg-font-lock-operator">[</span><span class="org-string">"x"</span><span class="org-tuareg-font-lock-operator">;</span> <span class="org-string">"z"</span><span class="org-tuareg-font-lock-operator">;</span> <span class="org-string">"w"</span><span class="org-tuareg-font-lock-operator">]</span>  <span class="org-tuareg-font-lock-operator">[</span><span class="org-tuareg-font-lock-constructor">Some</span> 10<span class="org-tuareg-font-lock-operator">;</span> <span class="org-tuareg-font-lock-constructor">None</span><span class="org-tuareg-font-lock-operator">]</span> <span class="org-tuareg-font-lock-operator">[</span>1<span class="org-tuareg-font-lock-operator">;</span> 2<span class="org-tuareg-font-lock-operator">;</span> 3<span class="org-tuareg-font-lock-operator">;</span> 4<span class="org-tuareg-font-lock-operator">;</span> 5<span class="org-tuareg-font-lock-operator">]</span> <span class="org-tuareg-font-lock-operator">;;</span>
<span class="org-function-name">-</span> <span class="org-tuareg-font-lock-operator">:</span> <span class="org-tuareg-font-lock-operator">(</span>string <span class="org-tuareg-font-lock-operator">*</span> int option <span class="org-tuareg-font-lock-operator">*</span> int<span class="org-tuareg-font-lock-operator">)</span> list <span class="org-tuareg-font-lock-operator">=</span>
<span class="org-tuareg-font-lock-operator">[(</span><span class="org-string">"x"</span><span class="org-tuareg-font-lock-operator">,</span> <span class="org-tuareg-font-lock-constructor">Some</span> 10<span class="org-tuareg-font-lock-operator">,</span> 1<span class="org-tuareg-font-lock-operator">);</span> <span class="org-tuareg-font-lock-operator">(</span><span class="org-string">"x"</span><span class="org-tuareg-font-lock-operator">,</span> <span class="org-tuareg-font-lock-constructor">Some</span> 10<span class="org-tuareg-font-lock-operator">,</span> 2<span class="org-tuareg-font-lock-operator">);</span> <span class="org-tuareg-font-lock-operator">(</span><span class="org-string">"x"</span><span class="org-tuareg-font-lock-operator">,</span> <span class="org-tuareg-font-lock-constructor">Some</span> 10<span class="org-tuareg-font-lock-operator">,</span> 3<span class="org-tuareg-font-lock-operator">);</span> <span class="org-tuareg-font-lock-operator">(</span><span class="org-string">"x"</span><span class="org-tuareg-font-lock-operator">,</span> <span class="org-tuareg-font-lock-constructor">Some</span> 10<span class="org-tuareg-font-lock-operator">,</span> 4<span class="org-tuareg-font-lock-operator">);</span>
 <span class="org-tuareg-font-lock-operator">(</span><span class="org-string">"x"</span><span class="org-tuareg-font-lock-operator">,</span> <span class="org-tuareg-font-lock-constructor">Some</span> 10<span class="org-tuareg-font-lock-operator">,</span> 5<span class="org-tuareg-font-lock-operator">);</span> <span class="org-tuareg-font-lock-operator">(</span><span class="org-string">"x"</span><span class="org-tuareg-font-lock-operator">,</span> <span class="org-tuareg-font-lock-constructor">None</span><span class="org-tuareg-font-lock-operator">,</span> 1<span class="org-tuareg-font-lock-operator">);</span> <span class="org-tuareg-font-lock-operator">(</span><span class="org-string">"x"</span><span class="org-tuareg-font-lock-operator">,</span> <span class="org-tuareg-font-lock-constructor">None</span><span class="org-tuareg-font-lock-operator">,</span> 2<span class="org-tuareg-font-lock-operator">);</span> <span class="org-tuareg-font-lock-operator">(</span><span class="org-string">"x"</span><span class="org-tuareg-font-lock-operator">,</span> <span class="org-tuareg-font-lock-constructor">None</span><span class="org-tuareg-font-lock-operator">,</span> 3<span class="org-tuareg-font-lock-operator">);</span>
 <span class="org-tuareg-font-lock-operator">(</span><span class="org-string">"x"</span><span class="org-tuareg-font-lock-operator">,</span> <span class="org-tuareg-font-lock-constructor">None</span><span class="org-tuareg-font-lock-operator">,</span> 4<span class="org-tuareg-font-lock-operator">);</span> <span class="org-tuareg-font-lock-operator">(</span><span class="org-string">"x"</span><span class="org-tuareg-font-lock-operator">,</span> <span class="org-tuareg-font-lock-constructor">None</span><span class="org-tuareg-font-lock-operator">,</span> 5<span class="org-tuareg-font-lock-operator">);</span> <span class="org-tuareg-font-lock-operator">(</span><span class="org-string">"z"</span><span class="org-tuareg-font-lock-operator">,</span> <span class="org-tuareg-font-lock-constructor">Some</span> 10<span class="org-tuareg-font-lock-operator">,</span> 1<span class="org-tuareg-font-lock-operator">);</span> <span class="org-tuareg-font-lock-operator">(</span><span class="org-string">"z"</span><span class="org-tuareg-font-lock-operator">,</span> <span class="org-tuareg-font-lock-constructor">Some</span> 10<span class="org-tuareg-font-lock-operator">,</span> 2<span class="org-tuareg-font-lock-operator">);</span>
 <span class="org-tuareg-font-lock-operator">(</span><span class="org-string">"z"</span><span class="org-tuareg-font-lock-operator">,</span> <span class="org-tuareg-font-lock-constructor">Some</span> 10<span class="org-tuareg-font-lock-operator">,</span> 3<span class="org-tuareg-font-lock-operator">);</span> <span class="org-tuareg-font-lock-operator">(</span><span class="org-string">"z"</span><span class="org-tuareg-font-lock-operator">,</span> <span class="org-tuareg-font-lock-constructor">Some</span> 10<span class="org-tuareg-font-lock-operator">,</span> 4<span class="org-tuareg-font-lock-operator">);</span> <span class="org-tuareg-font-lock-operator">(</span><span class="org-string">"z"</span><span class="org-tuareg-font-lock-operator">,</span> <span class="org-tuareg-font-lock-constructor">Some</span> 10<span class="org-tuareg-font-lock-operator">,</span> 5<span class="org-tuareg-font-lock-operator">);</span> <span class="org-tuareg-font-lock-operator">(</span><span class="org-string">"z"</span><span class="org-tuareg-font-lock-operator">,</span> <span class="org-tuareg-font-lock-constructor">None</span><span class="org-tuareg-font-lock-operator">,</span> 1<span class="org-tuareg-font-lock-operator">);</span>
 <span class="org-tuareg-font-lock-operator">(</span><span class="org-string">"z"</span><span class="org-tuareg-font-lock-operator">,</span> <span class="org-tuareg-font-lock-constructor">None</span><span class="org-tuareg-font-lock-operator">,</span> 2<span class="org-tuareg-font-lock-operator">);</span> <span class="org-tuareg-font-lock-operator">(</span><span class="org-string">"z"</span><span class="org-tuareg-font-lock-operator">,</span> <span class="org-tuareg-font-lock-constructor">None</span><span class="org-tuareg-font-lock-operator">,</span> 3<span class="org-tuareg-font-lock-operator">);</span> <span class="org-tuareg-font-lock-operator">(</span><span class="org-string">"z"</span><span class="org-tuareg-font-lock-operator">,</span> <span class="org-tuareg-font-lock-constructor">None</span><span class="org-tuareg-font-lock-operator">,</span> 4<span class="org-tuareg-font-lock-operator">);</span> <span class="org-tuareg-font-lock-operator">(</span><span class="org-string">"z"</span><span class="org-tuareg-font-lock-operator">,</span> <span class="org-tuareg-font-lock-constructor">None</span><span class="org-tuareg-font-lock-operator">,</span> 5<span class="org-tuareg-font-lock-operator">);</span>
 <span class="org-tuareg-font-lock-operator">(</span><span class="org-string">"w"</span><span class="org-tuareg-font-lock-operator">,</span> <span class="org-tuareg-font-lock-constructor">Some</span> 10<span class="org-tuareg-font-lock-operator">,</span> 1<span class="org-tuareg-font-lock-operator">);</span> <span class="org-tuareg-font-lock-operator">(</span><span class="org-string">"w"</span><span class="org-tuareg-font-lock-operator">,</span> <span class="org-tuareg-font-lock-constructor">Some</span> 10<span class="org-tuareg-font-lock-operator">,</span> 2<span class="org-tuareg-font-lock-operator">);</span> <span class="org-tuareg-font-lock-operator">(</span><span class="org-string">"w"</span><span class="org-tuareg-font-lock-operator">,</span> <span class="org-tuareg-font-lock-constructor">Some</span> 10<span class="org-tuareg-font-lock-operator">,</span> 3<span class="org-tuareg-font-lock-operator">);</span> <span class="org-tuareg-font-lock-operator">(</span><span class="org-string">"w"</span><span class="org-tuareg-font-lock-operator">,</span> <span class="org-tuareg-font-lock-constructor">Some</span> 10<span class="org-tuareg-font-lock-operator">,</span> 4<span class="org-tuareg-font-lock-operator">);</span>
 <span class="org-tuareg-font-lock-operator">(</span><span class="org-string">"w"</span><span class="org-tuareg-font-lock-operator">,</span> <span class="org-tuareg-font-lock-constructor">Some</span> 10<span class="org-tuareg-font-lock-operator">,</span> 5<span class="org-tuareg-font-lock-operator">);</span> <span class="org-tuareg-font-lock-operator">(</span><span class="org-string">"w"</span><span class="org-tuareg-font-lock-operator">,</span> <span class="org-tuareg-font-lock-constructor">None</span><span class="org-tuareg-font-lock-operator">,</span> 1<span class="org-tuareg-font-lock-operator">);</span> <span class="org-tuareg-font-lock-operator">(</span><span class="org-string">"w"</span><span class="org-tuareg-font-lock-operator">,</span> <span class="org-tuareg-font-lock-constructor">None</span><span class="org-tuareg-font-lock-operator">,</span> 2<span class="org-tuareg-font-lock-operator">);</span> <span class="org-tuareg-font-lock-operator">(</span><span class="org-string">"w"</span><span class="org-tuareg-font-lock-operator">,</span> <span class="org-tuareg-font-lock-constructor">None</span><span class="org-tuareg-font-lock-operator">,</span> 3<span class="org-tuareg-font-lock-operator">);</span>
 <span class="org-tuareg-font-lock-operator">(</span><span class="org-string">"w"</span><span class="org-tuareg-font-lock-operator">,</span> <span class="org-tuareg-font-lock-constructor">None</span><span class="org-tuareg-font-lock-operator">,</span> 4<span class="org-tuareg-font-lock-operator">);</span> <span class="org-tuareg-font-lock-operator">(</span><span class="org-string">"w"</span><span class="org-tuareg-font-lock-operator">,</span> <span class="org-tuareg-font-lock-constructor">None</span><span class="org-tuareg-font-lock-operator">,</span> 5<span class="org-tuareg-font-lock-operator">)]</span>
</pre>
</div>
</div>
</div>

<div id="outline-container-sec-1-14-3-3" class="outline-5">
<h5 id="sec-1-14-3-3"><span class="section-number-5">1.14.3.3</span> List Monad in F#</h5>
<div class="outline-text-5" id="text-1-14-3-3">
<p>
Example without syntax sugar: 
</p>

<div class="org-src-container">

<pre class="src src-fsharp"><span class="org-keyword">module</span> <span class="org-type">ListM</span> =

  <span class="org-keyword">let</span> <span class="org-function-name">bind</span> <span class="org-variable-name">ma</span> <span class="org-variable-name">f</span> = List.concat (List.map f ma)

  <span class="org-keyword">let</span> (&gt;&gt;=) = bind 

  <span class="org-comment">(* return  *)</span>
  <span class="org-keyword">let</span> <span class="org-function-name">unit</span> <span class="org-variable-name">a</span>  = [a]
;;


<span class="org-keyword">module</span> <span class="org-type">ListM</span> = <span class="org-keyword">begin</span>
  <span class="org-keyword">val</span> <span class="org-variable-name">bind</span> : <span class="org-type">ma:'a list </span>-&gt; f:('a -&gt; 'b list) -&gt; 'b list
  <span class="org-keyword">val</span> ( &gt;&gt;= ) : ('a list -&gt; ('a -&gt; 'b list) -&gt; 'b list)
  <span class="org-keyword">val</span> <span class="org-variable-name">unit</span> : <span class="org-type">a:'a </span>-&gt; 'a list
<span class="org-keyword">end</span>


<span class="org-comment">(*  Example:</span>

<span class="org-comment">cartesian :: [a] -&gt; [b] -&gt; [(a, b)]</span>
<span class="org-comment">cartesian xs ys = do</span>
<span class="org-comment">    x &lt;- xs </span>
<span class="org-comment">    y &lt;- ys </span>
<span class="org-comment">    return (x, y)</span>

<span class="org-comment">&gt; cartesian [1, 2, 3, 4] ["a", "b", "c"]</span>
<span class="org-comment">*)</span>


<span class="org-keyword">let</span> <span class="org-function-name">cartesian</span> <span class="org-variable-name">xs</span> <span class="org-variable-name">ys</span> =  
    <span class="org-keyword">let</span> (&gt;&gt;=) = ListM.(&gt;&gt;=) <span class="org-keyword">in</span> 
    <span class="org-keyword">let</span> <span class="org-variable-name">unit</span>  = ListM.unit <span class="org-keyword">in</span> 
   
    xs &gt;&gt;= <span class="org-keyword">fun</span> <span class="org-variable-name">x</span> -&gt;
    ys &gt;&gt;= <span class="org-keyword">fun</span> <span class="org-variable-name">y</span> -&gt;
    unit (x, y) 
;;

<span class="org-keyword">val</span> cartesian : 'a list -&gt; 'b list -&gt; ('a * 'b) list = &lt;<span class="org-keyword">fun</span>&gt;                                                           &gt; 


&gt; 
&gt; <span class="org-variable-name">cartesian</span> [1; 2; 3; 4; ] [<span class="org-string">"a"</span>; <span class="org-string">"b"</span>; <span class="org-string">"c"</span>]  ;;
<span class="org-keyword">val</span> <span class="org-variable-name">it</span> : (<span class="org-variable-name">int</span> * <span class="org-variable-name">string</span>) <span class="org-variable-name">list</span> =
  [(1, <span class="org-string">"a"</span>); (1, <span class="org-string">"b"</span>); (1, <span class="org-string">"c"</span>); 
   (2, <span class="org-string">"a"</span>); (2, <span class="org-string">"b"</span>); (2, <span class="org-string">"c"</span>); 
   (3, <span class="org-string">"a"</span>); (3, <span class="org-string">"b"</span>); (3, <span class="org-string">"c"</span>); 
   (4, <span class="org-string">"a"</span>); (4, <span class="org-string">"b"</span>); (4, <span class="org-string">"c"</span>)]
&gt; 


<span class="org-comment">(*  </span>

<span class="org-comment">F# List type is eager evaluated so the it will</span>
<span class="org-comment">really loop over 100 * 100 * 100 = 100,000,000</span>
<span class="org-comment">of combinations:  </span>

<span class="org-comment">pthytriples = do </span>
<span class="org-comment">    a &lt;- [1 .. 100]</span>
<span class="org-comment">    b &lt;- [1 .. 100]</span>
<span class="org-comment">    c &lt;- [1 .. 100]</span>

<span class="org-comment">    if (a ^ 2 + b ^ 2 == c ^ 2)</span>
<span class="org-comment">      then (return (Just (a, b, c)))</span>
<span class="org-comment">      else (return Nothing)</span>


<span class="org-comment">*)</span>
  

<span class="org-comment">(* Tail recursive function </span>

<span class="org-comment">*)</span>
<span class="org-keyword">let</span> <span class="org-function-name">range</span> <span class="org-variable-name">start</span> <span class="org-variable-name">stop</span> <span class="org-variable-name">step</span>  =

    <span class="org-keyword">let</span> <span class="org-keyword">rec</span> <span class="org-function-name">range_aux</span> <span class="org-variable-name">start</span> <span class="org-variable-name">acc</span> = 
        <span class="org-keyword">if</span> <span class="org-variable-name">start</span> &gt;= <span class="org-variable-name">stop</span> 
        <span class="org-keyword">then</span>  <span class="org-variable-name">List</span>.<span class="org-variable-name">rev</span> <span class="org-variable-name">acc</span> 
        <span class="org-keyword">else</span>  <span class="org-variable-name">range_aux</span> (<span class="org-variable-name">start</span> + <span class="org-variable-name">step</span>)  (<span class="org-variable-name">start</span>::<span class="org-variable-name">acc</span>)

    <span class="org-keyword">in</span> <span class="org-variable-name">range_aux</span> <span class="org-variable-name">start</span> []
  ;;

<span class="org-keyword">val</span> <span class="org-variable-name">range</span> : <span class="org-type">start:int </span>-&gt; stop:<span class="org-type">int </span>-&gt; step:<span class="org-type">int </span>-&gt; int list

&gt;  range 1 11 1 ;;
<span class="org-function-name">-</span> : <span class="org-type">int list </span>= [1; 2; 3; 4; 5; 6; 7; 8; 9; 10]
 

<span class="org-keyword">let</span> <span class="org-function-name">pthytriples</span> () = 
    <span class="org-keyword">let</span> (&gt;&gt;=) = ListM.(&gt;&gt;=) <span class="org-keyword">in</span> 
    <span class="org-keyword">let</span> <span class="org-variable-name">unit</span>  = ListM.unit <span class="org-keyword">in</span> 

    range 1 101 1 &gt;&gt;= <span class="org-keyword">fun</span> <span class="org-variable-name">a</span> -&gt;
    range 1 101 1 &gt;&gt;= <span class="org-keyword">fun</span> <span class="org-variable-name">b</span> -&gt;
    range 1 101 1 &gt;&gt;= <span class="org-keyword">fun</span> <span class="org-variable-name">c</span> -&gt;
    <span class="org-keyword">if</span> (a * a + b * b = c * c)
    <span class="org-keyword">then</span> unit (Some (a, b, c))
    <span class="org-keyword">else</span> unit None
;;

<span class="org-keyword">val</span> <span class="org-variable-name">pthytriples</span> : <span class="org-type">unit </span>-&gt; (int * int * int) option list


<span class="org-keyword">let</span> <span class="org-function-name">option_to_list</span> <span class="org-variable-name">opt_list</span> = 
    List.foldBack                     <span class="org-comment">(* Fold right *)</span>
      (<span class="org-keyword">fun</span> <span class="org-variable-name">x</span> <span class="org-variable-name">acc</span> -&gt; <span class="org-keyword">match</span> x <span class="org-keyword">with</span>
                    | Some a -&gt; a::acc
                    | None   -&gt; acc
      )
      opt_list
      []
;;      
             

- option_to_list (pthytriples ()) ;;

<span class="org-keyword">val</span> it : (int * int * int) list =
  [(3, 4, 5); (4, 3, 5); (5, 12, 13); (6, 8, 10); (7, 24, 25); (8, 6, 10);
   (8, 15, 17); (9, 12, 15); (9, 40, 41); (10, 24, 26); (11, 60, 61);
   (12, 5, 13); (12, 9, 15); (12, 16, 20); (12, 35, 37); (13, 84, 85);
   (14, 48, 50); (15, 8, 17); (15, 20, 25); (15, 36, 39); (16, 12, 20);
   (16, 30, 34); (16, 63, 65); (18, 24, 30); (18, 80, 82); (20, 15, 25);
   (20, 21, 29); (20, 48, 52); (21, 20, 29); (21, 28, 35); (21, 72, 75);
   (24, 7, 25); (24, 10, 26); (24, 18, 30); (24, 32, 40); (24, 45, 51);
   (24, 70, 74); (25, 60, 65); (27, 36, 45); (28, 21, 35); (28, 45, 53);
   (28, 96, 100); (30, 16, 34); (30, 40, 50); (30, 72, 78); (32, 24, 40);
   (32, 60, 68); (33, 44, 55); (33, 56, 65); (35, 12, 37); (35, 84, 91);
   (36, 15, 39); (36, 27, 45); (36, 48, 60); (36, 77, 85); (39, 52, 65);
   (39, 80, 89); (40, 9, 41); (40, 30, 50); (40, 42, 58); (40, 75, 85);
   (42, 40, 58); (42, 56, 70); (44, 33, 55); (45, 24, 51); (45, 28, 53);
   (45, 60, 75); (48, 14, 50); (48, 20, 52); (48, 36, 60); (48, 55, 73);
   (48, 64, 80); (51, 68, 85); (52, 39, 65); (54, 72, 90); (55, 48, 73);
   (56, 33, 65); (56, 42, 70); (57, 76, 95); (60, 11, 61); (60, 25, 65);
   (60, 32, 68); (60, 45, 75); (60, 63, 87); (60, 80, 100); (63, 16, 65);
   (63, 60, 87); (64, 48, 80); (65, 72, 97); (68, 51, 85); (70, 24, 74);
   (72, 21, 75); (72, 30, 78); (72, 54, 90); (72, 65, 97); (75, 40, 85);
   (76, 57, 95); (77, 36, 85); (80, 18, 82); (80, 39, 89); ...]
&gt;
</pre>
</div>

<p>
Example with F# "workflow" or "computation expression" syntax:
</p>

<div class="org-src-container">

<pre class="src src-ocaml"><span class="org-tuareg-font-lock-operator">-</span> <span class="org-tuareg-font-lock-module">List.</span>concat <span class="org-tuareg-font-lock-operator">[[</span>1<span class="org-tuareg-font-lock-operator">];</span> <span class="org-tuareg-font-lock-operator">[];</span> <span class="org-tuareg-font-lock-operator">[</span>2<span class="org-tuareg-font-lock-operator">;</span> 3<span class="org-tuareg-font-lock-operator">;</span> 4<span class="org-tuareg-font-lock-operator">;</span> 5<span class="org-tuareg-font-lock-operator">];</span> <span class="org-tuareg-font-lock-operator">[</span>10<span class="org-tuareg-font-lock-operator">;</span> 20<span class="org-tuareg-font-lock-operator">]]</span> <span class="org-tuareg-font-lock-operator">;;</span>
<span class="org-tuareg-font-lock-governing">val</span> <span class="org-function-name">it</span> <span class="org-tuareg-font-lock-operator">:</span> int list <span class="org-tuareg-font-lock-operator">=</span> <span class="org-tuareg-font-lock-operator">[</span>1<span class="org-tuareg-font-lock-operator">;</span> 2<span class="org-tuareg-font-lock-operator">;</span> 3<span class="org-tuareg-font-lock-operator">;</span> 4<span class="org-tuareg-font-lock-operator">;</span> 5<span class="org-tuareg-font-lock-operator">;</span> 10<span class="org-tuareg-font-lock-operator">;</span> 20<span class="org-tuareg-font-lock-operator">]</span>
<span class="org-tuareg-font-lock-operator">&gt;</span> 

<span class="org-comment-delimiter">(* </span><span class="org-comment">The F# workflow works like Haskell do-noation  </span>

<span class="org-comment-delimiter">*)</span>
<span class="org-tuareg-font-lock-governing">type</span> <span class="org-tuareg-font-lock-constructor">ListBuilder</span> <span class="org-tuareg-font-lock-operator">()</span> <span class="org-tuareg-font-lock-operator">=</span>    
    member this.<span class="org-tuareg-font-lock-constructor">Bind</span><span class="org-tuareg-font-lock-operator">(</span>xs<span class="org-tuareg-font-lock-operator">,</span> f<span class="org-tuareg-font-lock-operator">)</span> <span class="org-tuareg-font-lock-operator">=</span> <span class="org-tuareg-font-lock-module">List.</span>concat <span class="org-tuareg-font-lock-operator">(</span><span class="org-tuareg-font-lock-module">List.</span>map f xs<span class="org-tuareg-font-lock-operator">)</span>

    member this.<span class="org-tuareg-font-lock-constructor">Return</span><span class="org-tuareg-font-lock-operator">(</span>x<span class="org-tuareg-font-lock-operator">)</span> <span class="org-tuareg-font-lock-operator">=</span> <span class="org-tuareg-font-lock-operator">[</span>x<span class="org-tuareg-font-lock-operator">]</span>
<span class="org-tuareg-font-lock-operator">;;</span>


<span class="org-tuareg-font-lock-governing">type</span> <span class="org-tuareg-font-lock-constructor">ListBuilder</span> <span class="org-tuareg-font-lock-operator">=</span>
  <span class="org-tuareg-font-lock-governing">class</span>
    <span class="org-keyword">new</span> <span class="org-tuareg-font-lock-operator">:</span> unit <span class="org-tuareg-font-lock-operator">-&gt;</span> <span class="org-tuareg-font-lock-constructor">ListBuilder</span>
    member <span class="org-tuareg-font-lock-constructor">Bind</span> <span class="org-tuareg-font-lock-operator">:</span> <span class="org-constant">xs</span><span class="org-tuareg-font-lock-operator">:</span>'b list <span class="org-tuareg-font-lock-operator">*</span> f<span class="org-tuareg-font-lock-operator">:(</span>'b <span class="org-tuareg-font-lock-operator">-&gt;</span> 'c list<span class="org-tuareg-font-lock-operator">)</span> <span class="org-tuareg-font-lock-operator">-&gt;</span> 'c list
    member <span class="org-tuareg-font-lock-constructor">Return</span> <span class="org-tuareg-font-lock-operator">:</span> <span class="org-constant">x</span><span class="org-tuareg-font-lock-operator">:</span>'a <span class="org-tuareg-font-lock-operator">-&gt;</span> 'a list
  <span class="org-tuareg-font-lock-governing">end</span>

<span class="org-tuareg-font-lock-governing">let</span> <span class="org-variable-name">listDo</span> <span class="org-tuareg-font-lock-operator">=</span> <span class="org-tuareg-font-lock-constructor">ListBuilder</span> <span class="org-tuareg-font-lock-operator">()</span> <span class="org-tuareg-font-lock-operator">;;</span>

<span class="org-tuareg-font-lock-governing">val</span> <span class="org-function-name">listDo</span> <span class="org-tuareg-font-lock-operator">:</span> <span class="org-tuareg-font-lock-constructor">ListBuilder</span>

<span class="org-comment-delimiter">(*</span>
<span class="org-comment">cartesian :: [a] -&gt; [b] -&gt; [(a, b)]</span>
<span class="org-comment">cartesian xs ys = do</span>
<span class="org-comment">    x &lt;- xs </span>
<span class="org-comment">    y &lt;- ys </span>
<span class="org-comment">    return (x, y)</span>
<span class="org-comment-delimiter">*)</span>

<span class="org-tuareg-font-lock-governing">let</span> <span class="org-function-name">cartesian</span><span class="org-variable-name"> xs ys</span> <span class="org-tuareg-font-lock-operator">=</span> 
    listDo <span class="org-tuareg-font-lock-operator">{</span>
      <span class="org-tuareg-font-lock-governing">let</span><span class="org-tuareg-font-lock-operator">!</span> x <span class="org-tuareg-font-lock-operator">=</span> xs 
      <span class="org-tuareg-font-lock-governing">let</span><span class="org-tuareg-font-lock-operator">!</span> y <span class="org-tuareg-font-lock-operator">=</span> ys 
      return <span class="org-tuareg-font-lock-operator">(</span>x<span class="org-tuareg-font-lock-operator">,</span> y<span class="org-tuareg-font-lock-operator">)</span>
   <span class="org-tuareg-font-lock-operator">}</span>
<span class="org-tuareg-font-lock-operator">;;</span>

<span class="org-tuareg-font-lock-governing">val</span> <span class="org-function-name">cartesian</span> <span class="org-tuareg-font-lock-operator">:</span> <span class="org-constant">xs</span><span class="org-tuareg-font-lock-operator">:</span>'a list <span class="org-tuareg-font-lock-operator">-&gt;</span> <span class="org-constant">ys</span><span class="org-tuareg-font-lock-operator">:</span>'b list <span class="org-tuareg-font-lock-operator">-&gt;</span> <span class="org-tuareg-font-lock-operator">(</span>'a <span class="org-tuareg-font-lock-operator">*</span> 'b<span class="org-tuareg-font-lock-operator">)</span> list

<span class="org-tuareg-font-lock-operator">&gt;</span>  cartesian <span class="org-tuareg-font-lock-operator">[</span>1<span class="org-tuareg-font-lock-operator">;</span> 2<span class="org-tuareg-font-lock-operator">;</span> 3<span class="org-tuareg-font-lock-operator">;</span> 4<span class="org-tuareg-font-lock-operator">;</span> <span class="org-tuareg-font-lock-operator">]</span> <span class="org-tuareg-font-lock-operator">[</span><span class="org-string">"a"</span><span class="org-tuareg-font-lock-operator">;</span> <span class="org-string">"b"</span><span class="org-tuareg-font-lock-operator">;</span> <span class="org-string">"c"</span><span class="org-tuareg-font-lock-operator">]</span> <span class="org-tuareg-font-lock-operator">;;</span>
<span class="org-tuareg-font-lock-governing">val</span> <span class="org-function-name">it</span> <span class="org-tuareg-font-lock-operator">:</span> <span class="org-tuareg-font-lock-operator">(</span>int <span class="org-tuareg-font-lock-operator">*</span> string<span class="org-tuareg-font-lock-operator">)</span> list <span class="org-tuareg-font-lock-operator">=</span>
  <span class="org-tuareg-font-lock-operator">[(</span>1<span class="org-tuareg-font-lock-operator">,</span> <span class="org-string">"a"</span><span class="org-tuareg-font-lock-operator">);</span> <span class="org-tuareg-font-lock-operator">(</span>1<span class="org-tuareg-font-lock-operator">,</span> <span class="org-string">"b"</span><span class="org-tuareg-font-lock-operator">);</span> <span class="org-tuareg-font-lock-operator">(</span>1<span class="org-tuareg-font-lock-operator">,</span> <span class="org-string">"c"</span><span class="org-tuareg-font-lock-operator">);</span> 
   <span class="org-tuareg-font-lock-operator">(</span>2<span class="org-tuareg-font-lock-operator">,</span> <span class="org-string">"a"</span><span class="org-tuareg-font-lock-operator">);</span> <span class="org-tuareg-font-lock-operator">(</span>2<span class="org-tuareg-font-lock-operator">,</span> <span class="org-string">"b"</span><span class="org-tuareg-font-lock-operator">);</span> <span class="org-tuareg-font-lock-operator">(</span>2<span class="org-tuareg-font-lock-operator">,</span> <span class="org-string">"c"</span><span class="org-tuareg-font-lock-operator">);</span> 
   <span class="org-tuareg-font-lock-operator">(</span>3<span class="org-tuareg-font-lock-operator">,</span> <span class="org-string">"a"</span><span class="org-tuareg-font-lock-operator">);</span> <span class="org-tuareg-font-lock-operator">(</span>3<span class="org-tuareg-font-lock-operator">,</span> <span class="org-string">"b"</span><span class="org-tuareg-font-lock-operator">);</span> <span class="org-tuareg-font-lock-operator">(</span>3<span class="org-tuareg-font-lock-operator">,</span> <span class="org-string">"c"</span><span class="org-tuareg-font-lock-operator">);</span> 
   <span class="org-tuareg-font-lock-operator">(</span>4<span class="org-tuareg-font-lock-operator">,</span> <span class="org-string">"a"</span><span class="org-tuareg-font-lock-operator">);</span> <span class="org-tuareg-font-lock-operator">(</span>4<span class="org-tuareg-font-lock-operator">,</span> <span class="org-string">"b"</span><span class="org-tuareg-font-lock-operator">);</span> <span class="org-tuareg-font-lock-operator">(</span>4<span class="org-tuareg-font-lock-operator">,</span> <span class="org-string">"c"</span><span class="org-tuareg-font-lock-operator">)]</span>
<span class="org-tuareg-font-lock-operator">&gt;</span>
</pre>
</div>
</div>
</div>

<div id="outline-container-sec-1-14-3-4" class="outline-5">
<h5 id="sec-1-14-3-4"><span class="section-number-5">1.14.3.4</span> List Monad in Python</h5>
<div class="outline-text-5" id="text-1-14-3-4">
<div class="org-src-container">

<pre class="src src-python"><span class="org-keyword">from</span> functools <span class="org-keyword">import</span> <span class="org-builtin">reduce</span>

<span class="org-keyword">def</span> <span class="org-function-name">concat</span>(xss):
    <span class="org-string">"concat :: [[a]] -&gt; [a]"</span>
    <span class="org-keyword">return</span>  <span class="org-builtin">reduce</span>(<span class="org-keyword">lambda</span> acc, x: acc + x, xss, [])


<span class="org-keyword">def</span> <span class="org-function-name">listUnit</span> (x):
    <span class="org-string">"listUnit :: x -&gt; [x]"</span>
    <span class="org-keyword">return</span> [x]

<span class="org-keyword">def</span> <span class="org-function-name">listBind</span> (xss, f):
    <span class="org-string">"listBind :: [a] -&gt; (a -&gt; [b]) -&gt; [b] "</span>
    <span class="org-keyword">return</span> concat(<span class="org-builtin">map</span>(f, xss))

<span class="org-comment-delimiter"># </span><span class="org-comment">Haskel Code:</span>
<span class="org-comment-delimiter">#</span>
<span class="org-comment-delimiter"># </span><span class="org-comment">cartesian :: [a] -&gt; [b] -&gt; [(a, b)]              cartesian :: [a] -&gt; [b] -&gt; [(a, b)]   </span>
<span class="org-comment-delimiter"># </span><span class="org-comment">cartesian xs ys = do                             carteasian xs ys = </span>
<span class="org-comment-delimiter">#    </span><span class="org-comment">x &lt;- xs                              ==&gt;&gt;        xs &gt;&gt;= \x -&gt;    </span>
<span class="org-comment-delimiter">#    </span><span class="org-comment">y &lt;- ys                                          ys &gt;&gt;= \y -&gt; </span>
<span class="org-comment-delimiter">#    </span><span class="org-comment">return (x, y)                                    return (x, y)</span>
<span class="org-comment-delimiter">#</span>
<span class="org-comment-delimiter">#</span>
<span class="org-comment-delimiter"># </span><span class="org-comment">cartesian :: [a] -&gt; [b] -&gt; [(a, b)] </span>
<span class="org-comment-delimiter"># </span><span class="org-comment">carteasian xs ys = </span>
<span class="org-comment-delimiter">#   </span><span class="org-comment">bind xs (\x -&gt; </span>
<span class="org-comment-delimiter">#   </span><span class="org-comment">bind ys (\y -&gt; </span>
<span class="org-comment-delimiter">#   </span><span class="org-comment">return (x, y)))</span>
<span class="org-comment-delimiter">#</span>
<span class="org-keyword">def</span> <span class="org-function-name">cartesian</span>(xs, ys):
    
    <span class="org-keyword">return</span> listBind(xs,
                    <span class="org-keyword">lambda</span> x: listBind(ys,
                    <span class="org-keyword">lambda</span> y: listUnit ((x, y))))


<span class="org-keyword">def</span> <span class="org-function-name">triples</span>(xs, ys, zs):

    <span class="org-keyword">return</span> listBind(xs,
                    <span class="org-keyword">lambda</span> x: listBind(ys,
                    <span class="org-keyword">lambda</span> y: listBind(zs,
                    <span class="org-keyword">lambda</span> z: listUnit((x, y, z)))))

&gt;&gt;&gt; cartesian([1, 2, 3, 4], [<span class="org-string">"a"</span>, <span class="org-string">"b"</span>, <span class="org-string">"c"</span>])
[(1, <span class="org-string">'a'</span>), (1, <span class="org-string">'b'</span>), (1, <span class="org-string">'c'</span>), 
(2, <span class="org-string">'a'</span>), (2, <span class="org-string">'b'</span>), (2, <span class="org-string">'c'</span>), 
(3, <span class="org-string">'a'</span>), (3, <span class="org-string">'b'</span>), (3, <span class="org-string">'c'</span>), 
(4, <span class="org-string">'a'</span>), (4, <span class="org-string">'b'</span>), (4, <span class="org-string">'c'</span>)]
&gt;&gt;&gt; 

&gt;&gt;&gt; triples([1, 2], [<span class="org-string">"a"</span>, <span class="org-string">"b"</span>, <span class="org-string">"c"</span>], [<span class="org-string">"x"</span>, <span class="org-string">"y"</span>, <span class="org-string">"z"</span>])
[(1, <span class="org-string">'a'</span>, <span class="org-string">'x'</span>), 
(1, <span class="org-string">'a'</span>, <span class="org-string">'y'</span>), 
(1, <span class="org-string">'a'</span>, <span class="org-string">'z'</span>), 
(1, <span class="org-string">'b'</span>, <span class="org-string">'x'</span>), 
(1, <span class="org-string">'b'</span>, <span class="org-string">'y'</span>), 
(1, <span class="org-string">'b'</span>, <span class="org-string">'z'</span>), 
(1, <span class="org-string">'c'</span>, <span class="org-string">'x'</span>), 
...
&gt;&gt;&gt; 


 <span class="org-comment-delimiter"># </span><span class="org-comment">Emulate ML module </span>
 <span class="org-comment-delimiter">#</span>
<span class="org-keyword">class</span> <span class="org-type">ListM</span> ():

    <span class="org-type">@classmethod</span>
    <span class="org-keyword">def</span> <span class="org-function-name">bind</span>(cls, xss, f):
        <span class="org-keyword">return</span> concat(<span class="org-builtin">map</span>(f, xss))

    <span class="org-type">@classmethod</span>
    <span class="org-keyword">def</span> <span class="org-function-name">unit</span>(cls, x):
        <span class="org-keyword">return</span> [x]

<span class="org-keyword">def</span> <span class="org-function-name">cartesian</span> (xs, ys):
    <span class="org-keyword">return</span> ListM.bind( xs, <span class="org-keyword">lambda</span> x:
           ListM.bind( ys, <span class="org-keyword">lambda</span> y:
           ListM.unit ((x, y))))

&gt;&gt;&gt; cartesian([1, 2, 3, 4], [<span class="org-string">"a"</span>, <span class="org-string">"b"</span>, <span class="org-string">"c"</span>])

[(1, <span class="org-string">'a'</span>), (1, <span class="org-string">'b'</span>), (1, <span class="org-string">'c'</span>), 
(2, <span class="org-string">'a'</span>), (2, <span class="org-string">'b'</span>), (2, <span class="org-string">'c'</span>), 
(3, <span class="org-string">'a'</span>), (3, <span class="org-string">'b'</span>), (3, <span class="org-string">'c'</span>), 
(4, <span class="org-string">'a'</span>), (4, <span class="org-string">'b'</span>), (4, <span class="org-string">'c'</span>)]
&gt;&gt;&gt;
</pre>
</div>
</div>
</div>
</div>

<div id="outline-container-sec-1-14-4" class="outline-4">
<h4 id="sec-1-14-4"><span class="section-number-4">1.14.4</span> Maybe / Option Monad</h4>
<div class="outline-text-4" id="text-1-14-4">
</div><div id="outline-container-sec-1-14-4-1" class="outline-5">
<h5 id="sec-1-14-4-1"><span class="section-number-5">1.14.4.1</span> Overview</h5>
<div class="outline-text-5" id="text-1-14-4-1">
<p>
The Maybe type (Haskell) or Option type (ML, F# and OCaml) is used to
indicate that a function might return nothing, the value might not
exists or that a computation maight fail. This is helpful to remove
nested null checks, avoid null pointer or null object exceptions.
</p>

<p>
Some functions are a natural candidates to return a <span class="underline">maybe</span> or
<span class="underline">option</span> type like parser function, user input validation, lookup functions
that search an input in data structure or database and functions with
invalid input.
</p>
</div>
</div>

<div id="outline-container-sec-1-14-4-2" class="outline-5">
<h5 id="sec-1-14-4-2"><span class="section-number-5">1.14.4.2</span> Maybe Monad in Haskell</h5>
<div class="outline-text-5" id="text-1-14-4-2">
<p>
The Maybe monad ends the computation if any step fails. The module
<a href="https://hackage.haskell.org/package/base-4.8.2.0/docs/Data-Maybe.html">Data.Maybe</a> has useful function to deal with Maybe type.
</p>

<div class="org-src-container">

<pre class="src src-haskell"><span class="org-haskell-keyword">data</span> <span class="org-haskell-constructor">Maybe</span> a <span class="org-haskell-operator">=</span> <span class="org-haskell-constructor">Just</span> a <span class="org-haskell-operator">|</span> <span class="org-haskell-constructor">Nothing</span>

<span class="org-haskell-keyword">instance</span> <span class="org-haskell-constructor">Monad</span> <span class="org-haskell-constructor">Maybe</span> <span class="org-haskell-keyword">where</span>
  (<span class="org-haskell-constructor">Just</span> x) <span class="org-haskell-operator">&gt;&gt;=</span> k <span class="org-haskell-operator">=</span> k x
  <span class="org-haskell-constructor">Nothing</span>  <span class="org-haskell-operator">&gt;&gt;=</span> k <span class="org-haskell-operator">=</span> <span class="org-haskell-constructor">Nothing</span>

  return <span class="org-haskell-operator">=</span> <span class="org-haskell-constructor">Just</span>
</pre>
</div>


<p>
Example: The function below parses two numbers and adds them. 
</p>

<div class="org-src-container">

<pre class="src src-haskell"><span class="org-comment-delimiter">--</span><span class="org-comment">- File: test.hs </span>
<span class="org-comment-delimiter">--</span>
<span class="org-haskell-keyword">import</span> <span class="org-haskell-constructor">Data.List</span> (lookup)
<span class="org-haskell-keyword">import</span> <span class="org-haskell-constructor">Text.Read</span> (readMaybe)


  <span class="org-comment-delimiter">-- </span><span class="org-comment">Parser functions </span>

<span class="org-function-name">parseInt</span> <span class="org-haskell-operator">::</span> <span class="org-haskell-constructor">String</span> <span class="org-haskell-operator">-&gt;</span> <span class="org-haskell-constructor">Maybe</span> <span class="org-haskell-constructor">Int</span> 
<span class="org-haskell-definition">parseInt</span> x <span class="org-haskell-operator">=</span> readMaybe x <span class="org-haskell-operator">::</span> <span class="org-haskell-constructor">Maybe</span> <span class="org-haskell-constructor">Int</span> 

<span class="org-function-name">parseDouble</span> <span class="org-haskell-operator">::</span> <span class="org-haskell-constructor">String</span> <span class="org-haskell-operator">-&gt;</span> <span class="org-haskell-constructor">Maybe</span> <span class="org-haskell-constructor">Double</span>
<span class="org-haskell-definition">parseDouble</span> x <span class="org-haskell-operator">=</span> readMaybe x <span class="org-haskell-operator">::</span> <span class="org-haskell-constructor">Maybe</span> <span class="org-haskell-constructor">Double</span>

 <span class="org-comment-delimiter">-- </span><span class="org-comment">Function with invalid input </span>

<span class="org-function-name">sqrtSafe</span> <span class="org-haskell-operator">::</span> <span class="org-haskell-constructor">Double</span> <span class="org-haskell-operator">-&gt;</span> <span class="org-haskell-constructor">Maybe</span> <span class="org-haskell-constructor">Double</span> 
<span class="org-haskell-definition">sqrtSafe</span> x <span class="org-haskell-operator">=</span> <span class="org-haskell-keyword">if</span> x <span class="org-haskell-operator">&gt;</span> 0
             <span class="org-haskell-keyword">then</span> <span class="org-haskell-constructor">Just</span> (sqrt x)
             <span class="org-haskell-keyword">else</span> <span class="org-haskell-constructor">Nothing</span>

<span class="org-function-name">addSafe</span> <span class="org-haskell-operator">::</span> <span class="org-haskell-constructor">Maybe</span> <span class="org-haskell-constructor">Double</span> <span class="org-haskell-operator">-&gt;</span> <span class="org-haskell-constructor">Maybe</span> <span class="org-haskell-constructor">Double</span> <span class="org-haskell-operator">-&gt;</span> <span class="org-haskell-constructor">Maybe</span> <span class="org-haskell-constructor">Double</span> 
<span class="org-haskell-definition">addSafe</span> some_x some_y <span class="org-haskell-operator">=</span> <span class="org-haskell-keyword">do</span>
  x <span class="org-haskell-operator">&lt;-</span> some_x 
  y <span class="org-haskell-operator">&lt;-</span> some_y 
  return (x <span class="org-haskell-operator">+</span> y)


<span class="org-function-name">addOneSafe</span> <span class="org-haskell-operator">::</span> <span class="org-haskell-constructor">Maybe</span> <span class="org-haskell-constructor">Double</span> <span class="org-haskell-operator">-&gt;</span> <span class="org-haskell-constructor">Double</span> <span class="org-haskell-operator">-&gt;</span> <span class="org-haskell-constructor">Maybe</span> <span class="org-haskell-constructor">Double</span> 
<span class="org-haskell-definition">addOneSafe</span> a b <span class="org-haskell-operator">=</span> <span class="org-haskell-keyword">do</span>
  sa <span class="org-haskell-operator">&lt;-</span> a
  <span class="org-haskell-keyword">let</span> c <span class="org-haskell-operator">=</span>  3.0 <span class="org-haskell-operator">*</span> (b <span class="org-haskell-operator">+</span> sa)
  return (sa <span class="org-haskell-operator">+</span> c)
  

 <span class="org-comment-delimiter">-- </span><span class="org-comment">s - stands for Some  </span>
 <span class="org-comment-delimiter">--</span>
<span class="org-function-name">addSqrtSafe</span> <span class="org-haskell-operator">::</span> <span class="org-haskell-constructor">Double</span> <span class="org-haskell-operator">-&gt;</span> <span class="org-haskell-constructor">Double</span> <span class="org-haskell-operator">-&gt;</span> <span class="org-haskell-constructor">Maybe</span> <span class="org-haskell-constructor">Double</span> 
<span class="org-haskell-definition">addSqrtSafe</span> x y <span class="org-haskell-operator">=</span> <span class="org-haskell-keyword">do</span>
  sx <span class="org-haskell-operator">&lt;-</span> sqrtSafe x   
  sy <span class="org-haskell-operator">&lt;-</span> sqrtSafe y   
  return (sx <span class="org-haskell-operator">+</span> sy)

<span class="org-comment-delimiter">-- </span><span class="org-comment">addSqrtSafe desugarized </span>
<span class="org-comment-delimiter">--</span>
<span class="org-haskell-definition">addSqrtSafe2</span> x y <span class="org-haskell-operator">=</span> 
   sqrtSafe x <span class="org-haskell-operator">&gt;&gt;=</span> <span class="org-haskell-operator">\</span>sx <span class="org-haskell-operator">-&gt;</span>
   sqrtSafe y <span class="org-haskell-operator">&gt;&gt;=</span> <span class="org-haskell-operator">\</span>sy <span class="org-haskell-operator">-&gt;</span>
   return (sx <span class="org-haskell-operator">+</span>  sy)


 <span class="org-comment-delimiter">-- </span><span class="org-comment">End of test file </span>
 <span class="org-comment-delimiter">--</span><span class="org-comment">------------------------------</span>

<span class="org-haskell-operator">&gt;</span> <span class="org-haskell-constructor">:</span>load <span class="org-haskell-operator">/</span>tmp<span class="org-haskell-operator">/</span>test<span class="org-haskell-operator">.</span>hs 

<span class="org-haskell-operator">&gt;</span> <span class="org-haskell-constructor">:</span>t readMaybe
<span class="org-function-name">readMaybe</span> <span class="org-haskell-operator">::</span> <span class="org-haskell-constructor">Read</span> a <span class="org-haskell-operator">=&gt;</span> <span class="org-haskell-constructor">String</span> <span class="org-haskell-operator">-&gt;</span> <span class="org-haskell-constructor">Maybe</span> a
<span class="org-haskell-operator">&gt;</span> 

<span class="org-haskell-operator">&gt;</span> <span class="org-haskell-definition">parseInt</span> <span class="org-string">"100"</span> 
<span class="org-haskell-constructor">Just</span> 100


 <span class="org-comment-delimiter">-- </span><span class="org-comment">Returns nothing if computation fails </span>
 <span class="org-comment-delimiter">-- </span><span class="org-comment">instead of perform an exception </span>
 <span class="org-comment-delimiter">--</span>
<span class="org-haskell-operator">&gt;</span> <span class="org-haskell-definition">parseInt</span> <span class="org-string">"not an int."</span> 
<span class="org-haskell-constructor">Nothing</span>
<span class="org-haskell-operator">&gt;</span> 

<span class="org-haskell-operator">&gt;</span> <span class="org-haskell-definition">parseDouble</span> <span class="org-string">"1200"</span> 
<span class="org-haskell-constructor">Just</span> 1200.0
<span class="org-haskell-operator">&gt;</span> <span class="org-haskell-definition">parseDouble</span> <span class="org-string">"1200.232"</span> 
<span class="org-haskell-constructor">Just</span> 1200.232
<span class="org-haskell-operator">&gt;</span> <span class="org-haskell-definition">parseDouble</span> <span class="org-string">"12e3"</span> 
<span class="org-haskell-constructor">Just</span> 12000.0
<span class="org-haskell-operator">&gt;</span> <span class="org-haskell-definition">parseDouble</span> <span class="org-string">"not a valid number"</span> 
<span class="org-haskell-constructor">Nothing</span>
<span class="org-haskell-operator">&gt;</span> 


<span class="org-comment-delimiter">-- </span><span class="org-comment">This haskell function is safe, however in another language </span>
<span class="org-comment-delimiter">-- </span><span class="org-comment">it would yield a exception. </span>
<span class="org-comment-delimiter">--</span>
<span class="org-haskell-operator">&gt;</span> <span class="org-haskell-definition">sqrt</span> (<span class="org-haskell-operator">-</span>100.0)
<span class="org-haskell-constructor">NaN</span>
<span class="org-haskell-operator">&gt;</span> 

<span class="org-haskell-operator">&gt;</span> <span class="org-haskell-definition">sqrtSafe</span> (<span class="org-haskell-operator">-</span>1000.0)
<span class="org-haskell-constructor">Nothing</span>
<span class="org-haskell-operator">&gt;</span> 

<span class="org-haskell-operator">&gt;</span> <span class="org-haskell-definition">sqrtSafe</span> 100.0
<span class="org-haskell-constructor">Just</span> 10.0
<span class="org-haskell-operator">&gt;</span> 

<span class="org-comment-delimiter">-- </span><span class="org-comment">Thea function fmap is a generalization of map and applies a function </span>
<span class="org-comment-delimiter">-- </span><span class="org-comment">to the value wrapped in the monad. </span>
<span class="org-comment-delimiter">--</span>

<span class="org-haskell-operator">&gt;</span> <span class="org-haskell-constructor">:</span>t fmap
<span class="org-function-name">fmap</span> <span class="org-haskell-operator">::</span> <span class="org-haskell-constructor">Functor</span> f <span class="org-haskell-operator">=&gt;</span> (a <span class="org-haskell-operator">-&gt;</span> b) <span class="org-haskell-operator">-&gt;</span> f a <span class="org-haskell-operator">-&gt;</span> f b
<span class="org-haskell-operator">&gt;</span> 

<span class="org-haskell-operator">&gt;</span> <span class="org-haskell-definition">fmap</span> (<span class="org-haskell-operator">\</span>x <span class="org-haskell-operator">-&gt;</span> x <span class="org-haskell-operator">+</span> 1.0) (<span class="org-haskell-constructor">Just</span> 10.0)
<span class="org-haskell-constructor">Just</span> 11.0
<span class="org-haskell-operator">&gt;</span> <span class="org-haskell-definition">fmap</span> (<span class="org-haskell-operator">\</span>x <span class="org-haskell-operator">-&gt;</span> x <span class="org-haskell-operator">+</span> 1.0) <span class="org-haskell-constructor">Nothing</span> 
<span class="org-haskell-constructor">Nothing</span>
<span class="org-haskell-operator">&gt;</span>
<span class="org-haskell-operator">&gt;</span> <span class="org-haskell-definition">fmap</span> (<span class="org-haskell-operator">\</span>x <span class="org-haskell-operator">-&gt;</span> x <span class="org-haskell-operator">+</span> 1.0) (parseDouble <span class="org-string">"10.233"</span>) 
<span class="org-haskell-constructor">Just</span> 11.233
<span class="org-haskell-operator">&gt;</span> <span class="org-haskell-definition">fmap</span> (<span class="org-haskell-operator">\</span>x <span class="org-haskell-operator">-&gt;</span> x <span class="org-haskell-operator">+</span> 1.0) (parseDouble <span class="org-string">"ase10.2x3"</span>) 
<span class="org-haskell-constructor">Nothing</span>
<span class="org-haskell-operator">&gt;</span> 

<span class="org-comment-delimiter">--   </span><span class="org-comment">return function </span>
<span class="org-comment-delimiter">-- </span>

<span class="org-haskell-operator">&gt;</span> <span class="org-haskell-constructor">:</span>t return
<span class="org-function-name">return</span> <span class="org-haskell-operator">::</span> <span class="org-haskell-constructor">Monad</span> m <span class="org-haskell-operator">=&gt;</span> a <span class="org-haskell-operator">-&gt;</span> m a
<span class="org-haskell-operator">&gt;</span> 

 return 10 <span class="org-haskell-operator">::</span> <span class="org-haskell-constructor">Maybe</span> <span class="org-haskell-constructor">Int</span>
<span class="org-haskell-constructor">Just</span> 10
<span class="org-haskell-operator">&gt;</span> 

<span class="org-haskell-operator">&gt;</span> <span class="org-haskell-definition">return</span> <span class="org-string">"hello world"</span> <span class="org-haskell-operator">::</span> <span class="org-haskell-constructor">Maybe</span> <span class="org-haskell-constructor">String</span>
<span class="org-haskell-constructor">Just</span> <span class="org-string">"hello world"</span>
<span class="org-haskell-operator">&gt;</span> 


<span class="org-comment-delimiter">-- </span><span class="org-comment">Bind function </span>
<span class="org-comment-delimiter">--</span>
<span class="org-comment-delimiter">-- </span><span class="org-comment">The bind operator or funciton short circuits the computation if </span>
<span class="org-comment-delimiter">-- </span><span class="org-comment">it fails at any point </span>
<span class="org-comment-delimiter">-- </span>
<span class="org-comment-delimiter">--</span>

<span class="org-haskell-operator">&gt;</span> <span class="org-haskell-constructor">:</span>t (<span class="org-haskell-operator">&gt;&gt;=</span>)
(<span class="org-haskell-definition">&gt;&gt;=</span>) <span class="org-haskell-operator">::</span> <span class="org-haskell-constructor">Monad</span> m <span class="org-haskell-operator">=&gt;</span> m a <span class="org-haskell-operator">-&gt;</span> (a <span class="org-haskell-operator">-&gt;</span> m b) <span class="org-haskell-operator">-&gt;</span> m b
<span class="org-haskell-operator">&gt;</span> 

<span class="org-haskell-operator">&gt;</span> <span class="org-haskell-constructor">Just</span> <span class="org-string">"100.0"</span> <span class="org-haskell-operator">&gt;&gt;=</span> parseDouble <span class="org-haskell-operator">&gt;&gt;=</span> sqrtSafe
<span class="org-haskell-constructor">Just</span> 10.0
<span class="org-haskell-operator">&gt;</span> 
<span class="org-haskell-operator">&gt;</span> <span class="org-haskell-constructor">Nothing</span>  <span class="org-haskell-definition">&gt;&gt;=</span> parseDouble <span class="org-haskell-operator">&gt;&gt;=</span> sqrtSafe
<span class="org-haskell-constructor">Nothing</span>
<span class="org-haskell-operator">&gt;</span> 

<span class="org-haskell-operator">&gt;</span> <span class="org-haskell-definition">return</span> <span class="org-string">"100.0"</span> <span class="org-haskell-operator">&gt;&gt;=</span> parseDouble <span class="org-haskell-operator">&gt;&gt;=</span> sqrtSafe
<span class="org-haskell-constructor">Just</span> 10.0
<span class="org-haskell-operator">&gt;</span> 
<span class="org-haskell-operator">&gt;</span> <span class="org-haskell-definition">return</span> <span class="org-string">"-100.0"</span> <span class="org-haskell-operator">&gt;&gt;=</span> parseDouble <span class="org-haskell-operator">&gt;&gt;=</span> sqrtSafe
<span class="org-haskell-constructor">Nothing</span>
<span class="org-haskell-operator">&gt;</span> 



<span class="org-comment-delimiter">-- </span><span class="org-comment">Do noation </span>
<span class="org-comment-delimiter">--</span>
<span class="org-comment-delimiter">--</span>
<span class="org-comment-delimiter">-- </span><span class="org-comment">addSafe some_x some_y = do         addSafe = do </span>
<span class="org-comment-delimiter">--   </span><span class="org-comment">x &lt;- some_x                        some_x &gt;&gt;= \x -&gt;</span>
<span class="org-comment-delimiter">--   </span><span class="org-comment">y &lt;- some_y                 ==&gt;    some_y &gt;&gt;= \y -&gt;</span>
<span class="org-comment-delimiter">--   </span><span class="org-comment">return (x + y)                           return (x + y)</span>
<span class="org-comment-delimiter">--</span>
<span class="org-comment-delimiter">--</span>
<span class="org-comment-delimiter">--</span>
<span class="org-comment-delimiter">--</span>
<span class="org-comment-delimiter">--</span>
<span class="org-haskell-operator">&gt;</span> <span class="org-haskell-constructor">:</span>t addSafe
<span class="org-function-name">addSafe</span> <span class="org-haskell-operator">::</span> <span class="org-haskell-constructor">Maybe</span> <span class="org-haskell-constructor">Double</span> <span class="org-haskell-operator">-&gt;</span> <span class="org-haskell-constructor">Maybe</span> <span class="org-haskell-constructor">Double</span> <span class="org-haskell-operator">-&gt;</span> <span class="org-haskell-constructor">Maybe</span> <span class="org-haskell-constructor">Double</span>
<span class="org-haskell-operator">&gt;</span> 



<span class="org-haskell-operator">&gt;</span> <span class="org-haskell-definition">addSafe</span> (<span class="org-haskell-constructor">Just</span> 100.0) (<span class="org-haskell-constructor">Just</span> 20.0)
<span class="org-haskell-constructor">Just</span> 120.0
<span class="org-haskell-operator">&gt;</span> 

<span class="org-haskell-operator">&gt;</span> <span class="org-haskell-definition">addSafe</span> (<span class="org-haskell-constructor">Just</span> 100.0) <span class="org-haskell-constructor">Nothing</span>
<span class="org-haskell-constructor">Nothing</span>
<span class="org-haskell-operator">&gt;</span> 

<span class="org-haskell-operator">&gt;</span> <span class="org-haskell-definition">addSafe</span> <span class="org-haskell-constructor">Nothing</span> (<span class="org-haskell-constructor">Just</span> 100.0)
<span class="org-haskell-constructor">Nothing</span>
<span class="org-haskell-operator">&gt;</span> 

<span class="org-haskell-operator">&gt;</span> <span class="org-haskell-definition">addSafe</span> <span class="org-haskell-constructor">Nothing</span> <span class="org-haskell-constructor">Nothing</span>
<span class="org-haskell-constructor">Nothing</span>
<span class="org-haskell-operator">&gt;</span> 

<span class="org-haskell-operator">&gt;</span> <span class="org-haskell-definition">addSafe</span> (parseDouble <span class="org-string">"100.0"</span>) (sqrtSafe 400.0)
<span class="org-haskell-constructor">Just</span> 120.0
<span class="org-haskell-operator">&gt;</span> 

<span class="org-haskell-operator">&gt;</span> <span class="org-haskell-definition">addSafe</span> (<span class="org-haskell-constructor">Just</span> 100.0) (sqrtSafe (<span class="org-haskell-operator">-</span>20.0))
<span class="org-haskell-constructor">Nothing</span>
<span class="org-haskell-operator">&gt;</span> 

<span class="org-haskell-operator">&gt;</span> <span class="org-haskell-definition">addSafe</span> (parseDouble <span class="org-string">"asd100.0"</span>) (sqrtSafe 400.0)
<span class="org-haskell-constructor">Nothing</span>
<span class="org-haskell-operator">&gt;</span> 


<span class="org-haskell-operator">&gt;</span> <span class="org-haskell-constructor">:</span>t addSqrtSafe 
<span class="org-function-name">addSqrtSafe</span> <span class="org-haskell-operator">::</span> <span class="org-haskell-constructor">Double</span> <span class="org-haskell-operator">-&gt;</span> <span class="org-haskell-constructor">Double</span> <span class="org-haskell-operator">-&gt;</span> <span class="org-haskell-constructor">Maybe</span> <span class="org-haskell-constructor">Double</span>
<span class="org-haskell-operator">&gt;</span> 

<span class="org-haskell-operator">&gt;</span> <span class="org-haskell-definition">addSqrtSafe</span> 100.0 400.0
<span class="org-haskell-constructor">Just</span> 30.0
<span class="org-haskell-operator">&gt;</span> 

<span class="org-haskell-operator">&gt;</span> <span class="org-haskell-definition">addSqrtSafe</span> (<span class="org-haskell-operator">-</span>100.0) 400.0
<span class="org-haskell-constructor">Nothing</span>
<span class="org-haskell-operator">&gt;</span> 

<span class="org-haskell-operator">&gt;</span> <span class="org-haskell-definition">addSqrtSafe2</span> (<span class="org-haskell-operator">-</span>100.0) 400.0
<span class="org-haskell-constructor">Nothing</span>
<span class="org-haskell-operator">&gt;</span> <span class="org-haskell-definition">addSqrtSafe2</span> 100.0 400.0
<span class="org-haskell-constructor">Just</span> 30.0
<span class="org-haskell-operator">&gt;</span> 

<span class="org-haskell-operator">&gt;</span> <span class="org-haskell-definition">addOneSafe</span> (<span class="org-haskell-constructor">Just</span> 10.0) 20.0 
<span class="org-haskell-constructor">Just</span> 100.0
<span class="org-haskell-operator">&gt;</span> 
<span class="org-haskell-operator">&gt;</span> <span class="org-haskell-definition">addOneSafe</span> <span class="org-haskell-constructor">Nothing</span> 20.0 
<span class="org-haskell-constructor">Nothing</span>
<span class="org-haskell-operator">&gt;</span> 

<span class="org-haskell-operator">&gt;</span> <span class="org-haskell-definition">addOneSafe</span> (parseDouble <span class="org-string">"100.0"</span>) 20.0 
<span class="org-haskell-constructor">Just</span> 460.0
<span class="org-haskell-operator">&gt;</span>

<span class="org-haskell-operator">&gt;</span> <span class="org-haskell-definition">addOneSafe</span> (parseDouble <span class="org-string">"1dfd00.0"</span>) 20.0 
<span class="org-haskell-constructor">Nothing</span>
<span class="org-haskell-operator">&gt;</span>
</pre>
</div>
</div>
</div>

<div id="outline-container-sec-1-14-4-3" class="outline-5">
<h5 id="sec-1-14-4-3"><span class="section-number-5">1.14.4.3</span> Maybe Monad in OCaml</h5>
<div class="outline-text-5" id="text-1-14-4-3">
<p>
The maybe type is called Option in Ocaml and F#.
</p>

<div class="org-src-container">

<pre class="src src-ocaml"><span class="org-tuareg-font-lock-operator">-&gt;</span> <span class="org-tuareg-font-lock-constructor">Some</span> 100 <span class="org-tuareg-font-lock-operator">;;</span>
<span class="org-function-name">-</span> <span class="org-tuareg-font-lock-operator">:</span> int option <span class="org-tuareg-font-lock-operator">=</span> <span class="org-tuareg-font-lock-constructor">Some</span> 100
 

<span class="org-tuareg-font-lock-operator">-&gt;</span> <span class="org-tuareg-font-lock-constructor">None</span> <span class="org-tuareg-font-lock-operator">;;</span>
<span class="org-function-name">-</span> <span class="org-tuareg-font-lock-operator">:</span> 'a option <span class="org-tuareg-font-lock-operator">=</span> <span class="org-tuareg-font-lock-constructor">None</span>
 
<span class="org-tuareg-font-lock-governing">module</span> <span class="org-tuareg-font-lock-module">OptM</span> <span class="org-tuareg-font-lock-operator">=</span>
  <span class="org-tuareg-font-lock-governing">struct</span> 

    <span class="org-tuareg-font-lock-governing">let</span> <span class="org-function-name">unit</span><span class="org-variable-name"> x</span> <span class="org-tuareg-font-lock-operator">=</span> <span class="org-tuareg-font-lock-constructor">Some</span> x

    <span class="org-tuareg-font-lock-governing">let</span> <span class="org-function-name">bind</span><span class="org-variable-name"> ma f</span> <span class="org-tuareg-font-lock-operator">=</span>
      <span class="org-keyword">match</span> ma <span class="org-keyword">with</span>
      <span class="org-tuareg-font-lock-operator">|</span> <span class="org-tuareg-font-lock-constructor">Some</span> x  <span class="org-tuareg-font-lock-operator">-&gt;</span>  f x
      <span class="org-tuareg-font-lock-operator">|</span> <span class="org-tuareg-font-lock-constructor">None</span>    <span class="org-tuareg-font-lock-operator">-&gt;</span>  <span class="org-tuareg-font-lock-constructor">None</span> 

    <span class="org-tuareg-font-lock-governing">let</span> <span class="org-tuareg-font-lock-operator">(&gt;&gt;=)</span> <span class="org-tuareg-font-lock-operator">=</span> bind 

    <span class="org-comment-delimiter">(* </span><span class="org-comment">Haskell fmap </span><span class="org-comment-delimiter">*)</span>
    <span class="org-tuareg-font-lock-governing">let</span> <span class="org-function-name">map</span><span class="org-variable-name"> f ma</span> <span class="org-tuareg-font-lock-operator">=</span>
      <span class="org-keyword">match</span> ma <span class="org-keyword">with</span>
      <span class="org-tuareg-font-lock-operator">|</span> <span class="org-tuareg-font-lock-constructor">Some</span> x <span class="org-tuareg-font-lock-operator">-&gt;</span> <span class="org-tuareg-font-lock-constructor">Some</span> <span class="org-tuareg-font-lock-operator">(</span>f x<span class="org-tuareg-font-lock-operator">)</span>
      <span class="org-tuareg-font-lock-operator">|</span> <span class="org-tuareg-font-lock-constructor">None</span>   <span class="org-tuareg-font-lock-operator">-&gt;</span> <span class="org-tuareg-font-lock-constructor">None</span>   
     
  <span class="org-tuareg-font-lock-governing">end</span>


<span class="org-tuareg-font-lock-governing">module</span> <span class="org-tuareg-font-lock-module">OptM</span> <span class="org-tuareg-font-lock-operator">:</span>
  <span class="org-tuareg-font-lock-governing">sig</span>
    <span class="org-tuareg-font-lock-governing">val</span> <span class="org-function-name">unit</span> <span class="org-tuareg-font-lock-operator">:</span> 'a <span class="org-tuareg-font-lock-operator">-&gt;</span> 'a option
    <span class="org-tuareg-font-lock-governing">val</span> <span class="org-function-name">bind</span> <span class="org-tuareg-font-lock-operator">:</span> 'a option <span class="org-tuareg-font-lock-operator">-&gt;</span> <span class="org-tuareg-font-lock-operator">(</span>'a <span class="org-tuareg-font-lock-operator">-&gt;</span> 'b option<span class="org-tuareg-font-lock-operator">)</span> <span class="org-tuareg-font-lock-operator">-&gt;</span> 'b option
    <span class="org-tuareg-font-lock-governing">val</span> <span class="org-tuareg-font-lock-operator">(</span> <span class="org-tuareg-font-lock-operator">&gt;&gt;=</span> <span class="org-tuareg-font-lock-operator">)</span> <span class="org-tuareg-font-lock-operator">:</span> 'a option <span class="org-tuareg-font-lock-operator">-&gt;</span> <span class="org-tuareg-font-lock-operator">(</span>'a <span class="org-tuareg-font-lock-operator">-&gt;</span> 'b option<span class="org-tuareg-font-lock-operator">)</span> <span class="org-tuareg-font-lock-operator">-&gt;</span> 'b option
    <span class="org-tuareg-font-lock-governing">val</span> <span class="org-function-name">map</span> <span class="org-tuareg-font-lock-operator">:</span> <span class="org-tuareg-font-lock-operator">(</span>'a <span class="org-tuareg-font-lock-operator">-&gt;</span> 'b<span class="org-tuareg-font-lock-operator">)</span> <span class="org-tuareg-font-lock-operator">-&gt;</span> 'a option <span class="org-tuareg-font-lock-operator">-&gt;</span> 'b option
  <span class="org-tuareg-font-lock-governing">end</span>


<span class="org-tuareg-font-lock-operator">#</span>  <span class="org-tuareg-font-lock-module">OptM.</span>unit <span class="org-tuareg-font-lock-operator">;;</span>
<span class="org-function-name">-</span> <span class="org-tuareg-font-lock-operator">:</span> 'a <span class="org-tuareg-font-lock-operator">-&gt;</span> 'a option <span class="org-tuareg-font-lock-operator">=</span> <span class="org-tuareg-font-lock-operator">&lt;</span><span class="org-keyword">fun</span><span class="org-tuareg-font-lock-operator">&gt;</span>

<span class="org-tuareg-font-lock-operator">#</span> <span class="org-tuareg-font-lock-module">OptM.</span>bind <span class="org-tuareg-font-lock-operator">;;</span>
<span class="org-function-name">-</span> <span class="org-tuareg-font-lock-operator">:</span> 'a option <span class="org-tuareg-font-lock-operator">-&gt;</span> <span class="org-tuareg-font-lock-operator">(</span>'a <span class="org-tuareg-font-lock-operator">-&gt;</span> 'b option<span class="org-tuareg-font-lock-operator">)</span> <span class="org-tuareg-font-lock-operator">-&gt;</span> 'b option <span class="org-tuareg-font-lock-operator">=</span> <span class="org-tuareg-font-lock-operator">&lt;</span><span class="org-keyword">fun</span><span class="org-tuareg-font-lock-operator">&gt;</span>
<span class="org-tuareg-font-lock-operator">#</span> 

<span class="org-tuareg-font-lock-operator">#</span> <span class="org-tuareg-font-lock-module">OptM.</span>map <span class="org-tuareg-font-lock-operator">;;</span>
<span class="org-function-name">-</span> <span class="org-tuareg-font-lock-operator">:</span> <span class="org-tuareg-font-lock-operator">(</span>'a <span class="org-tuareg-font-lock-operator">-&gt;</span> 'b<span class="org-tuareg-font-lock-operator">)</span> <span class="org-tuareg-font-lock-operator">-&gt;</span> 'a option <span class="org-tuareg-font-lock-operator">-&gt;</span> 'b option <span class="org-tuareg-font-lock-operator">=</span> <span class="org-tuareg-font-lock-operator">&lt;</span><span class="org-keyword">fun</span><span class="org-tuareg-font-lock-operator">&gt;</span>
<span class="org-tuareg-font-lock-operator">#</span> 
    
<span class="org-tuareg-font-lock-operator">#</span> <span class="org-tuareg-font-lock-module">OptM.</span>map <span class="org-tuareg-font-lock-operator">(</span><span class="org-keyword">fun</span> <span class="org-variable-name">x</span> <span class="org-tuareg-font-lock-operator">-&gt;</span> x <span class="org-tuareg-font-lock-operator">+</span> 3<span class="org-tuareg-font-lock-operator">)</span> <span class="org-tuareg-font-lock-operator">(</span><span class="org-tuareg-font-lock-constructor">Some</span> 10<span class="org-tuareg-font-lock-operator">)</span> <span class="org-tuareg-font-lock-operator">;;</span>
<span class="org-function-name">-</span> <span class="org-tuareg-font-lock-operator">:</span> int option <span class="org-tuareg-font-lock-operator">=</span> <span class="org-tuareg-font-lock-constructor">Some</span> 13

<span class="org-tuareg-font-lock-operator">#</span>  <span class="org-tuareg-font-lock-module">OptM.</span>map <span class="org-tuareg-font-lock-operator">(</span><span class="org-keyword">fun</span> <span class="org-variable-name">x</span> <span class="org-tuareg-font-lock-operator">-&gt;</span> x <span class="org-tuareg-font-lock-operator">+</span> 3<span class="org-tuareg-font-lock-operator">)</span> <span class="org-tuareg-font-lock-constructor">None</span> <span class="org-tuareg-font-lock-operator">;;</span>
<span class="org-function-name">-</span> <span class="org-tuareg-font-lock-operator">:</span> int option <span class="org-tuareg-font-lock-operator">=</span> <span class="org-tuareg-font-lock-constructor">None</span>

<span class="org-tuareg-font-lock-operator">#</span>  float_of_string <span class="org-string">"100.23"</span> <span class="org-tuareg-font-lock-operator">;;</span>
<span class="org-function-name">-</span> <span class="org-tuareg-font-lock-operator">:</span> float <span class="org-tuareg-font-lock-operator">=</span> 100.23
<span class="org-tuareg-font-lock-operator">#</span> float_of_string <span class="org-string">"a100.23"</span> <span class="org-tuareg-font-lock-operator">;;</span>
<span class="org-function-name">Exception</span><span class="org-tuareg-font-lock-operator">:</span> <span class="org-tuareg-font-lock-constructor">Failure</span> <span class="org-string">"float_of_string"</span>.

<span class="org-tuareg-font-lock-governing">let</span> <span class="org-function-name">parseFloat</span><span class="org-variable-name"> x</span> <span class="org-tuareg-font-lock-operator">=</span> 
  <span class="org-keyword">try</span> <span class="org-tuareg-font-lock-constructor">Some</span> <span class="org-tuareg-font-lock-operator">(</span>float_of_string x<span class="org-tuareg-font-lock-operator">)</span>
  <span class="org-keyword">with</span> _ <span class="org-tuareg-font-lock-operator">-&gt;</span> <span class="org-tuareg-font-lock-constructor">None</span>
<span class="org-tuareg-font-lock-operator">;;</span>               

<span class="org-tuareg-font-lock-operator">#</span>  parseFloat <span class="org-string">"100.00"</span> <span class="org-tuareg-font-lock-operator">;;</span>
<span class="org-function-name">-</span> <span class="org-tuareg-font-lock-operator">:</span> float option <span class="org-tuareg-font-lock-operator">=</span> <span class="org-tuareg-font-lock-constructor">Some</span> 100.
<span class="org-tuareg-font-lock-operator">#</span> 
<span class="org-tuareg-font-lock-operator">#</span>  parseFloat <span class="org-string">"asds100.00"</span> <span class="org-tuareg-font-lock-operator">;;</span>
<span class="org-function-name">-</span> <span class="org-tuareg-font-lock-operator">:</span> float option <span class="org-tuareg-font-lock-operator">=</span> <span class="org-tuareg-font-lock-constructor">None</span>
<span class="org-tuareg-font-lock-operator">#</span> 

<span class="org-comment-delimiter">(*</span>

<span class="org-comment">addSafe :: Maybe Double -&gt; Maybe Double -&gt; Maybe Double </span>
<span class="org-comment">addSafe some_x some_y = do</span>
<span class="org-comment">  x &lt;- some_x </span>
<span class="org-comment">  y &lt;- some_y </span>
<span class="org-comment">  return (x + y) </span>

<span class="org-comment">addSafe some_x some_y = </span>
<span class="org-comment">  some_x &gt;&gt;= \x -&gt;</span>
<span class="org-comment">  some_y &gt;&gt;= \y -&gt;</span>
<span class="org-comment">  return (x + y)</span>

<span class="org-comment-delimiter">*)</span>

<span class="org-tuareg-font-lock-governing">let</span> <span class="org-function-name">addSafe</span><span class="org-variable-name"> sx sy</span> <span class="org-tuareg-font-lock-operator">=</span> 
    <span class="org-tuareg-font-lock-governing">let</span> <span class="org-tuareg-font-lock-governing">open </span><span class="org-tuareg-font-lock-module">OptM</span> <span class="org-tuareg-font-lock-governing">in</span> 
    sx <span class="org-tuareg-font-lock-operator">&gt;&gt;=</span> <span class="org-keyword">fun</span> <span class="org-variable-name">x</span> <span class="org-tuareg-font-lock-operator">-&gt;</span>
    sy <span class="org-tuareg-font-lock-operator">&gt;&gt;=</span> <span class="org-keyword">fun</span> <span class="org-variable-name">y</span> <span class="org-tuareg-font-lock-operator">-&gt;</span>
    unit <span class="org-tuareg-font-lock-operator">(</span>x <span class="org-tuareg-font-lock-operator">+.</span> y<span class="org-tuareg-font-lock-operator">)</span>
<span class="org-tuareg-font-lock-operator">;;</span>

<span class="org-tuareg-font-lock-governing">val</span> <span class="org-function-name">addSafe</span> <span class="org-tuareg-font-lock-operator">:</span> float option <span class="org-tuareg-font-lock-operator">-&gt;</span> float option <span class="org-tuareg-font-lock-operator">-&gt;</span> float option <span class="org-tuareg-font-lock-operator">=</span> <span class="org-tuareg-font-lock-operator">&lt;</span><span class="org-keyword">fun</span><span class="org-tuareg-font-lock-operator">&gt;</span>

<span class="org-tuareg-font-lock-operator">#</span> addSafe <span class="org-tuareg-font-lock-operator">(</span><span class="org-tuareg-font-lock-constructor">Some</span> 10.0<span class="org-tuareg-font-lock-operator">)</span> <span class="org-tuareg-font-lock-operator">(</span><span class="org-tuareg-font-lock-constructor">Some</span> 20.0<span class="org-tuareg-font-lock-operator">)</span> <span class="org-tuareg-font-lock-operator">;;</span>
<span class="org-function-name">-</span> <span class="org-tuareg-font-lock-operator">:</span> float option <span class="org-tuareg-font-lock-operator">=</span> <span class="org-tuareg-font-lock-constructor">Some</span> 30.
<span class="org-tuareg-font-lock-operator">#</span> addSafe <span class="org-tuareg-font-lock-constructor">None</span> <span class="org-tuareg-font-lock-operator">(</span><span class="org-tuareg-font-lock-constructor">Some</span> 20.0<span class="org-tuareg-font-lock-operator">)</span> <span class="org-tuareg-font-lock-operator">;;</span>
<span class="org-function-name">-</span> <span class="org-tuareg-font-lock-operator">:</span> float option <span class="org-tuareg-font-lock-operator">=</span> <span class="org-tuareg-font-lock-constructor">None</span>
<span class="org-tuareg-font-lock-operator">#</span> addSafe <span class="org-tuareg-font-lock-constructor">None</span> <span class="org-tuareg-font-lock-constructor">None</span> <span class="org-tuareg-font-lock-operator">;;</span>
<span class="org-function-name">-</span> <span class="org-tuareg-font-lock-operator">:</span> float option <span class="org-tuareg-font-lock-operator">=</span> <span class="org-tuareg-font-lock-constructor">None</span>
<span class="org-tuareg-font-lock-operator">#</span> 


<span class="org-comment-delimiter">(*</span>

<span class="org-comment">If Haskell functions were impure it would work:</span>

<span class="org-comment">addInputsSafe () = do</span>
<span class="org-comment">  x &lt;- parseDouble (readLine ())</span>
<span class="org-comment">  y &lt;- parseDouble (readLine ())</span>
<span class="org-comment">  z &lt;- parseDouble (readLine ())</span>
<span class="org-comment">  return (x + y + z)</span>

<span class="org-comment">addInputsSafe some_x some_y = </span>
<span class="org-comment">   readLine () &gt;&gt;= \x -&gt;</span>
<span class="org-comment">   readLine () &gt;&gt;= \y -&gt;</span>
<span class="org-comment">   readLine () &gt;&gt;= \x -&gt; </span>
<span class="org-comment">   return (x + y + z)</span>
<span class="org-comment-delimiter">*)</span>


<span class="org-tuareg-font-lock-governing">let</span> <span class="org-function-name">prompt</span><span class="org-variable-name">  message</span> <span class="org-tuareg-font-lock-operator">=</span> 
    print_string message <span class="org-tuareg-font-lock-operator">;</span>
    parseFloat <span class="org-tuareg-font-lock-operator">(</span>read_line<span class="org-tuareg-font-lock-operator">())</span>
<span class="org-tuareg-font-lock-operator">;;</span>

<span class="org-tuareg-font-lock-governing">val</span> <span class="org-function-name">prompt</span> <span class="org-tuareg-font-lock-operator">:</span> string <span class="org-tuareg-font-lock-operator">-&gt;</span> float option <span class="org-tuareg-font-lock-operator">=</span> <span class="org-tuareg-font-lock-operator">&lt;</span><span class="org-keyword">fun</span><span class="org-tuareg-font-lock-operator">&gt;</span>

<span class="org-tuareg-font-lock-governing">let</span> <span class="org-function-name">addInputsSafe</span><span class="org-variable-name"> </span><span class="org-tuareg-font-lock-operator">()</span> <span class="org-tuareg-font-lock-operator">=</span> 
    <span class="org-tuareg-font-lock-governing">let</span> <span class="org-tuareg-font-lock-governing">open </span><span class="org-tuareg-font-lock-module">OptM</span> <span class="org-tuareg-font-lock-governing">in</span> 
    prompt <span class="org-string">"Enter x: "</span>  <span class="org-tuareg-font-lock-operator">&gt;&gt;=</span> <span class="org-keyword">fun</span> <span class="org-variable-name">x</span> <span class="org-tuareg-font-lock-operator">-&gt;</span>
    prompt <span class="org-string">"Enter y: "</span>  <span class="org-tuareg-font-lock-operator">&gt;&gt;=</span> <span class="org-keyword">fun</span> <span class="org-variable-name">y</span> <span class="org-tuareg-font-lock-operator">-&gt;</span>
    prompt <span class="org-string">"Enter z: "</span>  <span class="org-tuareg-font-lock-operator">&gt;&gt;=</span> <span class="org-keyword">fun</span> <span class="org-variable-name">z</span> <span class="org-tuareg-font-lock-operator">-&gt;</span>
    unit <span class="org-tuareg-font-lock-operator">(</span>print_float  <span class="org-tuareg-font-lock-operator">(</span>x <span class="org-tuareg-font-lock-operator">+.</span> y <span class="org-tuareg-font-lock-operator">+.</span> z<span class="org-tuareg-font-lock-operator">))</span>
<span class="org-tuareg-font-lock-operator">;;</span>

<span class="org-tuareg-font-lock-governing">val</span> <span class="org-function-name">addInputsSafe</span> <span class="org-tuareg-font-lock-operator">:</span> unit <span class="org-tuareg-font-lock-operator">-&gt;</span> unit option <span class="org-tuareg-font-lock-operator">=</span> <span class="org-tuareg-font-lock-operator">&lt;</span><span class="org-keyword">fun</span><span class="org-tuareg-font-lock-operator">&gt;</span>

<span class="org-comment-delimiter">(* </span><span class="org-comment">It will stop the computation if any input is invalid </span><span class="org-comment-delimiter">*)</span>

<span class="org-tuareg-font-lock-operator">#</span> addInputsSafe <span class="org-tuareg-font-lock-operator">()</span> <span class="org-tuareg-font-lock-operator">;;</span>
<span class="org-tuareg-font-lock-constructor">Enter</span> x<span class="org-tuareg-font-lock-operator">:</span> 10.0
<span class="org-tuareg-font-lock-constructor">Enter</span> y<span class="org-tuareg-font-lock-operator">:</span> 20.0
<span class="org-tuareg-font-lock-constructor">Enter</span> z<span class="org-tuareg-font-lock-operator">:</span> 30.0
<span class="org-function-name">60.-</span> <span class="org-tuareg-font-lock-operator">:</span> unit option <span class="org-tuareg-font-lock-operator">=</span> <span class="org-tuareg-font-lock-constructor">Some</span> <span class="org-tuareg-font-lock-operator">()</span>
<span class="org-tuareg-font-lock-operator">#</span> 

<span class="org-tuareg-font-lock-operator">#</span> addInputsSafe <span class="org-tuareg-font-lock-operator">()</span> <span class="org-tuareg-font-lock-operator">;;</span>
<span class="org-tuareg-font-lock-constructor">Enter</span> x<span class="org-tuareg-font-lock-operator">:</span> 20.0
<span class="org-tuareg-font-lock-constructor">Enter</span> y<span class="org-tuareg-font-lock-operator">:</span> dsfd
<span class="org-function-name">-</span> <span class="org-tuareg-font-lock-operator">:</span> unit option <span class="org-tuareg-font-lock-operator">=</span> <span class="org-tuareg-font-lock-constructor">None</span>
<span class="org-tuareg-font-lock-operator">#</span> 

<span class="org-function-name">-</span> <span class="org-tuareg-font-lock-operator">:</span>  addInputsSafe <span class="org-tuareg-font-lock-operator">()</span> <span class="org-tuareg-font-lock-operator">;;</span>
<span class="org-tuareg-font-lock-constructor">Enter</span> x<span class="org-tuareg-font-lock-operator">:</span> 20.0
<span class="org-tuareg-font-lock-constructor">Enter</span> y<span class="org-tuareg-font-lock-operator">:</span> 30.0
<span class="org-tuareg-font-lock-constructor">Enter</span> z<span class="org-tuareg-font-lock-operator">:</span> a20afdf
<span class="org-function-name">-</span> <span class="org-tuareg-font-lock-operator">:</span> unit option <span class="org-tuareg-font-lock-operator">=</span> <span class="org-tuareg-font-lock-constructor">None</span>

<span class="org-tuareg-font-lock-operator">#</span> addInputsSafe <span class="org-tuareg-font-lock-operator">()</span> <span class="org-tuareg-font-lock-operator">;;</span>
<span class="org-tuareg-font-lock-constructor">Enter</span> x<span class="org-tuareg-font-lock-operator">:</span> erew34
<span class="org-function-name">-</span> <span class="org-tuareg-font-lock-operator">:</span> unit option <span class="org-tuareg-font-lock-operator">=</span> <span class="org-tuareg-font-lock-constructor">None</span>
<span class="org-tuareg-font-lock-operator">#</span>
</pre>
</div>
</div>
</div>

<div id="outline-container-sec-1-14-4-4" class="outline-5">
<h5 id="sec-1-14-4-4"><span class="section-number-5">1.14.4.4</span> Maybe Monad in Python</h5>
<div class="outline-text-5" id="text-1-14-4-4">
<p>
<b>Implementation with Functions</b>
</p>

<div class="org-src-container">

<pre class="src src-python"><span class="org-keyword">import</span> collections 

<span class="org-variable-name">Option</span> = collections.namedtuple(<span class="org-string">"Option"</span>, [<span class="org-string">"value"</span>])

<span class="org-comment-delimiter"># </span><span class="org-comment">Nothing </span>
<span class="org-variable-name">none</span> = Option(<span class="org-constant">None</span>)

<span class="org-comment-delimiter"># </span><span class="org-comment">Just </span>
<span class="org-variable-name">some</span> = Option

<span class="org-comment-delimiter"># </span><span class="org-comment">Haskell's return statement </span>
<span class="org-comment-delimiter">#</span>
<span class="org-variable-name">unit_option</span> = some 

<span class="org-keyword">def</span> <span class="org-function-name">isOption</span>(obj):
    <span class="org-keyword">return</span> <span class="org-builtin">isinstance</span>(obj, Option)

<span class="org-keyword">def</span> <span class="org-function-name">isOptionException</span>(obj):
    <span class="org-keyword">if</span> <span class="org-builtin">isinstance</span> (obj, Option):
        <span class="org-keyword">return</span> obj
    <span class="org-keyword">else</span>:
        <span class="org-keyword">raise</span> <span class="org-type">ValueError</span> (<span class="org-string">"Expected an instance of Option"</span>)
        
<span class="org-comment-delimiter"># </span><span class="org-comment">isJust </span>
<span class="org-keyword">def</span> <span class="org-function-name">isSome</span> (opt):
    <span class="org-keyword">return</span> <span class="org-keyword">not</span> (isOptionException(opt).value == <span class="org-constant">None</span>)
    
<span class="org-comment-delimiter"># </span><span class="org-comment">isNothing </span>
<span class="org-keyword">def</span> <span class="org-function-name">isNone</span> (opt):
    <span class="org-keyword">return</span> <span class="org-keyword">not</span>(isSome (opt))

<span class="org-keyword">def</span> <span class="org-function-name">fmap_option</span>(fn, opt):
    <span class="org-keyword">if</span> isSome(opt):
        <span class="org-keyword">return</span> some(fn(opt.value))
    <span class="org-keyword">else</span>:
        <span class="org-keyword">return</span> none 
        
<span class="org-keyword">def</span> <span class="org-function-name">bind_option</span>(opt, fn):
    <span class="org-keyword">if</span> isSome(opt):
        <span class="org-keyword">return</span> fn(opt.value)
    <span class="org-keyword">else</span>:
        <span class="org-keyword">return</span> none

<span class="org-keyword">def</span> <span class="org-function-name">parseFloat</span> (x):
    <span class="org-string">"parseFloat :: string -&gt; Option float"</span>
    <span class="org-keyword">try</span>:
        <span class="org-keyword">return</span> some(<span class="org-builtin">float</span>(x))
    <span class="org-keyword">except</span> <span class="org-type">ValueError</span>:
        <span class="org-keyword">return</span> none

   
<span class="org-keyword">def</span> <span class="org-function-name">addSafe</span>(opt_x, opt_y):
    <span class="org-string">"</span>
<span class="org-string">    addSafe :: option float -&gt; option float -&gt; option float</span>
<span class="org-string"> </span>
<span class="org-string"> </span>
<span class="org-string">    The same as Haskell </span>

<span class="org-string">    addSafe Maybe Double -&gt; Maybe Double -&gt; Maybe Double </span>
<span class="org-string">    addSafe opt_x opt_y = do</span>
<span class="org-string">      x &lt;- opt_x </span>
<span class="org-string">      y &lt;- opt_y </span>
<span class="org-string">      return (x + y)</span>

<span class="org-string">   addSafe opt_x opt_y =</span>
<span class="org-string">     opt_x &gt;&gt;= \x -&gt;</span>
<span class="org-string">     opt_y &gt;&gt;= \y -&gt; </span>
<span class="org-string">     return (x + y) </span>
<span class="org-string">  </span>

<span class="org-string">    "</span>
    <span class="org-keyword">return</span> bind_option(opt_x, <span class="org-keyword">lambda</span> x:
           bind_option(opt_y, <span class="org-keyword">lambda</span> y:
                       unit_option (x + y)))


<span class="org-keyword">def</span> <span class="org-function-name">prompt</span>(message):
    
    <span class="org-string">"prompt :: string -&gt; Option float"</span>
    
    <span class="org-keyword">print</span> (message)
    <span class="org-keyword">return</span> parseFloat(<span class="org-builtin">input</span> ())

<span class="org-keyword">def</span> <span class="org-function-name">addInputsSafe</span> ():
    <span class="org-keyword">return</span> bind_option(prompt(<span class="org-string">"Enter x:"</span>), <span class="org-keyword">lambda</span> x:
           bind_option(prompt(<span class="org-string">"Enter y:"</span>), <span class="org-keyword">lambda</span> y:
           bind_option(prompt(<span class="org-string">"Enter z:"</span>), <span class="org-keyword">lambda</span> z:
                       unit_option (x + y + z))))

&gt;&gt;&gt; some(100)
Option(value=100)
&gt;&gt;&gt; none
Option(value=<span class="org-constant">None</span>)
&gt;&gt;&gt;       

&gt;&gt;&gt; fmap_option(<span class="org-keyword">lambda</span> x: x * 5, some(10))
Option(value=50)
&gt;&gt;&gt; 
&gt;&gt;&gt; fmap_option(<span class="org-keyword">lambda</span> x: x * 5, none)
Option(value=<span class="org-constant">None</span>)
&gt;&gt;&gt; 

&gt;&gt;&gt; addSafe(some(100), none)
Option(value=<span class="org-constant">None</span>)
&gt;&gt;&gt; addSafe(some(100), some(200))
Option(value=300)
&gt;&gt;&gt; addSafe(none, none)
Option(value=<span class="org-constant">None</span>)
&gt;&gt;&gt; 

&gt;&gt;&gt; <span class="org-builtin">float</span>(<span class="org-string">"10asdas023"</span>)
Traceback (most recent call last):
  File <span class="org-string">"&lt;stdin&gt;"</span>, line 1, <span class="org-keyword">in</span> &lt;module&gt;
<span class="org-function-name">ValueError</span>: could <span class="org-keyword">not</span> convert string to <span class="org-builtin">float</span>: <span class="org-string">'10asdas023'</span>
&gt;&gt;&gt; 

&gt;&gt;&gt; parseFloat(<span class="org-string">"100.0"</span>)
Option(value=100.0)
&gt;&gt;&gt; parseFloat(<span class="org-string">"10asda0.0"</span>)
Option(value=<span class="org-constant">None</span>)
&gt;&gt;&gt; 
                
&gt;&gt;&gt; addSafe(parseFloat(<span class="org-string">"100"</span>), parseFloat(<span class="org-string">"200"</span>))
Option(value=300.0)
&gt;&gt;&gt; 
&gt;&gt;&gt; addSafe(parseFloat(<span class="org-string">"100"</span>), parseFloat(<span class="org-string">"2dsfsd00"</span>))
Option(value=<span class="org-constant">None</span>)
&gt;&gt;&gt; 
&gt;&gt;&gt;    
    
&gt;&gt;&gt; addSafe(parseFloat(<span class="org-string">"asdas"</span>), parseFloat(<span class="org-string">"2dsfsd00"</span>))
Option(value=<span class="org-constant">None</span>)
&gt;&gt;&gt;

<span class="org-comment-delimiter">#</span>
<span class="org-comment-delimiter">#  </span><span class="org-comment">Computation is stopped if any step go wrong </span>
<span class="org-comment-delimiter">#</span>
&gt;&gt;&gt; 
&gt;&gt;&gt; addInputsSafe ()
Enter x:
100
Enter y:
200
Enter z:
300
Option(value=600.0)
&gt;&gt;&gt; 
&gt;&gt;&gt; addInputsSafe ()
Enter x:
asdsa
Option(value=<span class="org-constant">None</span>)
&gt;&gt;&gt; 
&gt;&gt;&gt; addInputsSafe ()
Enter x:
100
Enter y:
sadas
Option(value=<span class="org-constant">None</span>)
&gt;&gt;&gt;
</pre>
</div>

<p>
<b>Implementation with Class</b>
</p>

<div class="org-src-container">

<pre class="src src-python"><span class="org-keyword">class</span> <span class="org-type">Option</span>():

    <span class="org-keyword">def</span> <span class="org-function-name">__init__</span>(<span class="org-keyword">self</span>, value):
        <span class="org-keyword">self</span>.value = value

    <span class="org-keyword">def</span> <span class="org-function-name">__str__</span>(<span class="org-keyword">self</span>):
        <span class="org-keyword">if</span> <span class="org-keyword">self</span>.isSome():
            <span class="org-keyword">return</span> <span class="org-string">"some {}"</span>.<span class="org-builtin">format</span>(<span class="org-keyword">self</span>.value)
        <span class="org-keyword">else</span>:
            <span class="org-keyword">return</span> <span class="org-string">"none"</span>

    <span class="org-keyword">def</span> <span class="org-function-name">__repr__</span>(<span class="org-keyword">self</span>):
        <span class="org-keyword">return</span> <span class="org-keyword">self</span>.__str__()

    <span class="org-keyword">def</span> <span class="org-function-name">isSome</span> (<span class="org-keyword">self</span>):
        <span class="org-keyword">return</span> (<span class="org-keyword">self</span>.value != <span class="org-constant">None</span>)

    <span class="org-keyword">def</span> <span class="org-function-name">isNone</span> (<span class="org-keyword">self</span>):
        <span class="org-keyword">return</span> (<span class="org-keyword">self</span>.value == <span class="org-constant">None</span>)

    <span class="org-comment-delimiter"># </span><span class="org-comment">fmap </span>
    <span class="org-keyword">def</span> <span class="org-function-name">map</span>(<span class="org-keyword">self</span>, fn):
        <span class="org-keyword">if</span> <span class="org-keyword">self</span>.isSome():
            <span class="org-keyword">return</span> Option(fn(<span class="org-keyword">self</span>.value))
        <span class="org-keyword">else</span>:
            <span class="org-keyword">return</span> Option(<span class="org-constant">None</span>)

    <span class="org-keyword">def</span> <span class="org-function-name">bind</span>(<span class="org-keyword">self</span>, fn):
        <span class="org-keyword">if</span> <span class="org-keyword">self</span>.isSome():
            <span class="org-keyword">return</span> fn(<span class="org-keyword">self</span>.value)
        <span class="org-keyword">else</span>:
            <span class="org-keyword">return</span> Option(<span class="org-constant">None</span>)
        
<span class="org-variable-name">some</span> = Option
<span class="org-variable-name">none</span> = Option(<span class="org-constant">None</span>)

<span class="org-keyword">def</span> <span class="org-function-name">parseFloat</span> (x):
    <span class="org-string">"parseFloat :: string -&gt; Option float"</span>
    <span class="org-keyword">try</span>:
        <span class="org-keyword">return</span> some(<span class="org-builtin">float</span>(x))
    <span class="org-keyword">except</span> <span class="org-type">ValueError</span>:
        <span class="org-keyword">return</span> none


&gt;&gt;&gt; parseFloat(<span class="org-string">"100.23"</span>)
Option(value=100.23)

&gt;&gt;&gt; parseFloat(<span class="org-string">"100asdas.23"</span>)
Option(value=<span class="org-constant">None</span>)
&gt;&gt;&gt; 

&gt;&gt;&gt; parseFloat(<span class="org-string">"10.5"</span>).<span class="org-builtin">map</span>(<span class="org-keyword">lambda</span> x: x * 3)
some 31.5
&gt;&gt;&gt; parseFloat(<span class="org-string">"1sdfsd0.5"</span>).<span class="org-builtin">map</span>(<span class="org-keyword">lambda</span> x: x * 3)
none
&gt;&gt;&gt; 

&gt;&gt;&gt; 
(parseFloat(<span class="org-string">"10.5"</span>)
 .<span class="org-builtin">map</span>(<span class="org-keyword">lambda</span> x: x * 3)
 .<span class="org-builtin">map</span>(<span class="org-keyword">lambda</span> x: x + 4)
 .<span class="org-builtin">map</span>(<span class="org-keyword">lambda</span> x: x * x)
 )
&gt;&gt;&gt; ... ... ... ... some 1260.25
&gt;&gt;&gt; 

&gt;&gt;&gt; 
(parseFloat(<span class="org-string">"10asdas.5"</span>)
 .<span class="org-builtin">map</span>(<span class="org-keyword">lambda</span> x: x * 3)
 .<span class="org-builtin">map</span>(<span class="org-keyword">lambda</span> x: x + 4)
 .<span class="org-builtin">map</span>(<span class="org-keyword">lambda</span> x: x * x)
 )
&gt;&gt;&gt; ... ... ... ... none
&gt;&gt;&gt; 

&gt;&gt;&gt; some(<span class="org-string">"10.5"</span>).bind(parseFloat)
some 10.5
&gt;&gt;&gt; 

&gt;&gt;&gt; some(<span class="org-string">"1sdf0.5"</span>).bind(parseFloat)
none
&gt;&gt;&gt; 

&gt;&gt;&gt; some(<span class="org-string">"10.5"</span>).bind(parseFloat).<span class="org-builtin">map</span>(<span class="org-keyword">lambda</span> x: x + 10)
some 20.5
&gt;&gt;&gt; some(<span class="org-string">"10sdf.5"</span>).bind(parseFloat).<span class="org-builtin">map</span>(<span class="org-keyword">lambda</span> x: x + 10)
none
&gt;&gt;&gt; 

                                        <span class="org-comment-delimiter"># </span><span class="org-comment">Haskell's code </span>
                                        <span class="org-comment-delimiter"># </span>
<span class="org-keyword">def</span> <span class="org-function-name">addSafe</span>(opt_x, opt_y):              <span class="org-comment-delimiter"># </span><span class="org-comment">addSafe opt_x opt_y =          addSafe opt_x opt_y =</span>
    <span class="org-keyword">return</span> opt_x.bind(<span class="org-keyword">lambda</span> x:         <span class="org-comment-delimiter">#         </span><span class="org-comment">opt_x &gt;&gt;= \x -&gt;                bind opt_x (\x -&gt;</span>
           opt_y.bind(<span class="org-keyword">lambda</span> y:         <span class="org-comment-delimiter">#         </span><span class="org-comment">opt_y &gt;&gt;= \y -&gt;    ==&gt;         bind opt_y (\y -&gt;</span>
                      Option(x + y)))   <span class="org-comment-delimiter">#         </span><span class="org-comment">return (x + y)                 return (x + y)))</span>

&gt;&gt;&gt; 
&gt;&gt;&gt; addSafe(some(10), some(20))
some 30
&gt;&gt;&gt; addSafe(some(10), none)
none
&gt;&gt;&gt; addSafe(none, none)
none
&gt;&gt;&gt; addSafe(none, some(30))
none
&gt;&gt;&gt; addSafe(parseFloat(<span class="org-string">"10"</span>), parseFloat(<span class="org-string">"15"</span>))
some 25.0
&gt;&gt;&gt; 
&gt;&gt;&gt; addSafe(parseFloat(<span class="org-string">"10"</span>), parseFloat(<span class="org-string">"1asd5"</span>))
none
&gt;&gt;&gt; addSafe(parseFloat(<span class="org-string">"1asd0"</span>), parseFloat(<span class="org-string">"1asd5"</span>))
none
&gt;&gt;&gt;
</pre>
</div>
</div>
</div>
</div>

<div id="outline-container-sec-1-14-5" class="outline-4">
<h4 id="sec-1-14-5"><span class="section-number-4">1.14.5</span> Either Monad</h4>
<div class="outline-text-4" id="text-1-14-5">
</div><div id="outline-container-sec-1-14-5-1" class="outline-5">
<h5 id="sec-1-14-5-1"><span class="section-number-5">1.14.5.1</span> Overview</h5>
<div class="outline-text-5" id="text-1-14-5-1">
<p>
The Either type is an extension of Maybe, it end a computation if any
step fails. Unlike Maybe it can indicate the source of the error. It
represents two values Right that holds a correct value (mneumonic
"right" meaning correct) and the constructor Left that holds an error value.
</p>

<p>
The module <a href="https://downloads.haskell.org/~ghc/6.12.2/docs/html/libraries/base-4.2.0.1/Data-Either.html">Data.Either</a> has combinators to manipulate the Either type.
</p>

<p>
From: <a href="https://hackage.haskell.org/package/category-extras-0.53.4/docs/src/Control-Monad-Either.html">src/Control/Monad/Either.hs</a>
</p>


<div class="org-src-container">

<pre class="src src-haskell"><span class="org-haskell-keyword">data</span> <span class="org-haskell-constructor">Either</span> a b <span class="org-haskell-operator">=</span> <span class="org-haskell-constructor">Left</span> a <span class="org-haskell-operator">|</span> <span class="org-haskell-constructor">Right</span> b <span class="org-haskell-keyword">deriving</span> (<span class="org-haskell-constructor">Eq</span><span class="org-haskell-operator">,</span> <span class="org-haskell-constructor">Show</span>)

<span class="org-haskell-keyword">instance</span> <span class="org-haskell-constructor">Monad</span> (<span class="org-haskell-constructor">Either</span> e) <span class="org-haskell-keyword">where</span>
        return <span class="org-haskell-operator">=</span> <span class="org-haskell-constructor">Right</span>

        <span class="org-haskell-constructor">Right</span> m <span class="org-haskell-operator">&gt;&gt;=</span> k <span class="org-haskell-operator">=</span> k m
        <span class="org-haskell-constructor">Left</span> e  <span class="org-haskell-operator">&gt;&gt;=</span> <span class="org-haskell-keyword">_</span> <span class="org-haskell-operator">=</span> <span class="org-haskell-constructor">Left</span> e
</pre>
</div>
</div>
</div>

<div id="outline-container-sec-1-14-5-2" class="outline-5">
<h5 id="sec-1-14-5-2"><span class="section-number-5">1.14.5.2</span> Example</h5>
<div class="outline-text-5" id="text-1-14-5-2">
<p>
file: either_monad.hs 
</p>

<div class="org-src-container">

<pre class="src src-haskell"><span class="org-comment-delimiter">--  </span><span class="org-comment">File: either_monad.hs</span>
<span class="org-comment-delimiter">--</span><span class="org-comment">----------------------------</span>

<span class="org-haskell-keyword">import</span> <span class="org-haskell-constructor">Text.Read</span> (readMaybe)

<span class="org-haskell-keyword">data</span> <span class="org-haskell-constructor">ErrorCode</span> <span class="org-haskell-operator">=</span> 
        <span class="org-haskell-constructor">ParserError</span> 
      <span class="org-haskell-operator">|</span> <span class="org-haskell-constructor">InvalidInput</span> 
      <span class="org-haskell-keyword">deriving</span> (<span class="org-haskell-constructor">Eq</span><span class="org-haskell-operator">,</span> <span class="org-haskell-constructor">Show</span>)

<span class="org-haskell-definition">describeErrorCode</span> <span class="org-haskell-constructor">ParserError</span>  <span class="org-haskell-operator">=</span> <span class="org-string">"The parser failed."</span> 
<span class="org-haskell-definition">describeErrorCode</span> <span class="org-haskell-constructor">InvalidInput</span> <span class="org-haskell-operator">=</span> <span class="org-string">"Input out function domain."</span>

<span class="org-haskell-definition">describeError</span> (<span class="org-haskell-constructor">Right</span> x)    <span class="org-haskell-operator">=</span> <span class="org-haskell-constructor">Right</span> x 
<span class="org-haskell-definition">describeError</span> (<span class="org-haskell-constructor">Left</span>  code) <span class="org-haskell-operator">=</span> <span class="org-haskell-constructor">Left</span> (describeErrorCode code)

<span class="org-function-name">parseDouble2</span> <span class="org-haskell-operator">::</span> <span class="org-haskell-constructor">String</span> <span class="org-haskell-operator">-&gt;</span> <span class="org-haskell-constructor">Either</span> <span class="org-haskell-constructor">ErrorCode</span> <span class="org-haskell-constructor">Double</span> 
<span class="org-haskell-definition">parseDouble2</span>  str <span class="org-haskell-operator">=</span> 
    <span class="org-haskell-keyword">case</span> (readMaybe str <span class="org-haskell-operator">::</span> <span class="org-haskell-constructor">Maybe</span> <span class="org-haskell-constructor">Double</span>) <span class="org-haskell-keyword">of</span>
    <span class="org-haskell-constructor">Just</span> x  <span class="org-haskell-operator">-&gt;</span>  <span class="org-haskell-constructor">Right</span> x 
    <span class="org-haskell-constructor">Nothing</span> <span class="org-haskell-operator">-&gt;</span>  <span class="org-haskell-constructor">Left</span>  <span class="org-haskell-constructor">ParserError</span>


<span class="org-function-name">sqrt_safe2</span> <span class="org-haskell-operator">::</span> <span class="org-haskell-constructor">Double</span> <span class="org-haskell-operator">-&gt;</span> <span class="org-haskell-constructor">Either</span> <span class="org-haskell-constructor">ErrorCode</span> <span class="org-haskell-constructor">Double</span> 
<span class="org-haskell-definition">sqrt_safe2</span> x <span class="org-haskell-operator">=</span> 
    <span class="org-haskell-keyword">if</span> x <span class="org-haskell-operator">&gt;=</span> 0 
    <span class="org-haskell-keyword">then</span> (<span class="org-haskell-constructor">Right</span> x)
    <span class="org-haskell-keyword">else</span> (<span class="org-haskell-constructor">Left</span> <span class="org-haskell-constructor">InvalidInput</span>)


<span class="org-function-name">addSafe1</span> <span class="org-haskell-operator">::</span> <span class="org-haskell-constructor">Either</span> err <span class="org-haskell-constructor">Double</span> <span class="org-haskell-operator">-&gt;</span> <span class="org-haskell-constructor">Either</span> err <span class="org-haskell-constructor">Double</span> <span class="org-haskell-operator">-&gt;</span> <span class="org-haskell-constructor">Either</span> err <span class="org-haskell-constructor">Double</span> 
<span class="org-haskell-definition">addSafe1</span> ex ey <span class="org-haskell-operator">=</span> <span class="org-haskell-keyword">do</span>
  x <span class="org-haskell-operator">&lt;-</span> ex
  y <span class="org-haskell-operator">&lt;-</span> ey 
  return <span class="org-haskell-operator">$</span> x <span class="org-haskell-operator">+</span> y 

<span class="org-function-name">addSafe2</span> <span class="org-haskell-operator">::</span> <span class="org-haskell-constructor">Either</span> err <span class="org-haskell-constructor">Double</span> <span class="org-haskell-operator">-&gt;</span> <span class="org-haskell-constructor">Either</span> err <span class="org-haskell-constructor">Double</span> <span class="org-haskell-operator">-&gt;</span> <span class="org-haskell-constructor">Either</span> err <span class="org-haskell-constructor">Double</span>
<span class="org-haskell-definition">addSafe2</span> ex ey <span class="org-haskell-operator">=</span> 
 ex <span class="org-haskell-operator">&gt;&gt;=</span> <span class="org-haskell-operator">\</span>x <span class="org-haskell-operator">-&gt;</span> 
 ey <span class="org-haskell-operator">&gt;&gt;=</span> <span class="org-haskell-operator">\</span>y <span class="org-haskell-operator">-&gt;</span>
 return (x <span class="org-haskell-operator">+</span> y)

<span class="org-haskell-definition">test1</span> input <span class="org-haskell-operator">=</span> <span class="org-haskell-keyword">do</span>
   x <span class="org-haskell-operator">&lt;-</span> parseDouble2 input 
   y <span class="org-haskell-operator">&lt;-</span> sqrt_safe2 x 
   return (x <span class="org-haskell-operator">+</span> y)

<span class="org-haskell-definition">test2</span> input <span class="org-haskell-operator">=</span> 
  parseDouble2 input <span class="org-haskell-operator">&gt;&gt;=</span> <span class="org-haskell-operator">\</span>x <span class="org-haskell-operator">-&gt;</span>
  sqrt_safe2 x       <span class="org-haskell-operator">&gt;&gt;=</span> <span class="org-haskell-operator">\</span>y <span class="org-haskell-operator">-&gt;</span>
  return (x <span class="org-haskell-operator">+</span> y)
  

<span class="org-comment-delimiter">-- </span><span class="org-comment">----- End of File  --------------------</span>
<span class="org-comment-delimiter">--</span><span class="org-comment">----------------------------------------</span>
</pre>
</div>

<p>
Repl:
</p>

<div class="org-src-container">

<pre class="src src-haskell"><span class="org-haskell-operator">&gt;</span> <span class="org-haskell-constructor">:</span>load <span class="org-haskell-operator">/</span>tmp<span class="org-haskell-operator">/</span>either_monad<span class="org-haskell-operator">.</span>hs

 <span class="org-comment-delimiter">-- </span><span class="org-comment">Playing with Return </span>
 <span class="org-comment-delimiter">--</span>
<span class="org-haskell-operator">&gt;</span> <span class="org-haskell-definition">return</span> 10 <span class="org-haskell-operator">::</span> <span class="org-haskell-constructor">Either</span> a <span class="org-haskell-constructor">Double</span>
<span class="org-haskell-constructor">Right</span> 10.0
<span class="org-haskell-operator">&gt;</span> 

<span class="org-haskell-operator">&gt;</span> <span class="org-haskell-keyword">let</span> returnEither x <span class="org-haskell-operator">=</span> <span class="org-haskell-constructor">Right</span> x 
<span class="org-haskell-operator">&gt;</span> 
<span class="org-haskell-operator">&gt;</span> <span class="org-haskell-definition">returnEither</span> 10
<span class="org-haskell-constructor">Right</span> 10

<span class="org-haskell-operator">&gt;</span> <span class="org-haskell-definition">returnEither</span> 10.0
<span class="org-haskell-constructor">Right</span> 10.0

<span class="org-haskell-operator">&gt;</span> <span class="org-haskell-constructor">:</span>t returnEither 10.0
<span class="org-haskell-definition">returnEither</span> 10.0 <span class="org-haskell-operator">::</span> <span class="org-haskell-constructor">Fractional</span> b <span class="org-haskell-operator">=&gt;</span> <span class="org-haskell-constructor">Either</span> a b
<span class="org-haskell-operator">&gt;</span> 

<span class="org-haskell-operator">&gt;</span> <span class="org-haskell-constructor">:</span>t returnEither (10.0 <span class="org-haskell-operator">::</span> <span class="org-haskell-constructor">Double</span>)
<span class="org-haskell-definition">returnEither</span> (10.0 <span class="org-haskell-operator">::</span> <span class="org-haskell-constructor">Double</span>) <span class="org-haskell-operator">::</span> <span class="org-haskell-constructor">Either</span> a <span class="org-haskell-constructor">Double</span>
<span class="org-haskell-operator">&gt;</span>

 <span class="org-comment-delimiter">--</span><span class="org-comment">-  Playing with bind operator  </span>
 <span class="org-comment-delimiter">--</span><span class="org-comment">-</span>

<span class="org-haskell-operator">&gt;</span> <span class="org-haskell-constructor">Right</span> 10 <span class="org-haskell-operator">&gt;&gt;=</span> <span class="org-haskell-operator">\</span>x <span class="org-haskell-operator">-&gt;</span> <span class="org-haskell-constructor">Right</span> (x <span class="org-haskell-operator">+</span> 5)
<span class="org-haskell-constructor">Right</span> 15
<span class="org-haskell-operator">&gt;</span> 

<span class="org-haskell-operator">&gt;</span> <span class="org-haskell-definition">return</span> 10 <span class="org-haskell-operator">&gt;&gt;=</span> <span class="org-haskell-operator">\</span>x <span class="org-haskell-operator">-&gt;</span> <span class="org-haskell-constructor">Right</span> (x <span class="org-haskell-operator">+</span> 5)
<span class="org-haskell-constructor">Right</span> 15
<span class="org-haskell-operator">&gt;</span> 


<span class="org-haskell-operator">&gt;</span> <span class="org-haskell-constructor">Right</span> 10 <span class="org-haskell-operator">&gt;&gt;=</span> <span class="org-haskell-operator">\</span>x <span class="org-haskell-operator">-&gt;</span> <span class="org-haskell-constructor">Left</span> <span class="org-string">"It always will fail"</span>
<span class="org-haskell-constructor">Left</span> <span class="org-string">"It always will fail"</span>
<span class="org-haskell-operator">&gt;</span> 

<span class="org-haskell-operator">&gt;</span> <span class="org-haskell-constructor">Left</span> <span class="org-string">"Computation failed"</span> <span class="org-haskell-operator">&gt;&gt;=</span> <span class="org-haskell-operator">\</span>x <span class="org-haskell-operator">-&gt;</span> <span class="org-haskell-constructor">Right</span> (x <span class="org-haskell-operator">+</span> 5)
<span class="org-haskell-constructor">Left</span> <span class="org-string">"Computation failed"</span>
<span class="org-haskell-operator">&gt;</span> 

<span class="org-haskell-operator">&gt;</span> <span class="org-haskell-definition">return</span> 5 <span class="org-haskell-operator">&gt;&gt;=</span> <span class="org-haskell-operator">\</span>x <span class="org-haskell-operator">-&gt;</span> <span class="org-haskell-keyword">if</span> x <span class="org-haskell-operator">&lt;</span> 20 <span class="org-haskell-keyword">then</span> <span class="org-haskell-constructor">Right</span> (x <span class="org-haskell-operator">+</span> 5) <span class="org-haskell-keyword">else</span> <span class="org-haskell-constructor">Left</span> <span class="org-string">"Number out of range greater than 20"</span>
<span class="org-haskell-constructor">Right</span> 10
<span class="org-haskell-operator">&gt;</span> 
<span class="org-haskell-operator">&gt;</span> <span class="org-haskell-definition">return</span> 30 <span class="org-haskell-operator">&gt;&gt;=</span> <span class="org-haskell-operator">\</span>x <span class="org-haskell-operator">-&gt;</span> <span class="org-haskell-keyword">if</span> x <span class="org-haskell-operator">&lt;</span> 20 <span class="org-haskell-keyword">then</span> <span class="org-haskell-constructor">Right</span> (x <span class="org-haskell-operator">+</span> 5) <span class="org-haskell-keyword">else</span> <span class="org-haskell-constructor">Left</span> <span class="org-string">"Number out of range greater than 20"</span>
<span class="org-haskell-constructor">Left</span> <span class="org-string">"Number out of range greater than 20"</span>
<span class="org-haskell-operator">&gt;</span> 


<span class="org-haskell-operator">&gt;</span> <span class="org-haskell-definition">return</span> <span class="org-string">"100.23"</span> <span class="org-haskell-operator">&gt;&gt;=</span> <span class="org-haskell-operator">\</span>x <span class="org-haskell-operator">-&gt;</span> parseDouble2 x
<span class="org-haskell-constructor">Right</span> 100.23
<span class="org-haskell-operator">&gt;</span> 
<span class="org-haskell-operator">&gt;</span> <span class="org-haskell-definition">return</span> <span class="org-string">"1dsf00.23"</span> <span class="org-haskell-operator">&gt;&gt;=</span> <span class="org-haskell-operator">\</span>x <span class="org-haskell-operator">-&gt;</span> parseDouble2 x
<span class="org-haskell-constructor">Left</span> <span class="org-haskell-constructor">ParserError</span>
<span class="org-haskell-operator">&gt;</span> 
 
 
<span class="org-haskell-operator">&gt;</span> <span class="org-haskell-definition">test1</span> <span class="org-string">"100.0"</span>
<span class="org-haskell-constructor">Right</span> 200.0
<span class="org-haskell-operator">&gt;</span>
<span class="org-haskell-operator">&gt;</span> 
<span class="org-haskell-operator">&gt;</span> <span class="org-haskell-definition">test1</span> <span class="org-string">"asd100.0"</span>
<span class="org-haskell-constructor">Left</span> <span class="org-haskell-constructor">ParserError</span>
<span class="org-haskell-operator">&gt;</span> 
<span class="org-haskell-operator">&gt;</span>
<span class="org-haskell-operator">&gt;</span> <span class="org-haskell-definition">test1</span> <span class="org-string">"-100"</span>
<span class="org-haskell-constructor">Left</span> <span class="org-haskell-constructor">InvalidInput</span>
<span class="org-haskell-operator">&gt;</span> 

<span class="org-haskell-operator">&gt;</span> <span class="org-haskell-definition">test2</span> <span class="org-string">"100"</span>
<span class="org-haskell-constructor">Right</span> 200.0
<span class="org-haskell-operator">&gt;</span>
<span class="org-haskell-operator">&gt;</span> <span class="org-haskell-definition">test2</span> <span class="org-string">"asdd10sd0"</span>
<span class="org-haskell-constructor">Left</span> <span class="org-haskell-constructor">ParserError</span>
<span class="org-haskell-operator">&gt;</span>
<span class="org-haskell-operator">&gt;</span> <span class="org-haskell-definition">test2</span> <span class="org-string">"-200"</span>
<span class="org-haskell-constructor">Left</span> <span class="org-haskell-constructor">InvalidInput</span>
<span class="org-haskell-operator">&gt;</span> 


<span class="org-haskell-operator">&gt;</span> <span class="org-haskell-constructor">:</span>t addSafe1 
<span class="org-haskell-definition">addSafe1</span>
  <span class="org-haskell-operator">::</span> <span class="org-haskell-constructor">Either</span> err <span class="org-haskell-constructor">Double</span> <span class="org-haskell-operator">-&gt;</span> <span class="org-haskell-constructor">Either</span> err <span class="org-haskell-constructor">Double</span> <span class="org-haskell-operator">-&gt;</span> <span class="org-haskell-constructor">Either</span> err <span class="org-haskell-constructor">Double</span>
<span class="org-haskell-operator">&gt;</span> 

<span class="org-haskell-operator">&gt;</span> <span class="org-haskell-definition">addSafe1</span> (<span class="org-haskell-constructor">Right</span> 100) (<span class="org-haskell-constructor">Right</span> 200)
<span class="org-haskell-constructor">Right</span> 300.0
<span class="org-haskell-operator">&gt;</span> 

<span class="org-haskell-operator">&gt;</span> <span class="org-haskell-definition">addSafe1</span> (<span class="org-haskell-constructor">Right</span> 100) (<span class="org-haskell-constructor">Left</span> <span class="org-string">"Error: second argument not a number"</span>)
<span class="org-haskell-constructor">Left</span> <span class="org-string">"Error: second argument not a number"</span>
<span class="org-haskell-operator">&gt;</span> 

<span class="org-haskell-operator">&gt;</span> <span class="org-haskell-definition">addSafe1</span> (<span class="org-haskell-constructor">Left</span> <span class="org-string">"Error: first argument not a number"</span>) (<span class="org-haskell-constructor">Right</span> 100)
<span class="org-haskell-constructor">Left</span> <span class="org-string">"Error: first argument not a number"</span>
<span class="org-haskell-operator">&gt;</span>

<span class="org-haskell-operator">&gt;</span> <span class="org-haskell-definition">addSafe1</span> (parseDouble2 <span class="org-string">"200.0"</span>) (sqrt_safe2 100.0)
<span class="org-haskell-constructor">Right</span> 300.0
<span class="org-haskell-operator">&gt;</span> 

<span class="org-haskell-operator">&gt;</span> <span class="org-haskell-definition">addSafe1</span> (parseDouble2 <span class="org-string">"200.0"</span>) (sqrt_safe2 (<span class="org-haskell-operator">-</span>100.0))
<span class="org-haskell-constructor">Left</span> <span class="org-haskell-constructor">InvalidInput</span>
<span class="org-haskell-operator">&gt;</span> 

<span class="org-haskell-operator">&gt;</span> <span class="org-haskell-definition">addSafe1</span> (parseDouble2 <span class="org-string">"2sdfs00.0"</span>) (sqrt_safe2 (<span class="org-haskell-operator">-</span>100.0))
<span class="org-haskell-constructor">Left</span> <span class="org-haskell-constructor">ParserError</span>
<span class="org-haskell-operator">&gt;</span> 

<span class="org-haskell-operator">&gt;</span> <span class="org-haskell-definition">addSafe2</span> (parseDouble2 <span class="org-string">"200.0"</span>) (sqrt_safe2 100.0)
<span class="org-haskell-constructor">Right</span> 300.0
<span class="org-haskell-operator">&gt;</span>

<span class="org-haskell-operator">&gt;</span> describeError <span class="org-haskell-definition">$</span> addSafe2 (parseDouble2 <span class="org-string">"20asdas0.0"</span>) (sqrt_safe2 100.0)
<span class="org-haskell-constructor">Left</span> <span class="org-string">"The parser failed."</span>
<span class="org-haskell-operator">&gt;</span> 

<span class="org-haskell-operator">&gt;</span> describeError <span class="org-haskell-definition">$</span> addSafe2 (parseDouble2 <span class="org-string">"2000.0"</span>) (sqrt_safe2 (<span class="org-haskell-operator">-</span>100.0))
<span class="org-haskell-constructor">Left</span> <span class="org-string">"Input out function domain."</span>
<span class="org-haskell-operator">&gt;</span> 

<span class="org-haskell-operator">&gt;</span> <span class="org-haskell-keyword">import</span> <span class="org-haskell-keyword">qualified</span> <span class="org-haskell-constructor">Data.Either</span> <span class="org-haskell-keyword">as</span> <span class="org-haskell-constructor">E</span>

<span class="org-comment-delimiter">-- </span><span class="org-comment">Extracts from a list of Either all the Left elements All the Left</span>
<span class="org-comment-delimiter">--   </span><span class="org-comment">elements are extracted in order.</span>
<span class="org-comment-delimiter">--</span>
<span class="org-haskell-operator">&gt;</span> <span class="org-haskell-constructor">E</span><span class="org-haskell-definition">.</span>lefts [<span class="org-haskell-constructor">Left</span> <span class="org-string">"Error 1"</span><span class="org-haskell-operator">,</span> <span class="org-haskell-constructor">Right</span> 10<span class="org-haskell-operator">,</span> <span class="org-haskell-constructor">Left</span> <span class="org-string">"Error 2"</span><span class="org-haskell-operator">,</span> <span class="org-haskell-constructor">Right</span> 200]
[<span class="org-string">"Error 1"</span><span class="org-haskell-operator">,</span><span class="org-string">"Error 2"</span>]
<span class="org-haskell-operator">&gt;</span> 

<span class="org-comment-delimiter">-- </span><span class="org-comment">Extracts from a list of Either all the Right elements All the Right</span>
<span class="org-comment-delimiter">-- </span><span class="org-comment">elements are extracted in order.</span>
<span class="org-comment-delimiter">--</span>
<span class="org-haskell-operator">&gt;</span> <span class="org-haskell-constructor">E</span><span class="org-haskell-definition">.</span>rights  [<span class="org-haskell-constructor">Left</span> <span class="org-string">"Error 1"</span><span class="org-haskell-operator">,</span> <span class="org-haskell-constructor">Right</span> 10<span class="org-haskell-operator">,</span> <span class="org-haskell-constructor">Left</span> <span class="org-string">"Error 2"</span><span class="org-haskell-operator">,</span> <span class="org-haskell-constructor">Right</span> 200]
[10<span class="org-haskell-operator">,</span>200]
<span class="org-haskell-operator">&gt;</span>


<span class="org-haskell-operator">&gt;</span> <span class="org-haskell-constructor">E</span><span class="org-haskell-definition">.</span>partitionEithers  [<span class="org-haskell-constructor">Left</span> <span class="org-string">"Error 1"</span><span class="org-haskell-operator">,</span> <span class="org-haskell-constructor">Right</span> 10<span class="org-haskell-operator">,</span> <span class="org-haskell-constructor">Left</span> <span class="org-string">"Error 2"</span><span class="org-haskell-operator">,</span> <span class="org-haskell-constructor">Right</span> 200]
([<span class="org-string">"Error 1"</span><span class="org-haskell-operator">,</span><span class="org-string">"Error 2"</span>]<span class="org-haskell-operator">,</span>[10<span class="org-haskell-operator">,</span>200])
<span class="org-haskell-operator">&gt;</span> 

<span class="org-comment-delimiter">--   </span><span class="org-comment">Case analysis for the Either type. If the value is Left a, apply</span>
<span class="org-comment-delimiter">--   </span><span class="org-comment">the first function to a; if it is Right b, apply the second</span>
<span class="org-comment-delimiter">--   </span><span class="org-comment">function to b.</span>
<span class="org-comment-delimiter">-- </span>

<span class="org-haskell-operator">&gt;</span> <span class="org-haskell-constructor">:</span>t <span class="org-haskell-constructor">E</span><span class="org-haskell-operator">.</span>either
<span class="org-function-name">E.either</span> <span class="org-haskell-operator">::</span> (a <span class="org-haskell-operator">-&gt;</span> c) <span class="org-haskell-operator">-&gt;</span> (b <span class="org-haskell-operator">-&gt;</span> c) <span class="org-haskell-operator">-&gt;</span> <span class="org-haskell-constructor">Either</span> a b <span class="org-haskell-operator">-&gt;</span> c
<span class="org-haskell-operator">&gt;</span> 

<span class="org-haskell-operator">&gt;</span> <span class="org-haskell-constructor">E</span><span class="org-haskell-definition">.</span>either (<span class="org-haskell-operator">\</span>left <span class="org-haskell-operator">-&gt;</span> left <span class="org-haskell-operator">+</span> 10) (<span class="org-haskell-operator">\</span>right <span class="org-haskell-operator">-&gt;</span> right <span class="org-haskell-operator">*</span> 3) (<span class="org-haskell-constructor">Right</span> 10)
30
<span class="org-haskell-operator">&gt;</span> 

<span class="org-haskell-operator">&gt;</span> <span class="org-haskell-constructor">E</span><span class="org-haskell-definition">.</span>either (<span class="org-haskell-operator">\</span>left <span class="org-haskell-operator">-&gt;</span> left <span class="org-haskell-operator">+</span> 10) (<span class="org-haskell-operator">\</span>right <span class="org-haskell-operator">-&gt;</span> right <span class="org-haskell-operator">*</span> 3) (<span class="org-haskell-constructor">Left</span> 10)
20
<span class="org-haskell-operator">&gt;</span> 

<span class="org-haskell-operator">&gt;</span> <span class="org-haskell-keyword">let</span> f <span class="org-haskell-operator">=</span> <span class="org-haskell-constructor">E</span><span class="org-haskell-operator">.</span>either (<span class="org-haskell-operator">\</span>left <span class="org-haskell-operator">-&gt;</span> left <span class="org-haskell-operator">+</span> 10) (<span class="org-haskell-operator">\</span>right <span class="org-haskell-operator">-&gt;</span> right <span class="org-haskell-operator">*</span> 3) 
<span class="org-haskell-operator">&gt;</span> <span class="org-haskell-constructor">:</span>t f
<span class="org-function-name">f</span> <span class="org-haskell-operator">::</span> <span class="org-haskell-constructor">Either</span> <span class="org-haskell-constructor">Integer</span> <span class="org-haskell-constructor">Integer</span> <span class="org-haskell-operator">-&gt;</span> <span class="org-haskell-constructor">Integer</span>
<span class="org-haskell-operator">&gt;</span> 

<span class="org-haskell-operator">&gt;</span> <span class="org-haskell-definition">f</span> (<span class="org-haskell-constructor">Right</span> 10)
30
<span class="org-haskell-operator">&gt;</span> <span class="org-haskell-definition">f</span> (<span class="org-haskell-constructor">Left</span> 10)
20
<span class="org-haskell-operator">&gt;</span>
</pre>
</div>
</div>
</div>
</div>

<div id="outline-container-sec-1-14-6" class="outline-4">
<h4 id="sec-1-14-6"><span class="section-number-4">1.14.6</span> IO Monad</h4>
<div class="outline-text-4" id="text-1-14-6">
</div><div id="outline-container-sec-1-14-6-1" class="outline-5">
<h5 id="sec-1-14-6-1"><span class="section-number-5">1.14.6.1</span> Overview</h5>
<div class="outline-text-5" id="text-1-14-6-1">
<p>
The type IO indicates an action that when evaluated may perform some
IO. The function <code>putChar :: Char -&gt; IO ()</code> takes a char and returns
an <span class="underline">IO action</span> that prints a char, no character is printed on the
screen and no side-effect is performed. This IO action can be passed
as a ordinary values to another IO actions and combined with another
IO actions. IO actions only will be executed when called from the
function <code>main :: IO ()</code> or called from another IO actions called from
main.
</p>

<p>
The values wrapped in an IO type like <code>getChar :: IO Char</code> can only be
extracted inside an IO action. 
</p>

<p>
Remarks: 
</p>

<ul class="org-ul">
<li>The Haskell's IO is pure and lazy.
</li>
<li>There is no way to extract a value of an IO action outside an IO
action.
</li>
<li>Only IO actions perform IO actions.  
</li>
<li>The entry point of a Haskell program is the function <span class="underline">main</span>. Only
the IO functions called from main will be executed.
</li>
<li>IO Actions are commands. <code>_putSTrln "str"_</code> doesn't print a
string. It actually creates a command to print a string that can be
manipulated like a value, repeated, stored in data structures and
passed to another IO actions. 
</li>
<li>By typing an action action in the REPL (ghci) forces its execution.
</li>
</ul>


<p>
Example: 
</p>

<p>
file: haskell_io1.hs
</p>

<div class="org-src-container">

<pre class="src src-haskell"><span class="org-haskell-keyword">import</span> <span class="org-haskell-constructor">System.IO</span> (hFlush<span class="org-haskell-operator">,</span> stdout)

<span class="org-function-name">action1</span> <span class="org-haskell-operator">::</span> <span class="org-haskell-constructor">IO</span> <span class="org-haskell-constructor">()</span>
<span class="org-haskell-definition">action1</span> <span class="org-haskell-operator">=</span> putStrLn <span class="org-string">"Say action 1 dummy"</span>

<span class="org-comment-delimiter">-- </span><span class="org-comment">action2 :: IO ()</span>
<span class="org-haskell-definition">action2</span> <span class="org-haskell-operator">=</span> putStrLn <span class="org-string">"Action2 won't be executed"</span>

<span class="org-function-name">action3</span> <span class="org-haskell-operator">::</span> <span class="org-haskell-constructor">IO</span> <span class="org-haskell-constructor">()</span>
<span class="org-haskell-definition">action3</span> <span class="org-haskell-operator">=</span> putStrLn <span class="org-string">"Action3 won't be executed"</span>

<span class="org-function-name">newline</span> <span class="org-haskell-operator">::</span> <span class="org-haskell-constructor">IO</span> <span class="org-haskell-constructor">()</span>
<span class="org-haskell-definition">newline</span> <span class="org-haskell-operator">=</span> putStrLn <span class="org-string">""</span>

<span class="org-comment-delimiter">-- </span><span class="org-comment">prompt :: String -&gt; IO String</span>
<span class="org-haskell-definition">prompt</span> message <span class="org-haskell-operator">=</span> <span class="org-haskell-keyword">do</span>
  putStr message
  hFlush stdout 
  line <span class="org-haskell-operator">&lt;-</span> getLine  
  newline
  newline
  return line 

<span class="org-function-name">askQuestion</span> <span class="org-haskell-operator">::</span> <span class="org-haskell-constructor">IO</span> <span class="org-haskell-constructor">String</span> 
<span class="org-haskell-definition">askQuestion</span> <span class="org-haskell-operator">=</span> prompt <span class="org-string">"&gt; Enter a line: "</span>

<span class="org-function-name">main</span> <span class="org-haskell-operator">::</span> <span class="org-haskell-constructor">IO</span> <span class="org-haskell-constructor">()</span>
<span class="org-haskell-definition">main</span> <span class="org-haskell-operator">=</span> <span class="org-haskell-keyword">do</span>
  putStrLn <span class="org-string">"Hello world"</span>
  action1
  line <span class="org-haskell-operator">&lt;-</span> askQuestion
  putStrLn (<span class="org-string">"You entered the line: "</span> <span class="org-haskell-operator">++</span> line)
</pre>
</div>

<p>
Compiling and running:
</p>

<div class="org-src-container">

<pre class="src src-sh"><span class="org-comment-delimiter"># </span><span class="org-comment">Compiling </span>

$ ghc haskell_test.hs
[1 of 1] Compiling Main             ( haskell_test.hs, haskell_test.o )
Linking haskell_test ...

<span class="org-comment-delimiter"># </span><span class="org-comment">Running the executable</span>
<span class="org-comment-delimiter">#</span>
$ ./haskell_test 
Hello world
Say action 1 dummy
&gt; Enter a line: Hola mundo. Muchas gracias Haskell!


You entered the line: Hola mundo. Muchas gracias Haskell!


<span class="org-comment-delimiter"># </span><span class="org-comment">Executing in batch mode (script) </span>
<span class="org-comment-delimiter">#</span>
$ runghc haskell_test.hs
Hello world
Say action 1 dummy
&gt; Enter a line: Hola mundo Haskell.


You entered the line: Hola mundo Haskell.
</pre>
</div>

<p>
It is noticeable that: 
</p>

<ul class="org-ul">
<li>action2 neither action3 are executed and they don't print anything.
</li>
<li>Only the IO actions called from main are executed.
</li>
<li>The string returned by the function askQuestion can only be
extracted inside an IO action.
</li>
</ul>

<p>
The application of the function <code>putStrLn :: String -&gt; IO ()</code> to a
string <code>_putStrLn "Hello world"_</code> is equivalent to the code below in
OCaml. 
</p>

<div class="org-src-container">

<pre class="src src-ocaml"><span class="org-tuareg-font-lock-operator">&gt;</span> <span class="org-tuareg-font-lock-governing">let</span> <span class="org-function-name">putStrLn</span><span class="org-variable-name"> message</span> <span class="org-tuareg-font-lock-operator">=</span> <span class="org-keyword">fun</span> <span class="org-tuareg-font-lock-operator">()</span> <span class="org-tuareg-font-lock-operator">-&gt;</span> print_string message <span class="org-tuareg-font-lock-operator">;</span> 
                                   print_string <span class="org-string">"\n"</span> <span class="org-tuareg-font-lock-operator">;;</span>

<span class="org-tuareg-font-lock-governing">val</span> <span class="org-function-name">putStrLn</span> <span class="org-tuareg-font-lock-operator">:</span> string <span class="org-tuareg-font-lock-operator">-&gt;</span> unit <span class="org-tuareg-font-lock-operator">-&gt;</span> unit <span class="org-tuareg-font-lock-operator">=</span> <span class="org-tuareg-font-lock-operator">&lt;</span><span class="org-keyword">fun</span><span class="org-tuareg-font-lock-operator">&gt;</span>


<span class="org-tuareg-font-lock-operator">&gt;</span>  putStrLn <span class="org-string">"Hello world"</span> <span class="org-tuareg-font-lock-operator">;;</span>
<span class="org-function-name">-</span> <span class="org-tuareg-font-lock-operator">:</span> unit <span class="org-tuareg-font-lock-operator">-&gt;</span> unit <span class="org-tuareg-font-lock-operator">=</span> <span class="org-tuareg-font-lock-operator">&lt;</span><span class="org-keyword">fun</span><span class="org-tuareg-font-lock-operator">&gt;</span>

<span class="org-comment-delimiter">(* </span><span class="org-comment">Nothing is printed. It is created an action or command </span>
<span class="org-comment">   that prints hello world</span>
<span class="org-comment-delimiter">*)</span>
<span class="org-tuareg-font-lock-operator">&gt;</span> <span class="org-tuareg-font-lock-governing">let</span> <span class="org-variable-name">action</span> <span class="org-tuareg-font-lock-operator">=</span> putStrLn <span class="org-string">"hello world"</span> <span class="org-tuareg-font-lock-operator">;;</span>
<span class="org-tuareg-font-lock-governing">val</span> <span class="org-function-name">action</span> <span class="org-tuareg-font-lock-operator">:</span> unit <span class="org-tuareg-font-lock-operator">-&gt;</span> unit <span class="org-tuareg-font-lock-operator">=</span> <span class="org-tuareg-font-lock-operator">&lt;</span><span class="org-keyword">fun</span><span class="org-tuareg-font-lock-operator">&gt;</span>

<span class="org-comment-delimiter">(* </span><span class="org-comment">Forces the evaluation of IO action. </span>
<span class="org-comment-delimiter">*)</span>
<span class="org-tuareg-font-lock-operator">&gt;</span> <span class="org-tuareg-font-lock-governing">let</span> <span class="org-function-name">runIO</span><span class="org-variable-name"> ioAction</span> <span class="org-tuareg-font-lock-operator">=</span> ioAction <span class="org-tuareg-font-lock-operator">()</span> <span class="org-tuareg-font-lock-operator">;;</span>
<span class="org-tuareg-font-lock-governing">val</span> <span class="org-function-name">runIO</span> <span class="org-tuareg-font-lock-operator">:</span> <span class="org-tuareg-font-lock-operator">(</span>unit <span class="org-tuareg-font-lock-operator">-&gt;</span> 'a<span class="org-tuareg-font-lock-operator">)</span> <span class="org-tuareg-font-lock-operator">-&gt;</span> 'a <span class="org-tuareg-font-lock-operator">=</span> <span class="org-tuareg-font-lock-operator">&lt;</span><span class="org-keyword">fun</span><span class="org-tuareg-font-lock-operator">&gt;</span>
 

<span class="org-comment-delimiter">(* </span><span class="org-comment">Not executed  </span><span class="org-comment-delimiter">*)</span>
<span class="org-tuareg-font-lock-operator">-</span> action <span class="org-tuareg-font-lock-operator">;;</span> 
<span class="org-tuareg-font-lock-governing">val</span> <span class="org-function-name">it</span> <span class="org-tuareg-font-lock-operator">:</span> <span class="org-tuareg-font-lock-operator">(</span>unit <span class="org-tuareg-font-lock-operator">-&gt;</span> unit<span class="org-tuareg-font-lock-operator">)</span> 
<span class="org-tuareg-font-lock-operator">&gt;</span> 

<span class="org-tuareg-font-lock-operator">&gt;</span>  runIO action <span class="org-tuareg-font-lock-operator">;;</span>
hello world
<span class="org-function-name">-</span> <span class="org-tuareg-font-lock-operator">:</span> unit <span class="org-tuareg-font-lock-operator">=</span> <span class="org-tuareg-font-lock-operator">()</span>
 
<span class="org-tuareg-font-lock-governing">let</span> <span class="org-function-name">do3times</span><span class="org-variable-name"> action</span> <span class="org-tuareg-font-lock-operator">=</span>
  runIO action <span class="org-tuareg-font-lock-operator">;</span>
  runIO action <span class="org-tuareg-font-lock-operator">;</span>
  runIO action
<span class="org-tuareg-font-lock-operator">;;</span>        
<span class="org-tuareg-font-lock-governing">val</span> <span class="org-function-name">do3times</span> <span class="org-tuareg-font-lock-operator">:</span> <span class="org-tuareg-font-lock-operator">(</span>unit <span class="org-tuareg-font-lock-operator">-&gt;</span> 'a<span class="org-tuareg-font-lock-operator">)</span> <span class="org-tuareg-font-lock-operator">-&gt;</span> 'a <span class="org-tuareg-font-lock-operator">=</span> <span class="org-tuareg-font-lock-operator">&lt;</span><span class="org-keyword">fun</span><span class="org-tuareg-font-lock-operator">&gt;</span>


<span class="org-tuareg-font-lock-operator">&gt;</span>  do3times action <span class="org-tuareg-font-lock-operator">;;</span>
hello world
hello world
hello world
<span class="org-function-name">-</span> <span class="org-tuareg-font-lock-operator">:</span> unit <span class="org-tuareg-font-lock-operator">=</span> <span class="org-tuareg-font-lock-operator">()</span>
</pre>
</div>

<p>
Bind and Return: 
</p>

<pre class="example">
(&gt;&gt;=) :: IO a -&gt; a -&gt; IO b -&gt; IO b 
(&gt;&gt;) :: IO () -&gt; IO () -&gt; IO ()
return :: a -&gt; IO a
</pre>
</div>
</div>

<div id="outline-container-sec-1-14-6-2" class="outline-5">
<h5 id="sec-1-14-6-2"><span class="section-number-5">1.14.6.2</span> Example</h5>
<div class="outline-text-5" id="text-1-14-6-2">
<p>
Examples with IO Monad:
</p>

<div class="org-src-container">

<pre class="src src-haskell"> <span class="org-comment-delimiter">-- </span><span class="org-comment">Wrapping a value into IO</span>
 <span class="org-comment-delimiter">-- </span>

<span class="org-haskell-operator">&gt;</span> <span class="org-haskell-definition">return</span> <span class="org-string">"Hello world"</span> <span class="org-haskell-operator">::</span> <span class="org-haskell-constructor">IO</span> <span class="org-haskell-constructor">String</span>
<span class="org-string">"Hello world"</span>
<span class="org-haskell-operator">&gt;</span> 
<span class="org-haskell-operator">&gt;</span> <span class="org-haskell-definition">return</span> 100 <span class="org-haskell-operator">::</span> <span class="org-haskell-constructor">IO</span> <span class="org-haskell-constructor">Integer</span>
100
<span class="org-haskell-operator">&gt;</span> <span class="org-haskell-constructor">:</span>t return 100 <span class="org-haskell-operator">::</span> <span class="org-haskell-constructor">IO</span> <span class="org-haskell-constructor">Integer</span>
<span class="org-haskell-definition">return</span> 100 <span class="org-haskell-operator">::</span> <span class="org-haskell-constructor">IO</span> <span class="org-haskell-constructor">Integer</span> <span class="org-haskell-operator">::</span> <span class="org-haskell-constructor">IO</span> <span class="org-haskell-constructor">Integer</span>
<span class="org-haskell-operator">&gt;</span> 


<span class="org-comment-delimiter">-- </span><span class="org-comment">The repl forces the evaluation of an IO action. </span>
<span class="org-comment-delimiter">--</span>
<span class="org-haskell-operator">&gt;</span> <span class="org-haskell-definition">return</span> <span class="org-string">"Hello world"</span> <span class="org-haskell-operator">&gt;&gt;=</span> putStrLn 
<span class="org-haskell-constructor">Hello</span> world
<span class="org-haskell-operator">&gt;</span>

<span class="org-haskell-operator">&gt;</span> <span class="org-haskell-constructor">:</span>t return <span class="org-string">"Hello world"</span> <span class="org-haskell-operator">&gt;&gt;=</span> putStrLn 
<span class="org-haskell-definition">return</span> <span class="org-string">"Hello world"</span> <span class="org-haskell-operator">&gt;&gt;=</span> putStrLn <span class="org-haskell-operator">::</span> <span class="org-haskell-constructor">IO</span> <span class="org-haskell-constructor">()</span>
<span class="org-haskell-operator">&gt;</span> 

<span class="org-comment-delimiter">-- </span><span class="org-comment">This is not executed, unless forced. </span>
<span class="org-comment-delimiter">-- </span>
<span class="org-haskell-operator">&gt;</span> <span class="org-haskell-keyword">let</span> action0 <span class="org-haskell-operator">=</span> return <span class="org-string">"Hello world"</span> <span class="org-haskell-operator">&gt;&gt;=</span> putStrLn 
<span class="org-haskell-operator">&gt;</span> 
<span class="org-haskell-operator">&gt;</span> <span class="org-haskell-constructor">:</span>t action0 
<span class="org-function-name">action0</span> <span class="org-haskell-operator">::</span> <span class="org-haskell-constructor">IO</span> <span class="org-haskell-constructor">()</span>
<span class="org-haskell-operator">&gt;</span> 

<span class="org-haskell-operator">&gt;</span> action0
<span class="org-haskell-constructor">Hello</span> world
<span class="org-haskell-operator">&gt;</span> 

<span class="org-haskell-operator">&gt;</span> <span class="org-haskell-keyword">let</span> action <span class="org-haskell-operator">=</span> putStrLn <span class="org-string">"Line1"</span> <span class="org-haskell-operator">&gt;&gt;</span> putStrLn <span class="org-string">"Line2"</span> <span class="org-haskell-operator">&gt;&gt;</span> putStrLn <span class="org-string">"Line3"</span>
<span class="org-haskell-operator">&gt;</span> <span class="org-haskell-constructor">:</span>t action 
<span class="org-function-name">action</span> <span class="org-haskell-operator">::</span> <span class="org-haskell-constructor">IO</span> <span class="org-haskell-constructor">()</span>

<span class="org-haskell-operator">&gt;</span> action 
<span class="org-haskell-constructor">Line1</span>
<span class="org-haskell-constructor">Line2</span>
<span class="org-haskell-constructor">Line3</span>
<span class="org-haskell-operator">&gt;</span>
</pre>
</div>



<p>
File: haskelldo.hs 
</p>

<div class="org-src-container">

<pre class="src src-haskell"><span class="org-haskell-definition">sumTwoNumbers</span> <span class="org-haskell-operator">=</span> <span class="org-haskell-keyword">do</span> 
   putStr <span class="org-string">"Enter the first number: "</span>
   line1 <span class="org-haskell-operator">&lt;-</span> getLine 
   putStr <span class="org-string">"Enter the second number: "</span>
   line2 <span class="org-haskell-operator">&lt;-</span> getLine 
   <span class="org-haskell-keyword">let</span>  x1 <span class="org-haskell-operator">=</span> read line1 <span class="org-haskell-operator">::</span> <span class="org-haskell-constructor">Integer</span>
   <span class="org-haskell-keyword">let</span>  x2 <span class="org-haskell-operator">=</span> read line2  <span class="org-haskell-operator">::</span> <span class="org-haskell-constructor">Integer</span> 
   <span class="org-haskell-keyword">let</span> sum <span class="org-haskell-operator">=</span> x1 <span class="org-haskell-operator">+</span> x2 
   putStrLn (<span class="org-string">"The sum is "</span> <span class="org-haskell-operator">++</span> show sum)
   return sum


<span class="org-comment-delimiter">-- </span><span class="org-comment">SumTwonumbers dessugarized </span>
<span class="org-comment-delimiter">--</span>
<span class="org-haskell-definition">sumTwoNumbers_v2</span> <span class="org-haskell-operator">=</span> 
  putStr <span class="org-string">"Enter the first number: "</span>     <span class="org-haskell-operator">&gt;&gt;=</span> <span class="org-haskell-operator">\</span><span class="org-haskell-keyword">_</span>      <span class="org-haskell-operator">-&gt;</span>
  getLine                               <span class="org-haskell-operator">&gt;&gt;=</span> <span class="org-haskell-operator">\</span>line1  <span class="org-haskell-operator">-&gt;</span>
  putStr <span class="org-string">"Enter the second number: "</span>    <span class="org-haskell-operator">&gt;&gt;=</span> <span class="org-haskell-operator">\</span><span class="org-haskell-keyword">_</span>      <span class="org-haskell-operator">-&gt;</span>
  getLine                               <span class="org-haskell-operator">&gt;&gt;=</span>  <span class="org-haskell-operator">\</span>line2 <span class="org-haskell-operator">-&gt;</span> 
  <span class="org-haskell-keyword">let</span> x1 <span class="org-haskell-operator">=</span> read line1 <span class="org-haskell-operator">::</span> <span class="org-haskell-constructor">Integer</span> <span class="org-haskell-keyword">in</span> 
  <span class="org-haskell-keyword">let</span> x2 <span class="org-haskell-operator">=</span> read line2 <span class="org-haskell-operator">::</span> <span class="org-haskell-constructor">Integer</span> <span class="org-haskell-keyword">in</span> 
  <span class="org-haskell-keyword">let</span> sum <span class="org-haskell-operator">=</span> x1 <span class="org-haskell-operator">+</span> x2 <span class="org-haskell-keyword">in</span> 
  putStrLn  (<span class="org-string">"The sum is "</span> <span class="org-haskell-operator">++</span> show sum) <span class="org-haskell-operator">&gt;&gt;=</span> <span class="org-haskell-operator">\</span><span class="org-haskell-keyword">_</span> <span class="org-haskell-operator">-&gt;</span> 
  return sum

<span class="org-function-name">showResult</span> <span class="org-haskell-operator">::</span> <span class="org-haskell-constructor">IO</span> <span class="org-haskell-constructor">Integer</span> <span class="org-haskell-operator">-&gt;</span>  <span class="org-haskell-constructor">IO</span> <span class="org-haskell-constructor">()</span>
<span class="org-haskell-definition">showResult</span> inputAction <span class="org-haskell-operator">=</span> <span class="org-haskell-keyword">do</span>
  x <span class="org-haskell-operator">&lt;-</span> inputAction 
  putStrLn ( <span class="org-string">"The result is "</span> <span class="org-haskell-operator">++</span> show x)
</pre>
</div>


<p>
Running in the REPL:
</p>

<div class="org-src-container">

<pre class="src src-haskell"><span class="org-haskell-operator">&gt;</span> <span class="org-haskell-constructor">:</span>load haskelldo<span class="org-haskell-operator">.</span>hs


<span class="org-haskell-operator">&gt;</span> sumTwoNumbers 
<span class="org-haskell-constructor">Enter</span> the first number<span class="org-haskell-constructor">:</span> 100
<span class="org-haskell-constructor">Enter</span> the second number<span class="org-haskell-constructor">:</span> 200
<span class="org-haskell-constructor">The</span> sum is 300
300
<span class="org-haskell-operator">&gt;</span> 
<span class="org-haskell-operator">&gt;</span> <span class="org-haskell-constructor">:</span>t sumTwoNumbers 
<span class="org-function-name">sumTwoNumbers</span> <span class="org-haskell-operator">::</span> <span class="org-haskell-constructor">IO</span> <span class="org-haskell-constructor">Integer</span>
<span class="org-haskell-operator">&gt;</span> 


<span class="org-haskell-operator">&gt;</span> sumTwoNumbers_v2
<span class="org-haskell-constructor">Enter</span> the first number<span class="org-haskell-constructor">:</span> 100
<span class="org-haskell-constructor">Enter</span> the second number<span class="org-haskell-constructor">:</span> 200
<span class="org-haskell-constructor">The</span> sum is 300
300
<span class="org-haskell-operator">&gt;</span> 

<span class="org-haskell-operator">&gt;</span> <span class="org-haskell-constructor">:</span>t sumTwoNumbers_v2
<span class="org-function-name">sumTwoNumbers_v2</span> <span class="org-haskell-operator">::</span> <span class="org-haskell-constructor">IO</span> <span class="org-haskell-constructor">Integer</span>
<span class="org-haskell-operator">&gt;</span> 

<span class="org-haskell-operator">&gt;</span> <span class="org-haskell-constructor">:</span>t showResult 
<span class="org-function-name">showResult</span> <span class="org-haskell-operator">::</span> <span class="org-haskell-constructor">IO</span> <span class="org-haskell-constructor">Integer</span> <span class="org-haskell-operator">-&gt;</span> <span class="org-haskell-constructor">IO</span> <span class="org-haskell-constructor">()</span>
<span class="org-haskell-operator">&gt;</span> 


 <span class="org-comment-delimiter">-- </span><span class="org-comment">It creates a new IO action. </span>
 <span class="org-comment-delimiter">--</span>
<span class="org-haskell-operator">&gt;</span> <span class="org-haskell-keyword">let</span> action <span class="org-haskell-operator">=</span> showResult sumTwoNumbers
<span class="org-haskell-operator">&gt;</span> 
<span class="org-haskell-operator">&gt;</span> action 
<span class="org-haskell-constructor">Enter</span> the first number<span class="org-haskell-constructor">:</span> 100
<span class="org-haskell-constructor">Enter</span> the second number<span class="org-haskell-constructor">:</span> 200
<span class="org-haskell-constructor">The</span> sum is 300
<span class="org-haskell-constructor">The</span> result is 300
<span class="org-haskell-operator">&gt;</span> 

<span class="org-haskell-operator">&gt;</span> <span class="org-haskell-constructor">:</span>t action
<span class="org-function-name">action</span> <span class="org-haskell-operator">::</span> <span class="org-haskell-constructor">IO</span> <span class="org-haskell-constructor">()</span>
<span class="org-haskell-operator">&gt;</span>

<span class="org-comment-delimiter">-- </span><span class="org-comment">The IO actions can be manipulated like values:</span>
<span class="org-comment-delimiter">--</span>
<span class="org-comment-delimiter">--</span><span class="org-comment">-----------------------------------------------</span>
<span class="org-haskell-operator">&gt;</span> <span class="org-haskell-constructor">:</span>t mapM_
<span class="org-function-name">mapM_</span> <span class="org-haskell-operator">::</span> <span class="org-haskell-constructor">Monad</span> m <span class="org-haskell-operator">=&gt;</span> (a <span class="org-haskell-operator">-&gt;</span> m b) <span class="org-haskell-operator">-&gt;</span> [a] <span class="org-haskell-operator">-&gt;</span> m <span class="org-haskell-constructor">()</span>
<span class="org-haskell-operator">&gt;</span> 

<span class="org-haskell-operator">&gt;</span> <span class="org-haskell-definition">mapM_</span> putStrLn [<span class="org-string">"line 0"</span><span class="org-haskell-operator">,</span> <span class="org-string">"line 1"</span><span class="org-haskell-operator">,</span> <span class="org-string">"line2"</span><span class="org-haskell-operator">,</span> <span class="org-string">"line 3"</span>] 
<span class="org-haskell-definition">line</span> 0
<span class="org-haskell-definition">line</span> 1
line2
<span class="org-haskell-definition">line</span> 3
<span class="org-haskell-operator">&gt;</span> 

<span class="org-haskell-operator">&gt;</span> <span class="org-haskell-keyword">let</span> forEachPrint <span class="org-haskell-operator">=</span> mapM_ putStrLn 
<span class="org-haskell-operator">&gt;</span> 
<span class="org-haskell-operator">&gt;</span> <span class="org-haskell-constructor">:</span>t forEachPrint 
<span class="org-function-name">forEachPrint</span> <span class="org-haskell-operator">::</span> [<span class="org-haskell-constructor">String</span>] <span class="org-haskell-operator">-&gt;</span> <span class="org-haskell-constructor">IO</span> <span class="org-haskell-constructor">()</span>
<span class="org-haskell-operator">&gt;</span> 
<span class="org-haskell-operator">&gt;</span> <span class="org-haskell-definition">forEachPrint</span> put
<span class="org-haskell-definition">putChar</span>   putStr    putStrLn
<span class="org-haskell-operator">&gt;</span> <span class="org-haskell-definition">forEachPrint</span> [<span class="org-string">"line 0"</span><span class="org-haskell-operator">,</span> <span class="org-string">"line 1"</span><span class="org-haskell-operator">,</span> <span class="org-string">"line2"</span><span class="org-haskell-operator">,</span> <span class="org-string">"line 3"</span>]
<span class="org-haskell-definition">line</span> 0
<span class="org-haskell-definition">line</span> 1
line2
<span class="org-haskell-definition">line</span> 3
<span class="org-haskell-operator">&gt;</span> 

<span class="org-haskell-operator">&gt;</span> <span class="org-haskell-constructor">:</span>t replicateM
<span class="org-function-name">replicateM</span> <span class="org-haskell-operator">::</span> <span class="org-haskell-constructor">Monad</span> m <span class="org-haskell-operator">=&gt;</span> <span class="org-haskell-constructor">Int</span> <span class="org-haskell-operator">-&gt;</span> m a <span class="org-haskell-operator">-&gt;</span> m [a]
<span class="org-haskell-operator">&gt;</span> 

<span class="org-haskell-operator">&gt;</span> <span class="org-haskell-keyword">let</span> askTwoTimes <span class="org-haskell-operator">=</span> replicateM 2 sumTwoNumbers
<span class="org-haskell-operator">&gt;</span>

<span class="org-haskell-operator">&gt;</span> askTwoTimes 
<span class="org-haskell-constructor">Enter</span> the first number<span class="org-haskell-constructor">:</span> 100
<span class="org-haskell-constructor">Enter</span> the second number<span class="org-haskell-constructor">:</span> 200
<span class="org-haskell-constructor">The</span> sum is 300
<span class="org-haskell-constructor">Enter</span> the first number<span class="org-haskell-constructor">:</span> 300
<span class="org-haskell-constructor">Enter</span> the second number<span class="org-haskell-constructor">:</span> 90
<span class="org-haskell-constructor">The</span> sum is 390
[300<span class="org-haskell-operator">,</span>390]
<span class="org-haskell-operator">&gt;</span>
</pre>
</div>


<p>
Some IO Primitives: 
</p>

<table border="2" cellspacing="0" cellpadding="6" rules="groups" frame="hsides">


<colgroup>
<col  class="left" />

<col  class="left" />
</colgroup>
<thead>
<tr>
<th scope="col" class="left">Console Output Functions</th>
<th scope="col" class="left">Console Input Functions</th>
</tr>
</thead>
<tbody>
<tr>
<td class="left">putChar  :: Char -&gt; IO ()</td>
<td class="left">getChar :: Char -&gt; IO ()</td>
</tr>

<tr>
<td class="left">putStr   :: String -&gt; IO ()</td>
<td class="left">&#xa0;</td>
</tr>

<tr>
<td class="left">putStrLn :: String -&gt; IO ()</td>
<td class="left">getLine :: IO String</td>
</tr>

<tr>
<td class="left">print    :: Show a =&gt; a -&gt; IO ()</td>
<td class="left">readLn :: Read a =&gt; IO a</td>
</tr>

<tr>
<td class="left">&#xa0;</td>
<td class="left">&#xa0;</td>
</tr>
</tbody>
</table>
</div>
</div>

<div id="outline-container-sec-1-14-6-3" class="outline-5">
<h5 id="sec-1-14-6-3"><span class="section-number-5">1.14.6.3</span> IO Monad in OCaml</h5>
<div class="outline-text-5" id="text-1-14-6-3">
<p>
The IO monad cannot be implemented in Haskell. However by implementing
it in OCaml is possible to understand how it works and get some
intuition about IO actions and also understand how the monad
combinators like (&gt;&gt;), sequence, sequence_ works. This implementation
was designed to by as simple as possible to understand. 
</p>


<p>
It is based on the paper: Waddler, Philip. <b>How to Declare an
Imperative</b> Language. Page 27. Available at
<a href="http://homepages.inf.ed.ac.uk/wadler/papers/monadsdeclare/monadsdeclare.ps">http://homepages.inf.ed.ac.uk/wadler/papers/monadsdeclare/monadsdeclare.ps</a>
</p>


<div class="org-src-container">

<pre class="src src-ocaml"><span class="org-tuareg-font-lock-governing">let</span> <span class="org-function-name">replicate</span><span class="org-variable-name"> n x</span> <span class="org-tuareg-font-lock-operator">=</span>
  <span class="org-tuareg-font-lock-governing">let</span> <span class="org-tuareg-font-lock-governing">rec</span> <span class="org-function-name">aux</span><span class="org-variable-name"> count acc</span> <span class="org-tuareg-font-lock-operator">=</span>
    <span class="org-keyword">if</span> count <span class="org-tuareg-font-lock-operator">=</span> 0
    <span class="org-keyword">then</span> acc
    <span class="org-keyword">else</span> aux <span class="org-tuareg-font-lock-operator">(</span>count <span class="org-tuareg-font-lock-operator">-</span> 1<span class="org-tuareg-font-lock-operator">)</span> <span class="org-tuareg-font-lock-operator">(</span>x<span class="org-tuareg-font-lock-operator">::</span><span class="org-type">acc</span><span class="org-tuareg-font-lock-operator">)</span>
             
  <span class="org-tuareg-font-lock-governing">in</span> aux n <span class="org-tuareg-font-lock-operator">[]</span>
<span class="org-tuareg-font-lock-operator">;;</span>
         
<span class="org-tuareg-font-lock-governing">module</span> <span class="org-tuareg-font-lock-module">IO</span> <span class="org-tuareg-font-lock-operator">=</span>
  <span class="org-tuareg-font-lock-governing">struct</span>

    <span class="org-comment-delimiter">(* </span><span class="org-comment">Wraps an imperative function like </span>
<span class="org-comment">       print_string into a thunk </span>
<span class="org-comment">    </span><span class="org-comment-delimiter">*)</span>
    <span class="org-tuareg-font-lock-governing">type</span> <span class="org-type">'a io</span> <span class="org-tuareg-font-lock-operator">=</span> <span class="org-tuareg-font-lock-constructor">IO</span> <span class="org-keyword">of</span> <span class="org-tuareg-font-lock-operator">(</span>unit <span class="org-tuareg-font-lock-operator">-&gt;</span> 'a<span class="org-tuareg-font-lock-operator">)</span>

    <span class="org-comment-delimiter">(* </span><span class="org-comment">Forces the evaluation of an IO action </span><span class="org-comment-delimiter">*)</span>                     
    <span class="org-tuareg-font-lock-governing">let</span> <span class="org-variable-name">run</span><span class="org-tuareg-font-lock-operator">:</span> <span class="org-type">'a io </span><span class="org-tuareg-font-lock-operator">-&gt;</span><span class="org-type"> 'a </span><span class="org-tuareg-font-lock-operator">=</span>
      <span class="org-keyword">fun</span> <span class="org-tuareg-font-lock-operator">(</span><span class="org-tuareg-font-lock-constructor">IO</span><span class="org-variable-name"> thunk</span><span class="org-tuareg-font-lock-operator">)</span> <span class="org-tuareg-font-lock-operator">-&gt;</span> thunk <span class="org-tuareg-font-lock-operator">()</span>

    <span class="org-comment-delimiter">(* </span><span class="org-comment">The same as Haskell return :: a -&gt; m a </span><span class="org-comment-delimiter">*)</span>                         
    <span class="org-tuareg-font-lock-governing">let</span> <span class="org-variable-name">unit</span><span class="org-tuareg-font-lock-operator">:</span> <span class="org-type">'a </span><span class="org-tuareg-font-lock-operator">-&gt;</span><span class="org-type"> 'a io  </span><span class="org-tuareg-font-lock-operator">=</span>
      <span class="org-keyword">fun</span> <span class="org-variable-name">a</span> <span class="org-tuareg-font-lock-operator">-&gt;</span> <span class="org-tuareg-font-lock-constructor">IO</span> <span class="org-tuareg-font-lock-operator">(</span> <span class="org-keyword">fun</span> <span class="org-tuareg-font-lock-operator">()</span> <span class="org-tuareg-font-lock-operator">-&gt;</span> a<span class="org-tuareg-font-lock-operator">)</span>

    <span class="org-tuareg-font-lock-governing">let</span> <span class="org-variable-name">bind</span><span class="org-tuareg-font-lock-operator">:</span> <span class="org-type">'a io </span><span class="org-tuareg-font-lock-operator">-&gt;</span><span class="org-type"> </span><span class="org-tuareg-font-lock-operator">(</span><span class="org-type">'a </span><span class="org-tuareg-font-lock-operator">-&gt;</span><span class="org-type"> 'b io</span><span class="org-tuareg-font-lock-operator">)</span><span class="org-type"> </span><span class="org-tuareg-font-lock-operator">-&gt;</span><span class="org-type"> 'b io </span><span class="org-tuareg-font-lock-operator">=</span>      
      <span class="org-keyword">fun</span> <span class="org-variable-name">io_a fn_io</span> <span class="org-tuareg-font-lock-operator">-&gt;</span>
           <span class="org-tuareg-font-lock-constructor">IO</span> <span class="org-tuareg-font-lock-operator">(</span><span class="org-keyword">fun</span> <span class="org-tuareg-font-lock-operator">()</span> <span class="org-tuareg-font-lock-operator">-&gt;</span> <span class="org-tuareg-font-lock-governing">let</span> <span class="org-variable-name">a</span> <span class="org-tuareg-font-lock-operator">=</span> run io_a <span class="org-tuareg-font-lock-governing">in</span>
                         run <span class="org-tuareg-font-lock-operator">(</span>fn_io a<span class="org-tuareg-font-lock-operator">))</span>

    <span class="org-tuareg-font-lock-governing">let</span> <span class="org-tuareg-font-lock-operator">(&gt;&gt;=)</span> <span class="org-tuareg-font-lock-operator">=</span> bind

    <span class="org-comment-delimiter">(* </span><span class="org-comment">(&gt;&gt;) :: m a -&gt; m b -&gt; m b </span>
<span class="org-comment">       (&gt;&gt;) ma mb = </span>
<span class="org-comment">            ma &gt;&gt;= \_ -&gt; mb </span>
<span class="org-comment">     </span><span class="org-comment-delimiter">*)</span>              
    <span class="org-tuareg-font-lock-governing">let</span> <span class="org-tuareg-font-lock-operator">(&gt;&gt;)</span> ma mb <span class="org-tuareg-font-lock-operator">=</span>
      ma <span class="org-tuareg-font-lock-operator">&gt;&gt;=</span> <span class="org-keyword">fun</span> <span class="org-variable-name">_</span> <span class="org-tuareg-font-lock-operator">-&gt;</span> mb


    <span class="org-comment-delimiter">(* </span><span class="org-comment">Converts an output function into a </span>
<span class="org-comment">       monadic output function </span>
<span class="org-comment">     </span><span class="org-comment-delimiter">*)</span>       
    <span class="org-tuareg-font-lock-governing">let</span> <span class="org-variable-name">lift_output</span><span class="org-tuareg-font-lock-operator">:</span> <span class="org-tuareg-font-lock-operator">(</span><span class="org-type">'a </span><span class="org-tuareg-font-lock-operator">-&gt;</span><span class="org-type"> unit</span><span class="org-tuareg-font-lock-operator">)</span><span class="org-type"> </span><span class="org-tuareg-font-lock-operator">-&gt;</span><span class="org-type"> </span><span class="org-tuareg-font-lock-operator">(</span><span class="org-type">'a </span><span class="org-tuareg-font-lock-operator">-&gt;</span><span class="org-type"> unit io</span><span class="org-tuareg-font-lock-operator">)</span><span class="org-type"> </span><span class="org-tuareg-font-lock-operator">=</span>
      <span class="org-keyword">fun</span> <span class="org-variable-name">output_fn a</span> <span class="org-tuareg-font-lock-operator">-&gt;</span> <span class="org-tuareg-font-lock-constructor">IO</span> <span class="org-tuareg-font-lock-operator">(</span><span class="org-keyword">fun</span> <span class="org-tuareg-font-lock-operator">()</span> <span class="org-tuareg-font-lock-operator">-&gt;</span> output_fn a<span class="org-tuareg-font-lock-operator">)</span>

    <span class="org-comment-delimiter">(* </span><span class="org-comment">Converts an input function into a </span>
<span class="org-comment">       monadic input function </span>
<span class="org-comment">     </span><span class="org-comment-delimiter">*)</span>                        
    <span class="org-tuareg-font-lock-governing">let</span> <span class="org-variable-name">lift_input</span><span class="org-tuareg-font-lock-operator">:</span> <span class="org-tuareg-font-lock-operator">(</span><span class="org-type">unit </span><span class="org-tuareg-font-lock-operator">-&gt;</span><span class="org-type"> 'a</span><span class="org-tuareg-font-lock-operator">)</span><span class="org-type"> </span><span class="org-tuareg-font-lock-operator">-&gt;</span><span class="org-type"> 'a io </span><span class="org-tuareg-font-lock-operator">=</span>
      <span class="org-keyword">fun</span> <span class="org-variable-name">fn_input</span> <span class="org-tuareg-font-lock-operator">-&gt;</span> <span class="org-tuareg-font-lock-constructor">IO</span> fn_input 
                    
    <span class="org-comment-delimiter">(*  </span><span class="org-comment">fmap derived from IO Monad</span>
<span class="org-comment">    </span>
<span class="org-comment">       fmap :: (a -&gt; b) -&gt; IO a -&gt; IO b </span>
<span class="org-comment">       fmap fn ma = do </span>
<span class="org-comment">          a &lt;- ma </span>
<span class="org-comment">          return (fn a)</span>

<span class="org-comment">     </span><span class="org-comment-delimiter">*)</span>        
    <span class="org-tuareg-font-lock-governing">let</span> <span class="org-function-name">map</span><span class="org-variable-name"> fn ma</span> <span class="org-tuareg-font-lock-operator">=</span>
      ma   <span class="org-tuareg-font-lock-operator">&gt;&gt;=</span> <span class="org-keyword">fun</span> <span class="org-variable-name">a</span> <span class="org-tuareg-font-lock-operator">-&gt;</span>
      unit <span class="org-tuareg-font-lock-operator">(</span>fn a<span class="org-tuareg-font-lock-operator">)</span>

    <span class="org-comment-delimiter">(* </span><span class="org-comment">from: Contro.Monad </span>

<span class="org-comment">      sequence :: Monad m =&gt; [m a] -&gt; m [a]</span>
<span class="org-comment">      sequence = foldr mcons (return [])</span>
<span class="org-comment">          where </span>
<span class="org-comment">             mcons p q = </span>
<span class="org-comment">                p &gt;&gt;= \x -&gt; </span>
<span class="org-comment">                q &gt;&gt;= \y -&gt; </span>
<span class="org-comment">                 return (x:y)         </span>
<span class="org-comment">    </span><span class="org-comment-delimiter">*)</span>          
    <span class="org-tuareg-font-lock-governing">let</span> <span class="org-function-name">sequence</span><span class="org-variable-name"> mlist</span> <span class="org-tuareg-font-lock-operator">=</span>
      <span class="org-tuareg-font-lock-governing">let</span> <span class="org-function-name">mcons</span><span class="org-variable-name"> p q</span> <span class="org-tuareg-font-lock-operator">=</span>
        p <span class="org-tuareg-font-lock-operator">&gt;&gt;=</span> <span class="org-keyword">fun</span> <span class="org-variable-name">x</span> <span class="org-tuareg-font-lock-operator">-&gt;</span>
        q <span class="org-tuareg-font-lock-operator">&gt;&gt;=</span> <span class="org-keyword">fun</span> <span class="org-variable-name">y</span> <span class="org-tuareg-font-lock-operator">-&gt;</span>
        unit <span class="org-tuareg-font-lock-operator">(</span>x<span class="org-tuareg-font-lock-operator">::</span><span class="org-type">y</span><span class="org-tuareg-font-lock-operator">)</span>

      <span class="org-tuareg-font-lock-governing">in</span> <span class="org-tuareg-font-lock-module">List.</span>fold_right mcons mlist <span class="org-tuareg-font-lock-operator">(</span>unit <span class="org-tuareg-font-lock-operator">[])</span>

    <span class="org-comment-delimiter">(* </span><span class="org-comment">from: Control.Monad </span><span class="org-comment-delimiter">*)</span>
    <span class="org-tuareg-font-lock-governing">let</span> <span class="org-function-name">sequence_</span><span class="org-variable-name"> mlist</span> <span class="org-tuareg-font-lock-operator">=</span>
      <span class="org-tuareg-font-lock-module">List.</span>fold_right <span class="org-tuareg-font-lock-operator">(&gt;&gt;)</span> mlist <span class="org-tuareg-font-lock-operator">(</span>unit <span class="org-tuareg-font-lock-operator">())</span>

    <span class="org-comment-delimiter">(* </span><span class="org-comment">from: Control.Monad </span><span class="org-comment-delimiter">*)</span>
    <span class="org-tuareg-font-lock-governing">let</span> <span class="org-function-name">replicateM_</span><span class="org-variable-name"> n ma</span> <span class="org-tuareg-font-lock-operator">=</span>
      sequence_ <span class="org-tuareg-font-lock-operator">(</span>replicate n ma<span class="org-tuareg-font-lock-operator">)</span>

    <span class="org-comment-delimiter">(* </span><span class="org-comment">from: Control.Monad </span><span class="org-comment-delimiter">*)</span> 
    <span class="org-tuareg-font-lock-governing">let</span> <span class="org-function-name">replicateM</span><span class="org-variable-name"> n ma</span> <span class="org-tuareg-font-lock-operator">=</span>
      sequence <span class="org-tuareg-font-lock-operator">(</span>replicate n ma<span class="org-tuareg-font-lock-operator">)</span>

    <span class="org-comment-delimiter">(*  </span><span class="org-comment">from: Control.Monad </span>

<span class="org-comment">       forever :: IO () -&gt; IO </span><span class="org-comment-delimiter">*)</span>           
    <span class="org-tuareg-font-lock-governing">let</span> <span class="org-tuareg-font-lock-governing">rec</span> <span class="org-function-name">forever</span><span class="org-variable-name"> </span><span class="org-tuareg-font-lock-operator">(</span><span class="org-variable-name">ma</span><span class="org-tuareg-font-lock-operator">:</span><span class="org-type"> unit io</span><span class="org-tuareg-font-lock-operator">)</span> <span class="org-tuareg-font-lock-operator">=</span>
      <span class="org-comment-delimiter">(* </span><span class="org-comment">let open IO in </span><span class="org-comment-delimiter">*)</span>
      <span class="org-tuareg-font-lock-constructor">IO</span> <span class="org-tuareg-font-lock-operator">(</span> <span class="org-keyword">fun</span> <span class="org-tuareg-font-lock-operator">()</span> <span class="org-tuareg-font-lock-operator">-&gt;</span> run  ma <span class="org-tuareg-font-lock-operator">;</span>
                     <span class="org-tuareg-font-lock-governing">let</span> <span class="org-variable-name">_</span> <span class="org-tuareg-font-lock-operator">=</span> run <span class="org-tuareg-font-lock-operator">(</span>forever ma<span class="org-tuareg-font-lock-operator">)</span>
                     <span class="org-tuareg-font-lock-governing">in</span> <span class="org-tuareg-font-lock-operator">()</span>           
         <span class="org-tuareg-font-lock-operator">)</span>
         
    <span class="org-comment-delimiter">(* </span><span class="org-comment">from: Control.Monad </span><span class="org-comment-delimiter">*)</span>
    <span class="org-tuareg-font-lock-governing">let</span> <span class="org-variable-name">mapM</span><span class="org-tuareg-font-lock-operator">:</span> <span class="org-tuareg-font-lock-operator">(</span><span class="org-type">'a </span><span class="org-tuareg-font-lock-operator">-&gt;</span><span class="org-type"> 'b io</span><span class="org-tuareg-font-lock-operator">)</span><span class="org-type"> </span><span class="org-tuareg-font-lock-operator">-&gt;</span><span class="org-type"> 'a list </span><span class="org-tuareg-font-lock-operator">-&gt;</span><span class="org-type"> </span><span class="org-tuareg-font-lock-operator">(</span><span class="org-type">'b list</span><span class="org-tuareg-font-lock-operator">)</span><span class="org-type"> io </span><span class="org-tuareg-font-lock-operator">=</span>
      <span class="org-keyword">fun</span> <span class="org-variable-name">fn alst</span> <span class="org-tuareg-font-lock-operator">-&gt;</span>  sequence <span class="org-tuareg-font-lock-operator">(</span><span class="org-tuareg-font-lock-module">List.</span>map fn alst<span class="org-tuareg-font-lock-operator">)</span>

    <span class="org-tuareg-font-lock-governing">let</span> <span class="org-variable-name">mapM_</span><span class="org-tuareg-font-lock-operator">:</span> <span class="org-tuareg-font-lock-operator">(</span><span class="org-type">'a </span><span class="org-tuareg-font-lock-operator">-&gt;</span><span class="org-type"> unit io</span><span class="org-tuareg-font-lock-operator">)</span><span class="org-type"> </span><span class="org-tuareg-font-lock-operator">-&gt;</span><span class="org-type"> 'a list </span><span class="org-tuareg-font-lock-operator">-&gt;</span><span class="org-type"> unit io </span><span class="org-tuareg-font-lock-operator">=</span>
      <span class="org-keyword">fun</span> <span class="org-variable-name">fn alst</span> <span class="org-tuareg-font-lock-operator">-&gt;</span> sequence_ <span class="org-tuareg-font-lock-operator">(</span><span class="org-tuareg-font-lock-module">List.</span>map fn alst<span class="org-tuareg-font-lock-operator">)</span>


    <span class="org-comment-delimiter">(* </span><span class="org-comment">----- Primitive IO Functions --------- </span><span class="org-comment-delimiter">*)</span>
                               
    <span class="org-tuareg-font-lock-governing">let</span> <span class="org-variable-name">print_string</span> <span class="org-tuareg-font-lock-operator">=</span> lift_output <span class="org-tuareg-font-lock-module">Pervasives.</span>print_string 
           
    <span class="org-tuareg-font-lock-governing">let</span> <span class="org-variable-name">print_char</span> <span class="org-tuareg-font-lock-operator">=</span> lift_output <span class="org-tuareg-font-lock-module">Pervasives.</span>print_char   
 
    <span class="org-tuareg-font-lock-governing">let</span> <span class="org-variable-name">read_char</span> <span class="org-tuareg-font-lock-operator">=</span> lift_input <span class="org-tuareg-font-lock-operator">(</span><span class="org-keyword">fun</span> <span class="org-variable-name">ch</span> <span class="org-tuareg-font-lock-operator">-&gt;</span> 
                                <span class="org-tuareg-font-lock-module">Pervasives.</span>input_char  stdin<span class="org-tuareg-font-lock-operator">)</span>

    <span class="org-tuareg-font-lock-governing">let</span> <span class="org-variable-name">read_line</span> <span class="org-tuareg-font-lock-operator">=</span> lift_input <span class="org-tuareg-font-lock-module">Pervasives.</span>read_line 
                                   
    <span class="org-tuareg-font-lock-governing">let</span> <span class="org-variable-name">read_int</span> <span class="org-tuareg-font-lock-operator">=</span> lift_input <span class="org-tuareg-font-lock-module">Pervasives.</span>read_int

                              
  <span class="org-tuareg-font-lock-governing">end</span>
<span class="org-tuareg-font-lock-operator">;;</span>    


<span class="org-tuareg-font-lock-governing">module</span> <span class="org-tuareg-font-lock-module">IO</span> <span class="org-tuareg-font-lock-operator">:</span>
  <span class="org-tuareg-font-lock-governing">sig</span>
    <span class="org-tuareg-font-lock-governing">type</span> <span class="org-type">'a io</span> <span class="org-tuareg-font-lock-operator">=</span> <span class="org-tuareg-font-lock-constructor">IO</span> <span class="org-keyword">of</span> <span class="org-tuareg-font-lock-operator">(</span>unit <span class="org-tuareg-font-lock-operator">-&gt;</span> 'a<span class="org-tuareg-font-lock-operator">)</span>
    <span class="org-tuareg-font-lock-governing">val</span> <span class="org-function-name">run</span> <span class="org-tuareg-font-lock-operator">:</span> 'a io <span class="org-tuareg-font-lock-operator">-&gt;</span> 'a
    <span class="org-tuareg-font-lock-governing">val</span> <span class="org-function-name">unit</span> <span class="org-tuareg-font-lock-operator">:</span> 'a <span class="org-tuareg-font-lock-operator">-&gt;</span> 'a io
    <span class="org-tuareg-font-lock-governing">val</span> <span class="org-function-name">bind</span> <span class="org-tuareg-font-lock-operator">:</span> 'a io <span class="org-tuareg-font-lock-operator">-&gt;</span> <span class="org-tuareg-font-lock-operator">(</span>'a <span class="org-tuareg-font-lock-operator">-&gt;</span> 'b io<span class="org-tuareg-font-lock-operator">)</span> <span class="org-tuareg-font-lock-operator">-&gt;</span> 'b io
    <span class="org-tuareg-font-lock-governing">val</span> <span class="org-tuareg-font-lock-operator">(</span> <span class="org-tuareg-font-lock-operator">&gt;&gt;=</span> <span class="org-tuareg-font-lock-operator">)</span> <span class="org-tuareg-font-lock-operator">:</span> 'a io <span class="org-tuareg-font-lock-operator">-&gt;</span> <span class="org-tuareg-font-lock-operator">(</span>'a <span class="org-tuareg-font-lock-operator">-&gt;</span> 'b io<span class="org-tuareg-font-lock-operator">)</span> <span class="org-tuareg-font-lock-operator">-&gt;</span> 'b io
    <span class="org-tuareg-font-lock-governing">val</span> <span class="org-tuareg-font-lock-operator">(</span> <span class="org-tuareg-font-lock-operator">&gt;&gt;</span> <span class="org-tuareg-font-lock-operator">)</span> <span class="org-tuareg-font-lock-operator">:</span> 'a io <span class="org-tuareg-font-lock-operator">-&gt;</span> 'b io <span class="org-tuareg-font-lock-operator">-&gt;</span> 'b io
    <span class="org-tuareg-font-lock-governing">val</span> <span class="org-function-name">lift_output</span> <span class="org-tuareg-font-lock-operator">:</span> <span class="org-tuareg-font-lock-operator">(</span>'a <span class="org-tuareg-font-lock-operator">-&gt;</span> unit<span class="org-tuareg-font-lock-operator">)</span> <span class="org-tuareg-font-lock-operator">-&gt;</span> 'a <span class="org-tuareg-font-lock-operator">-&gt;</span> unit io
    <span class="org-tuareg-font-lock-governing">val</span> <span class="org-function-name">lift_input</span> <span class="org-tuareg-font-lock-operator">:</span> <span class="org-tuareg-font-lock-operator">(</span>unit <span class="org-tuareg-font-lock-operator">-&gt;</span> 'a<span class="org-tuareg-font-lock-operator">)</span> <span class="org-tuareg-font-lock-operator">-&gt;</span> 'a io
    <span class="org-tuareg-font-lock-governing">val</span> <span class="org-function-name">map</span> <span class="org-tuareg-font-lock-operator">:</span> <span class="org-tuareg-font-lock-operator">(</span>'a <span class="org-tuareg-font-lock-operator">-&gt;</span> 'b<span class="org-tuareg-font-lock-operator">)</span> <span class="org-tuareg-font-lock-operator">-&gt;</span> 'a io <span class="org-tuareg-font-lock-operator">-&gt;</span> 'b io
    <span class="org-tuareg-font-lock-governing">val</span> <span class="org-function-name">sequence</span> <span class="org-tuareg-font-lock-operator">:</span> 'a io list <span class="org-tuareg-font-lock-operator">-&gt;</span> 'a list io
    <span class="org-tuareg-font-lock-governing">val</span> <span class="org-function-name">sequence_</span> <span class="org-tuareg-font-lock-operator">:</span> 'a io list <span class="org-tuareg-font-lock-operator">-&gt;</span> unit io
    <span class="org-tuareg-font-lock-governing">val</span> <span class="org-function-name">replicateM_</span> <span class="org-tuareg-font-lock-operator">:</span> int <span class="org-tuareg-font-lock-operator">-&gt;</span> 'a io <span class="org-tuareg-font-lock-operator">-&gt;</span> unit io
    <span class="org-tuareg-font-lock-governing">val</span> <span class="org-function-name">replicateM</span> <span class="org-tuareg-font-lock-operator">:</span> int <span class="org-tuareg-font-lock-operator">-&gt;</span> 'a io <span class="org-tuareg-font-lock-operator">-&gt;</span> 'a list io
    <span class="org-tuareg-font-lock-governing">val</span> <span class="org-function-name">forever</span> <span class="org-tuareg-font-lock-operator">:</span> unit io <span class="org-tuareg-font-lock-operator">-&gt;</span> unit io
    <span class="org-tuareg-font-lock-governing">val</span> <span class="org-function-name">mapM</span> <span class="org-tuareg-font-lock-operator">:</span> <span class="org-tuareg-font-lock-operator">(</span>'a <span class="org-tuareg-font-lock-operator">-&gt;</span> 'b io<span class="org-tuareg-font-lock-operator">)</span> <span class="org-tuareg-font-lock-operator">-&gt;</span> 'a list <span class="org-tuareg-font-lock-operator">-&gt;</span> 'b list io
    <span class="org-tuareg-font-lock-governing">val</span> <span class="org-function-name">mapM_</span> <span class="org-tuareg-font-lock-operator">:</span> <span class="org-tuareg-font-lock-operator">(</span>'a <span class="org-tuareg-font-lock-operator">-&gt;</span> unit io<span class="org-tuareg-font-lock-operator">)</span> <span class="org-tuareg-font-lock-operator">-&gt;</span> 'a list <span class="org-tuareg-font-lock-operator">-&gt;</span> unit io
    <span class="org-tuareg-font-lock-governing">val</span> <span class="org-function-name">print_string</span> <span class="org-tuareg-font-lock-operator">:</span> string <span class="org-tuareg-font-lock-operator">-&gt;</span> unit io
    <span class="org-tuareg-font-lock-governing">val</span> <span class="org-function-name">print_char</span> <span class="org-tuareg-font-lock-operator">:</span> char <span class="org-tuareg-font-lock-operator">-&gt;</span> unit io
    <span class="org-tuareg-font-lock-governing">val</span> <span class="org-function-name">read_char</span> <span class="org-tuareg-font-lock-operator">:</span> char io
    <span class="org-tuareg-font-lock-governing">val</span> <span class="org-function-name">read_line</span> <span class="org-tuareg-font-lock-operator">:</span> string io
    <span class="org-tuareg-font-lock-governing">val</span> <span class="org-function-name">read_int</span> <span class="org-tuareg-font-lock-operator">:</span> int io
  <span class="org-tuareg-font-lock-governing">end</span>
</pre>
</div>

<p>
Tests:
</p>

<div class="org-src-container">

<pre class="src src-ocaml"><span class="org-tuareg-font-lock-operator">&gt;</span>  <span class="org-tuareg-font-lock-module">IO.</span>print_string <span class="org-string">"\nHello world\n"</span> <span class="org-tuareg-font-lock-operator">;;</span>
<span class="org-function-name">-</span> <span class="org-tuareg-font-lock-operator">:</span> unit <span class="org-tuareg-font-lock-module">IO.</span>io <span class="org-tuareg-font-lock-operator">=</span> <span class="org-tuareg-font-lock-module">IO.</span><span class="org-tuareg-font-lock-constructor">IO</span> <span class="org-tuareg-font-lock-operator">&lt;</span><span class="org-keyword">fun</span><span class="org-tuareg-font-lock-operator">&gt;</span>
 

<span class="org-tuareg-font-lock-operator">&gt;</span> <span class="org-tuareg-font-lock-governing">let</span> <span class="org-variable-name">action</span> <span class="org-tuareg-font-lock-operator">=</span> <span class="org-tuareg-font-lock-module">IO.</span>print_string <span class="org-string">"\nHello world\n"</span> <span class="org-tuareg-font-lock-operator">;;</span>
<span class="org-tuareg-font-lock-governing">val</span> <span class="org-function-name">action</span> <span class="org-tuareg-font-lock-operator">:</span> unit <span class="org-tuareg-font-lock-module">IO.</span>io <span class="org-tuareg-font-lock-operator">=</span> <span class="org-tuareg-font-lock-module">IO.</span><span class="org-tuareg-font-lock-constructor">IO</span> <span class="org-tuareg-font-lock-operator">&lt;</span><span class="org-keyword">fun</span><span class="org-tuareg-font-lock-operator">&gt;</span>

<span class="org-tuareg-font-lock-operator">&gt;</span>  action <span class="org-tuareg-font-lock-operator">;;</span>
<span class="org-function-name">-</span> <span class="org-tuareg-font-lock-operator">:</span> unit <span class="org-tuareg-font-lock-module">IO.</span>io <span class="org-tuareg-font-lock-operator">=</span> <span class="org-tuareg-font-lock-module">IO.</span><span class="org-tuareg-font-lock-constructor">IO</span> <span class="org-tuareg-font-lock-operator">&lt;</span><span class="org-keyword">fun</span><span class="org-tuareg-font-lock-operator">&gt;</span>

<span class="org-tuareg-font-lock-operator">&gt;</span>  <span class="org-tuareg-font-lock-module">IO.</span>run action <span class="org-tuareg-font-lock-operator">;;</span>

<span class="org-tuareg-font-lock-constructor">Hello</span> world
<span class="org-function-name">-</span> <span class="org-tuareg-font-lock-operator">:</span> unit <span class="org-tuareg-font-lock-operator">=</span> <span class="org-tuareg-font-lock-operator">()</span>
 

<span class="org-tuareg-font-lock-operator">&gt;</span> <span class="org-tuareg-font-lock-governing">let</span> <span class="org-tuareg-font-lock-governing">open </span><span class="org-tuareg-font-lock-module">IO</span> <span class="org-tuareg-font-lock-governing">in</span> print_string <span class="org-string">"Hello world"</span> <span class="org-tuareg-font-lock-operator">;;</span>
<span class="org-function-name">-</span> <span class="org-tuareg-font-lock-operator">:</span> unit <span class="org-tuareg-font-lock-module">IO.</span>io <span class="org-tuareg-font-lock-operator">=</span> <span class="org-tuareg-font-lock-module">IO.</span><span class="org-tuareg-font-lock-constructor">IO</span> <span class="org-tuareg-font-lock-operator">&lt;</span><span class="org-keyword">fun</span><span class="org-tuareg-font-lock-operator">&gt;</span>
 

<span class="org-tuareg-font-lock-operator">&gt;</span> <span class="org-tuareg-font-lock-governing">let</span> <span class="org-tuareg-font-lock-governing">open </span><span class="org-tuareg-font-lock-module">IO</span> <span class="org-tuareg-font-lock-governing">in</span> run <span class="org-tuareg-font-lock-operator">(</span>print_string <span class="org-string">"Hello world"</span><span class="org-tuareg-font-lock-operator">)</span> <span class="org-tuareg-font-lock-operator">;;</span>
<span class="org-tuareg-font-lock-constructor">Hello</span> world<span class="org-tuareg-font-lock-operator">-</span> <span class="org-tuareg-font-lock-operator">:</span> unit <span class="org-tuareg-font-lock-operator">=</span> <span class="org-tuareg-font-lock-operator">()</span>


<span class="org-comment-delimiter">(*</span>
<span class="org-comment">echoDup = do </span>
<span class="org-comment"> c &lt;- getChar </span>
<span class="org-comment"> putChar c </span>
<span class="org-comment"> putChar c </span>

<span class="org-comment">echoDup = do                echoDup = do </span>
<span class="org-comment">  getChar     &gt;&gt;= \c -&gt;       getChar    &gt;&gt;= \c -&gt;</span>
<span class="org-comment">  putChar   c &gt;&gt;= \_ -&gt;       putChar c  &gt;&gt;     </span>
<span class="org-comment">  putChar c                   putChar c </span>

<span class="org-comment"> </span><span class="org-comment-delimiter">*)</span>
<span class="org-tuareg-font-lock-governing">let</span> <span class="org-variable-name">echoDup</span> <span class="org-tuareg-font-lock-operator">=</span>
  <span class="org-tuareg-font-lock-governing">let</span> <span class="org-tuareg-font-lock-governing">open </span><span class="org-tuareg-font-lock-module">IO</span> <span class="org-tuareg-font-lock-governing">in</span>
  read_char     <span class="org-tuareg-font-lock-operator">&gt;&gt;=</span> <span class="org-keyword">fun</span> <span class="org-variable-name">c</span> <span class="org-tuareg-font-lock-operator">-&gt;</span>
  print_char c  <span class="org-tuareg-font-lock-operator">&gt;&gt;</span>
  print_char c
<span class="org-tuareg-font-lock-operator">;;</span>                  

<span class="org-tuareg-font-lock-governing">val</span> <span class="org-function-name">echoDup</span> <span class="org-tuareg-font-lock-operator">:</span> unit <span class="org-tuareg-font-lock-module">IO.</span>io <span class="org-tuareg-font-lock-operator">=</span> <span class="org-tuareg-font-lock-module">IO.</span><span class="org-tuareg-font-lock-constructor">IO</span> <span class="org-tuareg-font-lock-operator">&lt;</span><span class="org-keyword">fun</span><span class="org-tuareg-font-lock-operator">&gt;</span>

<span class="org-tuareg-font-lock-operator">#</span>  echoDup <span class="org-tuareg-font-lock-operator">;;</span>
<span class="org-function-name">-</span> <span class="org-tuareg-font-lock-operator">:</span> unit <span class="org-tuareg-font-lock-module">IO.</span>io <span class="org-tuareg-font-lock-operator">=</span> <span class="org-tuareg-font-lock-module">IO.</span><span class="org-tuareg-font-lock-constructor">IO</span> <span class="org-tuareg-font-lock-operator">&lt;</span><span class="org-keyword">fun</span><span class="org-tuareg-font-lock-operator">&gt;</span>

<span class="org-tuareg-font-lock-operator">#</span>  <span class="org-tuareg-font-lock-module">IO.</span>run echoDup <span class="org-tuareg-font-lock-operator">;;</span>
a
<span class="org-function-name">aa-</span> <span class="org-tuareg-font-lock-operator">:</span> unit <span class="org-tuareg-font-lock-operator">=</span> <span class="org-tuareg-font-lock-operator">()</span>

<span class="org-tuareg-font-lock-operator">#</span>   <span class="org-tuareg-font-lock-module">IO.</span>run echoDup <span class="org-tuareg-font-lock-operator">;;</span>
b
<span class="org-function-name">bb-</span> <span class="org-tuareg-font-lock-operator">:</span> unit <span class="org-tuareg-font-lock-operator">=</span> <span class="org-tuareg-font-lock-operator">()</span>
<span class="org-tuareg-font-lock-operator">#</span>                              
                                       
<span class="org-tuareg-font-lock-governing">let</span> <span class="org-function-name">make_prompt1</span><span class="org-variable-name"> prompt</span> <span class="org-tuareg-font-lock-operator">=</span>
  <span class="org-tuareg-font-lock-governing">let</span> <span class="org-tuareg-font-lock-governing">open </span><span class="org-tuareg-font-lock-module">IO</span> <span class="org-tuareg-font-lock-governing">in</span> 
  print_string prompt            <span class="org-tuareg-font-lock-operator">&gt;&gt;=</span> <span class="org-keyword">fun</span> <span class="org-variable-name">_</span>    <span class="org-tuareg-font-lock-operator">-&gt;</span>
  read_line                      <span class="org-tuareg-font-lock-operator">&gt;&gt;=</span> <span class="org-keyword">fun</span> <span class="org-variable-name">line</span> <span class="org-tuareg-font-lock-operator">-&gt;</span>
  print_string <span class="org-string">"The line is :\n"</span> <span class="org-tuareg-font-lock-operator">&gt;&gt;=</span> <span class="org-keyword">fun</span> <span class="org-variable-name">_</span>    <span class="org-tuareg-font-lock-operator">-&gt;</span>
  print_string line              <span class="org-tuareg-font-lock-operator">&gt;&gt;=</span> <span class="org-keyword">fun</span> <span class="org-variable-name">_</span>    <span class="org-tuareg-font-lock-operator">-&gt;</span> 
  unit <span class="org-tuareg-font-lock-operator">(</span><span class="org-tuareg-font-lock-module">String.</span>length line<span class="org-tuareg-font-lock-operator">)</span>
  <span class="org-tuareg-font-lock-operator">;;</span>
<span class="org-tuareg-font-lock-governing">val</span> <span class="org-function-name">make_prompt1</span> <span class="org-tuareg-font-lock-operator">:</span> string <span class="org-tuareg-font-lock-operator">-&gt;</span> int <span class="org-tuareg-font-lock-module">IO.</span>io <span class="org-tuareg-font-lock-operator">=</span> <span class="org-tuareg-font-lock-operator">&lt;</span><span class="org-keyword">fun</span><span class="org-tuareg-font-lock-operator">&gt;</span>
<span class="org-tuareg-font-lock-operator">#</span> 

<span class="org-tuareg-font-lock-governing">let</span> <span class="org-function-name">make_prompt2</span><span class="org-variable-name"> prompt</span> <span class="org-tuareg-font-lock-operator">=</span>
  <span class="org-tuareg-font-lock-governing">let</span> <span class="org-tuareg-font-lock-governing">open </span><span class="org-tuareg-font-lock-module">IO</span> <span class="org-tuareg-font-lock-governing">in</span> 
  print_string prompt            <span class="org-tuareg-font-lock-operator">&gt;&gt;</span>
  read_line                      <span class="org-tuareg-font-lock-operator">&gt;&gt;=</span> <span class="org-keyword">fun</span> <span class="org-variable-name">line</span> <span class="org-tuareg-font-lock-operator">-&gt;</span>
  print_string <span class="org-string">"The line is :\n"</span> <span class="org-tuareg-font-lock-operator">&gt;&gt;</span>
  print_string line              <span class="org-tuareg-font-lock-operator">&gt;&gt;</span> 
  unit <span class="org-tuareg-font-lock-operator">(</span><span class="org-tuareg-font-lock-module">String.</span>length line<span class="org-tuareg-font-lock-operator">)</span>
  <span class="org-tuareg-font-lock-operator">;;</span>
<span class="org-tuareg-font-lock-governing">val</span> <span class="org-function-name">make_prompt2</span> <span class="org-tuareg-font-lock-operator">:</span> string <span class="org-tuareg-font-lock-operator">-&gt;</span> int <span class="org-tuareg-font-lock-module">IO.</span>io <span class="org-tuareg-font-lock-operator">=</span> <span class="org-tuareg-font-lock-operator">&lt;</span><span class="org-keyword">fun</span><span class="org-tuareg-font-lock-operator">&gt;</span>
 
<span class="org-tuareg-font-lock-governing">let</span> <span class="org-function-name">do3Times</span><span class="org-variable-name"> action</span> <span class="org-tuareg-font-lock-operator">=</span>
  <span class="org-tuareg-font-lock-governing">let</span> <span class="org-tuareg-font-lock-governing">open </span><span class="org-tuareg-font-lock-module">IO</span> <span class="org-tuareg-font-lock-governing">in</span>
  action    <span class="org-tuareg-font-lock-operator">&gt;&gt;</span>
  action    <span class="org-tuareg-font-lock-operator">&gt;&gt;</span>
  action
  <span class="org-tuareg-font-lock-operator">;;</span>      
<span class="org-tuareg-font-lock-governing">val</span> <span class="org-function-name">do3Times</span> <span class="org-tuareg-font-lock-operator">:</span> 'a <span class="org-tuareg-font-lock-module">IO.</span>io <span class="org-tuareg-font-lock-operator">-&gt;</span> 'a <span class="org-tuareg-font-lock-module">IO.</span>io <span class="org-tuareg-font-lock-operator">=</span> <span class="org-tuareg-font-lock-operator">&lt;</span><span class="org-keyword">fun</span><span class="org-tuareg-font-lock-operator">&gt;</span>

<span class="org-tuareg-font-lock-operator">#</span> <span class="org-tuareg-font-lock-governing">let</span> <span class="org-variable-name">act</span> <span class="org-tuareg-font-lock-operator">=</span> <span class="org-tuareg-font-lock-module">IO.</span>print_string <span class="org-string">"\nHello world"</span> <span class="org-tuareg-font-lock-operator">;;</span>
<span class="org-tuareg-font-lock-governing">val</span> <span class="org-function-name">act</span> <span class="org-tuareg-font-lock-operator">:</span> unit <span class="org-tuareg-font-lock-module">IO.</span>io <span class="org-tuareg-font-lock-operator">=</span> <span class="org-tuareg-font-lock-module">IO.</span><span class="org-tuareg-font-lock-constructor">IO</span> <span class="org-tuareg-font-lock-operator">&lt;</span><span class="org-keyword">fun</span><span class="org-tuareg-font-lock-operator">&gt;</span>

<span class="org-tuareg-font-lock-operator">#</span> <span class="org-tuareg-font-lock-module">IO.</span>run act <span class="org-tuareg-font-lock-operator">;;</span>

<span class="org-tuareg-font-lock-constructor">Hello</span> world<span class="org-tuareg-font-lock-operator">-</span> <span class="org-tuareg-font-lock-operator">:</span> unit <span class="org-tuareg-font-lock-operator">=</span> <span class="org-tuareg-font-lock-operator">()</span>
                                   

<span class="org-tuareg-font-lock-operator">#</span> <span class="org-tuareg-font-lock-governing">let</span> <span class="org-variable-name">act3times</span> <span class="org-tuareg-font-lock-operator">=</span> do3Times act <span class="org-tuareg-font-lock-operator">;;</span>
<span class="org-tuareg-font-lock-governing">val</span> <span class="org-function-name">act3times</span> <span class="org-tuareg-font-lock-operator">:</span> unit <span class="org-tuareg-font-lock-module">IO.</span>io <span class="org-tuareg-font-lock-operator">=</span> <span class="org-tuareg-font-lock-module">IO.</span><span class="org-tuareg-font-lock-constructor">IO</span> <span class="org-tuareg-font-lock-operator">&lt;</span><span class="org-keyword">fun</span><span class="org-tuareg-font-lock-operator">&gt;</span>

<span class="org-tuareg-font-lock-operator">#</span>  <span class="org-tuareg-font-lock-module">IO.</span>run act3times <span class="org-tuareg-font-lock-operator">;;</span>
<span class="org-tuareg-font-lock-constructor">Hello</span> world
<span class="org-tuareg-font-lock-constructor">Hello</span> world
<span class="org-tuareg-font-lock-constructor">Hello</span> world<span class="org-tuareg-font-lock-operator">-</span> <span class="org-tuareg-font-lock-operator">:</span> unit <span class="org-tuareg-font-lock-operator">=</span> <span class="org-tuareg-font-lock-operator">()</span>
<span class="org-tuareg-font-lock-operator">#</span> 

                                         
<span class="org-tuareg-font-lock-operator">#</span>  <span class="org-tuareg-font-lock-module">IO.</span>run action1 <span class="org-tuareg-font-lock-operator">;;</span>
<span class="org-tuareg-font-lock-constructor">Tell</span> your name <span class="org-tuareg-font-lock-operator">:</span><span class="org-tuareg-font-lock-constructor">My</span> name is <span class="org-tuareg-font-lock-constructor">Jack</span>
<span class="org-tuareg-font-lock-constructor">The</span> line is <span class="org-tuareg-font-lock-operator">:</span>
<span class="org-tuareg-font-lock-constructor">My</span> name is <span class="org-tuareg-font-lock-constructor">Jack</span><span class="org-tuareg-font-lock-operator">-</span> <span class="org-tuareg-font-lock-operator">:</span> int <span class="org-tuareg-font-lock-operator">=</span> 15


<span class="org-tuareg-font-lock-operator">&gt;</span>  <span class="org-tuareg-font-lock-module">IO.</span>run <span class="org-tuareg-font-lock-operator">(</span>do3Times action1<span class="org-tuareg-font-lock-operator">)</span> <span class="org-tuareg-font-lock-operator">;;</span>
<span class="org-tuareg-font-lock-constructor">Tell</span> your name <span class="org-tuareg-font-lock-operator">:</span><span class="org-tuareg-font-lock-constructor">Jack</span>
<span class="org-tuareg-font-lock-constructor">The</span> line is <span class="org-tuareg-font-lock-operator">:</span>
<span class="org-tuareg-font-lock-constructor">JackTell</span> your name <span class="org-tuareg-font-lock-operator">:</span><span class="org-tuareg-font-lock-constructor">John</span>
<span class="org-tuareg-font-lock-constructor">The</span> line is <span class="org-tuareg-font-lock-operator">:</span>
<span class="org-tuareg-font-lock-constructor">JohnTell</span> your name <span class="org-tuareg-font-lock-operator">:</span><span class="org-tuareg-font-lock-constructor">Caesar</span>
<span class="org-tuareg-font-lock-constructor">The</span> line is <span class="org-tuareg-font-lock-operator">:</span>
<span class="org-function-name">Caesar-</span> <span class="org-tuareg-font-lock-operator">:</span> int <span class="org-tuareg-font-lock-operator">=</span> 6
<span class="org-tuareg-font-lock-operator">#</span> 

<span class="org-tuareg-font-lock-governing">let</span> <span class="org-variable-name">readTwoNumbers</span> <span class="org-tuareg-font-lock-operator">=</span>
  <span class="org-tuareg-font-lock-governing">let</span> <span class="org-tuareg-font-lock-governing">open </span><span class="org-tuareg-font-lock-module">IO</span> <span class="org-tuareg-font-lock-governing">in</span>
  read_int  <span class="org-tuareg-font-lock-operator">&gt;&gt;=</span> <span class="org-keyword">fun</span> <span class="org-variable-name">a</span> <span class="org-tuareg-font-lock-operator">-&gt;</span>
  read_int  <span class="org-tuareg-font-lock-operator">&gt;&gt;=</span> <span class="org-keyword">fun</span> <span class="org-variable-name">b</span> <span class="org-tuareg-font-lock-operator">-&gt;</span>
  unit <span class="org-tuareg-font-lock-operator">(</span>2 <span class="org-tuareg-font-lock-operator">*</span>a <span class="org-tuareg-font-lock-operator">+</span> b<span class="org-tuareg-font-lock-operator">)</span>
<span class="org-tuareg-font-lock-operator">;;</span>
<span class="org-tuareg-font-lock-governing">val</span> <span class="org-function-name">readTwoNumbers</span> <span class="org-tuareg-font-lock-operator">:</span> int <span class="org-tuareg-font-lock-module">IO.</span>io <span class="org-tuareg-font-lock-operator">=</span> <span class="org-tuareg-font-lock-module">IO.</span><span class="org-tuareg-font-lock-constructor">IO</span> <span class="org-tuareg-font-lock-operator">&lt;</span><span class="org-keyword">fun</span><span class="org-tuareg-font-lock-operator">&gt;</span>
                                             

<span class="org-tuareg-font-lock-operator">#</span> <span class="org-tuareg-font-lock-module">IO.</span>replicateM_  5 <span class="org-tuareg-font-lock-operator">(</span><span class="org-tuareg-font-lock-module">IO.</span>print_string <span class="org-string">"\nHello World\n"</span><span class="org-tuareg-font-lock-operator">)</span> <span class="org-tuareg-font-lock-operator">;;</span>
<span class="org-function-name">-</span> <span class="org-tuareg-font-lock-operator">:</span> unit <span class="org-tuareg-font-lock-module">IO.</span>io <span class="org-tuareg-font-lock-operator">=</span> <span class="org-tuareg-font-lock-module">IO.</span><span class="org-tuareg-font-lock-constructor">IO</span> <span class="org-tuareg-font-lock-operator">&lt;</span><span class="org-keyword">fun</span><span class="org-tuareg-font-lock-operator">&gt;</span>
<span class="org-tuareg-font-lock-operator">#</span> 
  <span class="org-tuareg-font-lock-module">IO.</span>run <span class="org-tuareg-font-lock-operator">(</span><span class="org-tuareg-font-lock-module">IO.</span>replicateM_  5 <span class="org-tuareg-font-lock-operator">(</span><span class="org-tuareg-font-lock-module">IO.</span>print_string <span class="org-string">"\nHello World\n"</span><span class="org-tuareg-font-lock-operator">))</span> <span class="org-tuareg-font-lock-operator">;;</span>

<span class="org-tuareg-font-lock-constructor">Hello</span> <span class="org-tuareg-font-lock-constructor">World</span>

<span class="org-tuareg-font-lock-constructor">Hello</span> <span class="org-tuareg-font-lock-constructor">World</span>

<span class="org-tuareg-font-lock-constructor">Hello</span> <span class="org-tuareg-font-lock-constructor">World</span>

<span class="org-tuareg-font-lock-constructor">Hello</span> <span class="org-tuareg-font-lock-constructor">World</span>

<span class="org-tuareg-font-lock-constructor">Hello</span> <span class="org-tuareg-font-lock-constructor">World</span>
<span class="org-function-name">-</span> <span class="org-tuareg-font-lock-operator">:</span> unit <span class="org-tuareg-font-lock-operator">=</span> <span class="org-tuareg-font-lock-operator">()</span>
<span class="org-tuareg-font-lock-operator">#</span> 

<span class="org-tuareg-font-lock-operator">#</span>  <span class="org-tuareg-font-lock-module">IO.</span>run <span class="org-tuareg-font-lock-module">IO.</span>read_int <span class="org-tuareg-font-lock-operator">;;</span>
232
<span class="org-function-name">-</span> <span class="org-tuareg-font-lock-operator">:</span> int <span class="org-tuareg-font-lock-operator">=</span> 232
 
<span class="org-tuareg-font-lock-operator">#</span> <span class="org-tuareg-font-lock-module">IO.</span>replicateM 4 <span class="org-tuareg-font-lock-module">IO.</span>read_int <span class="org-tuareg-font-lock-operator">;;</span>
<span class="org-function-name">-</span> <span class="org-tuareg-font-lock-operator">:</span> int list <span class="org-tuareg-font-lock-module">IO.</span>io <span class="org-tuareg-font-lock-operator">=</span> <span class="org-tuareg-font-lock-module">IO.</span><span class="org-tuareg-font-lock-constructor">IO</span> <span class="org-tuareg-font-lock-operator">&lt;</span><span class="org-keyword">fun</span><span class="org-tuareg-font-lock-operator">&gt;</span>
 
<span class="org-tuareg-font-lock-operator">#</span>  <span class="org-tuareg-font-lock-module">IO.</span>run <span class="org-tuareg-font-lock-operator">(</span><span class="org-tuareg-font-lock-module">IO.</span>replicateM 4 <span class="org-tuareg-font-lock-module">IO.</span>read_int<span class="org-tuareg-font-lock-operator">)</span> <span class="org-tuareg-font-lock-operator">;;</span>
2
43
34
100
<span class="org-function-name">-</span> <span class="org-tuareg-font-lock-operator">:</span> <span class="org-tuareg-font-lock-governing">in</span>


<span class="org-tuareg-font-lock-governing">let</span> <span class="org-variable-name">echoLine</span> <span class="org-tuareg-font-lock-operator">=</span>
  <span class="org-tuareg-font-lock-governing">let</span> <span class="org-tuareg-font-lock-governing">open </span><span class="org-tuareg-font-lock-module">IO</span> <span class="org-tuareg-font-lock-governing">in</span>
  read_line         <span class="org-tuareg-font-lock-operator">&gt;&gt;=</span> <span class="org-keyword">fun</span> <span class="org-variable-name">line</span> <span class="org-tuareg-font-lock-operator">-&gt;</span>
  print_string line
<span class="org-tuareg-font-lock-operator">;;</span>               

<span class="org-tuareg-font-lock-governing">val</span> <span class="org-function-name">echoLine</span> <span class="org-tuareg-font-lock-operator">:</span> unit <span class="org-tuareg-font-lock-module">IO.</span>io <span class="org-tuareg-font-lock-operator">=</span> <span class="org-tuareg-font-lock-module">IO.</span><span class="org-tuareg-font-lock-constructor">IO</span> <span class="org-tuareg-font-lock-operator">&lt;</span><span class="org-keyword">fun</span><span class="org-tuareg-font-lock-operator">&gt;</span>


<span class="org-tuareg-font-lock-operator">#</span>  <span class="org-tuareg-font-lock-module">IO.</span>run echoLine <span class="org-tuareg-font-lock-operator">;;</span>
<span class="org-tuareg-font-lock-constructor">Hello</span> world
<span class="org-tuareg-font-lock-constructor">Hello</span> world<span class="org-tuareg-font-lock-operator">-</span> <span class="org-tuareg-font-lock-operator">:</span> unit <span class="org-tuareg-font-lock-operator">=</span> <span class="org-tuareg-font-lock-operator">()</span>
<span class="org-tuareg-font-lock-operator">#</span>

<span class="org-tuareg-font-lock-operator">#</span>  <span class="org-tuareg-font-lock-module">IO.</span>forever echoLine <span class="org-tuareg-font-lock-operator">;;</span>
<span class="org-function-name">-</span> <span class="org-tuareg-font-lock-operator">:</span> unit <span class="org-tuareg-font-lock-module">IO.</span>io <span class="org-tuareg-font-lock-operator">=</span> <span class="org-tuareg-font-lock-module">IO.</span><span class="org-tuareg-font-lock-constructor">IO</span> <span class="org-tuareg-font-lock-operator">&lt;</span><span class="org-keyword">fun</span><span class="org-tuareg-font-lock-operator">&gt;</span>

<span class="org-tuareg-font-lock-operator">#</span> <span class="org-tuareg-font-lock-governing">let</span> <span class="org-variable-name">echoLoop</span> <span class="org-tuareg-font-lock-operator">=</span> <span class="org-tuareg-font-lock-module">IO.</span>forever echoLine <span class="org-tuareg-font-lock-operator">;;</span>
<span class="org-tuareg-font-lock-governing">val</span> <span class="org-function-name">echoLoop</span> <span class="org-tuareg-font-lock-operator">:</span> unit <span class="org-tuareg-font-lock-module">IO.</span>io <span class="org-tuareg-font-lock-operator">=</span> <span class="org-tuareg-font-lock-module">IO.</span><span class="org-tuareg-font-lock-constructor">IO</span> <span class="org-tuareg-font-lock-operator">&lt;</span><span class="org-keyword">fun</span><span class="org-tuareg-font-lock-operator">&gt;</span>
 
<span class="org-tuareg-font-lock-operator">#</span>  <span class="org-tuareg-font-lock-module">IO.</span>run echoLoop <span class="org-tuareg-font-lock-operator">;;</span>
line1
line1
line2
line2
line3
line3   <span class="org-comment-delimiter">(* </span><span class="org-comment">Hit Ctrl + D </span><span class="org-comment-delimiter">*)</span>
<span class="org-function-name">Exception</span><span class="org-tuareg-font-lock-operator">:</span> <span class="org-tuareg-font-lock-module">End_of_file.</span>


<span class="org-tuareg-font-lock-operator">#</span>  <span class="org-tuareg-font-lock-module">IO.</span>mapM <span class="org-tuareg-font-lock-operator">;;</span>
<span class="org-function-name">-</span> <span class="org-tuareg-font-lock-operator">:</span> <span class="org-tuareg-font-lock-operator">(</span>'a <span class="org-tuareg-font-lock-operator">-&gt;</span> 'b <span class="org-tuareg-font-lock-module">IO.</span>io<span class="org-tuareg-font-lock-operator">)</span> <span class="org-tuareg-font-lock-operator">-&gt;</span> 'a list <span class="org-tuareg-font-lock-operator">-&gt;</span> 'b list <span class="org-tuareg-font-lock-module">IO.</span>io <span class="org-tuareg-font-lock-operator">=</span> <span class="org-tuareg-font-lock-operator">&lt;</span><span class="org-keyword">fun</span><span class="org-tuareg-font-lock-operator">&gt;</span>
 
<span class="org-tuareg-font-lock-operator">#</span>  <span class="org-tuareg-font-lock-module">IO.</span>mapM <span class="org-tuareg-font-lock-module">IO.</span>print_string <span class="org-tuareg-font-lock-operator">[</span><span class="org-string">"a"</span><span class="org-tuareg-font-lock-operator">;</span> <span class="org-string">"b"</span><span class="org-tuareg-font-lock-operator">;</span> <span class="org-string">"c"</span><span class="org-tuareg-font-lock-operator">;</span> <span class="org-string">"d"</span><span class="org-tuareg-font-lock-operator">]</span> <span class="org-tuareg-font-lock-operator">;;</span>
<span class="org-function-name">-</span> <span class="org-tuareg-font-lock-operator">:</span> unit list <span class="org-tuareg-font-lock-module">IO.</span>io <span class="org-tuareg-font-lock-operator">=</span> <span class="org-tuareg-font-lock-module">IO.</span><span class="org-tuareg-font-lock-constructor">IO</span> <span class="org-tuareg-font-lock-operator">&lt;</span><span class="org-keyword">fun</span><span class="org-tuareg-font-lock-operator">&gt;</span>
<span class="org-tuareg-font-lock-operator">#</span> 

<span class="org-tuareg-font-lock-operator">#</span>  <span class="org-tuareg-font-lock-module">IO.</span>run <span class="org-tuareg-font-lock-operator">(</span><span class="org-tuareg-font-lock-module">IO.</span>mapM_ <span class="org-tuareg-font-lock-module">IO.</span>print_string <span class="org-tuareg-font-lock-operator">[</span><span class="org-string">"a"</span><span class="org-tuareg-font-lock-operator">;</span> <span class="org-string">"b"</span><span class="org-tuareg-font-lock-operator">;</span> <span class="org-string">"c"</span><span class="org-tuareg-font-lock-operator">;</span> <span class="org-string">"d"</span><span class="org-tuareg-font-lock-operator">]</span> <span class="org-tuareg-font-lock-operator">);;</span>
<span class="org-function-name">abcd-</span> <span class="org-tuareg-font-lock-operator">:</span> unit <span class="org-tuareg-font-lock-operator">=</span> <span class="org-tuareg-font-lock-operator">()</span>                       
              

<span class="org-tuareg-font-lock-operator">#</span> <span class="org-tuareg-font-lock-governing">let</span> <span class="org-tuareg-font-lock-governing">open </span><span class="org-tuareg-font-lock-module">IO</span> <span class="org-tuareg-font-lock-governing">in</span> replicateM_ 6 <span class="org-tuareg-font-lock-operator">(</span>print_string <span class="org-string">"\ntest"</span><span class="org-tuareg-font-lock-operator">)</span> <span class="org-tuareg-font-lock-operator">|&gt;</span> run <span class="org-tuareg-font-lock-operator">;;</span>

test
test
test
test
test
<span class="org-function-name">test-</span> <span class="org-tuareg-font-lock-operator">:</span> unit <span class="org-tuareg-font-lock-operator">=</span> <span class="org-tuareg-font-lock-operator">()</span>
<span class="org-tuareg-font-lock-operator">#</span>
</pre>
</div>
</div>
</div>
</div>

<div id="outline-container-sec-1-14-7" class="outline-4">
<h4 id="sec-1-14-7"><span class="section-number-4">1.14.7</span> State Monad</h4>
<div class="outline-text-4" id="text-1-14-7">
</div><div id="outline-container-sec-1-14-7-1" class="outline-5">
<h5 id="sec-1-14-7-1"><span class="section-number-5">1.14.7.1</span> Overview</h5>
<div class="outline-text-5" id="text-1-14-7-1">
<p>
The state monad represents stateful in purely
functional way. 
</p>
</div>
</div>

<div id="outline-container-sec-1-14-7-2" class="outline-5">
<h5 id="sec-1-14-7-2"><span class="section-number-5">1.14.7.2</span> State monad in Haskell</h5>
<div class="outline-text-5" id="text-1-14-7-2">
<p>
The state monad in Haskell 2010 standard is not implemented in a
simple way like in Haskell 98 which breaks legacy codes from papers
and old books based on the 98 standards. Now it is implemented as a
combination of StateT monad transformer and Identity monad. Despite
the implementation changes the behavior of State monad is the same as
in the old one.
</p>



<div class="org-src-container">

<pre class="src src-haskell"><span class="org-haskell-keyword">type</span> <span class="org-haskell-constructor">State</span> s <span class="org-haskell-operator">=</span> <span class="org-haskell-constructor">StateT</span> s <span class="org-haskell-constructor">Data.Functor.Identity.Identity</span>
        <span class="org-comment-delimiter">-- </span><span class="org-comment">Defined in &#8216;Control.Monad.Trans.State.Lazy&#8217;</span>

<span class="org-comment-delimiter">--</span><span class="org-comment">- Old Implementation: </span>
<span class="org-comment-delimiter">--</span><span class="org-comment">-</span>
<span class="org-haskell-keyword">newtype</span> <span class="org-haskell-constructor">State</span> s a <span class="org-haskell-operator">=</span> <span class="org-haskell-constructor">State</span> { runState <span class="org-haskell-operator">::</span> s <span class="org-haskell-operator">-&gt;</span> (a<span class="org-haskell-operator">,</span> s)  }
</pre>
</div>

<p>
It is equivalent to: 
</p>

<p>
<code>type State s a = s -&gt; (a, s)</code>
</p>

<p>
State transformer:
</p>

<p>
<b>state</b> 
</p>

<p>
Wraps a state transformer function of type <code>s -&gt; (a, s)</code> into a State
type constructor. 
</p>

<div class="org-src-container">

<pre class="src src-haskell"><span class="org-function-name">state</span> <span class="org-haskell-operator">::</span> <span class="org-haskell-constructor">MonadState</span> s m <span class="org-haskell-operator">=&gt;</span> (s <span class="org-haskell-operator">-&gt;</span> (a<span class="org-haskell-operator">,</span> s)) <span class="org-haskell-operator">-&gt;</span> m a

<span class="org-haskell-operator">&gt;&gt;&gt;</span> <span class="org-haskell-keyword">import</span> <span class="org-haskell-constructor">Control.Monad.State</span>

<span class="org-haskell-operator">&gt;&gt;&gt;</span> <span class="org-haskell-keyword">let</span> fnSt <span class="org-haskell-operator">=</span> (state <span class="org-haskell-operator">$</span> <span class="org-haskell-operator">\</span>s <span class="org-haskell-operator">-&gt;</span> (s <span class="org-haskell-operator">*</span> 3<span class="org-haskell-operator">,</span> s <span class="org-haskell-operator">+</span> 2) ) <span class="org-haskell-operator">::</span> <span class="org-haskell-constructor">State</span> <span class="org-haskell-constructor">Int</span> <span class="org-haskell-constructor">Int</span>

<span class="org-haskell-operator">&gt;&gt;&gt;</span> <span class="org-haskell-constructor">:</span>t fnSt 
<span class="org-function-name">fnSt</span> <span class="org-haskell-operator">::</span> <span class="org-haskell-constructor">State</span> <span class="org-haskell-constructor">Int</span> <span class="org-haskell-constructor">Int</span>
<span class="org-haskell-operator">&gt;&gt;&gt;</span> 

<span class="org-haskell-operator">&gt;&gt;&gt;</span> runState fnSt 1
(3<span class="org-haskell-operator">,</span>3)
<span class="org-haskell-operator">&gt;&gt;&gt;</span> runState fnSt 0
(0<span class="org-haskell-operator">,</span>2)
<span class="org-haskell-operator">&gt;&gt;&gt;</span> runState fnSt 2
(6<span class="org-haskell-operator">,</span>4)

<span class="org-comment-delimiter">{-</span>
<span class="org-comment">  In the old implementation it was: </span>

<span class="org-comment">  let fnSt = (State $ \s -&gt; (s * 3, s + 2)) :: State Int Int </span>

<span class="org-comment"> It doesn't work anymore. </span>
<span class="org-comment">-}</span> 

<span class="org-haskell-operator">&gt;&gt;&gt;</span> <span class="org-haskell-keyword">let</span> fnSt <span class="org-haskell-operator">=</span> (<span class="org-haskell-constructor">State</span> <span class="org-haskell-operator">$</span> <span class="org-haskell-operator">\</span>s <span class="org-haskell-operator">-&gt;</span> (s <span class="org-haskell-operator">*</span> 3<span class="org-haskell-operator">,</span> s <span class="org-haskell-operator">+</span> 2) ) <span class="org-haskell-operator">::</span> <span class="org-haskell-constructor">State</span> <span class="org-haskell-constructor">Int</span> <span class="org-haskell-constructor">Int</span>
<span class="org-haskell-constructor">Prelude</span> <span class="org-haskell-constructor">System.Directory</span> <span class="org-haskell-constructor">System.Process</span> <span class="org-haskell-constructor">Control.Monad.State</span><span class="org-haskell-operator">|</span> 

<span class="org-haskell-operator">&lt;</span>interactive<span class="org-haskell-operator">&gt;:</span>223<span class="org-haskell-constructor">:</span>13<span class="org-haskell-constructor">:</span>
    <span class="org-haskell-constructor">Not</span> <span class="org-haskell-keyword">in</span> scope<span class="org-haskell-constructor">:</span> <span class="org-haskell-keyword">data</span> constructor <span class="org-haskell-operator">&#8216;</span><span class="org-haskell-constructor">State</span><span class="org-haskell-operator">&#8217;</span>
    <span class="org-haskell-constructor">Perhaps</span> you meant one <span class="org-haskell-keyword">of</span> these<span class="org-haskell-constructor">:</span>
      <span class="org-haskell-operator">&#8216;</span><span class="org-haskell-constructor">StateT</span><span class="org-haskell-operator">&#8217;</span> (imported from <span class="org-haskell-constructor">Control.Monad.State</span>)<span class="org-haskell-operator">,</span>
      variable <span class="org-haskell-operator">&#8216;</span>state<span class="org-haskell-operator">&#8217;</span> (imported from <span class="org-haskell-constructor">Control.Monad.State</span>)
<span class="org-haskell-operator">&gt;&gt;&gt;</span>
</pre>
</div>

<p>
<b>runState</b>
</p>

<p>
Applies a state transformer type (State s a) to a current state and
returns a new state and an output. 
</p>

<div class="org-src-container">

<pre class="src src-haskell"><span class="org-function-name">runState</span> <span class="org-haskell-operator">::</span> <span class="org-haskell-constructor">State</span> s a <span class="org-haskell-operator">-&gt;</span> s <span class="org-haskell-operator">-&gt;</span> (a<span class="org-haskell-operator">,</span> s)
</pre>
</div>


<p>
<b>evalState</b>
</p>

<p>
Similar to runState, but returns only the output. 
</p>

<div class="org-src-container">

<pre class="src src-haskell"><span class="org-function-name">evalState</span> <span class="org-haskell-operator">::</span> <span class="org-haskell-constructor">State</span> s a <span class="org-haskell-operator">-&gt;</span> s <span class="org-haskell-operator">-&gt;</span> a
<span class="org-haskell-definition">evalState</span> <span class="org-haskell-operator">=</span> fst <span class="org-haskell-operator">.</span> runState
</pre>
</div>

<p>
<b>execState</b>
</p>

<p>
Similar to runState, but returns only the next state. 
</p>

<div class="org-src-container">

<pre class="src src-haskell"><span class="org-function-name">execState</span> <span class="org-haskell-operator">::</span> <span class="org-haskell-constructor">State</span> s a <span class="org-haskell-operator">-&gt;</span> s <span class="org-haskell-operator">-&gt;</span> s
<span class="org-haskell-definition">execState</span> <span class="org-haskell-operator">=</span> snd <span class="org-haskell-operator">.</span> runState
</pre>
</div>

<p>
<b>return</b> 
</p>

<p>
Sets the output regardless of the current state:
</p>

<div class="org-src-container">

<pre class="src src-haskell"><span class="org-haskell-definition">return</span> a <span class="org-haskell-operator">=</span> <span class="org-haskell-constructor">State</span> <span class="org-haskell-operator">$</span> <span class="org-haskell-operator">\</span>s <span class="org-haskell-operator">-&gt;</span>  (a<span class="org-haskell-operator">,</span> s)

<span class="org-haskell-operator">&gt;&gt;&gt;</span> <span class="org-haskell-keyword">let</span> st <span class="org-haskell-operator">=</span> return 10 <span class="org-haskell-operator">::</span> <span class="org-haskell-constructor">State</span> <span class="org-haskell-constructor">Int</span> <span class="org-haskell-constructor">Int</span>
<span class="org-haskell-operator">&gt;&gt;&gt;</span> runState st 0
(10<span class="org-haskell-operator">,</span>0)
<span class="org-haskell-operator">&gt;&gt;&gt;</span> runState st 1
(10<span class="org-haskell-operator">,</span>1)
<span class="org-haskell-operator">&gt;&gt;&gt;</span> runState st 2
(10<span class="org-haskell-operator">,</span>2)
<span class="org-haskell-operator">&gt;&gt;&gt;</span> 

<span class="org-haskell-operator">&gt;&gt;&gt;</span> runState (return 10) 0
(10<span class="org-haskell-operator">,</span>0)
<span class="org-haskell-operator">&gt;&gt;&gt;</span> runState (return 10) 1
(10<span class="org-haskell-operator">,</span>1)
<span class="org-haskell-operator">&gt;&gt;&gt;</span> runState (return 10) 2
(10<span class="org-haskell-operator">,</span>2)
<span class="org-haskell-operator">&gt;&gt;&gt;</span> runState (return 10) 3
(10<span class="org-haskell-operator">,</span>3)
<span class="org-haskell-operator">&gt;&gt;&gt;</span> runState (return 10) 4
</pre>
</div>

<p>
<b>bind</b>
</p>

<p>
Note: This is the old implementation with meaningful names. But with
the same behavior as the new implementation. 
</p>

<div class="org-src-container">

<pre class="src src-haskell">(<span class="org-haskell-definition">&gt;&gt;=</span>) <span class="org-haskell-operator">::</span> <span class="org-haskell-constructor">State</span> s a <span class="org-haskell-operator">-&gt;</span> (a <span class="org-haskell-operator">-&gt;</span> <span class="org-haskell-constructor">State</span> s b) <span class="org-haskell-operator">-&gt;</span> <span class="org-haskell-constructor">State</span> s b 
stateFn <span class="org-haskell-definition">&gt;&gt;=</span> stateMaker  <span class="org-haskell-operator">=</span>
  <span class="org-haskell-constructor">State</span> <span class="org-haskell-operator">$</span> <span class="org-haskell-operator">\</span>oldState <span class="org-haskell-operator">-&gt;</span> <span class="org-haskell-keyword">let</span> (result<span class="org-haskell-operator">,</span> newState) <span class="org-haskell-operator">=</span> runState stateFn oldState
                       <span class="org-haskell-keyword">in</span>  runState (stateMaker result) newState
</pre>
</div>

<p>
<b>put</b>
</p>

<p>
Set a state ignoring the output. 
</p>

<div class="org-src-container">

<pre class="src src-haskell"><span class="org-function-name">put</span> <span class="org-haskell-operator">::</span> <span class="org-haskell-constructor">MonadState</span> s m <span class="org-haskell-operator">=&gt;</span> s <span class="org-haskell-operator">-&gt;</span> m <span class="org-haskell-constructor">()</span>

<span class="org-comment-delimiter">-- </span><span class="org-comment">Old implementation: </span>
<span class="org-comment-delimiter">--</span>
<span class="org-function-name">put</span> <span class="org-haskell-operator">::</span> s <span class="org-haskell-operator">-&gt;</span> <span class="org-haskell-constructor">State</span> s <span class="org-haskell-constructor">()</span>
<span class="org-haskell-definition">put</span> s <span class="org-haskell-operator">=</span> <span class="org-haskell-constructor">State</span> (<span class="org-haskell-operator">\</span> <span class="org-haskell-keyword">_</span> <span class="org-haskell-operator">-&gt;</span> (<span class="org-haskell-constructor">()</span><span class="org-haskell-operator">,</span> s))

<span class="org-haskell-operator">&gt;&gt;&gt;</span> runState (put 10) 0
(<span class="org-haskell-constructor">()</span><span class="org-haskell-operator">,</span>10)
<span class="org-haskell-operator">&gt;&gt;&gt;</span> runState (put 10) 1
(<span class="org-haskell-constructor">()</span><span class="org-haskell-operator">,</span>10)
<span class="org-haskell-operator">&gt;&gt;&gt;</span> runState (put 10) 2
(<span class="org-haskell-constructor">()</span><span class="org-haskell-operator">,</span>10)
<span class="org-haskell-operator">&gt;&gt;&gt;</span> runState (put 10) 3
(<span class="org-haskell-constructor">()</span><span class="org-haskell-operator">,</span>10)

<span class="org-haskell-operator">&gt;&gt;&gt;</span> execState (put 10) 0
10
<span class="org-haskell-operator">&gt;&gt;&gt;</span> execState (put 10) 1
10
<span class="org-haskell-operator">&gt;&gt;&gt;</span> execState (put 10) 2
10
<span class="org-haskell-operator">&gt;&gt;&gt;</span> execState (put 10) 3
10
<span class="org-haskell-operator">&gt;&gt;&gt;</span>
</pre>
</div>

<p>
<b>get</b>
</p>

<p>
Get the current state. 
</p>

<div class="org-src-container">

<pre class="src src-haskell"><span class="org-function-name">get</span> <span class="org-haskell-operator">::</span> <span class="org-haskell-constructor">MonadState</span> s m <span class="org-haskell-operator">=&gt;</span> m s

<span class="org-comment-delimiter">-- </span><span class="org-comment">Old implementation: </span>
<span class="org-comment-delimiter">-- </span>
<span class="org-function-name">get</span> <span class="org-haskell-operator">::</span> <span class="org-haskell-constructor">State</span> s s
<span class="org-haskell-definition">get</span> <span class="org-haskell-operator">=</span> <span class="org-haskell-constructor">State</span> (<span class="org-haskell-operator">\</span>s <span class="org-haskell-operator">-&gt;</span> (s<span class="org-haskell-operator">,</span> s))

<span class="org-haskell-operator">&gt;&gt;&gt;</span> runState get 0
(0<span class="org-haskell-operator">,</span>0)
<span class="org-haskell-operator">&gt;&gt;&gt;</span> runState get 1
(1<span class="org-haskell-operator">,</span>1)
<span class="org-haskell-operator">&gt;&gt;&gt;</span> runState get 2
(2<span class="org-haskell-operator">,</span>2)
<span class="org-haskell-operator">&gt;&gt;&gt;</span> runState get 3
(3<span class="org-haskell-operator">,</span>3)
</pre>
</div>


<p>
<b>withstate</b>
</p>

<p>
withState f m executes action m on a state modified by applying
f. (Documentation)
</p>

<div class="org-src-container">

<pre class="src src-haskell"><span class="org-function-name">withState</span> <span class="org-haskell-operator">::</span> (s <span class="org-haskell-operator">-&gt;</span> s) <span class="org-haskell-operator">-&gt;</span> <span class="org-haskell-constructor">State</span> s a <span class="org-haskell-operator">-&gt;</span> <span class="org-haskell-constructor">State</span> s a
<span class="org-haskell-definition">withState</span> f m <span class="org-haskell-operator">=</span> modify f <span class="org-haskell-operator">&gt;&gt;</span> m
</pre>
</div>


<p>
<b>fmap</b> 
</p>

<p>
Returns a new state transformer applying a function to the output of
the old state transformer.
</p>

<p>
Note: This the old implementation without StateT. However it still
works in the same way and still describes what the State functor does.
</p>

<div class="org-src-container">

<pre class="src src-haskell"><span class="org-haskell-keyword">instance</span> <span class="org-haskell-constructor">Functor</span> (<span class="org-haskell-constructor">State</span> s) <span class="org-haskell-keyword">where</span>
  
  <span class="org-comment-delimiter">-- </span><span class="org-comment">Applies a function to the state output. </span>
  <span class="org-comment-delimiter">--</span>
  <span class="org-comment-delimiter">-- </span><span class="org-comment">fmap :: (a -&gt; b) -&gt; F a -&gt; F b </span>
  <span class="org-comment-delimiter">--</span>
  <span class="org-comment-delimiter">-- </span><span class="org-comment">fmap :: (a -&gt; b) -&gt; State s a -&gt; State s b</span>
  fmap f fns <span class="org-haskell-operator">=</span>
    <span class="org-haskell-constructor">State</span> <span class="org-haskell-operator">$</span> <span class="org-haskell-operator">\</span>oldState <span class="org-haskell-operator">-&gt;</span> <span class="org-haskell-keyword">let</span> (output<span class="org-haskell-operator">,</span> newState) <span class="org-haskell-operator">=</span> runState fns oldState
                         <span class="org-haskell-keyword">in</span> (f output<span class="org-haskell-operator">,</span> newState)
</pre>
</div>


<p>
Example:
</p>

<div class="org-src-container">

<pre class="src src-haskell"><span class="org-haskell-operator">&gt;&gt;&gt;</span> <span class="org-haskell-keyword">import</span> <span class="org-haskell-constructor">Control.Monad.State</span> 
<span class="org-haskell-operator">&gt;&gt;&gt;</span> 

<span class="org-haskell-operator">&gt;&gt;&gt;</span> <span class="org-haskell-constructor">:</span>show language
<span class="org-haskell-definition">base</span> language is<span class="org-haskell-constructor">:</span> <span class="org-haskell-constructor">Haskell2010</span>
<span class="org-haskell-definition">with</span> the following modifiers<span class="org-haskell-constructor">:</span>
  <span class="org-haskell-operator">-</span><span class="org-haskell-constructor">XNoDatatypeContexts</span>
  <span class="org-haskell-operator">-</span><span class="org-haskell-constructor">XNondecreasingIndentation</span>
<span class="org-haskell-operator">&gt;&gt;&gt;</span>

<span class="org-haskell-operator">&gt;&gt;&gt;</span> <span class="org-haskell-constructor">:</span>info <span class="org-haskell-constructor">State</span>
<span class="org-haskell-keyword">type</span> <span class="org-haskell-constructor">State</span> s <span class="org-haskell-operator">=</span> <span class="org-haskell-constructor">StateT</span> s <span class="org-haskell-constructor">Data.Functor.Identity.Identity</span>
        <span class="org-comment-delimiter">-- </span><span class="org-comment">Defined in &#8216;Control.Monad.Trans.State.Lazy&#8217;</span>

<span class="org-comment-delimiter">-- </span><span class="org-comment">Check type signature </span>
<span class="org-comment-delimiter">-- </span>
<span class="org-haskell-operator">&gt;&gt;&gt;</span> <span class="org-haskell-constructor">:</span>t state
<span class="org-function-name">state</span> <span class="org-haskell-operator">::</span> <span class="org-haskell-constructor">MonadState</span> s m <span class="org-haskell-operator">=&gt;</span> (s <span class="org-haskell-operator">-&gt;</span> (a<span class="org-haskell-operator">,</span> s)) <span class="org-haskell-operator">-&gt;</span> m a
<span class="org-haskell-operator">&gt;&gt;&gt;</span> 

<span class="org-haskell-operator">&gt;&gt;&gt;</span> <span class="org-haskell-constructor">:</span>t evalState
<span class="org-function-name">evalState</span> <span class="org-haskell-operator">::</span> <span class="org-haskell-constructor">State</span> s a <span class="org-haskell-operator">-&gt;</span> s <span class="org-haskell-operator">-&gt;</span> a
<span class="org-haskell-operator">&gt;&gt;&gt;</span> 

<span class="org-haskell-operator">&gt;&gt;&gt;</span> <span class="org-haskell-constructor">:</span>t evalState
<span class="org-function-name">evalState</span> <span class="org-haskell-operator">::</span> <span class="org-haskell-constructor">State</span> s a <span class="org-haskell-operator">-&gt;</span> s <span class="org-haskell-operator">-&gt;</span> a
<span class="org-haskell-operator">&gt;&gt;&gt;</span> 

<span class="org-haskell-operator">&gt;&gt;&gt;</span> <span class="org-haskell-constructor">:</span>t runState
<span class="org-function-name">runState</span> <span class="org-haskell-operator">::</span> <span class="org-haskell-constructor">State</span> s a <span class="org-haskell-operator">-&gt;</span> s <span class="org-haskell-operator">-&gt;</span> (a<span class="org-haskell-operator">,</span> s)
<span class="org-haskell-operator">&gt;&gt;&gt;</span>

<span class="org-haskell-operator">&gt;&gt;&gt;</span> <span class="org-haskell-constructor">:</span>t put
<span class="org-function-name">put</span> <span class="org-haskell-operator">::</span> <span class="org-haskell-constructor">MonadState</span> s m <span class="org-haskell-operator">=&gt;</span> s <span class="org-haskell-operator">-&gt;</span> m <span class="org-haskell-constructor">()</span>
<span class="org-haskell-operator">&gt;&gt;&gt;</span> 
<span class="org-haskell-operator">&gt;&gt;&gt;</span> <span class="org-haskell-constructor">:</span>t get
<span class="org-function-name">get</span> <span class="org-haskell-operator">::</span> <span class="org-haskell-constructor">MonadState</span> s m <span class="org-haskell-operator">=&gt;</span> m s
<span class="org-haskell-operator">&gt;&gt;&gt;</span> 

<span class="org-comment-delimiter">-- </span><span class="org-comment">Code block to paste in the GHCI repl </span>
<span class="org-comment-delimiter">-- </span>
<span class="org-comment-delimiter">--</span>

<span class="org-haskell-operator">&gt;&gt;&gt;</span> <span class="org-haskell-keyword">let</span> postincrement <span class="org-haskell-operator">=</span> <span class="org-haskell-keyword">do</span> { x <span class="org-haskell-operator">&lt;-</span> get<span class="org-haskell-operator">;</span> put (x<span class="org-haskell-operator">+</span>1)<span class="org-haskell-operator">;</span> return x }

<span class="org-haskell-operator">&gt;&gt;&gt;</span> runState postincrement 1
(1<span class="org-haskell-operator">,</span>2)
<span class="org-haskell-operator">&gt;&gt;&gt;</span> runState postincrement 2
(2<span class="org-haskell-operator">,</span>3)
<span class="org-haskell-operator">&gt;&gt;&gt;</span> runState postincrement 3
(3<span class="org-haskell-operator">,</span>4)
<span class="org-haskell-operator">&gt;&gt;&gt;</span> 

<span class="org-haskell-constructor">:</span>set <span class="org-haskell-operator">+</span>m  

<span class="org-haskell-constructor">:</span>{
  
<span class="org-haskell-keyword">let</span> stFn <span class="org-haskell-operator">::</span> <span class="org-haskell-constructor">Int</span> <span class="org-haskell-operator">-&gt;</span> (<span class="org-haskell-constructor">Int</span><span class="org-haskell-operator">,</span> <span class="org-haskell-constructor">Int</span>)
    stFn <span class="org-haskell-operator">=</span> <span class="org-haskell-operator">\</span> currentState <span class="org-haskell-operator">-&gt;</span>
      <span class="org-haskell-keyword">let</span> output <span class="org-haskell-operator">=</span> 2 <span class="org-haskell-operator">*</span> currentState <span class="org-haskell-keyword">in</span>
      <span class="org-haskell-keyword">let</span> nextState <span class="org-haskell-operator">=</span> currentState <span class="org-haskell-operator">+</span> 1 <span class="org-haskell-keyword">in</span>
      (output<span class="org-haskell-operator">,</span> nextState)
<span class="org-haskell-constructor">:</span>}      
      
<span class="org-haskell-operator">&gt;&gt;&gt;</span> <span class="org-haskell-constructor">:</span>t stFn
<span class="org-function-name">stFn</span> <span class="org-haskell-operator">::</span> <span class="org-haskell-constructor">Int</span> <span class="org-haskell-operator">-&gt;</span> (<span class="org-haskell-constructor">Int</span><span class="org-haskell-operator">,</span> <span class="org-haskell-constructor">Int</span>)
<span class="org-haskell-operator">&gt;&gt;&gt;</span>

<span class="org-haskell-operator">&gt;&gt;&gt;</span> stFn 1   <span class="org-comment-delimiter">-- </span><span class="org-comment">S0 = 1 --&gt; S1 = 2, output = 2  </span>
(2<span class="org-haskell-operator">,</span>2)
<span class="org-haskell-operator">&gt;&gt;&gt;</span> stFn 2   <span class="org-comment-delimiter">-- </span><span class="org-comment">S1 = 1 --&gt; S2 = 3, output = 4 </span>
(4<span class="org-haskell-operator">,</span>3)
<span class="org-haskell-operator">&gt;&gt;&gt;</span> stFn 3   <span class="org-comment-delimiter">-- </span><span class="org-comment">S2 = 3 --&gt; S3 = 4, output = 6 </span>
(6<span class="org-haskell-operator">,</span>4)
<span class="org-haskell-operator">&gt;&gt;&gt;</span> stFn 4
(8<span class="org-haskell-operator">,</span>5)
<span class="org-haskell-operator">&gt;&gt;&gt;</span> stFn 5
(10<span class="org-haskell-operator">,</span>6)
<span class="org-haskell-operator">&gt;&gt;&gt;</span>


 
<span class="org-comment-delimiter">{- </span><span class="org-comment">Now let's wrap inside the State type -}</span>

<span class="org-haskell-constructor">:</span>{
<span class="org-haskell-keyword">let</span> stateFn1 <span class="org-haskell-operator">::</span>  <span class="org-haskell-constructor">State</span> <span class="org-haskell-constructor">Int</span> <span class="org-haskell-constructor">Int</span>
    stateFn1 <span class="org-haskell-operator">=</span> state <span class="org-haskell-operator">$</span> <span class="org-haskell-operator">\</span> st <span class="org-haskell-operator">-&gt;</span> (2 <span class="org-haskell-operator">*</span> st<span class="org-haskell-operator">,</span> st <span class="org-haskell-operator">+</span> 1)
<span class="org-haskell-constructor">:</span>}      

<span class="org-haskell-operator">&gt;&gt;&gt;</span> <span class="org-haskell-constructor">:</span>t stateFn1
<span class="org-function-name">stateFn1</span> <span class="org-haskell-operator">::</span> <span class="org-haskell-constructor">State</span> <span class="org-haskell-constructor">Int</span> <span class="org-haskell-constructor">Int</span>
<span class="org-haskell-operator">&gt;&gt;&gt;</span> 


<span class="org-haskell-operator">&gt;&gt;&gt;</span> runState stateFn1 1
(2<span class="org-haskell-operator">,</span>2)
<span class="org-haskell-operator">&gt;&gt;&gt;</span> runState stateFn1 2
(4<span class="org-haskell-operator">,</span>3)
<span class="org-haskell-operator">&gt;&gt;&gt;</span> runState stateFn1 3
(6<span class="org-haskell-operator">,</span>4)
<span class="org-haskell-operator">&gt;&gt;&gt;</span> runState stateFn1 4
(8<span class="org-haskell-operator">,</span>5)
<span class="org-haskell-operator">&gt;&gt;&gt;</span> runState stateFn1 5
(10<span class="org-haskell-operator">,</span>6)
<span class="org-haskell-operator">&gt;&gt;&gt;</span>

<span class="org-haskell-operator">&gt;&gt;&gt;</span> execState stateFn1 5 <span class="org-comment-delimiter">--</span><span class="org-comment">-  snd (10, 6)</span>
6
<span class="org-haskell-operator">&gt;&gt;&gt;</span> evalState stateFn1 5 <span class="org-comment-delimiter">--</span><span class="org-comment">-- fst (10, 6)</span>
10
<span class="org-haskell-operator">&gt;&gt;&gt;</span>

<span class="org-haskell-operator">&gt;&gt;&gt;</span> runState (withState (<span class="org-haskell-operator">\</span>s <span class="org-haskell-operator">-&gt;</span> s <span class="org-haskell-operator">+</span> 3) stateFn1) 1
(8<span class="org-haskell-operator">,</span>5)
<span class="org-haskell-operator">&gt;&gt;&gt;</span> runState (withState (<span class="org-haskell-operator">\</span>s <span class="org-haskell-operator">-&gt;</span> s <span class="org-haskell-operator">+</span> 3) stateFn1) 2
(10<span class="org-haskell-operator">,</span>6)
<span class="org-haskell-operator">&gt;&gt;&gt;</span> runState (withState (<span class="org-haskell-operator">\</span>s <span class="org-haskell-operator">-&gt;</span> s <span class="org-haskell-operator">+</span> 3) stateFn1) 3
(12<span class="org-haskell-operator">,</span>7)
<span class="org-haskell-operator">&gt;&gt;&gt;</span> runState (withState (<span class="org-haskell-operator">\</span>s <span class="org-haskell-operator">-&gt;</span> s <span class="org-haskell-operator">+</span> 3) stateFn1) 4
(14<span class="org-haskell-operator">,</span>8)
<span class="org-haskell-operator">&gt;&gt;&gt;</span> runState (withState (<span class="org-haskell-operator">\</span>s <span class="org-haskell-operator">-&gt;</span> s <span class="org-haskell-operator">+</span> 3) stateFn1) 5
(16<span class="org-haskell-operator">,</span>9)
<span class="org-haskell-operator">&gt;&gt;&gt;</span> 



<span class="org-haskell-keyword">type</span> <span class="org-haskell-constructor">StState</span> <span class="org-haskell-operator">=</span> <span class="org-haskell-constructor">Int</span>
<span class="org-haskell-keyword">type</span> <span class="org-haskell-constructor">StOutput</span> <span class="org-haskell-operator">=</span> <span class="org-haskell-constructor">Int</span> 

<span class="org-haskell-constructor">:</span>{
<span class="org-haskell-keyword">let</span> stateFn2 <span class="org-haskell-operator">::</span> <span class="org-haskell-constructor">State</span> <span class="org-haskell-constructor">StState</span> <span class="org-haskell-constructor">StOutput</span>
    stateFn2 <span class="org-haskell-operator">=</span>  state <span class="org-haskell-operator">$</span> <span class="org-haskell-operator">\</span> st <span class="org-haskell-operator">-&gt;</span> (2 <span class="org-haskell-operator">*</span> st<span class="org-haskell-operator">,</span> st <span class="org-haskell-operator">+</span> 1)

<span class="org-haskell-constructor">:</span>}

<span class="org-haskell-operator">&gt;&gt;&gt;</span> <span class="org-haskell-constructor">:</span>t stateFn2
<span class="org-function-name">stateFn2</span> <span class="org-haskell-operator">::</span> <span class="org-haskell-constructor">State</span> <span class="org-haskell-constructor">StState</span> <span class="org-haskell-constructor">StOutput</span>
<span class="org-haskell-operator">&gt;&gt;&gt;</span>

<span class="org-haskell-operator">&gt;&gt;&gt;</span> runState stateFn2 0
(0<span class="org-haskell-operator">,</span>1)
<span class="org-haskell-operator">&gt;&gt;&gt;</span> runState stateFn2 1
(2<span class="org-haskell-operator">,</span>2)
<span class="org-haskell-operator">&gt;&gt;&gt;</span> runState stateFn2 2
(4<span class="org-haskell-operator">,</span>3)
<span class="org-haskell-operator">&gt;&gt;&gt;</span> runState stateFn2 3
(6<span class="org-haskell-operator">,</span>4)
<span class="org-haskell-operator">&gt;&gt;&gt;</span> runState stateFn2 4
(8<span class="org-haskell-operator">,</span>5)

<span class="org-haskell-operator">&gt;&gt;&gt;</span> <span class="org-haskell-constructor">:</span>t stateFn2
<span class="org-function-name">stateFn2</span> <span class="org-haskell-operator">::</span> <span class="org-haskell-constructor">State</span> <span class="org-haskell-constructor">StState</span> <span class="org-haskell-constructor">StOutput</span>
<span class="org-haskell-operator">&gt;&gt;&gt;</span> 

<span class="org-haskell-operator">&gt;&gt;&gt;</span> <span class="org-haskell-constructor">:</span>t runState stateFn2 4
<span class="org-haskell-definition">runState</span> stateFn2 4 <span class="org-haskell-operator">::</span> (<span class="org-haskell-constructor">StOutput</span><span class="org-haskell-operator">,</span> <span class="org-haskell-constructor">StState</span>)
<span class="org-haskell-operator">&gt;&gt;&gt;</span> 

<span class="org-haskell-constructor">:</span>{

<span class="org-haskell-keyword">let</span> stateFn3 <span class="org-haskell-operator">::</span> <span class="org-haskell-constructor">State</span> <span class="org-haskell-constructor">Int</span> <span class="org-haskell-constructor">Int</span>
    stateFn3 <span class="org-haskell-operator">=</span> <span class="org-haskell-keyword">do</span>
      currentState <span class="org-haskell-operator">&lt;-</span> get
      put (currentState <span class="org-haskell-operator">+</span> 1)  <span class="org-comment-delimiter">--</span><span class="org-comment">- put $ currentState +  1</span>
      return (2 <span class="org-haskell-operator">*</span> currentState)
<span class="org-haskell-constructor">:</span>}      

<span class="org-haskell-operator">&gt;&gt;&gt;</span> <span class="org-haskell-constructor">:</span>t stateFn3
<span class="org-function-name">stateFn3</span> <span class="org-haskell-operator">::</span> <span class="org-haskell-constructor">State</span> <span class="org-haskell-constructor">Int</span> <span class="org-haskell-constructor">Int</span>
<span class="org-haskell-operator">&gt;&gt;&gt;</span> 

<span class="org-haskell-operator">&gt;&gt;&gt;</span> runState stateFn3 0
(0<span class="org-haskell-operator">,</span>1)
<span class="org-haskell-operator">&gt;&gt;&gt;</span> runState stateFn3 1
(2<span class="org-haskell-operator">,</span>2)
<span class="org-haskell-operator">&gt;&gt;&gt;</span> runState stateFn3 2
(4<span class="org-haskell-operator">,</span>3)
<span class="org-haskell-operator">&gt;&gt;&gt;</span> runState stateFn3 3
(6<span class="org-haskell-operator">,</span>4)
<span class="org-haskell-operator">&gt;&gt;&gt;</span> runState stateFn3 4
(8<span class="org-haskell-operator">,</span>5)
<span class="org-haskell-operator">&gt;&gt;&gt;</span> runState stateFn3 5
(10<span class="org-haskell-operator">,</span>6)
<span class="org-haskell-operator">&gt;&gt;&gt;</span> 


<span class="org-comment-delimiter">{- </span><span class="org-comment">Do-notation dessugarized </span>

<span class="org-comment">  cs : Stands for current state. </span>
<span class="org-comment">-}</span> 

<span class="org-haskell-constructor">:</span>{
<span class="org-haskell-keyword">let</span> stateFn4 <span class="org-haskell-operator">::</span> <span class="org-haskell-constructor">State</span> <span class="org-haskell-constructor">Int</span> <span class="org-haskell-constructor">Int</span>
    stateFn4 <span class="org-haskell-operator">=</span>
      get          <span class="org-haskell-operator">&gt;&gt;=</span> <span class="org-haskell-operator">\</span>  cs <span class="org-haskell-operator">-&gt;</span>
      put (cs <span class="org-haskell-operator">+</span> 1) <span class="org-haskell-operator">&gt;&gt;=</span> <span class="org-haskell-operator">\</span>  <span class="org-haskell-keyword">_</span>  <span class="org-haskell-operator">-&gt;</span>
      return (2 <span class="org-haskell-operator">*</span> cs)     
<span class="org-haskell-constructor">:</span>}

<span class="org-haskell-operator">&gt;&gt;&gt;</span> runState stateFn4 0
(0<span class="org-haskell-operator">,</span>1)
<span class="org-haskell-operator">&gt;&gt;&gt;</span> runState stateFn4 1
(2<span class="org-haskell-operator">,</span>2)
<span class="org-haskell-operator">&gt;&gt;&gt;</span> runState stateFn4 2
(4<span class="org-haskell-operator">,</span>3)
<span class="org-haskell-operator">&gt;&gt;&gt;</span> runState stateFn4 3
(6<span class="org-haskell-operator">,</span>4)
<span class="org-haskell-operator">&gt;&gt;&gt;</span> runState stateFn4 4
(8<span class="org-haskell-operator">,</span>5)
<span class="org-haskell-operator">&gt;&gt;&gt;</span> runState stateFn4 5
(10<span class="org-haskell-operator">,</span>6)
<span class="org-haskell-operator">&gt;&gt;&gt;</span> 

<span class="org-haskell-operator">&gt;&gt;&gt;</span> runState (fmap (<span class="org-haskell-operator">\</span>x <span class="org-haskell-operator">-&gt;</span> x <span class="org-haskell-operator">+</span> 3) stateFn4) 0 <span class="org-comment-delimiter">-- </span><span class="org-comment">3 = (\x -&gt; x + 3) 0 </span>
(3<span class="org-haskell-operator">,</span>1)
<span class="org-haskell-operator">&gt;&gt;&gt;</span> runState (fmap (<span class="org-haskell-operator">\</span>x <span class="org-haskell-operator">-&gt;</span> x <span class="org-haskell-operator">+</span> 3) stateFn4) 1 <span class="org-comment-delimiter">-- </span><span class="org-comment">5 = (\x -&gt; x + 3) 2 </span>
(5<span class="org-haskell-operator">,</span>2)
<span class="org-haskell-operator">&gt;&gt;&gt;</span> runState (fmap (<span class="org-haskell-operator">\</span>x <span class="org-haskell-operator">-&gt;</span> x <span class="org-haskell-operator">+</span> 3) stateFn4) 2 <span class="org-comment-delimiter">-- </span><span class="org-comment">7 = (\x -&gt; x + 4)</span>
(7<span class="org-haskell-operator">,</span>3)
<span class="org-haskell-operator">&gt;&gt;&gt;</span> runState (fmap (<span class="org-haskell-operator">\</span>x <span class="org-haskell-operator">-&gt;</span> x <span class="org-haskell-operator">+</span> 3) stateFn4) 3
(9<span class="org-haskell-operator">,</span>4)
<span class="org-haskell-operator">&gt;&gt;&gt;</span> runState (fmap (<span class="org-haskell-operator">\</span>x <span class="org-haskell-operator">-&gt;</span> x <span class="org-haskell-operator">+</span> 3) stateFn4) 4
(11<span class="org-haskell-operator">,</span>5)
<span class="org-haskell-operator">&gt;&gt;&gt;</span> runState (fmap (<span class="org-haskell-operator">\</span>x <span class="org-haskell-operator">-&gt;</span> x <span class="org-haskell-operator">+</span> 3) stateFn4) 5
(13<span class="org-haskell-operator">,</span>6)


<span class="org-haskell-operator">&gt;&gt;&gt;</span> <span class="org-haskell-constructor">:</span>t fmap
<span class="org-function-name">fmap</span> <span class="org-haskell-operator">::</span> <span class="org-haskell-constructor">Functor</span> f <span class="org-haskell-operator">=&gt;</span> (a <span class="org-haskell-operator">-&gt;</span> b) <span class="org-haskell-operator">-&gt;</span> f a <span class="org-haskell-operator">-&gt;</span> f b
<span class="org-haskell-operator">&gt;&gt;&gt;</span> 

<span class="org-haskell-operator">&gt;&gt;&gt;</span> <span class="org-haskell-keyword">let</span> stateFnMap <span class="org-haskell-operator">=</span> fmap (<span class="org-haskell-operator">\</span>x <span class="org-haskell-operator">-&gt;</span> x <span class="org-haskell-operator">+</span> 3) stateFn3
<span class="org-haskell-operator">&gt;&gt;&gt;</span> <span class="org-haskell-constructor">:</span>t stateFnMap 
<span class="org-function-name">stateFnMap</span> <span class="org-haskell-operator">::</span> <span class="org-haskell-constructor">StateT</span> <span class="org-haskell-constructor">Int</span> <span class="org-haskell-constructor">Data.Functor.Identity.Identity</span> <span class="org-haskell-constructor">Int</span>
<span class="org-haskell-operator">&gt;&gt;&gt;</span> 

<span class="org-haskell-operator">&gt;&gt;&gt;</span> runState stateFnMap 0
(3<span class="org-haskell-operator">,</span>1)
<span class="org-haskell-operator">&gt;&gt;&gt;</span> runState stateFnMap 1
(5<span class="org-haskell-operator">,</span>2)
<span class="org-haskell-operator">&gt;&gt;&gt;</span> runState stateFnMap 2
(7<span class="org-haskell-operator">,</span>3)
<span class="org-haskell-operator">&gt;&gt;&gt;</span> runState stateFnMap 3
(9<span class="org-haskell-operator">,</span>4)
<span class="org-haskell-operator">&gt;&gt;&gt;</span> runState stateFnMap 4
(11<span class="org-haskell-operator">,</span>5)
<span class="org-haskell-operator">&gt;&gt;&gt;</span>
</pre>
</div>

<p>
Example from the book Learn You a Haskell: 
</p>

<p>
Simulating a stack:
</p>

<div class="org-src-container">

<pre class="src src-haskell"><span class="org-haskell-keyword">import</span> <span class="org-haskell-constructor">Control.Monad.State</span>  

<span class="org-haskell-keyword">type</span> <span class="org-haskell-constructor">Stack</span> <span class="org-haskell-operator">=</span> [<span class="org-haskell-constructor">Int</span>] 

<span class="org-comment-delimiter">-- </span><span class="org-comment">Each code block must be pasted into the repl (ghci)</span>
<span class="org-comment-delimiter">--</span>
<span class="org-haskell-constructor">:</span>set <span class="org-haskell-operator">+</span>m

<span class="org-haskell-constructor">:</span>{

<span class="org-haskell-keyword">let</span> pop <span class="org-haskell-operator">::</span> <span class="org-haskell-constructor">State</span> <span class="org-haskell-constructor">Stack</span> <span class="org-haskell-constructor">Int</span>  
    pop <span class="org-haskell-operator">=</span> state <span class="org-haskell-operator">$</span> <span class="org-haskell-operator">\</span>(x<span class="org-haskell-constructor">:</span>xs) <span class="org-haskell-operator">-&gt;</span> (x<span class="org-haskell-operator">,</span> xs)
    <span class="org-comment-delimiter">-- </span><span class="org-comment">pop = State $ \(x:xs) -&gt; (x,xs)    (It doesn't work anymore in this way).</span>
<span class="org-haskell-constructor">:</span>}

<span class="org-haskell-operator">&gt;&gt;&gt;</span> <span class="org-haskell-constructor">:</span>t pop
<span class="org-function-name">pop</span> <span class="org-haskell-operator">::</span> <span class="org-haskell-constructor">State</span> <span class="org-haskell-constructor">Stack</span> <span class="org-haskell-constructor">Int</span>
<span class="org-haskell-operator">&gt;&gt;&gt;</span> 

<span class="org-haskell-constructor">:</span>{
      
<span class="org-haskell-keyword">let</span> push <span class="org-haskell-operator">::</span> <span class="org-haskell-constructor">Int</span> <span class="org-haskell-operator">-&gt;</span> <span class="org-haskell-constructor">State</span> <span class="org-haskell-constructor">Stack</span> <span class="org-haskell-constructor">()</span>  
    push a <span class="org-haskell-operator">=</span> state <span class="org-haskell-operator">$</span> <span class="org-haskell-operator">\</span>xs <span class="org-haskell-operator">-&gt;</span> (<span class="org-haskell-constructor">()</span><span class="org-haskell-operator">,</span> a<span class="org-haskell-constructor">:</span>xs)

<span class="org-haskell-constructor">:</span>}

<span class="org-haskell-operator">&gt;&gt;&gt;</span> <span class="org-haskell-constructor">:</span>t push
<span class="org-function-name">push</span> <span class="org-haskell-operator">::</span> <span class="org-haskell-constructor">Int</span> <span class="org-haskell-operator">-&gt;</span> <span class="org-haskell-constructor">State</span> <span class="org-haskell-constructor">Stack</span> <span class="org-haskell-constructor">()</span>
<span class="org-haskell-operator">&gt;&gt;&gt;</span>

<span class="org-haskell-constructor">:</span>{
<span class="org-haskell-keyword">let</span> stackManip <span class="org-haskell-operator">=</span> <span class="org-haskell-keyword">do</span>  
      push 3  
      a <span class="org-haskell-operator">&lt;-</span> pop  
      pop 
<span class="org-haskell-constructor">:</span>}

<span class="org-haskell-operator">&gt;&gt;&gt;</span> <span class="org-haskell-constructor">:</span>t stackManip 
<span class="org-function-name">stackManip</span> <span class="org-haskell-operator">::</span> <span class="org-haskell-constructor">StateT</span> <span class="org-haskell-constructor">Stack</span> <span class="org-haskell-constructor">Data.Functor.Identity.Identity</span> <span class="org-haskell-constructor">Int</span>
<span class="org-haskell-operator">&gt;&gt;&gt;</span> 


<span class="org-haskell-operator">&gt;&gt;&gt;</span> runState pop [1<span class="org-haskell-operator">,</span> 2<span class="org-haskell-operator">,</span> 3<span class="org-haskell-operator">,</span> 4]
(1<span class="org-haskell-operator">,</span>[2<span class="org-haskell-operator">,</span>3<span class="org-haskell-operator">,</span>4])
<span class="org-haskell-operator">&gt;&gt;&gt;</span> runState pop [2<span class="org-haskell-operator">,</span> 3<span class="org-haskell-operator">,</span> 4]
(2<span class="org-haskell-operator">,</span>[3<span class="org-haskell-operator">,</span>4])
<span class="org-haskell-operator">&gt;&gt;&gt;</span> runState pop [3<span class="org-haskell-operator">,</span> 4]
(3<span class="org-haskell-operator">,</span>[4])
<span class="org-haskell-operator">&gt;&gt;&gt;</span> runState pop [4]
(4<span class="org-haskell-operator">,</span><span class="org-haskell-constructor">[]</span>)
<span class="org-haskell-operator">&gt;&gt;&gt;</span> runState pop <span class="org-haskell-constructor">[]</span>
 <span class="org-haskell-operator">***</span> <span class="org-haskell-constructor">Exception:</span> <span class="org-haskell-operator">&lt;</span>interactive<span class="org-haskell-operator">&gt;:</span>20<span class="org-haskell-constructor">:</span>19<span class="org-haskell-operator">-</span>36<span class="org-haskell-constructor">:</span> <span class="org-haskell-constructor">Non</span><span class="org-haskell-operator">-</span>exhaustive patterns <span class="org-haskell-keyword">in</span> lambda


<span class="org-haskell-operator">&gt;&gt;&gt;</span> evalState pop [1<span class="org-haskell-operator">,</span> 2<span class="org-haskell-operator">,</span> 3<span class="org-haskell-operator">,</span> 4]
1
<span class="org-haskell-operator">&gt;&gt;&gt;</span> evalState pop [2<span class="org-haskell-operator">,</span> 3<span class="org-haskell-operator">,</span> 4]
2

<span class="org-haskell-operator">&gt;&gt;&gt;</span> execState pop [1<span class="org-haskell-operator">,</span> 2<span class="org-haskell-operator">,</span> 3<span class="org-haskell-operator">,</span> 4]
[2<span class="org-haskell-operator">,</span>3<span class="org-haskell-operator">,</span>4]
<span class="org-haskell-operator">&gt;&gt;&gt;</span> execState pop [2<span class="org-haskell-operator">,</span> 3<span class="org-haskell-operator">,</span> 4]
[3<span class="org-haskell-operator">,</span>4]
<span class="org-haskell-operator">&gt;&gt;&gt;</span> 

<span class="org-haskell-operator">&gt;&gt;&gt;</span> runState (push 3) [4<span class="org-haskell-operator">,</span> 5<span class="org-haskell-operator">,</span> 6]
(<span class="org-haskell-constructor">()</span><span class="org-haskell-operator">,</span>[3<span class="org-haskell-operator">,</span>4<span class="org-haskell-operator">,</span>5<span class="org-haskell-operator">,</span>6])
<span class="org-haskell-operator">&gt;&gt;&gt;</span> runState (push 10) [1<span class="org-haskell-operator">,</span> 4<span class="org-haskell-operator">,</span> 5<span class="org-haskell-operator">,</span> 6]
(<span class="org-haskell-constructor">()</span><span class="org-haskell-operator">,</span>[10<span class="org-haskell-operator">,</span>1<span class="org-haskell-operator">,</span>4<span class="org-haskell-operator">,</span>5<span class="org-haskell-operator">,</span>6])
<span class="org-haskell-operator">&gt;&gt;&gt;</span> 

<span class="org-haskell-operator">&gt;&gt;&gt;</span> runState stackManip [5<span class="org-haskell-operator">,</span>8<span class="org-haskell-operator">,</span>2<span class="org-haskell-operator">,</span>1]
(5<span class="org-haskell-operator">,</span>[8<span class="org-haskell-operator">,</span>2<span class="org-haskell-operator">,</span>1])
<span class="org-haskell-operator">&gt;&gt;&gt;</span>


<span class="org-comment-delimiter">{-</span>

<span class="org-comment">    stackStuff :: State Stack ()  </span>
<span class="org-comment">    stackStuff = do  </span>
<span class="org-comment">        a &lt;- pop  </span>
<span class="org-comment">        if a == 5  </span>
<span class="org-comment">            then push 5  </span>
<span class="org-comment">            else do  </span>
<span class="org-comment">                push 3  </span>
<span class="org-comment">                push 8  </span>

<span class="org-comment">-}</span>

<span class="org-haskell-constructor">:</span>{

<span class="org-haskell-keyword">let</span> stackStuff <span class="org-haskell-operator">::</span> <span class="org-haskell-constructor">State</span> <span class="org-haskell-constructor">Stack</span> <span class="org-haskell-constructor">()</span>  
    stackStuff <span class="org-haskell-operator">=</span> <span class="org-haskell-keyword">do</span>  
      a <span class="org-haskell-operator">&lt;-</span> pop  
      <span class="org-haskell-keyword">if</span> a <span class="org-haskell-operator">==</span> 5  
        <span class="org-haskell-keyword">then</span> push 5  
        <span class="org-haskell-keyword">else</span> <span class="org-haskell-keyword">do</span>  
          push 3  
          push 8    

<span class="org-haskell-constructor">:</span>}  

<span class="org-haskell-operator">&gt;&gt;&gt;</span> <span class="org-haskell-constructor">:</span>t stackStuff 
<span class="org-function-name">stackStuff</span> <span class="org-haskell-operator">::</span> <span class="org-haskell-constructor">State</span> <span class="org-haskell-constructor">Stack</span> <span class="org-haskell-constructor">()</span>
<span class="org-haskell-operator">&gt;&gt;&gt;</span>

<span class="org-haskell-operator">&gt;&gt;&gt;</span> runState stackStuff [9<span class="org-haskell-operator">,</span>0<span class="org-haskell-operator">,</span>2<span class="org-haskell-operator">,</span>1<span class="org-haskell-operator">,</span>0]  
(<span class="org-haskell-constructor">()</span><span class="org-haskell-operator">,</span>[8<span class="org-haskell-operator">,</span>3<span class="org-haskell-operator">,</span>0<span class="org-haskell-operator">,</span>2<span class="org-haskell-operator">,</span>1<span class="org-haskell-operator">,</span>0])
<span class="org-haskell-operator">&gt;&gt;&gt;</span>

<span class="org-comment-delimiter">-- </span><span class="org-comment">push a = State $ \xs -&gt; ((),a:xs)</span>
</pre>
</div>

<p>
Random numbers:
</p>

<div class="org-src-container">

<pre class="src src-haskell"><span class="org-haskell-operator">&gt;&gt;&gt;</span> <span class="org-haskell-keyword">import</span> <span class="org-haskell-constructor">Control.Monad.State</span>
<span class="org-haskell-operator">&gt;&gt;&gt;</span> <span class="org-haskell-keyword">import</span> <span class="org-haskell-constructor">System.Random</span>
<span class="org-haskell-operator">&gt;&gt;&gt;</span> 

<span class="org-comment-delimiter">{-</span>
<span class="org-comment">   randomSt :: (RandomGen g, Random a) =&gt; State g a  </span>
<span class="org-comment">   randomSt = State random</span>
<span class="org-comment">-}</span>
<span class="org-haskell-operator">&gt;&gt;&gt;</span> <span class="org-haskell-keyword">let</span> randomSt <span class="org-haskell-operator">=</span> state random 
<span class="org-haskell-operator">&gt;&gt;&gt;</span> 
<span class="org-haskell-operator">&gt;&gt;&gt;</span> <span class="org-haskell-constructor">:</span>t randomSt 
<span class="org-function-name">randomSt</span> <span class="org-haskell-operator">::</span> (<span class="org-haskell-constructor">MonadState</span> s m<span class="org-haskell-operator">,</span> <span class="org-haskell-constructor">RandomGen</span> s<span class="org-haskell-operator">,</span> <span class="org-haskell-constructor">Random</span> a) <span class="org-haskell-operator">=&gt;</span> m a
<span class="org-haskell-operator">&gt;&gt;&gt;</span> 

<span class="org-haskell-operator">&gt;&gt;&gt;</span> <span class="org-haskell-constructor">:</span>t randomSt 
<span class="org-function-name">randomSt</span> <span class="org-haskell-operator">::</span> (<span class="org-haskell-constructor">MonadState</span> s m<span class="org-haskell-operator">,</span> <span class="org-haskell-constructor">RandomGen</span> s<span class="org-haskell-operator">,</span> <span class="org-haskell-constructor">Random</span> a) <span class="org-haskell-operator">=&gt;</span> m a
<span class="org-haskell-operator">&gt;&gt;&gt;</span> 

<span class="org-comment-delimiter">{-</span>

<span class="org-comment">threeCoins :: State StdGen (Bool,Bool,Bool)  </span>
<span class="org-comment">threeCoins = do  </span>
<span class="org-comment">    a &lt;- randomSt  </span>
<span class="org-comment">    b &lt;- randomSt  </span>
<span class="org-comment">    c &lt;- randomSt  </span>
<span class="org-comment">    return (a,b,c)</span>
<span class="org-comment">-}</span>

<span class="org-haskell-constructor">:</span>{

<span class="org-haskell-keyword">let</span> threeCoins <span class="org-haskell-operator">::</span> <span class="org-haskell-constructor">State</span> <span class="org-haskell-constructor">StdGen</span> (<span class="org-haskell-constructor">Bool</span><span class="org-haskell-operator">,</span><span class="org-haskell-constructor">Bool</span><span class="org-haskell-operator">,</span><span class="org-haskell-constructor">Bool</span>)  
    threeCoins <span class="org-haskell-operator">=</span> <span class="org-haskell-keyword">do</span>  
      a <span class="org-haskell-operator">&lt;-</span> randomSt  
      b <span class="org-haskell-operator">&lt;-</span> randomSt  
      c <span class="org-haskell-operator">&lt;-</span> randomSt  
      return (a<span class="org-haskell-operator">,</span>b<span class="org-haskell-operator">,</span>c)
<span class="org-haskell-constructor">:</span>}

<span class="org-haskell-operator">&gt;&gt;&gt;</span> <span class="org-haskell-constructor">:</span>t threeCoins 
<span class="org-function-name">threeCoins</span> <span class="org-haskell-operator">::</span> <span class="org-haskell-constructor">State</span> <span class="org-haskell-constructor">StdGen</span> (<span class="org-haskell-constructor">Bool</span><span class="org-haskell-operator">,</span> <span class="org-haskell-constructor">Bool</span><span class="org-haskell-operator">,</span> <span class="org-haskell-constructor">Bool</span>)
<span class="org-haskell-operator">&gt;&gt;&gt;</span> 

<span class="org-haskell-operator">&gt;&gt;&gt;</span> runState threeCoins (mkStdGen 33)
((<span class="org-haskell-constructor">True</span><span class="org-haskell-operator">,</span><span class="org-haskell-constructor">False</span><span class="org-haskell-operator">,</span><span class="org-haskell-constructor">True</span>)<span class="org-haskell-operator">,</span>680029187 2103410263)
<span class="org-haskell-operator">&gt;&gt;&gt;</span> 
<span class="org-haskell-operator">&gt;&gt;&gt;</span> runState threeCoins (mkStdGen 33)
((<span class="org-haskell-constructor">True</span><span class="org-haskell-operator">,</span><span class="org-haskell-constructor">False</span><span class="org-haskell-operator">,</span><span class="org-haskell-constructor">True</span>)<span class="org-haskell-operator">,</span>680029187 2103410263)
<span class="org-haskell-operator">&gt;&gt;&gt;</span> 


<span class="org-haskell-operator">&gt;&gt;&gt;</span> <span class="org-haskell-keyword">import</span> <span class="org-haskell-constructor">Data.List</span> (unfoldr)
<span class="org-haskell-operator">&gt;&gt;&gt;</span> 
<span class="org-haskell-operator">&gt;&gt;&gt;</span> <span class="org-haskell-constructor">:</span>t unfoldr
<span class="org-function-name">unfoldr</span> <span class="org-haskell-operator">::</span> (b <span class="org-haskell-operator">-&gt;</span> <span class="org-haskell-constructor">Maybe</span> (a<span class="org-haskell-operator">,</span> b)) <span class="org-haskell-operator">-&gt;</span> b <span class="org-haskell-operator">-&gt;</span> [a]
<span class="org-haskell-operator">&gt;&gt;&gt;</span> 


<span class="org-comment-delimiter">{- </span><span class="org-comment">Generates an infinite sequence of state output   -}</span>

<span class="org-haskell-constructor">:</span>{
  
<span class="org-haskell-keyword">let</span> stateSeqOutput stateFn state0 <span class="org-haskell-operator">=</span>
      unfoldr
      ( <span class="org-haskell-operator">\</span>s <span class="org-haskell-operator">-&gt;</span> <span class="org-haskell-keyword">let</span> (out<span class="org-haskell-operator">,</span> ns) <span class="org-haskell-operator">=</span> runState stateFn s
                        <span class="org-haskell-keyword">in</span> <span class="org-haskell-constructor">Just</span> (out<span class="org-haskell-operator">,</span> ns))
      state0
      
<span class="org-haskell-constructor">:</span>}      
      
      
<span class="org-haskell-operator">&gt;&gt;&gt;</span> <span class="org-haskell-constructor">:</span>t stateSeqOutput 
<span class="org-function-name">stateSeqOutput</span> <span class="org-haskell-operator">::</span> <span class="org-haskell-constructor">State</span> b a <span class="org-haskell-operator">-&gt;</span> b <span class="org-haskell-operator">-&gt;</span> [a]
<span class="org-haskell-operator">&gt;&gt;&gt;</span>

<span class="org-haskell-operator">&gt;&gt;&gt;</span> take 4 <span class="org-haskell-operator">$</span> stateSeqOutput threeCoins (mkStdGen 33)
[(<span class="org-haskell-constructor">True</span><span class="org-haskell-operator">,</span><span class="org-haskell-constructor">False</span><span class="org-haskell-operator">,</span><span class="org-haskell-constructor">True</span>)<span class="org-haskell-operator">,</span>(<span class="org-haskell-constructor">True</span><span class="org-haskell-operator">,</span><span class="org-haskell-constructor">True</span><span class="org-haskell-operator">,</span><span class="org-haskell-constructor">True</span>)<span class="org-haskell-operator">,</span>(<span class="org-haskell-constructor">False</span><span class="org-haskell-operator">,</span><span class="org-haskell-constructor">False</span><span class="org-haskell-operator">,</span><span class="org-haskell-constructor">False</span>)<span class="org-haskell-operator">,</span>(<span class="org-haskell-constructor">True</span><span class="org-haskell-operator">,</span><span class="org-haskell-constructor">False</span><span class="org-haskell-operator">,</span><span class="org-haskell-constructor">True</span>)]
<span class="org-haskell-operator">&gt;&gt;&gt;</span> 

<span class="org-haskell-operator">&gt;&gt;&gt;</span> mapM_ print  <span class="org-haskell-operator">$</span>  take 10 <span class="org-haskell-operator">$</span> stateSeqOutput threeCoins (mkStdGen 33) 
(<span class="org-haskell-constructor">True</span><span class="org-haskell-operator">,</span><span class="org-haskell-constructor">False</span><span class="org-haskell-operator">,</span><span class="org-haskell-constructor">True</span>)
(<span class="org-haskell-constructor">True</span><span class="org-haskell-operator">,</span><span class="org-haskell-constructor">True</span><span class="org-haskell-operator">,</span><span class="org-haskell-constructor">True</span>)
(<span class="org-haskell-constructor">False</span><span class="org-haskell-operator">,</span><span class="org-haskell-constructor">False</span><span class="org-haskell-operator">,</span><span class="org-haskell-constructor">False</span>)
(<span class="org-haskell-constructor">True</span><span class="org-haskell-operator">,</span><span class="org-haskell-constructor">False</span><span class="org-haskell-operator">,</span><span class="org-haskell-constructor">True</span>)
(<span class="org-haskell-constructor">True</span><span class="org-haskell-operator">,</span><span class="org-haskell-constructor">False</span><span class="org-haskell-operator">,</span><span class="org-haskell-constructor">True</span>)
(<span class="org-haskell-constructor">True</span><span class="org-haskell-operator">,</span><span class="org-haskell-constructor">True</span><span class="org-haskell-operator">,</span><span class="org-haskell-constructor">False</span>)
(<span class="org-haskell-constructor">False</span><span class="org-haskell-operator">,</span><span class="org-haskell-constructor">False</span><span class="org-haskell-operator">,</span><span class="org-haskell-constructor">True</span>)
(<span class="org-haskell-constructor">False</span><span class="org-haskell-operator">,</span><span class="org-haskell-constructor">False</span><span class="org-haskell-operator">,</span><span class="org-haskell-constructor">False</span>)
(<span class="org-haskell-constructor">True</span><span class="org-haskell-operator">,</span><span class="org-haskell-constructor">True</span><span class="org-haskell-operator">,</span><span class="org-haskell-constructor">False</span>)
(<span class="org-haskell-constructor">True</span><span class="org-haskell-operator">,</span><span class="org-haskell-constructor">True</span><span class="org-haskell-operator">,</span><span class="org-haskell-constructor">True</span>)
<span class="org-haskell-operator">&gt;&gt;&gt;</span>
</pre>
</div>


<p>
Example: Fibonacci Sequence
</p>

<p>
The Fibonacci sequence is defined by the rule.
</p>

<pre class="example">
a[n+2] = a[n+1] + a[n]

    0 
        1
            1 = 1 + 0
               2  = 1 + 1
                 3  = 2 + 1
                    5 = 3 + 2
                        8 = 5 + 3 
                            ...

         +-----+             +----+           +----+
 S0   --&gt;+ fn  +-----------&gt; | fn +----------&gt;| fn |------&gt;  ....
(0, 1)   +--+--+ S1          +-+--+ S2        +-+--+ S3 (2, 3)
            |  (1, 0 + 1)      |  (1, 2)        | 
            |  (1, 1)          |                | 
           \ /                \ /              \ /
            output = 0 + 1     output = 1 + 1   output = 1 + 2
                   = 1                = 2              = 3
</pre>

<p>
It needs to keep track of the two last numbers. 
</p>

<div class="org-src-container">

<pre class="src src-haskell"><span class="org-haskell-keyword">import</span> <span class="org-haskell-constructor">Control.Monad.State</span> 

<span class="org-comment-delimiter">-- </span><span class="org-comment">Load from a file </span>
<span class="org-comment-delimiter">--</span>
<span class="org-function-name">fibgen</span> <span class="org-haskell-operator">::</span> <span class="org-haskell-constructor">State</span> (<span class="org-haskell-constructor">Int</span><span class="org-haskell-operator">,</span> <span class="org-haskell-constructor">Int</span>) <span class="org-haskell-constructor">Int</span> 
<span class="org-haskell-definition">fibgen</span> <span class="org-haskell-operator">=</span> <span class="org-haskell-keyword">do</span>
       a<span class="org-haskell-operator">,</span> b <span class="org-haskell-operator">&lt;-</span> get 
       <span class="org-haskell-keyword">let</span> c  <span class="org-haskell-operator">=</span> a <span class="org-haskell-operator">+</span> b
       put (b<span class="org-haskell-operator">,</span> c)      <span class="org-comment-delimiter">-- </span><span class="org-comment">set the new state </span>
       return c

<span class="org-comment-delimiter">-- </span><span class="org-comment">Repl friendly version </span>
<span class="org-comment-delimiter">--</span>
<span class="org-haskell-constructor">:</span>{
<span class="org-haskell-keyword">let</span> fibgen <span class="org-haskell-operator">::</span> <span class="org-haskell-constructor">State</span> (<span class="org-haskell-constructor">Int</span><span class="org-haskell-operator">,</span> <span class="org-haskell-constructor">Int</span>) <span class="org-haskell-constructor">Int</span>
    fibgen <span class="org-haskell-operator">=</span> <span class="org-haskell-keyword">do</span>
       (a<span class="org-haskell-operator">,</span> b) <span class="org-haskell-operator">&lt;-</span> get 
       <span class="org-haskell-keyword">let</span> c  <span class="org-haskell-operator">=</span> a <span class="org-haskell-operator">+</span> b
       put (b<span class="org-haskell-operator">,</span> c)      <span class="org-comment-delimiter">-- </span><span class="org-comment">set the new state </span>
       return c
<span class="org-haskell-constructor">:</span>}


<span class="org-haskell-operator">&gt;&gt;&gt;</span> <span class="org-haskell-constructor">:</span>t fibgen 
<span class="org-function-name">fibgen</span> <span class="org-haskell-operator">::</span> <span class="org-haskell-constructor">State</span> (<span class="org-haskell-constructor">Int</span><span class="org-haskell-operator">,</span> <span class="org-haskell-constructor">Int</span>) <span class="org-haskell-constructor">Int</span>
<span class="org-haskell-operator">&gt;&gt;&gt;</span> 

<span class="org-haskell-operator">&gt;&gt;&gt;</span> runState fibgen (0<span class="org-haskell-operator">,</span> 1)
(1<span class="org-haskell-operator">,</span>(1<span class="org-haskell-operator">,</span>1))
<span class="org-haskell-operator">&gt;&gt;&gt;</span> runState fibgen (1<span class="org-haskell-operator">,</span> 1)
(2<span class="org-haskell-operator">,</span>(1<span class="org-haskell-operator">,</span>2))
<span class="org-haskell-operator">&gt;&gt;&gt;</span> runState fibgen (1<span class="org-haskell-operator">,</span> 2)
(3<span class="org-haskell-operator">,</span>(2<span class="org-haskell-operator">,</span>3))
<span class="org-haskell-operator">&gt;&gt;&gt;</span> runState fibgen (2<span class="org-haskell-operator">,</span> 3)
(5<span class="org-haskell-operator">,</span>(3<span class="org-haskell-operator">,</span>5))
<span class="org-haskell-operator">&gt;&gt;&gt;</span> runState fibgen (3<span class="org-haskell-operator">,</span> 5)
(8<span class="org-haskell-operator">,</span>(5<span class="org-haskell-operator">,</span>8))
<span class="org-haskell-operator">&gt;&gt;&gt;</span> runState fibgen (5<span class="org-haskell-operator">,</span> 8)
(13<span class="org-haskell-operator">,</span>(8<span class="org-haskell-operator">,</span>13))
<span class="org-haskell-operator">&gt;&gt;&gt;</span>

<span class="org-haskell-operator">&gt;&gt;&gt;</span> evalState fibgen (5<span class="org-haskell-operator">,</span> 8)
13
<span class="org-haskell-operator">&gt;&gt;&gt;</span> execState fibgen (5<span class="org-haskell-operator">,</span> 8)
(8<span class="org-haskell-operator">,</span>13)
<span class="org-haskell-operator">&gt;&gt;&gt;</span> 


<span class="org-haskell-constructor">:</span>{
<span class="org-haskell-keyword">let</span> fibgen2 <span class="org-haskell-operator">::</span> <span class="org-haskell-constructor">State</span> (<span class="org-haskell-constructor">Int</span><span class="org-haskell-operator">,</span> <span class="org-haskell-constructor">Int</span>) <span class="org-haskell-constructor">Int</span> 
    fibgen2 <span class="org-haskell-operator">=</span> state <span class="org-haskell-operator">$</span> <span class="org-haskell-operator">\</span> (a<span class="org-haskell-operator">,</span> b) <span class="org-haskell-operator">-&gt;</span> <span class="org-haskell-keyword">let</span> c <span class="org-haskell-operator">=</span> a <span class="org-haskell-operator">+</span> b <span class="org-haskell-keyword">in</span> (c<span class="org-haskell-operator">,</span> (b<span class="org-haskell-operator">,</span> c))
                                
<span class="org-haskell-constructor">:</span>}

<span class="org-haskell-operator">&gt;&gt;&gt;</span> runState fibgen2 (0<span class="org-haskell-operator">,</span> 1)
(1<span class="org-haskell-operator">,</span>(1<span class="org-haskell-operator">,</span>1))
<span class="org-haskell-operator">&gt;&gt;&gt;</span> runState fibgen2 (1<span class="org-haskell-operator">,</span> 1)
(2<span class="org-haskell-operator">,</span>(1<span class="org-haskell-operator">,</span>2))
<span class="org-haskell-operator">&gt;&gt;&gt;</span> runState fibgen2 (1<span class="org-haskell-operator">,</span> 2)
(3<span class="org-haskell-operator">,</span>(2<span class="org-haskell-operator">,</span>3))
<span class="org-haskell-operator">&gt;&gt;&gt;</span> runState fibgen2 (2<span class="org-haskell-operator">,</span> 3)
(5<span class="org-haskell-operator">,</span>(3<span class="org-haskell-operator">,</span>5))
<span class="org-haskell-operator">&gt;&gt;&gt;</span> runState fibgen2 (3<span class="org-haskell-operator">,</span> 5)
(8<span class="org-haskell-operator">,</span>(5<span class="org-haskell-operator">,</span>8))
<span class="org-haskell-operator">&gt;&gt;&gt;</span> runState fibgen2 (5<span class="org-haskell-operator">,</span> 8)
(13<span class="org-haskell-operator">,</span>(8<span class="org-haskell-operator">,</span>13))
<span class="org-haskell-operator">&gt;&gt;&gt;</span> 

<span class="org-comment-delimiter">{- </span><span class="org-comment">Generating the state sequence  </span>

<span class="org-comment">-}</span>

<span class="org-haskell-operator">&gt;&gt;&gt;</span> <span class="org-haskell-keyword">import</span> <span class="org-haskell-constructor">Data.List</span> (unfoldr)
<span class="org-haskell-operator">&gt;&gt;&gt;</span> 
<span class="org-haskell-operator">&gt;&gt;&gt;</span> <span class="org-haskell-constructor">:</span>t unfoldr
<span class="org-function-name">unfoldr</span> <span class="org-haskell-operator">::</span> (b <span class="org-haskell-operator">-&gt;</span> <span class="org-haskell-constructor">Maybe</span> (a<span class="org-haskell-operator">,</span> b)) <span class="org-haskell-operator">-&gt;</span> b <span class="org-haskell-operator">-&gt;</span> [a]
<span class="org-haskell-operator">&gt;&gt;&gt;</span> 


<span class="org-haskell-constructor">:</span>{
<span class="org-haskell-keyword">let</span> fibseq <span class="org-haskell-operator">=</span> 
      unfoldr (<span class="org-haskell-operator">\</span>s <span class="org-haskell-operator">-&gt;</span> <span class="org-haskell-keyword">let</span> (out<span class="org-haskell-operator">,</span> ns) <span class="org-haskell-operator">=</span> runState fibgen s 
                     <span class="org-haskell-keyword">in</span> <span class="org-haskell-constructor">Just</span> (out<span class="org-haskell-operator">,</span> ns)) (0<span class="org-haskell-operator">,</span> 1)
<span class="org-haskell-constructor">:</span>}


<span class="org-haskell-operator">&gt;&gt;&gt;</span> <span class="org-haskell-constructor">:</span>t fibseq 
<span class="org-function-name">fibseq</span> <span class="org-haskell-operator">::</span> [<span class="org-haskell-constructor">Int</span>]
<span class="org-haskell-operator">&gt;&gt;&gt;</span> 

<span class="org-haskell-operator">&gt;&gt;&gt;</span> take 20 fibseq 
[1<span class="org-haskell-operator">,</span>2<span class="org-haskell-operator">,</span>3<span class="org-haskell-operator">,</span>5<span class="org-haskell-operator">,</span>8<span class="org-haskell-operator">,</span>13<span class="org-haskell-operator">,</span>21<span class="org-haskell-operator">,</span>34<span class="org-haskell-operator">,</span>55<span class="org-haskell-operator">,</span>89<span class="org-haskell-operator">,</span>144<span class="org-haskell-operator">,</span>233<span class="org-haskell-operator">,</span>377<span class="org-haskell-operator">,</span>610<span class="org-haskell-operator">,</span>987<span class="org-haskell-operator">,</span>1597<span class="org-haskell-operator">,</span>2584<span class="org-haskell-operator">,</span>4181<span class="org-haskell-operator">,</span>6765<span class="org-haskell-operator">,</span>10946]
<span class="org-haskell-operator">&gt;&gt;&gt;</span>
</pre>
</div>
</div>
</div>

<div id="outline-container-sec-1-14-7-3" class="outline-5">
<h5 id="sec-1-14-7-3"><span class="section-number-5">1.14.7.3</span> State monad in OCaml</h5>
<div class="outline-text-5" id="text-1-14-7-3">
<p>
Implementation: 
</p>

<div class="org-src-container">

<pre class="src src-ocaml"><span class="org-comment-delimiter">(* </span><span class="org-comment">stfn - Stands for state transformer </span><span class="org-comment-delimiter">*)</span> 

<span class="org-tuareg-font-lock-governing">module</span> <span class="org-tuareg-font-lock-module">State</span> <span class="org-tuareg-font-lock-operator">=</span>
  <span class="org-tuareg-font-lock-governing">struct</span>

    <span class="org-tuareg-font-lock-governing">type</span> <span class="org-tuareg-font-lock-operator">(</span><span class="org-type">'s</span><span class="org-tuareg-font-lock-operator">,</span><span class="org-type"> 'a</span><span class="org-tuareg-font-lock-operator">)</span><span class="org-type"> state</span> <span class="org-tuareg-font-lock-operator">=</span> <span class="org-tuareg-font-lock-constructor">ST</span> <span class="org-keyword">of</span> <span class="org-tuareg-font-lock-operator">(</span>'s <span class="org-tuareg-font-lock-operator">-&gt;</span> 'a <span class="org-tuareg-font-lock-operator">*</span> 's<span class="org-tuareg-font-lock-operator">)</span>

   <span class="org-comment-delimiter">(* </span><span class="org-comment">Runs  the state transformer  </span>
<span class="org-comment">    </span>
<span class="org-comment">     runState </span>
<span class="org-comment">    </span><span class="org-comment-delimiter">*)</span>                                 
    <span class="org-tuareg-font-lock-governing">let</span> <span class="org-function-name">run</span><span class="org-variable-name"> </span><span class="org-tuareg-font-lock-operator">(</span><span class="org-tuareg-font-lock-constructor">ST</span><span class="org-variable-name"> stfnt</span><span class="org-tuareg-font-lock-operator">)</span><span class="org-variable-name"> s</span> <span class="org-tuareg-font-lock-operator">=</span> stfnt s

    <span class="org-comment-delimiter">(* </span><span class="org-comment">Gets only the result and discards the </span>
<span class="org-comment">       the next state. </span>
<span class="org-comment">       </span>
<span class="org-comment">      evalState </span>
<span class="org-comment">     </span><span class="org-comment-delimiter">*)</span>                           
    <span class="org-tuareg-font-lock-governing">let</span> <span class="org-function-name">eval</span><span class="org-variable-name"> stfn s</span> <span class="org-tuareg-font-lock-operator">=</span> fst <span class="org-tuareg-font-lock-operator">(</span>run stfn s<span class="org-tuareg-font-lock-operator">)</span>

    <span class="org-comment-delimiter">(* </span><span class="org-comment">Gets only the next state and drops the </span>
<span class="org-comment">       result </span>

<span class="org-comment">      execState </span>
<span class="org-comment">     </span><span class="org-comment-delimiter">*)</span>
    <span class="org-tuareg-font-lock-governing">let</span> <span class="org-function-name">exec</span><span class="org-variable-name"> stfn s</span> <span class="org-tuareg-font-lock-operator">=</span> snd <span class="org-tuareg-font-lock-operator">(</span>run stfn s<span class="org-tuareg-font-lock-operator">)</span>


    <span class="org-tuareg-font-lock-governing">let</span> <span class="org-function-name">put</span><span class="org-variable-name"> s</span> <span class="org-tuareg-font-lock-operator">=</span> <span class="org-tuareg-font-lock-constructor">ST</span> <span class="org-tuareg-font-lock-operator">(</span><span class="org-keyword">fun</span> <span class="org-variable-name">_</span> <span class="org-tuareg-font-lock-operator">-&gt;</span> <span class="org-tuareg-font-lock-operator">((),</span> s<span class="org-tuareg-font-lock-operator">))</span>

    <span class="org-tuareg-font-lock-governing">let</span> <span class="org-variable-name">get</span> <span class="org-tuareg-font-lock-operator">=</span> <span class="org-tuareg-font-lock-constructor">ST</span> <span class="org-tuareg-font-lock-operator">(</span><span class="org-keyword">fun</span> <span class="org-variable-name">s</span> <span class="org-tuareg-font-lock-operator">-&gt;</span> <span class="org-tuareg-font-lock-operator">(</span>s<span class="org-tuareg-font-lock-operator">,</span> s<span class="org-tuareg-font-lock-operator">))</span>

    <span class="org-comment-delimiter">(* </span><span class="org-comment">return a = State $ \s -&gt; (a, s) </span><span class="org-comment-delimiter">*)</span>             
    <span class="org-tuareg-font-lock-governing">let</span> <span class="org-function-name">unit</span><span class="org-variable-name"> a</span> <span class="org-tuareg-font-lock-operator">=</span> <span class="org-tuareg-font-lock-constructor">ST</span> <span class="org-tuareg-font-lock-operator">(</span><span class="org-keyword">fun</span> <span class="org-variable-name">s</span> <span class="org-tuareg-font-lock-operator">-&gt;</span> <span class="org-tuareg-font-lock-operator">(</span>a<span class="org-tuareg-font-lock-operator">,</span> s<span class="org-tuareg-font-lock-operator">))</span>

    <span class="org-tuareg-font-lock-governing">let</span> <span class="org-function-name">bind</span><span class="org-variable-name"> stfn stfnMaker</span> <span class="org-tuareg-font-lock-operator">=</span>
      <span class="org-tuareg-font-lock-constructor">ST</span> <span class="org-tuareg-font-lock-operator">(</span> <span class="org-keyword">fun</span> <span class="org-variable-name">currentState</span> <span class="org-tuareg-font-lock-operator">-&gt;</span>
           <span class="org-tuareg-font-lock-governing">let</span> <span class="org-tuareg-font-lock-operator">(</span><span class="org-variable-name">result</span><span class="org-tuareg-font-lock-operator">,</span><span class="org-variable-name"> newState</span><span class="org-tuareg-font-lock-operator">)</span> <span class="org-tuareg-font-lock-operator">=</span> run stfn currentState
           <span class="org-tuareg-font-lock-governing">in</span> run <span class="org-tuareg-font-lock-operator">(</span>stfnMaker result<span class="org-tuareg-font-lock-operator">)</span> newState 
         <span class="org-tuareg-font-lock-operator">)</span>
         
    <span class="org-comment-delimiter">(* </span><span class="org-comment">fmap </span><span class="org-comment-delimiter">*)</span>
    <span class="org-tuareg-font-lock-governing">let</span> <span class="org-function-name">map</span><span class="org-variable-name"> fn stfn</span> <span class="org-tuareg-font-lock-operator">=</span>
      <span class="org-tuareg-font-lock-constructor">ST</span> <span class="org-tuareg-font-lock-operator">(</span><span class="org-keyword">fun</span> <span class="org-variable-name">currentState</span> <span class="org-tuareg-font-lock-operator">-&gt;</span>
          <span class="org-tuareg-font-lock-governing">let</span> <span class="org-tuareg-font-lock-operator">(</span><span class="org-variable-name">result</span><span class="org-tuareg-font-lock-operator">,</span><span class="org-variable-name"> newState</span><span class="org-tuareg-font-lock-operator">)</span> <span class="org-tuareg-font-lock-operator">=</span> run stfn currentState 
          <span class="org-tuareg-font-lock-governing">in</span> <span class="org-tuareg-font-lock-operator">(</span>fn result<span class="org-tuareg-font-lock-operator">,</span> newState<span class="org-tuareg-font-lock-operator">)</span>
         <span class="org-tuareg-font-lock-operator">)</span>

         
    <span class="org-tuareg-font-lock-governing">let</span> <span class="org-tuareg-font-lock-operator">(&gt;&gt;=)</span> <span class="org-tuareg-font-lock-operator">=</span> bind

    <span class="org-tuareg-font-lock-governing">let</span> <span class="org-tuareg-font-lock-operator">(&lt;</span><span class="org-variable-name">$</span><span class="org-tuareg-font-lock-operator">&gt;)</span> <span class="org-tuareg-font-lock-operator">=</span> map
                             
    <span class="org-tuareg-font-lock-governing">let</span> <span class="org-tuareg-font-lock-operator">(&gt;&gt;)</span> ma mb <span class="org-tuareg-font-lock-operator">=</span>
      ma <span class="org-tuareg-font-lock-operator">&gt;&gt;=</span> <span class="org-keyword">fun</span> <span class="org-variable-name">_</span> <span class="org-tuareg-font-lock-operator">-&gt;</span> mb

    <span class="org-tuareg-font-lock-governing">let</span> <span class="org-function-name">sequence</span><span class="org-variable-name"> mlist</span> <span class="org-tuareg-font-lock-operator">=</span>
      <span class="org-tuareg-font-lock-governing">let</span> <span class="org-function-name">mcons</span><span class="org-variable-name"> p q</span> <span class="org-tuareg-font-lock-operator">=</span>
        p <span class="org-tuareg-font-lock-operator">&gt;&gt;=</span> <span class="org-keyword">fun</span> <span class="org-variable-name">x</span> <span class="org-tuareg-font-lock-operator">-&gt;</span>
        q <span class="org-tuareg-font-lock-operator">&gt;&gt;=</span> <span class="org-keyword">fun</span> <span class="org-variable-name">y</span> <span class="org-tuareg-font-lock-operator">-&gt;</span>
        unit <span class="org-tuareg-font-lock-operator">(</span>x<span class="org-tuareg-font-lock-operator">::</span><span class="org-type">y</span><span class="org-tuareg-font-lock-operator">)</span>
      <span class="org-tuareg-font-lock-governing">in</span> <span class="org-tuareg-font-lock-module">List.</span>fold_right mcons mlist <span class="org-tuareg-font-lock-operator">(</span>unit <span class="org-tuareg-font-lock-operator">[])</span>


    <span class="org-comment-delimiter">(* </span><span class="org-comment">Applicative Functor - Haskell &lt;$&gt;  </span><span class="org-comment-delimiter">*)</span>             
    <span class="org-tuareg-font-lock-governing">let</span> <span class="org-tuareg-font-lock-operator">(&lt;*&gt;)</span> m_fn ma <span class="org-tuareg-font-lock-operator">=</span>
      m_fn     <span class="org-tuareg-font-lock-operator">&gt;&gt;=</span> <span class="org-keyword">fun</span> <span class="org-variable-name">fn</span> <span class="org-tuareg-font-lock-operator">-&gt;</span>
      ma       <span class="org-tuareg-font-lock-operator">&gt;&gt;=</span> <span class="org-keyword">fun</span> <span class="org-variable-name">a</span>  <span class="org-tuareg-font-lock-operator">-&gt;</span>
      unit <span class="org-tuareg-font-lock-operator">(</span>fn a<span class="org-tuareg-font-lock-operator">)</span>

    <span class="org-tuareg-font-lock-governing">let</span> <span class="org-function-name">liftM2</span><span class="org-variable-name"> fn ma mb</span> <span class="org-tuareg-font-lock-operator">=</span>
      ma      <span class="org-tuareg-font-lock-operator">&gt;&gt;=</span> <span class="org-keyword">fun</span> <span class="org-variable-name">a</span> <span class="org-tuareg-font-lock-operator">-&gt;</span>
      mb      <span class="org-tuareg-font-lock-operator">&gt;&gt;=</span> <span class="org-keyword">fun</span> <span class="org-variable-name">b</span> <span class="org-tuareg-font-lock-operator">-&gt;</span>
      unit <span class="org-tuareg-font-lock-operator">(</span>fn a b<span class="org-tuareg-font-lock-operator">)</span>

    <span class="org-tuareg-font-lock-governing">let</span> <span class="org-function-name">liftM3</span><span class="org-variable-name"> fn ma mb mc</span> <span class="org-tuareg-font-lock-operator">=</span> 
      ma     <span class="org-tuareg-font-lock-operator">&gt;&gt;=</span> <span class="org-keyword">fun</span> <span class="org-variable-name">a</span> <span class="org-tuareg-font-lock-operator">-&gt;</span>
      mb     <span class="org-tuareg-font-lock-operator">&gt;&gt;=</span> <span class="org-keyword">fun</span> <span class="org-variable-name">b</span> <span class="org-tuareg-font-lock-operator">-&gt;</span>
      mc     <span class="org-tuareg-font-lock-operator">&gt;&gt;=</span> <span class="org-keyword">fun</span> <span class="org-variable-name">c</span> <span class="org-tuareg-font-lock-operator">-&gt;</span>
      unit <span class="org-tuareg-font-lock-operator">(</span>fn a b c<span class="org-tuareg-font-lock-operator">)</span>
                         
    <span class="org-tuareg-font-lock-governing">let</span> <span class="org-function-name">mapM</span><span class="org-variable-name"> fn alst</span> <span class="org-tuareg-font-lock-operator">=</span>
      sequence <span class="org-tuareg-font-lock-operator">(</span><span class="org-tuareg-font-lock-module">List.</span>map fn alst<span class="org-tuareg-font-lock-operator">)</span>
                         
  <span class="org-tuareg-font-lock-governing">end</span> 
<span class="org-tuareg-font-lock-operator">;;</span>

<span class="org-tuareg-font-lock-governing">module</span> <span class="org-tuareg-font-lock-module">State</span> <span class="org-tuareg-font-lock-operator">:</span>
  <span class="org-tuareg-font-lock-governing">sig</span>
    <span class="org-tuareg-font-lock-governing">type</span> <span class="org-tuareg-font-lock-operator">(</span><span class="org-type">'s</span><span class="org-tuareg-font-lock-operator">,</span><span class="org-type"> 'a</span><span class="org-tuareg-font-lock-operator">)</span><span class="org-type"> state</span> <span class="org-tuareg-font-lock-operator">=</span> <span class="org-tuareg-font-lock-constructor">ST</span> <span class="org-keyword">of</span> <span class="org-tuareg-font-lock-operator">(</span>'s <span class="org-tuareg-font-lock-operator">-&gt;</span> 'a <span class="org-tuareg-font-lock-operator">*</span> 's<span class="org-tuareg-font-lock-operator">)</span>
    <span class="org-tuareg-font-lock-governing">val</span> <span class="org-function-name">run</span> <span class="org-tuareg-font-lock-operator">:</span> <span class="org-tuareg-font-lock-operator">(</span>'a<span class="org-tuareg-font-lock-operator">,</span> 'b<span class="org-tuareg-font-lock-operator">)</span> state <span class="org-tuareg-font-lock-operator">-&gt;</span> 'a <span class="org-tuareg-font-lock-operator">-&gt;</span> 'b <span class="org-tuareg-font-lock-operator">*</span> 'a
    <span class="org-tuareg-font-lock-governing">val</span> <span class="org-function-name">eval</span> <span class="org-tuareg-font-lock-operator">:</span> <span class="org-tuareg-font-lock-operator">(</span>'a<span class="org-tuareg-font-lock-operator">,</span> 'b<span class="org-tuareg-font-lock-operator">)</span> state <span class="org-tuareg-font-lock-operator">-&gt;</span> 'a <span class="org-tuareg-font-lock-operator">-&gt;</span> 'b
    <span class="org-tuareg-font-lock-governing">val</span> <span class="org-function-name">exec</span> <span class="org-tuareg-font-lock-operator">:</span> <span class="org-tuareg-font-lock-operator">(</span>'a<span class="org-tuareg-font-lock-operator">,</span> 'b<span class="org-tuareg-font-lock-operator">)</span> state <span class="org-tuareg-font-lock-operator">-&gt;</span> 'a <span class="org-tuareg-font-lock-operator">-&gt;</span> 'a
    <span class="org-tuareg-font-lock-governing">val</span> <span class="org-function-name">put</span> <span class="org-tuareg-font-lock-operator">:</span> 'a <span class="org-tuareg-font-lock-operator">-&gt;</span> <span class="org-tuareg-font-lock-operator">(</span>'a<span class="org-tuareg-font-lock-operator">,</span> unit<span class="org-tuareg-font-lock-operator">)</span> state
    <span class="org-tuareg-font-lock-governing">val</span> <span class="org-function-name">get</span> <span class="org-tuareg-font-lock-operator">:</span> <span class="org-tuareg-font-lock-operator">(</span>'a<span class="org-tuareg-font-lock-operator">,</span> 'a<span class="org-tuareg-font-lock-operator">)</span> state
    <span class="org-tuareg-font-lock-governing">val</span> <span class="org-function-name">unit</span> <span class="org-tuareg-font-lock-operator">:</span> 'a <span class="org-tuareg-font-lock-operator">-&gt;</span> <span class="org-tuareg-font-lock-operator">(</span>'b<span class="org-tuareg-font-lock-operator">,</span> 'a<span class="org-tuareg-font-lock-operator">)</span> state
    <span class="org-tuareg-font-lock-governing">val</span> <span class="org-function-name">bind</span> <span class="org-tuareg-font-lock-operator">:</span> <span class="org-tuareg-font-lock-operator">(</span>'a<span class="org-tuareg-font-lock-operator">,</span> 'b<span class="org-tuareg-font-lock-operator">)</span> state <span class="org-tuareg-font-lock-operator">-&gt;</span> <span class="org-tuareg-font-lock-operator">(</span>'b <span class="org-tuareg-font-lock-operator">-&gt;</span> <span class="org-tuareg-font-lock-operator">(</span>'a<span class="org-tuareg-font-lock-operator">,</span> 'c<span class="org-tuareg-font-lock-operator">)</span> state<span class="org-tuareg-font-lock-operator">)</span> <span class="org-tuareg-font-lock-operator">-&gt;</span> <span class="org-tuareg-font-lock-operator">(</span>'a<span class="org-tuareg-font-lock-operator">,</span> 'c<span class="org-tuareg-font-lock-operator">)</span> state
    <span class="org-tuareg-font-lock-governing">val</span> <span class="org-function-name">map</span> <span class="org-tuareg-font-lock-operator">:</span> <span class="org-tuareg-font-lock-operator">(</span>'a <span class="org-tuareg-font-lock-operator">-&gt;</span> 'b<span class="org-tuareg-font-lock-operator">)</span> <span class="org-tuareg-font-lock-operator">-&gt;</span> <span class="org-tuareg-font-lock-operator">(</span>'c<span class="org-tuareg-font-lock-operator">,</span> 'a<span class="org-tuareg-font-lock-operator">)</span> state <span class="org-tuareg-font-lock-operator">-&gt;</span> <span class="org-tuareg-font-lock-operator">(</span>'c<span class="org-tuareg-font-lock-operator">,</span> 'b<span class="org-tuareg-font-lock-operator">)</span> state
    <span class="org-tuareg-font-lock-governing">val</span> <span class="org-tuareg-font-lock-operator">(</span> <span class="org-tuareg-font-lock-operator">&gt;&gt;=</span> <span class="org-tuareg-font-lock-operator">)</span> <span class="org-tuareg-font-lock-operator">:</span> <span class="org-tuareg-font-lock-operator">(</span>'a<span class="org-tuareg-font-lock-operator">,</span> 'b<span class="org-tuareg-font-lock-operator">)</span> state <span class="org-tuareg-font-lock-operator">-&gt;</span> <span class="org-tuareg-font-lock-operator">(</span>'b <span class="org-tuareg-font-lock-operator">-&gt;</span> <span class="org-tuareg-font-lock-operator">(</span>'a<span class="org-tuareg-font-lock-operator">,</span> 'c<span class="org-tuareg-font-lock-operator">)</span> state<span class="org-tuareg-font-lock-operator">)</span> <span class="org-tuareg-font-lock-operator">-&gt;</span> <span class="org-tuareg-font-lock-operator">(</span>'a<span class="org-tuareg-font-lock-operator">,</span> 'c<span class="org-tuareg-font-lock-operator">)</span> state
    <span class="org-tuareg-font-lock-governing">val</span> <span class="org-tuareg-font-lock-operator">(</span> <span class="org-tuareg-font-lock-operator">&lt;</span>$<span class="org-tuareg-font-lock-operator">&gt;</span> <span class="org-tuareg-font-lock-operator">)</span> <span class="org-tuareg-font-lock-operator">:</span> <span class="org-tuareg-font-lock-operator">(</span>'a <span class="org-tuareg-font-lock-operator">-&gt;</span> 'b<span class="org-tuareg-font-lock-operator">)</span> <span class="org-tuareg-font-lock-operator">-&gt;</span> <span class="org-tuareg-font-lock-operator">(</span>'c<span class="org-tuareg-font-lock-operator">,</span> 'a<span class="org-tuareg-font-lock-operator">)</span> state <span class="org-tuareg-font-lock-operator">-&gt;</span> <span class="org-tuareg-font-lock-operator">(</span>'c<span class="org-tuareg-font-lock-operator">,</span> 'b<span class="org-tuareg-font-lock-operator">)</span> state
    <span class="org-tuareg-font-lock-governing">val</span> <span class="org-tuareg-font-lock-operator">(</span> <span class="org-tuareg-font-lock-operator">&gt;&gt;</span> <span class="org-tuareg-font-lock-operator">)</span> <span class="org-tuareg-font-lock-operator">:</span> <span class="org-tuareg-font-lock-operator">(</span>'a<span class="org-tuareg-font-lock-operator">,</span> 'b<span class="org-tuareg-font-lock-operator">)</span> state <span class="org-tuareg-font-lock-operator">-&gt;</span> <span class="org-tuareg-font-lock-operator">(</span>'a<span class="org-tuareg-font-lock-operator">,</span> 'c<span class="org-tuareg-font-lock-operator">)</span> state <span class="org-tuareg-font-lock-operator">-&gt;</span> <span class="org-tuareg-font-lock-operator">(</span>'a<span class="org-tuareg-font-lock-operator">,</span> 'c<span class="org-tuareg-font-lock-operator">)</span> state
    <span class="org-tuareg-font-lock-governing">val</span> <span class="org-function-name">sequence</span> <span class="org-tuareg-font-lock-operator">:</span> <span class="org-tuareg-font-lock-operator">(</span>'a<span class="org-tuareg-font-lock-operator">,</span> 'b<span class="org-tuareg-font-lock-operator">)</span> state list <span class="org-tuareg-font-lock-operator">-&gt;</span> <span class="org-tuareg-font-lock-operator">(</span>'a<span class="org-tuareg-font-lock-operator">,</span> 'b list<span class="org-tuareg-font-lock-operator">)</span> state
    <span class="org-tuareg-font-lock-governing">val</span> <span class="org-tuareg-font-lock-operator">(</span> <span class="org-tuareg-font-lock-operator">&lt;*&gt;</span> <span class="org-tuareg-font-lock-operator">)</span> <span class="org-tuareg-font-lock-operator">:</span> <span class="org-tuareg-font-lock-operator">(</span>'a<span class="org-tuareg-font-lock-operator">,</span> 'b <span class="org-tuareg-font-lock-operator">-&gt;</span> 'c<span class="org-tuareg-font-lock-operator">)</span> state <span class="org-tuareg-font-lock-operator">-&gt;</span> <span class="org-tuareg-font-lock-operator">(</span>'a<span class="org-tuareg-font-lock-operator">,</span> 'b<span class="org-tuareg-font-lock-operator">)</span> state <span class="org-tuareg-font-lock-operator">-&gt;</span> <span class="org-tuareg-font-lock-operator">(</span>'a<span class="org-tuareg-font-lock-operator">,</span> 'c<span class="org-tuareg-font-lock-operator">)</span> state
    <span class="org-tuareg-font-lock-governing">val</span> <span class="org-function-name">liftM2</span> <span class="org-tuareg-font-lock-operator">:</span>
      <span class="org-tuareg-font-lock-operator">(</span>'a <span class="org-tuareg-font-lock-operator">-&gt;</span> 'b <span class="org-tuareg-font-lock-operator">-&gt;</span> 'c<span class="org-tuareg-font-lock-operator">)</span> <span class="org-tuareg-font-lock-operator">-&gt;</span> <span class="org-tuareg-font-lock-operator">(</span>'d<span class="org-tuareg-font-lock-operator">,</span> 'a<span class="org-tuareg-font-lock-operator">)</span> state <span class="org-tuareg-font-lock-operator">-&gt;</span> <span class="org-tuareg-font-lock-operator">(</span>'d<span class="org-tuareg-font-lock-operator">,</span> 'b<span class="org-tuareg-font-lock-operator">)</span> state <span class="org-tuareg-font-lock-operator">-&gt;</span> <span class="org-tuareg-font-lock-operator">(</span>'d<span class="org-tuareg-font-lock-operator">,</span> 'c<span class="org-tuareg-font-lock-operator">)</span> state
    <span class="org-tuareg-font-lock-governing">val</span> <span class="org-function-name">liftM3</span> <span class="org-tuareg-font-lock-operator">:</span>
      <span class="org-tuareg-font-lock-operator">(</span>'a <span class="org-tuareg-font-lock-operator">-&gt;</span> 'b <span class="org-tuareg-font-lock-operator">-&gt;</span> 'c <span class="org-tuareg-font-lock-operator">-&gt;</span> 'd<span class="org-tuareg-font-lock-operator">)</span> <span class="org-tuareg-font-lock-operator">-&gt;</span>
      <span class="org-tuareg-font-lock-operator">(</span>'e<span class="org-tuareg-font-lock-operator">,</span> 'a<span class="org-tuareg-font-lock-operator">)</span> state <span class="org-tuareg-font-lock-operator">-&gt;</span> <span class="org-tuareg-font-lock-operator">(</span>'e<span class="org-tuareg-font-lock-operator">,</span> 'b<span class="org-tuareg-font-lock-operator">)</span> state <span class="org-tuareg-font-lock-operator">-&gt;</span> <span class="org-tuareg-font-lock-operator">(</span>'e<span class="org-tuareg-font-lock-operator">,</span> 'c<span class="org-tuareg-font-lock-operator">)</span> state <span class="org-tuareg-font-lock-operator">-&gt;</span> <span class="org-tuareg-font-lock-operator">(</span>'e<span class="org-tuareg-font-lock-operator">,</span> 'd<span class="org-tuareg-font-lock-operator">)</span> state
    <span class="org-tuareg-font-lock-governing">val</span> <span class="org-function-name">mapM</span> <span class="org-tuareg-font-lock-operator">:</span> <span class="org-tuareg-font-lock-operator">(</span>'a <span class="org-tuareg-font-lock-operator">-&gt;</span> <span class="org-tuareg-font-lock-operator">(</span>'b<span class="org-tuareg-font-lock-operator">,</span> 'c<span class="org-tuareg-font-lock-operator">)</span> state<span class="org-tuareg-font-lock-operator">)</span> <span class="org-tuareg-font-lock-operator">-&gt;</span> 'a list <span class="org-tuareg-font-lock-operator">-&gt;</span> <span class="org-tuareg-font-lock-operator">(</span>'b<span class="org-tuareg-font-lock-operator">,</span> 'c list<span class="org-tuareg-font-lock-operator">)</span> state
  <span class="org-tuareg-font-lock-governing">end</span>
<span class="org-tuareg-font-lock-operator">#</span>
</pre>
</div>

<p>
Tests:
</p>


<p>
Basic Example:
</p>

<div class="org-src-container">

<pre class="src src-ocaml"><span class="org-tuareg-font-lock-governing">let</span> <span class="org-variable-name">stFn</span> <span class="org-tuareg-font-lock-operator">=</span> 
   <span class="org-tuareg-font-lock-governing">let</span> <span class="org-tuareg-font-lock-governing">open </span><span class="org-tuareg-font-lock-module">State</span> <span class="org-tuareg-font-lock-governing">in</span> 
   <span class="org-tuareg-font-lock-constructor">ST</span> <span class="org-tuareg-font-lock-operator">(</span><span class="org-keyword">fun</span> <span class="org-variable-name">s</span> <span class="org-tuareg-font-lock-operator">-&gt;</span> <span class="org-tuareg-font-lock-operator">(</span>2 <span class="org-tuareg-font-lock-operator">*</span> s<span class="org-tuareg-font-lock-operator">,</span> s <span class="org-tuareg-font-lock-operator">+</span> 1<span class="org-tuareg-font-lock-operator">))</span> 
<span class="org-tuareg-font-lock-operator">;;</span>
<span class="org-tuareg-font-lock-governing">val</span> <span class="org-function-name">stFn</span> <span class="org-tuareg-font-lock-operator">:</span> <span class="org-tuareg-font-lock-operator">(</span>int<span class="org-tuareg-font-lock-operator">,</span> int<span class="org-tuareg-font-lock-operator">)</span> <span class="org-tuareg-font-lock-module">State.</span>state <span class="org-tuareg-font-lock-operator">=</span> <span class="org-tuareg-font-lock-module">State.</span><span class="org-tuareg-font-lock-constructor">ST</span> <span class="org-tuareg-font-lock-operator">&lt;</span><span class="org-keyword">fun</span><span class="org-tuareg-font-lock-operator">&gt;</span>

<span class="org-tuareg-font-lock-operator">#</span>  <span class="org-tuareg-font-lock-module">State.</span>run stFn 1 <span class="org-tuareg-font-lock-operator">;;</span>
<span class="org-function-name">-</span> <span class="org-tuareg-font-lock-operator">:</span> int <span class="org-tuareg-font-lock-operator">*</span> int <span class="org-tuareg-font-lock-operator">=</span> <span class="org-tuareg-font-lock-operator">(</span>2<span class="org-tuareg-font-lock-operator">,</span> 2<span class="org-tuareg-font-lock-operator">)</span>
<span class="org-tuareg-font-lock-operator">#</span> 
  <span class="org-tuareg-font-lock-module">State.</span>run stFn 2 <span class="org-tuareg-font-lock-operator">;;</span>
<span class="org-function-name">-</span> <span class="org-tuareg-font-lock-operator">:</span> int <span class="org-tuareg-font-lock-operator">*</span> int <span class="org-tuareg-font-lock-operator">=</span> <span class="org-tuareg-font-lock-operator">(</span>4<span class="org-tuareg-font-lock-operator">,</span> 3<span class="org-tuareg-font-lock-operator">)</span>
<span class="org-tuareg-font-lock-operator">#</span> <span class="org-tuareg-font-lock-module">State.</span>run stFn 3 <span class="org-tuareg-font-lock-operator">;;</span>
<span class="org-function-name">-</span> <span class="org-tuareg-font-lock-operator">:</span> int <span class="org-tuareg-font-lock-operator">*</span> int <span class="org-tuareg-font-lock-operator">=</span> <span class="org-tuareg-font-lock-operator">(</span>6<span class="org-tuareg-font-lock-operator">,</span> 4<span class="org-tuareg-font-lock-operator">)</span>
<span class="org-tuareg-font-lock-operator">#</span> <span class="org-tuareg-font-lock-module">State.</span>run stFn 4 <span class="org-tuareg-font-lock-operator">;;</span>
<span class="org-function-name">-</span> <span class="org-tuareg-font-lock-operator">:</span> int <span class="org-tuareg-font-lock-operator">*</span> int <span class="org-tuareg-font-lock-operator">=</span> <span class="org-tuareg-font-lock-operator">(</span>8<span class="org-tuareg-font-lock-operator">,</span> 5<span class="org-tuareg-font-lock-operator">)</span>
<span class="org-tuareg-font-lock-operator">#</span> <span class="org-tuareg-font-lock-module">State.</span>run stFn 5 <span class="org-tuareg-font-lock-operator">;;</span>
<span class="org-function-name">-</span> <span class="org-tuareg-font-lock-operator">:</span> int <span class="org-tuareg-font-lock-operator">*</span> int <span class="org-tuareg-font-lock-operator">=</span> <span class="org-tuareg-font-lock-operator">(</span>10<span class="org-tuareg-font-lock-operator">,</span> 6<span class="org-tuareg-font-lock-operator">)</span>
<span class="org-tuareg-font-lock-operator">#</span> <span class="org-tuareg-font-lock-module">State.</span>run stFn 6 <span class="org-tuareg-font-lock-operator">;;</span>
<span class="org-function-name">-</span> <span class="org-tuareg-font-lock-operator">:</span> int <span class="org-tuareg-font-lock-operator">*</span> int <span class="org-tuareg-font-lock-operator">=</span> <span class="org-tuareg-font-lock-operator">(</span>12<span class="org-tuareg-font-lock-operator">,</span> 7<span class="org-tuareg-font-lock-operator">)</span>
<span class="org-tuareg-font-lock-operator">#</span> 

<span class="org-tuareg-font-lock-operator">#</span> <span class="org-tuareg-font-lock-module">State.</span>eval stFn 6 <span class="org-tuareg-font-lock-operator">;;</span>
<span class="org-function-name">-</span> <span class="org-tuareg-font-lock-operator">:</span> int <span class="org-tuareg-font-lock-operator">=</span> 12
<span class="org-tuareg-font-lock-operator">#</span> 
<span class="org-tuareg-font-lock-operator">#</span> <span class="org-tuareg-font-lock-module">State.</span>exec stFn 6 <span class="org-tuareg-font-lock-operator">;;</span>
<span class="org-function-name">-</span> <span class="org-tuareg-font-lock-operator">:</span> int <span class="org-tuareg-font-lock-operator">=</span> 7
<span class="org-tuareg-font-lock-operator">#</span> 

<span class="org-tuareg-font-lock-operator">#</span> <span class="org-tuareg-font-lock-governing">let</span> <span class="org-variable-name">stFn2</span> <span class="org-tuareg-font-lock-operator">=</span> 
      <span class="org-tuareg-font-lock-governing">let</span> <span class="org-tuareg-font-lock-governing">open </span><span class="org-tuareg-font-lock-module">State</span> <span class="org-tuareg-font-lock-governing">in</span> 
      map <span class="org-tuareg-font-lock-operator">(</span><span class="org-keyword">fun</span> <span class="org-variable-name">x</span> <span class="org-tuareg-font-lock-operator">-&gt;</span> x <span class="org-tuareg-font-lock-operator">+</span> 3<span class="org-tuareg-font-lock-operator">)</span> stFn 
  <span class="org-tuareg-font-lock-operator">;;</span>
<span class="org-tuareg-font-lock-governing">val</span> <span class="org-function-name">stFn2</span> <span class="org-tuareg-font-lock-operator">:</span> <span class="org-tuareg-font-lock-operator">(</span>int<span class="org-tuareg-font-lock-operator">,</span> int<span class="org-tuareg-font-lock-operator">)</span> <span class="org-tuareg-font-lock-module">State.</span>state <span class="org-tuareg-font-lock-operator">=</span> <span class="org-tuareg-font-lock-module">State.</span><span class="org-tuareg-font-lock-constructor">ST</span> <span class="org-tuareg-font-lock-operator">&lt;</span>fu


<span class="org-tuareg-font-lock-operator">#</span>  <span class="org-tuareg-font-lock-module">State.</span>run stFn2 1 <span class="org-tuareg-font-lock-operator">;;</span>
<span class="org-function-name">-</span> <span class="org-tuareg-font-lock-operator">:</span> int <span class="org-tuareg-font-lock-operator">*</span> int <span class="org-tuareg-font-lock-operator">=</span> <span class="org-tuareg-font-lock-operator">(</span>5<span class="org-tuareg-font-lock-operator">,</span> 2<span class="org-tuareg-font-lock-operator">)</span>

<span class="org-tuareg-font-lock-operator">#</span>  <span class="org-tuareg-font-lock-module">State.</span>run stFn2 2 <span class="org-tuareg-font-lock-operator">;;</span>
<span class="org-function-name">-</span> <span class="org-tuareg-font-lock-operator">:</span> int <span class="org-tuareg-font-lock-operator">*</span> int <span class="org-tuareg-font-lock-operator">=</span> <span class="org-tuareg-font-lock-operator">(</span>7<span class="org-tuareg-font-lock-operator">,</span> 3<span class="org-tuareg-font-lock-operator">)</span>

<span class="org-tuareg-font-lock-operator">#</span> <span class="org-tuareg-font-lock-module">State.</span>run stFn2 3 <span class="org-tuareg-font-lock-operator">;;</span>
<span class="org-function-name">-</span> <span class="org-tuareg-font-lock-operator">:</span> int <span class="org-tuareg-font-lock-operator">*</span> int <span class="org-tuareg-font-lock-operator">=</span> <span class="org-tuareg-font-lock-operator">(</span>9<span class="org-tuareg-font-lock-operator">,</span> 4<span class="org-tuareg-font-lock-operator">)</span>

<span class="org-tuareg-font-lock-operator">#</span> <span class="org-tuareg-font-lock-module">State.</span>run stFn2 4 <span class="org-tuareg-font-lock-operator">;;</span>
<span class="org-function-name">-</span> <span class="org-tuareg-font-lock-operator">:</span> int <span class="org-tuareg-font-lock-operator">*</span> int <span class="org-tuareg-font-lock-operator">=</span> <span class="org-tuareg-font-lock-operator">(</span>11<span class="org-tuareg-font-lock-operator">,</span> 5<span class="org-tuareg-font-lock-operator">)</span>

<span class="org-tuareg-font-lock-operator">#</span> <span class="org-tuareg-font-lock-module">State.</span>run stFn2 5 <span class="org-tuareg-font-lock-operator">;;</span>
<span class="org-function-name">-</span> <span class="org-tuareg-font-lock-operator">:</span> int <span class="org-tuareg-font-lock-operator">*</span> int <span class="org-tuareg-font-lock-operator">=</span> <span class="org-tuareg-font-lock-operator">(</span>13<span class="org-tuareg-font-lock-operator">,</span> 6<span class="org-tuareg-font-lock-operator">)</span>


<span class="org-tuareg-font-lock-operator">#</span> <span class="org-tuareg-font-lock-governing">let</span> <span class="org-function-name">fn</span><span class="org-variable-name"> x</span> <span class="org-tuareg-font-lock-operator">=</span> x <span class="org-tuareg-font-lock-operator">+</span> 3 <span class="org-tuareg-font-lock-operator">;;</span>
<span class="org-tuareg-font-lock-governing">val</span> <span class="org-function-name">fn</span> <span class="org-tuareg-font-lock-operator">:</span> int <span class="org-tuareg-font-lock-operator">-&gt;</span> int <span class="org-tuareg-font-lock-operator">=</span> <span class="org-tuareg-font-lock-operator">&lt;</span><span class="org-keyword">fun</span><span class="org-tuareg-font-lock-operator">&gt;</span>

<span class="org-tuareg-font-lock-operator">#</span> <span class="org-tuareg-font-lock-module">State.</span>run <span class="org-tuareg-font-lock-operator">(</span><span class="org-tuareg-font-lock-module">State.</span>map fn stFn<span class="org-tuareg-font-lock-operator">)</span> 1 <span class="org-tuareg-font-lock-operator">;;</span>
<span class="org-function-name">-</span> <span class="org-tuareg-font-lock-operator">:</span> int <span class="org-tuareg-font-lock-operator">*</span> int <span class="org-tuareg-font-lock-operator">=</span> <span class="org-tuareg-font-lock-operator">(</span>5<span class="org-tuareg-font-lock-operator">,</span> 2<span class="org-tuareg-font-lock-operator">)</span>
<span class="org-tuareg-font-lock-operator">#</span> <span class="org-tuareg-font-lock-module">State.</span>run <span class="org-tuareg-font-lock-operator">(</span><span class="org-tuareg-font-lock-module">State.</span>map fn stFn<span class="org-tuareg-font-lock-operator">)</span> 2 <span class="org-tuareg-font-lock-operator">;;</span>
<span class="org-function-name">-</span> <span class="org-tuareg-font-lock-operator">:</span> int <span class="org-tuareg-font-lock-operator">*</span> int <span class="org-tuareg-font-lock-operator">=</span> <span class="org-tuareg-font-lock-operator">(</span>7<span class="org-tuareg-font-lock-operator">,</span> 3<span class="org-tuareg-font-lock-operator">)</span>
<span class="org-tuareg-font-lock-operator">#</span> <span class="org-tuareg-font-lock-module">State.</span>run <span class="org-tuareg-font-lock-operator">(</span><span class="org-tuareg-font-lock-module">State.</span>map fn stFn<span class="org-tuareg-font-lock-operator">)</span> 3 <span class="org-tuareg-font-lock-operator">;;</span>
<span class="org-function-name">-</span> <span class="org-tuareg-font-lock-operator">:</span> int <span class="org-tuareg-font-lock-operator">*</span> int <span class="org-tuareg-font-lock-operator">=</span> <span class="org-tuareg-font-lock-operator">(</span>9<span class="org-tuareg-font-lock-operator">,</span> 4<span class="org-tuareg-font-lock-operator">)</span>
<span class="org-tuareg-font-lock-operator">#</span> <span class="org-tuareg-font-lock-module">State.</span>run <span class="org-tuareg-font-lock-operator">(</span><span class="org-tuareg-font-lock-module">State.</span>map fn stFn<span class="org-tuareg-font-lock-operator">)</span> 4 <span class="org-tuareg-font-lock-operator">;;</span>
<span class="org-function-name">-</span> <span class="org-tuareg-font-lock-operator">:</span> int <span class="org-tuareg-font-lock-operator">*</span> int <span class="org-tuareg-font-lock-operator">=</span> <span class="org-tuareg-font-lock-operator">(</span>11<span class="org-tuareg-font-lock-operator">,</span> 5<span class="org-tuareg-font-lock-operator">)</span>
<span class="org-tuareg-font-lock-operator">#</span>


<span class="org-comment-delimiter">(* </span><span class="org-comment">Haskell Code:  </span>
<span class="org-comment">    </span>
<span class="org-comment">   :{</span>
<span class="org-comment">   </span>
<span class="org-comment">   let stateFn3 :: State Int Int</span>
<span class="org-comment">       stateFn3 = do</span>
<span class="org-comment">         currentState &lt;- get</span>
<span class="org-comment">         put (currentState + 1)  --- put $ currentState +  1</span>
<span class="org-comment">         return (2 * currentState)</span>
<span class="org-comment">   :}      </span>
<span class="org-comment"> </span>
<span class="org-comment"> ----------------------------------------      </span>

<span class="org-comment"> </span><span class="org-comment-delimiter">*)</span>

<span class="org-tuareg-font-lock-governing">let</span> <span class="org-variable-name">stFn3</span> <span class="org-tuareg-font-lock-operator">=</span>
  <span class="org-tuareg-font-lock-governing">let</span> <span class="org-tuareg-font-lock-governing">open </span><span class="org-tuareg-font-lock-module">State</span> <span class="org-tuareg-font-lock-governing">in</span> 
  get          <span class="org-tuareg-font-lock-operator">&gt;&gt;=</span>  <span class="org-keyword">fun</span> <span class="org-variable-name">cs</span> <span class="org-tuareg-font-lock-operator">-&gt;</span>
  put <span class="org-tuareg-font-lock-operator">(</span>cs <span class="org-tuareg-font-lock-operator">+</span> 1<span class="org-tuareg-font-lock-operator">)</span> <span class="org-tuareg-font-lock-operator">&gt;&gt;=</span>  <span class="org-keyword">fun</span> <span class="org-variable-name">_</span>  <span class="org-tuareg-font-lock-operator">-&gt;</span>
  unit <span class="org-tuareg-font-lock-operator">(</span>2 <span class="org-tuareg-font-lock-operator">*</span> cs<span class="org-tuareg-font-lock-operator">)</span>
<span class="org-tuareg-font-lock-operator">;;</span>       

<span class="org-tuareg-font-lock-governing">val</span> <span class="org-function-name">stFn3</span> <span class="org-tuareg-font-lock-operator">:</span> <span class="org-tuareg-font-lock-operator">(</span>int<span class="org-tuareg-font-lock-operator">,</span> int<span class="org-tuareg-font-lock-operator">)</span> <span class="org-tuareg-font-lock-module">State.</span>state <span class="org-tuareg-font-lock-operator">=</span> <span class="org-tuareg-font-lock-module">State.</span><span class="org-tuareg-font-lock-constructor">ST</span> <span class="org-tuareg-font-lock-operator">&lt;</span><span class="org-keyword">fun</span><span class="org-tuareg-font-lock-operator">&gt;</span>

  
<span class="org-tuareg-font-lock-governing">let</span> <span class="org-variable-name">stFn4</span> <span class="org-tuareg-font-lock-operator">=</span>
  <span class="org-tuareg-font-lock-governing">let</span> <span class="org-tuareg-font-lock-governing">open </span><span class="org-tuareg-font-lock-module">State</span> <span class="org-tuareg-font-lock-governing">in</span> 
  get          <span class="org-tuareg-font-lock-operator">&gt;&gt;=</span>  <span class="org-keyword">fun</span> <span class="org-variable-name">cs</span> <span class="org-tuareg-font-lock-operator">-&gt;</span>
  put <span class="org-tuareg-font-lock-operator">(</span>cs <span class="org-tuareg-font-lock-operator">+</span> 1<span class="org-tuareg-font-lock-operator">)</span> <span class="org-tuareg-font-lock-operator">&gt;&gt;</span>
  unit <span class="org-tuareg-font-lock-operator">(</span>2 <span class="org-tuareg-font-lock-operator">*</span> cs<span class="org-tuareg-font-lock-operator">)</span>
<span class="org-tuareg-font-lock-operator">;;</span>       

<span class="org-tuareg-font-lock-governing">val</span> <span class="org-function-name">stFn4</span> <span class="org-tuareg-font-lock-operator">:</span> <span class="org-tuareg-font-lock-operator">(</span>int<span class="org-tuareg-font-lock-operator">,</span> int<span class="org-tuareg-font-lock-operator">)</span> <span class="org-tuareg-font-lock-module">State.</span>state <span class="org-tuareg-font-lock-operator">=</span> <span class="org-tuareg-font-lock-module">State.</span><span class="org-tuareg-font-lock-constructor">ST</span> <span class="org-tuareg-font-lock-operator">&lt;</span><span class="org-keyword">fun</span><span class="org-tuareg-font-lock-operator">&gt;</span>  


<span class="org-tuareg-font-lock-operator">#</span> <span class="org-tuareg-font-lock-module">State.</span>run stFn3 1 <span class="org-tuareg-font-lock-operator">;;</span>
<span class="org-function-name">-</span> <span class="org-tuareg-font-lock-operator">:</span> int <span class="org-tuareg-font-lock-operator">*</span> int <span class="org-tuareg-font-lock-operator">=</span> <span class="org-tuareg-font-lock-operator">(</span>2<span class="org-tuareg-font-lock-operator">,</span> 2<span class="org-tuareg-font-lock-operator">)</span>
<span class="org-tuareg-font-lock-operator">#</span> <span class="org-tuareg-font-lock-module">State.</span>run stFn3 2 <span class="org-tuareg-font-lock-operator">;;</span>
<span class="org-function-name">-</span> <span class="org-tuareg-font-lock-operator">:</span> int <span class="org-tuareg-font-lock-operator">*</span> int <span class="org-tuareg-font-lock-operator">=</span> <span class="org-tuareg-font-lock-operator">(</span>4<span class="org-tuareg-font-lock-operator">,</span> 3<span class="org-tuareg-font-lock-operator">)</span>
<span class="org-tuareg-font-lock-operator">#</span> <span class="org-tuareg-font-lock-module">State.</span>run stFn3 3 <span class="org-tuareg-font-lock-operator">;;</span>
<span class="org-function-name">-</span> <span class="org-tuareg-font-lock-operator">:</span> int <span class="org-tuareg-font-lock-operator">*</span> int <span class="org-tuareg-font-lock-operator">=</span> <span class="org-tuareg-font-lock-operator">(</span>6<span class="org-tuareg-font-lock-operator">,</span> 4<span class="org-tuareg-font-lock-operator">)</span>
<span class="org-tuareg-font-lock-operator">#</span> <span class="org-tuareg-font-lock-module">State.</span>run stFn3 4 <span class="org-tuareg-font-lock-operator">;;</span>
<span class="org-function-name">-</span> <span class="org-tuareg-font-lock-operator">:</span> int <span class="org-tuareg-font-lock-operator">*</span> int <span class="org-tuareg-font-lock-operator">=</span> <span class="org-tuareg-font-lock-operator">(</span>8<span class="org-tuareg-font-lock-operator">,</span> 5<span class="org-tuareg-font-lock-operator">)</span>
<span class="org-tuareg-font-lock-operator">#</span> <span class="org-tuareg-font-lock-module">State.</span>run stFn3 5 <span class="org-tuareg-font-lock-operator">;;</span>
<span class="org-function-name">-</span> <span class="org-tuareg-font-lock-operator">:</span> int <span class="org-tuareg-font-lock-operator">*</span> int <span class="org-tuareg-font-lock-operator">=</span> <span class="org-tuareg-font-lock-operator">(</span>10<span class="org-tuareg-font-lock-operator">,</span> 6<span class="org-tuareg-font-lock-operator">)</span>
                  <span class="org-tuareg-font-lock-operator">#</span>

<span class="org-tuareg-font-lock-operator">#</span> <span class="org-tuareg-font-lock-module">State.</span>run stFn4 1 <span class="org-tuareg-font-lock-operator">;;</span>
<span class="org-function-name">-</span> <span class="org-tuareg-font-lock-operator">:</span> int <span class="org-tuareg-font-lock-operator">*</span> int <span class="org-tuareg-font-lock-operator">=</span> <span class="org-tuareg-font-lock-operator">(</span>2<span class="org-tuareg-font-lock-operator">,</span> 2<span class="org-tuareg-font-lock-operator">)</span>
<span class="org-tuareg-font-lock-operator">#</span> <span class="org-tuareg-font-lock-module">State.</span>run stFn4 2 <span class="org-tuareg-font-lock-operator">;;</span>
<span class="org-function-name">-</span> <span class="org-tuareg-font-lock-operator">:</span> int <span class="org-tuareg-font-lock-operator">*</span> int <span class="org-tuareg-font-lock-operator">=</span> <span class="org-tuareg-font-lock-operator">(</span>4<span class="org-tuareg-font-lock-operator">,</span> 3<span class="org-tuareg-font-lock-operator">)</span>
<span class="org-tuareg-font-lock-operator">#</span> <span class="org-tuareg-font-lock-module">State.</span>run stFn4 3 <span class="org-tuareg-font-lock-operator">;;</span>
<span class="org-function-name">-</span> <span class="org-tuareg-font-lock-operator">:</span> int <span class="org-tuareg-font-lock-operator">*</span> int <span class="org-tuareg-font-lock-operator">=</span> <span class="org-tuareg-font-lock-operator">(</span>6<span class="org-tuareg-font-lock-operator">,</span> 4<span class="org-tuareg-font-lock-operator">)</span>
<span class="org-tuareg-font-lock-operator">#</span> <span class="org-tuareg-font-lock-module">State.</span>run stFn4 4 <span class="org-tuareg-font-lock-operator">;;</span>
<span class="org-function-name">-</span> <span class="org-tuareg-font-lock-operator">:</span> int <span class="org-tuareg-font-lock-operator">*</span> int <span class="org-tuareg-font-lock-operator">=</span> <span class="org-tuareg-font-lock-operator">(</span>8<span class="org-tuareg-font-lock-operator">,</span> 5<span class="org-tuareg-font-lock-operator">)</span>
<span class="org-tuareg-font-lock-operator">#</span> <span class="org-tuareg-font-lock-module">State.</span>run stFn4 5 <span class="org-tuareg-font-lock-operator">;;</span>
<span class="org-function-name">-</span> <span class="org-tuareg-font-lock-operator">:</span> int <span class="org-tuareg-font-lock-operator">*</span> int <span class="org-tuareg-font-lock-operator">=</span> <span class="org-tuareg-font-lock-operator">(</span>10<span class="org-tuareg-font-lock-operator">,</span> 6<span class="org-tuareg-font-lock-operator">)</span>
<span class="org-tuareg-font-lock-operator">#</span>
</pre>
</div>


<p>
Simulating a Stack:
</p>

<div class="org-src-container">

<pre class="src src-ocaml"><span class="org-comment-delimiter">(* </span><span class="org-comment">type Stack = [Int]  </span><span class="org-comment-delimiter">*)</span>

<span class="org-tuareg-font-lock-governing">type</span> <span class="org-type">stack</span> <span class="org-tuareg-font-lock-operator">=</span> int list 

<span class="org-comment-delimiter">(* </span><span class="org-comment">With type signature </span><span class="org-comment-delimiter">*)</span>                 
<span class="org-tuareg-font-lock-governing">let</span> <span class="org-variable-name">pop</span><span class="org-tuareg-font-lock-operator">:</span> <span class="org-tuareg-font-lock-operator">(</span><span class="org-type">stack</span><span class="org-tuareg-font-lock-operator">,</span><span class="org-type"> int</span><span class="org-tuareg-font-lock-operator">)</span><span class="org-type"> </span><span class="org-tuareg-font-lock-module">State.</span><span class="org-type">state </span><span class="org-tuareg-font-lock-operator">=</span>
  <span class="org-tuareg-font-lock-governing">let</span> <span class="org-tuareg-font-lock-governing">open </span><span class="org-tuareg-font-lock-module">State</span> <span class="org-tuareg-font-lock-governing">in</span>
  <span class="org-tuareg-font-lock-constructor">ST</span> <span class="org-tuareg-font-lock-operator">(</span> <span class="org-keyword">fun</span> <span class="org-tuareg-font-lock-operator">(</span><span class="org-variable-name">x</span><span class="org-tuareg-font-lock-operator">::</span><span class="org-type">xs</span><span class="org-tuareg-font-lock-operator">)</span> <span class="org-tuareg-font-lock-operator">-&gt;</span> <span class="org-tuareg-font-lock-operator">(</span>x<span class="org-tuareg-font-lock-operator">,</span> xs<span class="org-tuareg-font-lock-operator">)</span> <span class="org-tuareg-font-lock-operator">)</span>
  
<span class="org-tuareg-font-lock-operator">;;</span>  
<span class="org-tuareg-font-lock-governing">val</span> <span class="org-function-name">pop</span> <span class="org-tuareg-font-lock-operator">:</span> <span class="org-tuareg-font-lock-operator">(</span>stack<span class="org-tuareg-font-lock-operator">,</span> int<span class="org-tuareg-font-lock-operator">)</span> <span class="org-tuareg-font-lock-module">State.</span>state <span class="org-tuareg-font-lock-operator">=</span> <span class="org-tuareg-font-lock-module">State.</span><span class="org-tuareg-font-lock-constructor">ST</span> <span class="org-tuareg-font-lock-operator">&lt;</span><span class="org-keyword">fun</span><span class="org-tuareg-font-lock-operator">&gt;</span>
  
<span class="org-comment-delimiter">(* </span><span class="org-comment">Without type signature </span><span class="org-comment-delimiter">*)</span>
  
<span class="org-tuareg-font-lock-governing">let</span> <span class="org-variable-name">pop</span> <span class="org-tuareg-font-lock-operator">=</span>
  <span class="org-tuareg-font-lock-governing">let</span> <span class="org-tuareg-font-lock-governing">open </span><span class="org-tuareg-font-lock-module">State</span> <span class="org-tuareg-font-lock-governing">in</span>
  <span class="org-tuareg-font-lock-constructor">ST</span> <span class="org-tuareg-font-lock-operator">(</span><span class="org-keyword">fun</span> <span class="org-tuareg-font-lock-operator">(</span><span class="org-variable-name">x</span><span class="org-tuareg-font-lock-operator">::</span><span class="org-type">xs</span><span class="org-tuareg-font-lock-operator">)</span> <span class="org-tuareg-font-lock-operator">-&gt;</span> <span class="org-tuareg-font-lock-operator">(</span>x<span class="org-tuareg-font-lock-operator">,</span> xs<span class="org-tuareg-font-lock-operator">))</span>
<span class="org-tuareg-font-lock-operator">;;</span>
  
     
<span class="org-tuareg-font-lock-governing">let</span> <span class="org-variable-name">push</span><span class="org-tuareg-font-lock-operator">:</span> <span class="org-type">int </span><span class="org-tuareg-font-lock-operator">-&gt;</span><span class="org-type"> </span><span class="org-tuareg-font-lock-operator">(</span><span class="org-type">stack</span><span class="org-tuareg-font-lock-operator">,</span><span class="org-type"> unit</span><span class="org-tuareg-font-lock-operator">)</span><span class="org-type"> </span><span class="org-tuareg-font-lock-module">State.</span><span class="org-type">state </span><span class="org-tuareg-font-lock-operator">=</span>
  <span class="org-tuareg-font-lock-governing">let</span> <span class="org-tuareg-font-lock-governing">open </span><span class="org-tuareg-font-lock-module">State</span> <span class="org-tuareg-font-lock-governing">in</span> 
  <span class="org-keyword">fun</span> <span class="org-variable-name">a</span> <span class="org-tuareg-font-lock-operator">-&gt;</span> <span class="org-tuareg-font-lock-constructor">ST</span> <span class="org-tuareg-font-lock-operator">(</span> <span class="org-keyword">fun</span>  <span class="org-variable-name">xs</span> <span class="org-tuareg-font-lock-operator">-&gt;</span> <span class="org-tuareg-font-lock-operator">((),</span> a<span class="org-tuareg-font-lock-operator">::</span><span class="org-type">xs</span><span class="org-tuareg-font-lock-operator">)</span> <span class="org-tuareg-font-lock-operator">)</span>
<span class="org-tuareg-font-lock-operator">;;</span>

<span class="org-tuareg-font-lock-governing">val</span> <span class="org-function-name">push</span> <span class="org-tuareg-font-lock-operator">:</span> int <span class="org-tuareg-font-lock-operator">-&gt;</span> <span class="org-tuareg-font-lock-operator">(</span>stack<span class="org-tuareg-font-lock-operator">,</span> unit<span class="org-tuareg-font-lock-operator">)</span> <span class="org-tuareg-font-lock-module">State.</span>state <span class="org-tuareg-font-lock-operator">=</span> <span class="org-tuareg-font-lock-operator">&lt;</span><span class="org-keyword">fun</span><span class="org-tuareg-font-lock-operator">&gt;</span> 
  
<span class="org-comment-delimiter">(*</span>
<span class="org-comment">:{</span>
<span class="org-comment">let stackManip = do  </span>
<span class="org-comment">      push 3  </span>
<span class="org-comment">      a &lt;- pop  </span>
<span class="org-comment">      pop </span>
<span class="org-comment">:}</span>
<span class="org-comment"> </span><span class="org-comment-delimiter">*)</span>

<span class="org-tuareg-font-lock-governing">let</span> <span class="org-variable-name">stackManip</span> <span class="org-tuareg-font-lock-operator">=</span>
  <span class="org-tuareg-font-lock-governing">let</span> <span class="org-tuareg-font-lock-governing">open </span><span class="org-tuareg-font-lock-module">State</span> <span class="org-tuareg-font-lock-governing">in</span>
  push 3   <span class="org-tuareg-font-lock-operator">&gt;&gt;</span>
  pop      <span class="org-tuareg-font-lock-operator">&gt;&gt;=</span> <span class="org-keyword">fun</span> <span class="org-variable-name">a</span> <span class="org-tuareg-font-lock-operator">-&gt;</span>
  pop   
<span class="org-tuareg-font-lock-operator">;;</span>

<span class="org-tuareg-font-lock-governing">val</span> <span class="org-function-name">stackManip</span> <span class="org-tuareg-font-lock-operator">:</span> <span class="org-tuareg-font-lock-operator">(</span>stack<span class="org-tuareg-font-lock-operator">,</span> int<span class="org-tuareg-font-lock-operator">)</span> <span class="org-tuareg-font-lock-module">State.</span>state <span class="org-tuareg-font-lock-operator">=</span> <span class="org-tuareg-font-lock-module">State.</span><span class="org-tuareg-font-lock-constructor">ST</span> <span class="org-tuareg-font-lock-operator">&lt;</span><span class="org-keyword">fun</span><span class="org-tuareg-font-lock-operator">&gt;</span>  
  


<span class="org-tuareg-font-lock-operator">#</span>  <span class="org-tuareg-font-lock-module">State.</span>run pop <span class="org-tuareg-font-lock-operator">[</span>1<span class="org-tuareg-font-lock-operator">;</span> 2<span class="org-tuareg-font-lock-operator">;</span> 3<span class="org-tuareg-font-lock-operator">;</span> 4<span class="org-tuareg-font-lock-operator">]</span> <span class="org-tuareg-font-lock-operator">;;</span>
 <span class="org-tuareg-font-lock-operator">-</span> <span class="org-tuareg-font-lock-operator">:</span> int <span class="org-tuareg-font-lock-operator">*</span> int list <span class="org-tuareg-font-lock-operator">=</span> <span class="org-tuareg-font-lock-operator">(</span>1<span class="org-tuareg-font-lock-operator">,</span> <span class="org-tuareg-font-lock-operator">[</span>2<span class="org-tuareg-font-lock-operator">;</span> 3<span class="org-tuareg-font-lock-operator">;</span> 4<span class="org-tuareg-font-lock-operator">])</span>

<span class="org-tuareg-font-lock-operator">#</span> <span class="org-tuareg-font-lock-module">State.</span>run pop <span class="org-tuareg-font-lock-operator">[</span>2<span class="org-tuareg-font-lock-operator">;</span> 3<span class="org-tuareg-font-lock-operator">;</span> 4<span class="org-tuareg-font-lock-operator">]</span> <span class="org-tuareg-font-lock-operator">;;</span>
<span class="org-function-name">-</span> <span class="org-tuareg-font-lock-operator">:</span> int <span class="org-tuareg-font-lock-operator">*</span> int list <span class="org-tuareg-font-lock-operator">=</span> <span class="org-tuareg-font-lock-operator">(</span>2<span class="org-tuareg-font-lock-operator">,</span> <span class="org-tuareg-font-lock-operator">[</span>3<span class="org-tuareg-font-lock-operator">;</span> 4<span class="org-tuareg-font-lock-operator">])</span>

<span class="org-comment-delimiter">(*</span>

<span class="org-comment">:{</span>

<span class="org-comment">let stackStuff :: State Stack ()  </span>
<span class="org-comment">    stackStuff = do  </span>
<span class="org-comment">      a &lt;- pop  </span>
<span class="org-comment">      if a == 5  </span>
<span class="org-comment">        then push 5  </span>
<span class="org-comment">        else do  </span>
<span class="org-comment">          push 3  </span>
<span class="org-comment">          push 8    </span>
<span class="org-comment">:}  </span>

<span class="org-comment-delimiter">*)</span>

<span class="org-tuareg-font-lock-governing">let</span> <span class="org-variable-name">stackStuff</span> <span class="org-tuareg-font-lock-operator">=</span>
  <span class="org-tuareg-font-lock-governing">let</span> <span class="org-tuareg-font-lock-governing">open </span><span class="org-tuareg-font-lock-module">State</span> <span class="org-tuareg-font-lock-governing">in</span> 
  pop         <span class="org-tuareg-font-lock-operator">&gt;&gt;=</span> <span class="org-keyword">fun</span> <span class="org-variable-name">a</span> <span class="org-tuareg-font-lock-operator">-&gt;</span>
  <span class="org-keyword">if</span> a <span class="org-tuareg-font-lock-operator">=</span> 5
  <span class="org-keyword">then</span> push 5
  <span class="org-keyword">else</span> <span class="org-tuareg-font-lock-operator">(</span>
      push 3  <span class="org-tuareg-font-lock-operator">&gt;&gt;</span>
      push 8
  <span class="org-tuareg-font-lock-operator">)</span>
<span class="org-tuareg-font-lock-operator">;;</span>

<span class="org-tuareg-font-lock-governing">val</span> <span class="org-function-name">stackStuff</span> <span class="org-tuareg-font-lock-operator">:</span> <span class="org-tuareg-font-lock-operator">(</span>stack<span class="org-tuareg-font-lock-operator">,</span> unit<span class="org-tuareg-font-lock-operator">)</span> <span class="org-tuareg-font-lock-module">State.</span>state <span class="org-tuareg-font-lock-operator">=</span> <span class="org-tuareg-font-lock-module">State.</span><span class="org-tuareg-font-lock-constructor">ST</span> <span class="org-tuareg-font-lock-operator">&lt;</span><span class="org-keyword">fun</span><span class="org-tuareg-font-lock-operator">&gt;</span>
  
<span class="org-tuareg-font-lock-operator">#</span> <span class="org-tuareg-font-lock-module">State.</span>run stackStuff <span class="org-tuareg-font-lock-operator">[</span>9<span class="org-tuareg-font-lock-operator">;</span> 0<span class="org-tuareg-font-lock-operator">;</span> 2<span class="org-tuareg-font-lock-operator">;</span> 1<span class="org-tuareg-font-lock-operator">;</span> 0<span class="org-tuareg-font-lock-operator">]</span> <span class="org-tuareg-font-lock-operator">;;</span>
<span class="org-function-name">-</span> <span class="org-tuareg-font-lock-operator">:</span> unit <span class="org-tuareg-font-lock-operator">*</span> stack <span class="org-tuareg-font-lock-operator">=</span> <span class="org-tuareg-font-lock-operator">((),</span> <span class="org-tuareg-font-lock-operator">[</span>8<span class="org-tuareg-font-lock-operator">;</span> 3<span class="org-tuareg-font-lock-operator">;</span> 0<span class="org-tuareg-font-lock-operator">;</span> 2<span class="org-tuareg-font-lock-operator">;</span> 1<span class="org-tuareg-font-lock-operator">;</span> 0<span class="org-tuareg-font-lock-operator">])</span>
<span class="org-tuareg-font-lock-operator">#</span>
</pre>
</div>
</div>
</div>
</div>



<div id="outline-container-sec-1-14-8" class="outline-4">
<h4 id="sec-1-14-8"><span class="section-number-4">1.14.8</span> Writer Monad</h4>
<div class="outline-text-4" id="text-1-14-8">
<p>
The writer monad makes possible to compose functions which returns
values and a log string. 
</p>

<p>
The writer monad in no longer implemented in a simple way like in
Haskell 98. It is now implemented as special case of the WriterT monad
transformer. 
</p>

<p>
New implementation of type constructor Writer: 
</p>

<div class="org-src-container">

<pre class="src src-haskell"><span class="org-haskell-operator">&gt;&gt;&gt;</span> <span class="org-haskell-keyword">import</span> <span class="org-haskell-constructor">Control.Monad.Writer</span>
<span class="org-haskell-operator">&gt;&gt;&gt;</span>

<span class="org-haskell-operator">&gt;&gt;&gt;</span> <span class="org-haskell-constructor">:</span>info <span class="org-haskell-constructor">Writer</span>
<span class="org-haskell-keyword">type</span> <span class="org-haskell-constructor">Writer</span> w <span class="org-haskell-operator">=</span> <span class="org-haskell-constructor">WriterT</span> w <span class="org-haskell-constructor">Identity</span>
        <span class="org-comment-delimiter">-- </span><span class="org-comment">Defined in &#8216;Control.Monad.Trans.Writer.Lazy&#8217;</span>
<span class="org-haskell-operator">&gt;&gt;&gt;</span>
</pre>
</div>

<p>
Old implementation of type constructor Writer: (Book: Learn You a Haskell)
</p>

<div class="org-src-container">

<pre class="src src-haskell"><span class="org-haskell-keyword">newtype</span> <span class="org-haskell-constructor">Writer</span> w a <span class="org-haskell-operator">=</span> <span class="org-haskell-constructor">Writer</span> { runWriter <span class="org-haskell-operator">::</span> (a<span class="org-haskell-operator">,</span> w) }  

<span class="org-haskell-keyword">instance</span> (<span class="org-haskell-constructor">Monoid</span> w) <span class="org-haskell-operator">=&gt;</span> <span class="org-haskell-constructor">Monad</span> (<span class="org-haskell-constructor">Writer</span> w) <span class="org-haskell-keyword">where</span>  
    return x <span class="org-haskell-operator">=</span> <span class="org-haskell-constructor">Writer</span> (x<span class="org-haskell-operator">,</span> mempty)  
    (<span class="org-haskell-constructor">Writer</span> (x<span class="org-haskell-operator">,</span>v)) <span class="org-haskell-operator">&gt;&gt;=</span> f <span class="org-haskell-operator">=</span> <span class="org-haskell-keyword">let</span> (<span class="org-haskell-constructor">Writer</span> (y<span class="org-haskell-operator">,</span> v')) <span class="org-haskell-operator">=</span> f x <span class="org-haskell-keyword">in</span> <span class="org-haskell-constructor">Writer</span> (y<span class="org-haskell-operator">,</span> v <span class="org-haskell-operator">`mappend`</span> v')
</pre>
</div>


<p>
Documentation: <a href="https://hackage.haskell.org/package/mtl-2.2.1/docs/Control-Monad-Writer-Lazy.html">Control.Monad.Writer</a>
</p>


<p>
Example: 
</p>

<div class="org-src-container">

<pre class="src src-haskell"><span class="org-comment-delimiter">-- </span><span class="org-comment">Haskell v7.10.2</span>
<span class="org-comment-delimiter">--</span>
<span class="org-haskell-operator">&gt;&gt;&gt;</span> <span class="org-haskell-keyword">import</span> <span class="org-haskell-constructor">Control.Monad.Writer</span>
<span class="org-haskell-operator">&gt;&gt;&gt;</span>

<span class="org-haskell-operator">&gt;&gt;&gt;</span> <span class="org-haskell-constructor">:</span>t writer
<span class="org-function-name">writer</span> <span class="org-haskell-operator">::</span> <span class="org-haskell-constructor">MonadWriter</span> w m <span class="org-haskell-operator">=&gt;</span> (a<span class="org-haskell-operator">,</span> w) <span class="org-haskell-operator">-&gt;</span> m a
<span class="org-haskell-operator">&gt;&gt;&gt;</span> 
<span class="org-haskell-operator">&gt;&gt;&gt;</span> <span class="org-haskell-constructor">:</span>t runWriter
<span class="org-function-name">runWriter</span> <span class="org-haskell-operator">::</span> <span class="org-haskell-constructor">Writer</span> w a <span class="org-haskell-operator">-&gt;</span> (a<span class="org-haskell-operator">,</span> w)
<span class="org-haskell-operator">&gt;&gt;&gt;</span> 
<span class="org-haskell-operator">&gt;&gt;&gt;</span> <span class="org-haskell-constructor">:</span>t execWriter
<span class="org-function-name">execWriter</span> <span class="org-haskell-operator">::</span> <span class="org-haskell-constructor">Writer</span> w a <span class="org-haskell-operator">-&gt;</span> w
<span class="org-haskell-operator">&gt;&gt;&gt;</span> 
<span class="org-haskell-operator">&gt;&gt;&gt;</span> <span class="org-haskell-constructor">:</span>t tell
<span class="org-function-name">tell</span> <span class="org-haskell-operator">::</span> <span class="org-haskell-constructor">MonadWriter</span> w m <span class="org-haskell-operator">=&gt;</span> w <span class="org-haskell-operator">-&gt;</span> m <span class="org-haskell-constructor">()</span>
<span class="org-haskell-operator">&gt;&gt;&gt;</span> 


<span class="org-haskell-operator">&gt;&gt;&gt;</span> writer (10<span class="org-haskell-operator">,</span> <span class="org-string">"The value is "</span> <span class="org-haskell-operator">++</span> show 10) <span class="org-haskell-operator">::</span> <span class="org-haskell-constructor">Writer</span> <span class="org-haskell-constructor">String</span> <span class="org-haskell-constructor">Int</span>
<span class="org-haskell-constructor">WriterT</span> (<span class="org-haskell-constructor">Identity</span> (10<span class="org-haskell-operator">,</span><span class="org-string">"The value is 10"</span>))
<span class="org-haskell-operator">&gt;&gt;&gt;</span>

<span class="org-haskell-operator">&gt;&gt;&gt;</span> <span class="org-haskell-keyword">let</span> w <span class="org-haskell-operator">=</span> writer (10<span class="org-haskell-operator">,</span> <span class="org-string">"The value is "</span> <span class="org-haskell-operator">++</span> show 10) <span class="org-haskell-operator">::</span> <span class="org-haskell-constructor">Writer</span> <span class="org-haskell-constructor">String</span> <span class="org-haskell-constructor">Int</span>
<span class="org-haskell-operator">&gt;&gt;&gt;</span> w
<span class="org-haskell-constructor">WriterT</span> (<span class="org-haskell-constructor">Identity</span> (10<span class="org-haskell-operator">,</span><span class="org-string">"The value is 10"</span>))
<span class="org-haskell-operator">&gt;&gt;&gt;</span>

<span class="org-haskell-operator">&gt;&gt;&gt;</span> runWriter w
(10<span class="org-haskell-operator">,</span><span class="org-string">"The value is 10"</span>)
<span class="org-haskell-operator">&gt;&gt;&gt;</span>

<span class="org-haskell-operator">&gt;&gt;&gt;</span> execWriter w
<span class="org-string">"The value is 10"</span>
<span class="org-haskell-operator">&gt;&gt;&gt;</span> 

<span class="org-haskell-operator">&gt;&gt;&gt;</span> <span class="org-haskell-constructor">:</span>t tell
<span class="org-function-name">tell</span> <span class="org-haskell-operator">::</span> <span class="org-haskell-constructor">MonadWriter</span> w m <span class="org-haskell-operator">=&gt;</span> w <span class="org-haskell-operator">-&gt;</span> m <span class="org-haskell-constructor">()</span>
<span class="org-haskell-operator">&gt;&gt;&gt;</span>

<span class="org-haskell-operator">&gt;&gt;&gt;</span> <span class="org-haskell-constructor">:</span>t writer
<span class="org-function-name">writer</span> <span class="org-haskell-operator">::</span> <span class="org-haskell-constructor">MonadWriter</span> w m <span class="org-haskell-operator">=&gt;</span> (a<span class="org-haskell-operator">,</span> w) <span class="org-haskell-operator">-&gt;</span> m a


<span class="org-haskell-constructor">:</span>set <span class="org-haskell-operator">+</span>m 

<span class="org-haskell-constructor">:</span>{
<span class="org-haskell-keyword">let</span> fn1 <span class="org-haskell-operator">::</span> <span class="org-haskell-constructor">Int</span> <span class="org-haskell-operator">-&gt;</span> <span class="org-haskell-constructor">Writer</span> <span class="org-haskell-constructor">String</span> <span class="org-haskell-constructor">Int</span>  
    fn1 x <span class="org-haskell-operator">=</span> writer (2 <span class="org-haskell-operator">*</span> x<span class="org-haskell-operator">,</span> <span class="org-string">"The value of x is : "</span> <span class="org-haskell-operator">++</span> show x) 
<span class="org-haskell-constructor">:</span>}

<span class="org-haskell-operator">&gt;&gt;&gt;</span> <span class="org-haskell-constructor">:</span>t fn1
<span class="org-function-name">fn1</span> <span class="org-haskell-operator">::</span> <span class="org-haskell-constructor">Int</span> <span class="org-haskell-operator">-&gt;</span> <span class="org-haskell-constructor">Writer</span> <span class="org-haskell-constructor">String</span> <span class="org-haskell-constructor">Int</span>
<span class="org-haskell-operator">&gt;&gt;&gt;</span>

<span class="org-haskell-operator">&gt;&gt;&gt;</span> fn1 2
<span class="org-haskell-constructor">WriterT</span> (<span class="org-haskell-constructor">Identity</span> (4<span class="org-haskell-operator">,</span><span class="org-string">"The value of x is : 2"</span>))
<span class="org-haskell-operator">&gt;&gt;&gt;</span> 
<span class="org-haskell-operator">&gt;&gt;&gt;</span> fn1 3
<span class="org-haskell-constructor">WriterT</span> (<span class="org-haskell-constructor">Identity</span> (6<span class="org-haskell-operator">,</span><span class="org-string">"The value of x is : 3"</span>))
<span class="org-haskell-operator">&gt;&gt;&gt;</span> 

<span class="org-haskell-operator">&gt;&gt;&gt;</span> runWriter <span class="org-haskell-operator">$</span> fn1 2
(4<span class="org-haskell-operator">,</span><span class="org-string">"The value of x is : 2"</span>)
<span class="org-haskell-operator">&gt;&gt;&gt;</span> runWriter <span class="org-haskell-operator">$</span> fn1 3
(6<span class="org-haskell-operator">,</span><span class="org-string">"The value of x is : 3"</span>)
<span class="org-haskell-operator">&gt;&gt;&gt;</span> 

<span class="org-haskell-operator">&gt;&gt;&gt;</span> fst <span class="org-haskell-operator">.</span> runWriter <span class="org-haskell-operator">$</span> fn1 2
4
<span class="org-haskell-operator">&gt;&gt;&gt;</span> fst <span class="org-haskell-operator">.</span> runWriter <span class="org-haskell-operator">$</span> fn1 3
6
<span class="org-haskell-operator">&gt;&gt;&gt;</span> 

<span class="org-haskell-operator">&gt;&gt;&gt;</span> snd <span class="org-haskell-operator">.</span> runWriter <span class="org-haskell-operator">$</span> fn1 2
<span class="org-string">"The value of x is : 2"</span>
<span class="org-haskell-operator">&gt;&gt;&gt;</span> snd <span class="org-haskell-operator">.</span> runWriter <span class="org-haskell-operator">$</span> fn1 3
<span class="org-string">"The value of x is : 3"</span>
<span class="org-haskell-operator">&gt;&gt;&gt;</span> 

<span class="org-haskell-operator">&gt;&gt;&gt;</span> execWriter <span class="org-haskell-operator">$</span> fn1 3
<span class="org-string">"The value of x is : 3"</span>
<span class="org-haskell-operator">&gt;&gt;&gt;</span> execWriter <span class="org-haskell-operator">$</span> fn1 2
<span class="org-string">"The value of x is : 2"</span>
<span class="org-haskell-operator">&gt;&gt;&gt;</span> 

<span class="org-haskell-operator">&gt;&gt;&gt;</span> return 1 <span class="org-haskell-operator">::</span> <span class="org-haskell-constructor">Writer</span> <span class="org-haskell-constructor">String</span> <span class="org-haskell-constructor">Integer</span>
<span class="org-haskell-constructor">WriterT</span> (<span class="org-haskell-constructor">Identity</span> (1<span class="org-haskell-operator">,</span><span class="org-string">""</span>))
<span class="org-haskell-operator">&gt;&gt;&gt;</span> 
<span class="org-haskell-operator">&gt;&gt;&gt;</span> return 100 <span class="org-haskell-operator">::</span> <span class="org-haskell-constructor">Writer</span> <span class="org-haskell-constructor">String</span> <span class="org-haskell-constructor">Integer</span>
<span class="org-haskell-constructor">WriterT</span> (<span class="org-haskell-constructor">Identity</span> (100<span class="org-haskell-operator">,</span><span class="org-string">""</span>))
<span class="org-haskell-operator">&gt;&gt;&gt;</span> 

<span class="org-haskell-operator">&gt;&gt;&gt;</span> return (<span class="org-haskell-constructor">Just</span> 100) <span class="org-haskell-operator">::</span> <span class="org-haskell-constructor">Writer</span> <span class="org-haskell-constructor">String</span> (<span class="org-haskell-constructor">Maybe</span> <span class="org-haskell-constructor">Integer</span>)
<span class="org-haskell-constructor">WriterT</span> (<span class="org-haskell-constructor">Identity</span> (<span class="org-haskell-constructor">Just</span> 100<span class="org-haskell-operator">,</span><span class="org-string">""</span>))
<span class="org-haskell-operator">&gt;&gt;&gt;</span> 

<span class="org-haskell-operator">&gt;&gt;&gt;</span> runWriter (return 100 <span class="org-haskell-operator">::</span> <span class="org-haskell-constructor">Writer</span> <span class="org-haskell-constructor">String</span> <span class="org-haskell-constructor">Integer</span>)
(100<span class="org-haskell-operator">,</span><span class="org-string">""</span>)
<span class="org-haskell-operator">&gt;&gt;&gt;</span>

<span class="org-comment-delimiter">--  </span>
<span class="org-comment-delimiter">-- </span><span class="org-comment">This version must be loaded from a file. </span>
<span class="org-comment-delimiter">--</span>
<span class="org-function-name">fn2</span> <span class="org-haskell-operator">::</span> <span class="org-haskell-constructor">Int</span> <span class="org-haskell-operator">-&gt;</span> <span class="org-haskell-constructor">Writer</span> <span class="org-haskell-constructor">String</span> <span class="org-haskell-constructor">Int</span>  
<span class="org-haskell-definition">fn2</span> x <span class="org-haskell-operator">=</span> <span class="org-haskell-keyword">do</span> <span class="org-comment-delimiter">--</span><span class="org-comment">writer (2 * x, "The value of x is : " ++ show x)</span>
  tell ( <span class="org-string">"The value of x is : "</span> <span class="org-haskell-operator">++</span> show x )
  return ( 2 <span class="org-haskell-operator">*</span> x )

<span class="org-comment-delimiter">--</span><span class="org-comment">-</span>
<span class="org-comment-delimiter">--</span><span class="org-comment">- This version can be pasted in the repl</span>
<span class="org-comment-delimiter">--</span><span class="org-comment">-</span>
<span class="org-haskell-constructor">:</span>{ 
<span class="org-haskell-keyword">let</span> fn2 <span class="org-haskell-operator">::</span> <span class="org-haskell-constructor">Int</span> <span class="org-haskell-operator">-&gt;</span> <span class="org-haskell-constructor">Writer</span> <span class="org-haskell-constructor">String</span> <span class="org-haskell-constructor">Int</span>  
    fn2 x <span class="org-haskell-operator">=</span> <span class="org-haskell-keyword">do</span> <span class="org-comment-delimiter">--</span><span class="org-comment">writer (2 * x, "The value of x is : " ++ show x)</span>
      tell ( <span class="org-string">"The value of x is : "</span> <span class="org-haskell-operator">++</span> show x )
      return ( 2 <span class="org-haskell-operator">*</span> x )
<span class="org-haskell-constructor">:</span>}
      

<span class="org-haskell-operator">&gt;&gt;&gt;</span> <span class="org-haskell-constructor">:</span>t fn2
<span class="org-function-name">fn2</span> <span class="org-haskell-operator">::</span> <span class="org-haskell-constructor">Int</span> <span class="org-haskell-operator">-&gt;</span> <span class="org-haskell-constructor">Writer</span> <span class="org-haskell-constructor">String</span> <span class="org-haskell-constructor">Int</span>
<span class="org-haskell-operator">&gt;&gt;&gt;</span>

<span class="org-haskell-operator">&gt;&gt;&gt;</span> fn2 2
<span class="org-haskell-constructor">WriterT</span> (<span class="org-haskell-constructor">Identity</span> (4<span class="org-haskell-operator">,</span><span class="org-string">"The value of x is : 2"</span>))
<span class="org-haskell-operator">&gt;&gt;&gt;</span> fn2 3
<span class="org-haskell-constructor">WriterT</span> (<span class="org-haskell-constructor">Identity</span> (6<span class="org-haskell-operator">,</span><span class="org-string">"The value of x is : 3"</span>))
<span class="org-haskell-operator">&gt;&gt;&gt;</span> 

<span class="org-comment-delimiter">{- </span><span class="org-comment">Example from Learn You a Haskell </span>
<span class="org-comment">  </span>
<span class="org-comment">   - http://learnyouahaskell.com/for-a-few-monads-more</span>

<span class="org-comment">logNumber :: Int -&gt; Writer [String] Int  </span>
<span class="org-comment">logNumber x = Writer (x, ["Got number: " ++ show x])  </span>
<span class="org-comment">-}</span>
<span class="org-haskell-constructor">:</span>{

<span class="org-haskell-keyword">let</span> logNumber <span class="org-haskell-operator">::</span> <span class="org-haskell-constructor">Int</span> <span class="org-haskell-operator">-&gt;</span> <span class="org-haskell-constructor">Writer</span> [<span class="org-haskell-constructor">String</span>] <span class="org-haskell-constructor">Int</span>  
    logNumber x <span class="org-haskell-operator">=</span> writer (x<span class="org-haskell-operator">,</span> [<span class="org-string">"Got number: "</span> <span class="org-haskell-operator">++</span> show x]) 
<span class="org-haskell-constructor">:</span>}

<span class="org-haskell-operator">&gt;&gt;&gt;</span> <span class="org-haskell-constructor">:</span>t logNumber 
<span class="org-function-name">logNumber</span> <span class="org-haskell-operator">::</span> <span class="org-haskell-constructor">Int</span> <span class="org-haskell-operator">-&gt;</span> <span class="org-haskell-constructor">Writer</span> [<span class="org-haskell-constructor">String</span>] <span class="org-haskell-constructor">Int</span>
<span class="org-haskell-operator">&gt;&gt;&gt;</span> 

<span class="org-haskell-operator">&gt;&gt;&gt;</span> logNumber 1
<span class="org-haskell-constructor">WriterT</span> (<span class="org-haskell-constructor">Identity</span> (1<span class="org-haskell-operator">,</span>[<span class="org-string">"Got number: 1"</span>]))
<span class="org-haskell-operator">&gt;&gt;&gt;</span> 
<span class="org-haskell-operator">&gt;&gt;&gt;</span> logNumber 2
<span class="org-haskell-constructor">WriterT</span> (<span class="org-haskell-constructor">Identity</span> (2<span class="org-haskell-operator">,</span>[<span class="org-string">"Got number: 2"</span>]))
<span class="org-haskell-operator">&gt;&gt;&gt;</span> 

<span class="org-haskell-operator">&gt;&gt;&gt;</span> runWriter <span class="org-haskell-operator">$</span> logNumber 1
(1<span class="org-haskell-operator">,</span>[<span class="org-string">"Got number: 1"</span>])
<span class="org-haskell-operator">&gt;&gt;&gt;</span> 

<span class="org-haskell-operator">-</span>
<span class="org-function-name">multWithLog</span> <span class="org-haskell-operator">::</span> <span class="org-haskell-constructor">Writer</span> [<span class="org-haskell-constructor">String</span>] <span class="org-haskell-constructor">Int</span>  
<span class="org-haskell-definition">multWithLog</span> <span class="org-haskell-operator">=</span> <span class="org-haskell-keyword">do</span>  
    a <span class="org-haskell-operator">&lt;-</span> logNumber 3  
    b <span class="org-haskell-operator">&lt;-</span> logNumber 5  
    return (a<span class="org-haskell-operator">*</span>b)

<span class="org-haskell-constructor">:</span>{
<span class="org-haskell-keyword">let</span> multWithLog <span class="org-haskell-operator">::</span> <span class="org-haskell-constructor">Writer</span> [<span class="org-haskell-constructor">String</span>] <span class="org-haskell-constructor">Int</span>  
    multWithLog <span class="org-haskell-operator">=</span> <span class="org-haskell-keyword">do</span>  
      a <span class="org-haskell-operator">&lt;-</span> logNumber 3  
      b <span class="org-haskell-operator">&lt;-</span> logNumber 5  
      return (a<span class="org-haskell-operator">*</span>b)
<span class="org-haskell-constructor">:</span>}

<span class="org-haskell-operator">&gt;&gt;&gt;</span> <span class="org-haskell-constructor">:</span>t multWithLog 
<span class="org-function-name">multWithLog</span> <span class="org-haskell-operator">::</span> <span class="org-haskell-constructor">Writer</span> [<span class="org-haskell-constructor">String</span>] <span class="org-haskell-constructor">Int</span>
<span class="org-haskell-operator">&gt;&gt;&gt;</span>

<span class="org-haskell-operator">&gt;&gt;&gt;</span> multWithLog 
<span class="org-haskell-constructor">WriterT</span> (<span class="org-haskell-constructor">Identity</span> (15<span class="org-haskell-operator">,</span>[<span class="org-string">"Got number: 3"</span><span class="org-haskell-operator">,</span><span class="org-string">"Got number: 5"</span>]))
<span class="org-haskell-operator">&gt;&gt;&gt;</span> 

<span class="org-haskell-operator">&gt;&gt;&gt;</span> runWriter multWithLog 
(15<span class="org-haskell-operator">,</span>[<span class="org-string">"Got number: 3"</span><span class="org-haskell-operator">,</span><span class="org-string">"Got number: 5"</span>])
<span class="org-haskell-operator">&gt;&gt;&gt;</span> 

<span class="org-haskell-operator">&gt;&gt;&gt;</span> execWriter multWithLog 
[<span class="org-string">"Got number: 3"</span><span class="org-haskell-operator">,</span><span class="org-string">"Got number: 5"</span>]
<span class="org-haskell-operator">&gt;&gt;&gt;</span> 


<span class="org-function-name">multWithLog</span> <span class="org-haskell-operator">::</span> <span class="org-haskell-constructor">Writer</span> [<span class="org-haskell-constructor">String</span>] <span class="org-haskell-constructor">Int</span>  
<span class="org-haskell-definition">multWithLog</span> <span class="org-haskell-operator">=</span> <span class="org-haskell-keyword">do</span>  
    a <span class="org-haskell-operator">&lt;-</span> logNumber 3  
    b <span class="org-haskell-operator">&lt;-</span> logNumber 5  
    tell [<span class="org-string">"Gonna multiply these two"</span>]  
    return (a<span class="org-haskell-operator">*</span>b) 

<span class="org-haskell-constructor">:</span>{
<span class="org-haskell-keyword">let</span> multWithLog <span class="org-haskell-operator">::</span> <span class="org-haskell-constructor">Writer</span> [<span class="org-haskell-constructor">String</span>] <span class="org-haskell-constructor">Int</span>  
    multWithLog <span class="org-haskell-operator">=</span> <span class="org-haskell-keyword">do</span>  
      a <span class="org-haskell-operator">&lt;-</span> logNumber 3  
      b <span class="org-haskell-operator">&lt;-</span> logNumber 5  
      tell [<span class="org-string">"Gonna multiply these two"</span>]  
      return (a<span class="org-haskell-operator">*</span>b) 
<span class="org-haskell-constructor">:</span>}

<span class="org-haskell-operator">&gt;&gt;&gt;</span> multWithLog 
<span class="org-haskell-constructor">WriterT</span> (<span class="org-haskell-constructor">Identity</span> (15<span class="org-haskell-operator">,</span>[<span class="org-string">"Got number: 3"</span><span class="org-haskell-operator">,</span><span class="org-string">"Got number: 5"</span><span class="org-haskell-operator">,</span><span class="org-string">"Gonna multiply these two"</span>]))
<span class="org-haskell-operator">&gt;&gt;&gt;</span> 

<span class="org-haskell-operator">&gt;&gt;&gt;</span> runWriter multWithLog 
(15<span class="org-haskell-operator">,</span>[<span class="org-string">"Got number: 3"</span><span class="org-haskell-operator">,</span><span class="org-string">"Got number: 5"</span><span class="org-haskell-operator">,</span><span class="org-string">"Gonna multiply these two"</span>])
<span class="org-haskell-operator">&gt;&gt;&gt;</span>


<span class="org-haskell-constructor">:</span>{
<span class="org-haskell-keyword">let</span> multWithLog2 <span class="org-haskell-operator">::</span> <span class="org-haskell-constructor">Writer</span> [<span class="org-haskell-constructor">String</span>] <span class="org-haskell-constructor">Int</span>  
    multWithLog2 <span class="org-haskell-operator">=</span>   
      logNumber 3                       <span class="org-haskell-operator">&gt;&gt;=</span> <span class="org-haskell-operator">\</span>a <span class="org-haskell-operator">-&gt;</span>
      logNumber 5                       <span class="org-haskell-operator">&gt;&gt;=</span> <span class="org-haskell-operator">\</span>b <span class="org-haskell-operator">-&gt;</span>
      tell [<span class="org-string">"Gonna multiply these two"</span>] <span class="org-haskell-operator">&gt;&gt;=</span> <span class="org-haskell-operator">\</span><span class="org-haskell-keyword">_</span> <span class="org-haskell-operator">-&gt;</span> 
      return (a<span class="org-haskell-operator">*</span>b) 
<span class="org-haskell-constructor">:</span>}

<span class="org-haskell-operator">&gt;&gt;&gt;</span> <span class="org-haskell-constructor">:</span>t multWithLog2
<span class="org-function-name">multWithLog2</span> <span class="org-haskell-operator">::</span> <span class="org-haskell-constructor">Writer</span> [<span class="org-haskell-constructor">String</span>] <span class="org-haskell-constructor">Int</span>
<span class="org-haskell-operator">&gt;&gt;&gt;</span> 
<span class="org-haskell-operator">&gt;&gt;&gt;</span> runWriter multWithLog2
(15<span class="org-haskell-operator">,</span>[<span class="org-string">"Got number: 3"</span><span class="org-haskell-operator">,</span><span class="org-string">"Got number: 5"</span><span class="org-haskell-operator">,</span><span class="org-string">"Gonna multiply these two"</span>])
<span class="org-haskell-operator">&gt;&gt;&gt;</span> 



<span class="org-haskell-definition">gcd</span>' <span class="org-haskell-operator">::</span> <span class="org-haskell-constructor">Int</span> <span class="org-haskell-operator">-&gt;</span> <span class="org-haskell-constructor">Int</span> <span class="org-haskell-operator">-&gt;</span> <span class="org-haskell-constructor">Writer</span> [<span class="org-haskell-constructor">String</span>] <span class="org-haskell-constructor">Int</span>  
<span class="org-haskell-definition">gcd</span>' a b  
    <span class="org-haskell-operator">|</span> b <span class="org-haskell-operator">==</span> 0 <span class="org-haskell-operator">=</span> <span class="org-haskell-keyword">do</span>  
        tell [<span class="org-string">"Finished with "</span> <span class="org-haskell-operator">++</span> show a]  
        return a  
    <span class="org-haskell-operator">|</span> otherwise <span class="org-haskell-operator">=</span> <span class="org-haskell-keyword">do</span>  
        tell [show a <span class="org-haskell-operator">++</span> <span class="org-string">" mod "</span> <span class="org-haskell-operator">++</span> show b <span class="org-haskell-operator">++</span> <span class="org-string">" = "</span> <span class="org-haskell-operator">++</span> show (a <span class="org-haskell-operator">`mod`</span> b)]  
        gcd' b (a <span class="org-haskell-operator">`mod`</span> b)

<span class="org-haskell-constructor">:</span>{

<span class="org-haskell-keyword">let</span> gcd' <span class="org-haskell-operator">::</span> <span class="org-haskell-constructor">Int</span> <span class="org-haskell-operator">-&gt;</span> <span class="org-haskell-constructor">Int</span> <span class="org-haskell-operator">-&gt;</span> <span class="org-haskell-constructor">Writer</span> [<span class="org-haskell-constructor">String</span>] <span class="org-haskell-constructor">Int</span>  
    gcd' a b  
      <span class="org-haskell-operator">|</span> b <span class="org-haskell-operator">==</span> 0 <span class="org-haskell-operator">=</span> <span class="org-haskell-keyword">do</span>  
          tell [<span class="org-string">"Finished with "</span> <span class="org-haskell-operator">++</span> show a]  
          return a  
      <span class="org-haskell-operator">|</span> otherwise <span class="org-haskell-operator">=</span> <span class="org-haskell-keyword">do</span>  
          tell [show a <span class="org-haskell-operator">++</span> <span class="org-string">" mod "</span> <span class="org-haskell-operator">++</span> show b <span class="org-haskell-operator">++</span> <span class="org-string">" = "</span> <span class="org-haskell-operator">++</span> show (a <span class="org-haskell-operator">`mod`</span> b)]  
          gcd' b (a <span class="org-haskell-operator">`mod`</span> b)

<span class="org-haskell-constructor">:</span>}


<span class="org-haskell-operator">&gt;&gt;&gt;</span> <span class="org-haskell-constructor">:</span>t gcd'
<span class="org-haskell-definition">gcd</span>' <span class="org-haskell-operator">::</span> <span class="org-haskell-constructor">Int</span> <span class="org-haskell-operator">-&gt;</span> <span class="org-haskell-constructor">Int</span> <span class="org-haskell-operator">-&gt;</span> <span class="org-haskell-constructor">Writer</span> [<span class="org-haskell-constructor">String</span>] <span class="org-haskell-constructor">Int</span>
<span class="org-haskell-operator">&gt;&gt;&gt;</span> 

<span class="org-haskell-operator">&gt;&gt;&gt;</span> gcd' 100 40
<span class="org-haskell-constructor">WriterT</span> (<span class="org-haskell-constructor">Identity</span> (20<span class="org-haskell-operator">,</span>[<span class="org-string">"100 mod 40 = 20"</span><span class="org-haskell-operator">,</span><span class="org-string">"40 mod 20 = 0"</span><span class="org-haskell-operator">,</span><span class="org-string">"Finished with 20"</span>]))
<span class="org-haskell-operator">&gt;&gt;&gt;</span> 

<span class="org-haskell-operator">&gt;&gt;&gt;</span> runWriter <span class="org-haskell-operator">$</span> gcd' 100 40
(20<span class="org-haskell-operator">,</span>[<span class="org-string">"100 mod 40 = 20"</span><span class="org-haskell-operator">,</span><span class="org-string">"40 mod 20 = 0"</span><span class="org-haskell-operator">,</span><span class="org-string">"Finished with 20"</span>])
<span class="org-haskell-operator">&gt;&gt;&gt;</span> 

<span class="org-haskell-operator">&gt;&gt;&gt;</span> <span class="org-haskell-keyword">import</span> <span class="org-haskell-constructor">Control.Monad</span> (mapM_)
<span class="org-haskell-operator">&gt;&gt;&gt;</span> 

<span class="org-haskell-operator">&gt;&gt;&gt;</span> <span class="org-haskell-keyword">import</span> <span class="org-haskell-constructor">Control.Monad</span> (mapM_)
<span class="org-haskell-operator">&gt;&gt;&gt;</span> 
<span class="org-haskell-operator">&gt;&gt;&gt;</span> mapM_ putStrLn <span class="org-haskell-operator">$</span> snd <span class="org-haskell-operator">$</span> runWriter <span class="org-haskell-operator">$</span> gcd' 8 3
8 mod 3 <span class="org-haskell-operator">=</span> 2
3 mod 2 <span class="org-haskell-operator">=</span> 1
2 mod 1 <span class="org-haskell-operator">=</span> 0
<span class="org-haskell-constructor">Finished</span> with 1
<span class="org-haskell-operator">&gt;&gt;&gt;</span>

<span class="org-haskell-operator">&gt;&gt;&gt;</span> mapM_ putStrLn <span class="org-haskell-operator">$</span> snd <span class="org-haskell-operator">$</span> runWriter <span class="org-haskell-operator">$</span> gcd' 100 68
100 mod 68 <span class="org-haskell-operator">=</span> 32
68 mod 32 <span class="org-haskell-operator">=</span> 4
32 mod 4 <span class="org-haskell-operator">=</span> 0
<span class="org-haskell-constructor">Finished</span> with 4
<span class="org-haskell-operator">&gt;&gt;&gt;</span>

<span class="org-function-name">gcdReverse</span> <span class="org-haskell-operator">::</span> <span class="org-haskell-constructor">Int</span> <span class="org-haskell-operator">-&gt;</span> <span class="org-haskell-constructor">Int</span> <span class="org-haskell-operator">-&gt;</span> <span class="org-haskell-constructor">Writer</span> [<span class="org-haskell-constructor">String</span>] <span class="org-haskell-constructor">Int</span>  
<span class="org-haskell-definition">gcdReverse</span> a b  
    <span class="org-haskell-operator">|</span> b <span class="org-haskell-operator">==</span> 0 <span class="org-haskell-operator">=</span> <span class="org-haskell-keyword">do</span>  
        tell [<span class="org-string">"Finished with "</span> <span class="org-haskell-operator">++</span> show a]  
        return a  
    <span class="org-haskell-operator">|</span> otherwise <span class="org-haskell-operator">=</span> <span class="org-haskell-keyword">do</span>  
        result <span class="org-haskell-operator">&lt;-</span> gcdReverse b (a <span class="org-haskell-operator">`mod`</span> b)  
        tell [show a <span class="org-haskell-operator">++</span> <span class="org-string">" mod "</span> <span class="org-haskell-operator">++</span> show b <span class="org-haskell-operator">++</span> <span class="org-string">" = "</span> <span class="org-haskell-operator">++</span> show (a <span class="org-haskell-operator">`mod`</span> b)]  
        return result


<span class="org-haskell-constructor">:</span>{
<span class="org-haskell-keyword">let</span> gcdReverse <span class="org-haskell-operator">::</span> <span class="org-haskell-constructor">Int</span> <span class="org-haskell-operator">-&gt;</span> <span class="org-haskell-constructor">Int</span> <span class="org-haskell-operator">-&gt;</span> <span class="org-haskell-constructor">Writer</span> [<span class="org-haskell-constructor">String</span>] <span class="org-haskell-constructor">Int</span>  
    gcdReverse a b  
      <span class="org-haskell-operator">|</span> b <span class="org-haskell-operator">==</span> 0 <span class="org-haskell-operator">=</span> <span class="org-haskell-keyword">do</span>  
          tell [<span class="org-string">"Finished with "</span> <span class="org-haskell-operator">++</span> show a]  
          return a  
      <span class="org-haskell-operator">|</span> otherwise <span class="org-haskell-operator">=</span> <span class="org-haskell-keyword">do</span>  
          result <span class="org-haskell-operator">&lt;-</span> gcdReverse b (a <span class="org-haskell-operator">`mod`</span> b)  
          tell [show a <span class="org-haskell-operator">++</span> <span class="org-string">" mod "</span> <span class="org-haskell-operator">++</span> show b <span class="org-haskell-operator">++</span> <span class="org-string">" = "</span> <span class="org-haskell-operator">++</span> show (a <span class="org-haskell-operator">`mod`</span> b)]  
          return result 

<span class="org-haskell-constructor">:</span>}

<span class="org-haskell-operator">&gt;&gt;&gt;</span> <span class="org-haskell-constructor">:</span>t gcdReverse 
<span class="org-function-name">gcdReverse</span> <span class="org-haskell-operator">::</span> <span class="org-haskell-constructor">Int</span> <span class="org-haskell-operator">-&gt;</span> <span class="org-haskell-constructor">Int</span> <span class="org-haskell-operator">-&gt;</span> <span class="org-haskell-constructor">Writer</span> [<span class="org-haskell-constructor">String</span>] <span class="org-haskell-constructor">Int</span>
<span class="org-haskell-operator">&gt;&gt;&gt;</span>

<span class="org-haskell-operator">&gt;&gt;&gt;</span> mapM_ putStrLn <span class="org-haskell-operator">$</span> snd <span class="org-haskell-operator">.</span> runWriter <span class="org-haskell-operator">$</span> gcdReverse 39 106
<span class="org-haskell-constructor">Finished</span> with 1
5 mod 1 <span class="org-haskell-operator">=</span> 0
6 mod 5 <span class="org-haskell-operator">=</span> 1
11 mod 6 <span class="org-haskell-operator">=</span> 5
28 mod 11 <span class="org-haskell-operator">=</span> 6
39 mod 28 <span class="org-haskell-operator">=</span> 11
106 mod 39 <span class="org-haskell-operator">=</span> 28
39 mod 106 <span class="org-haskell-operator">=</span> 39
<span class="org-haskell-operator">&gt;&gt;&gt;</span>
</pre>
</div>
</div>
</div>

<div id="outline-container-sec-1-14-9" class="outline-4">
<h4 id="sec-1-14-9"><span class="section-number-4">1.14.9</span> See also</h4>
<div class="outline-text-4" id="text-1-14-9">
<p>
<b>Monads</b>
</p>

<ul class="org-ul">
<li><a href="http://www.idryman.org/blog/2014/01/23/yet-another-monad-tutorial/">Yet Another Monad Tutorial in 15 Minutes - Carpe diem (Felix's blog)</a>
</li>

<li><a href="http://www.muitovar.com/monad/moncow.xhtml">Haskell Monad Tutorial - The Greenhorn's Guide to becoming a Monad Cowboy</a> 
</li>

<li><a href="http://homepages.inf.ed.ac.uk/wadler/papers/marktoberdorf/baastad.pdf">Monads for functional programming - Philip Wadler</a>
</li>

<li><a href="https://en.wikibooks.org/wiki/Haskell/Understanding_monads">Haskell/Understanding monads - Wikibooks, open books for an open world</a>
</li>

<li><a href="http://book.realworldhaskell.org/read/monads.html">ChapterÂ 14.Â Monads</a> - Real World Haskell 
</li>

<li><a href="http://techguyinmidtown.com/2008/05/20/monads-demystified/">Monads Demystified | tech guy in midtown</a>
</li>

<li><a href="http://ocw.mit.edu/courses/mathematics/18-s996-category-theory-for-scientists-spring-2013/projects/MIT18_S996S13_Monad.pdf">In search of a Monad for system call abstractions - Taesoo Kim - MIT CSAIL</a>
</li>

<li><a href="https://wiki.haskell.org/All_About_Monads">All about Monads - Haskell Wiki</a>
</li>

<li><a href="http://www.eli.sdsu.edu/courses/fall14/cs596/notes/D22MonadsDesignPatterns.pdf">CS 596 Functional Programming and Design Fall Semester, 2014 Doc 22 Monads &amp; Design Patterns</a>
</li>
</ul>

<p>
<b>List Monad</b>
</p>

<ul class="org-ul">
<li><a href="http://eed3si9n.com/learning-scalaz/List+Monad.html">learning Scalaz â€” List Monad</a>
</li>

<li><a href="https://en.wikibooks.org/wiki/Haskell/Understanding_monads/List">Haskell/Understanding monads/List - Wikibooks, open books for an open world</a>
</li>

<li><a href="https://en.wikibooks.org/wiki/Haskell/Understanding_monads/Maybe">Haskell/Understanding monads/Maybe - Wikibooks, open books for an open world</a>
</li>
</ul>

<p>
<b>Monads in Ocaml</b>
</p>

<ul class="org-ul">
<li><a href="https://www.cs.cornell.edu/Courses/cs3110/2015sp/lectures/21/lec21.html">Lecture 21: Monads - CS 3110 Spring 2015 - Data Structures and Functional Programming</a>
</li>
</ul>

<p>
<b>Monads in F#</b>
</p>

<ul class="org-ul">
<li><a href="http://research.microsoft.com/pubs/217375/computation-zoo.pdf">The F# Computation Expression Zoo</a>
</li>

<li><a href="https://msdn.microsoft.com/en-us/library/dd233182.aspx">Computation Expressions (F#)</a>
</li>

<li><a href="https://en.wikibooks.org/wiki/F_Sharp_Programming/Computation_Expressions">F Sharp Programming/Computation Expressions</a>
</li>

<li><a href="http://tomasp.net/blog/2013/computation-zoo-padl/">The F# Computation Expression Zoo (PADL'14)</a>
</li>
</ul>

<p>
<b>Option/ Maybe Monad</b>
</p>

<ul class="org-ul">
<li><a href="http://james-iry.blogspot.com.br/2010/08/why-scalas-and-haskells-types-will-save.html">One Div Zero: Why Scala's "Option" and Haskell's "Maybe" types will save you from null</a>
</li>

<li><a href="http://www.codecommit.com/blog/scala/the-option-pattern">The Option Pattern/ Code Commit</a>
</li>

<li><a href="http://www.codeproject.com/Articles/845601/MayBe-Monad-Usage-Examples">MayBe Monad: Usage Examples - CodeProject</a>
</li>

<li><a href="http://sean.voisen.org/blog/2013/10/intro-monads-maybe/">Sean Voisen Â» A Gentle Intro to Monads â€¦ Maybe?</a>
</li>

<li><a href="https://www.niwi.nz/2015/03/08/error-handling/">Niwi.Nz : A little overview of error handling.</a>
</li>

<li><a href="http://robotlolita.me/2013/12/08/a-monad-in-practicality-first-class-failures.html">A Monad in Practicality: First-Class Failures - Quils in Space</a>
</li>

<li><a href="https://boykin.wordpress.com/2011/09/11/option-monad-in-scala/">Option Monad in Scala | Patrick Oscar Boykin's Personal Weblog</a>
</li>
</ul>


<p>
<b>IO Monad</b>
</p>

<ul class="org-ul">
<li><a href="https://wiki.haskell.org/IO_inside">https://wiki.haskell.org/IO_inside</a> 
</li>

<li><a href="http://learnyouahaskell.com/input-and-output">Input and Output - Learn You a Haskell for Great Good!</a>
</li>

<li><a href="https://www.haskell.org/tutorial/io.html">A Gentle Introduction to Haskell: IO</a>
</li>

<li><a href="https://en.wikibooks.org/wiki/Haskell/Understanding_monads/IO">Haskell/Understanding monads/IO - Wikibooks, open books for an open world</a>
</li>
</ul>
</div>
</div>
</div>
</div>

<div id="outline-container-sec-2" class="outline-2">
<h2 id="sec-2"><span class="section-number-2">2</span> Functional Languages</h2>
<div class="outline-text-2" id="text-2">
<p>
Note: There is no consensus about what really is a functional
language. In this table were selected programming languages which can
be programmed in functional-style or favors this style. 
</p>

<p>
Some Functional programming languages:
</p>

<table border="2" cellspacing="0" cellpadding="6" rules="groups" frame="hsides">


<colgroup>
<col  class="left" />

<col  class="left" />

<col  class="left" />

<col  class="left" />

<col  class="left" />

<col  class="left" />

<col  class="left" />

<col  class="left" />

<col  class="left" />

<col  class="left" />

<col  class="left" />

<col  class="left" />

<col  class="left" />

<col  class="left" />
</colgroup>
<thead>
<tr>
<th scope="col" class="left">Language</th>
<th scope="col" class="left">Evaluation</th>
<th scope="col" class="left">Typing</th>
<th scope="col" class="left">Type Inference</th>
<th scope="col" class="left">Pattern Matching</th>
<th scope="col" class="left">Syntax Sugars</th>
<th scope="col" class="left">GIL</th>
<th scope="col" class="left">TCO</th>
<th scope="col" class="left">OO</th>
<th scope="col" class="left">AGDT</th>
<th scope="col" class="left">Platform</th>
<th scope="col" class="left">Family</th>
<th scope="col" class="left">Currying</th>
<th scope="col" class="left">Feature</th>
</tr>
</thead>
<tbody>
<tr>
<td class="left">Haskell</td>
<td class="left">Lazy</td>
<td class="left">Static</td>
<td class="left">Yes</td>
<td class="left">Yes</td>
<td class="left">Yes</td>
<td class="left">No</td>
<td class="left">Yes</td>
<td class="left">No</td>
<td class="left">Yes</td>
<td class="left">NAT</td>
<td class="left">ML/SML</td>
<td class="left">Yes</td>
<td class="left">Concurrency, Parallelism and Purity</td>
</tr>

<tr>
<td class="left">Ocaml</td>
<td class="left">Strict</td>
<td class="left">Static</td>
<td class="left">Yes</td>
<td class="left">Yes</td>
<td class="left">Yes</td>
<td class="left">Yes</td>
<td class="left">Yes</td>
<td class="left">Yes</td>
<td class="left">Yes</td>
<td class="left">NAT/BC</td>
<td class="left">ML/SML</td>
<td class="left">Yes</td>
<td class="left">&#xa0;</td>
</tr>

<tr>
<td class="left">F# (F sharp)</td>
<td class="left">Strict</td>
<td class="left">Static</td>
<td class="left">Yes</td>
<td class="left">Yes</td>
<td class="left">Yes</td>
<td class="left">No</td>
<td class="left">Yes</td>
<td class="left">Yes</td>
<td class="left">Yes</td>
<td class="left">.NET</td>
<td class="left">ML/SML</td>
<td class="left">Yes</td>
<td class="left">.NET Integration</td>
</tr>

<tr>
<td class="left">Scheme</td>
<td class="left">Strict</td>
<td class="left">Dynamic</td>
<td class="left">No</td>
<td class="left">No</td>
<td class="left">Yes/ Macros</td>
<td class="left">*</td>
<td class="left">Yes</td>
<td class="left">No</td>
<td class="left">No</td>
<td class="left">-</td>
<td class="left">Lisp</td>
<td class="left">No</td>
<td class="left">Minimalist Educational</td>
</tr>

<tr>
<td class="left">Clojure</td>
<td class="left">Strict</td>
<td class="left">Dynamic</td>
<td class="left">No</td>
<td class="left">Yes. Destructuring and macros</td>
<td class="left">Yes/ Macros</td>
<td class="left">No</td>
<td class="left">No</td>
<td class="left">No</td>
<td class="left">No</td>
<td class="left">JVM</td>
<td class="left">Lisp</td>
<td class="left">No</td>
<td class="left">Java integration + Macros</td>
</tr>

<tr>
<td class="left">Scala</td>
<td class="left">Strict</td>
<td class="left">Static</td>
<td class="left">Yes</td>
<td class="left">Yes</td>
<td class="left">Yes</td>
<td class="left">No</td>
<td class="left">Yes</td>
<td class="left">Yes</td>
<td class="left">Yes</td>
<td class="left">JVM</td>
<td class="left">&#xa0;</td>
<td class="left">Yes</td>
<td class="left">Java integration + Type safety</td>
</tr>

<tr>
<td class="left">Erlang</td>
<td class="left">Strict</td>
<td class="left">Dynamic</td>
<td class="left">?</td>
<td class="left">Yes</td>
<td class="left">Yes</td>
<td class="left">No</td>
<td class="left">Yes</td>
<td class="left">?</td>
<td class="left">?</td>
<td class="left">VM/Bytecode</td>
<td class="left">&#xa0;</td>
<td class="left">?</td>
<td class="left">Telecommunications, Servers, Concurrency</td>
</tr>

<tr>
<td class="left">Elixir</td>
<td class="left">Strict</td>
<td class="left">Dynamic</td>
<td class="left">?</td>
<td class="left">Yes</td>
<td class="left">Yes</td>
<td class="left">No</td>
<td class="left">Yes</td>
<td class="left">?</td>
<td class="left">?</td>
<td class="left">Erlang VM</td>
<td class="left">-</td>
<td class="left">?</td>
<td class="left">Erlang VM + macros</td>
</tr>

<tr>
<td class="left">Python</td>
<td class="left">Strict</td>
<td class="left">Dynamic</td>
<td class="left">No</td>
<td class="left">No</td>
<td class="left">No</td>
<td class="left">Yes</td>
<td class="left">No</td>
<td class="left">Yes</td>
<td class="left">No</td>
<td class="left">VM/Bytecode</td>
<td class="left">-</td>
<td class="left">No</td>
<td class="left">Libraries and easier to use.</td>
</tr>

<tr>
<td class="left">&#xa0;</td>
<td class="left">&#xa0;</td>
<td class="left">&#xa0;</td>
<td class="left">&#xa0;</td>
<td class="left">&#xa0;</td>
<td class="left">&#xa0;</td>
<td class="left">&#xa0;</td>
<td class="left">&#xa0;</td>
<td class="left">&#xa0;</td>
<td class="left">&#xa0;</td>
<td class="left">&#xa0;</td>
<td class="left">&#xa0;</td>
<td class="left">&#xa0;</td>
<td class="left">&#xa0;</td>
</tr>

<tr>
<td class="left">JavaScript</td>
<td class="left">Strict</td>
<td class="left">Dynamic</td>
<td class="left">No</td>
<td class="left">No</td>
<td class="left">No</td>
<td class="left">?*</td>
<td class="left">No</td>
<td class="left">Yes</td>
<td class="left">No</td>
<td class="left">VM/Interpreted</td>
<td class="left">*Lisp/ Scheme</td>
<td class="left">No</td>
<td class="left">The only language allowed to run in the browser.</td>
</tr>

<tr>
<td class="left">R</td>
<td class="left">Strict</td>
<td class="left">Dynamic</td>
<td class="left">No</td>
<td class="left">No</td>
<td class="left">No</td>
<td class="left">?</td>
<td class="left">No</td>
<td class="left">Yes</td>
<td class="left">-</td>
<td class="left">VM/Bytecode</td>
<td class="left">*Lisp/ Scheme</td>
<td class="left">No</td>
<td class="left">DSL - Statistics</td>
</tr>

<tr>
<td class="left">Mathematica</td>
<td class="left">Strict</td>
<td class="left">Dynamic</td>
<td class="left">Yes</td>
<td class="left">?</td>
<td class="left">?</td>
<td class="left">?</td>
<td class="left">??</td>
<td class="left">?</td>
<td class="left">?</td>
<td class="left">?</td>
<td class="left">&#xa0;</td>
<td class="left">No</td>
<td class="left">DSL - Computer Algebraic System</td>
</tr>

<tr>
<td class="left">&#xa0;</td>
<td class="left">&#xa0;</td>
<td class="left">&#xa0;</td>
<td class="left">&#xa0;</td>
<td class="left">&#xa0;</td>
<td class="left">&#xa0;</td>
<td class="left">&#xa0;</td>
<td class="left">&#xa0;</td>
<td class="left">&#xa0;</td>
<td class="left">&#xa0;</td>
<td class="left">&#xa0;</td>
<td class="left">&#xa0;</td>
<td class="left">&#xa0;</td>
<td class="left">&#xa0;</td>
</tr>
</tbody>
</table>


<p>
Notes:
</p>

<ul class="org-ul">
<li><a href="https://en.wikipedia.org/wiki/Algebraic_data_type">AGDT</a>  - Algebraic Data Types
</li>

<li><a href="https://en.wikipedia.org/wiki/Global_interpreter_lock">GIL</a> - Global Interpreter Locking. Languages with GIL cannot take
advantage of multi-core processors.
</li>

<li>TCO - Tail Call Optimization. Languages without TCO cannot perform
recursion safely. It can lead to a stack overflow for a big number
of iterations. 
</li>

<li>JVM    - Java Virtual Machine / Java Platform
</li>

<li>.NET  - Dot Net Platform: <a href="https://en.wikipedia.org/wiki/Common_Language_Runtime">CLR</a> - Virtual Machine
</li>

<li>NAT    - Native Code. Native code is not portable like a virtual
machine, its execution is constrained to the processor architecture
and to the system calls of the operating system. 
</li>

<li>VM     - Virtual Machine 
</li>

<li>OO     - Object Orientated
</li>

<li>Currying  - Curried functions like in Haskell, F# and Ocaml 
</li>

<li>DSL    - Domain Specific Language
</li>

<li><span class="underline">Syntax Sugars</span> help increase expressiveness and to write shorter,
concise and more readable code. 

<ul class="org-ul">
<li>Short lambda functions:
<ul class="org-ul">
<li>Haskell:      (\ x y -&gt; 3 * x + y)
</li>
<li>Ocaml and F#  (fun x y -&gt; x + y)
</li>
</ul>
</li>

<li>Monad bind operator: &gt;&gt;= from Haskell 
</li>

<li>Function application.

<ul class="org-ul">
<li>The operator (|&gt;) from F# that pipes an argument into a
function.  10 |&gt; sin |&gt; exp |&gt; cos is equivalent to:  (sin (exp (cos 10)))
</li>

<li>Clojure (-&gt;) macro: (-&gt; 10 Math/sin Math/exp Math/cos) which is
expanded to: (Math/cos (Math/exp (Math/sin 10)))
</li>
</ul>
</li>

<li>Function composition operator:  (&gt;&gt;) from F# and (.) dot from
Haskell
</li>
</ul>
</li>

<li>JavaScript: Is single-thread with event loop and uses
asynchronous IO (non blocking IO) with callbacks.
</li>

<li>It is controversial that Javascript is based on scheme. According
to Douglas Crockford JavaScript is Scheme on a C clothe. With a
C-like syntax <a href="http://www.crockford.com/javascript/little.html">{Reference}</a>.
</li>
</ul>

<p>
More Information: <a href="http://en.wikipedia.org/wiki/Comparison_of_functional_programming_languages">Comparison of Functional Programming Languages</a>
</p>

<p>
See also: <a href="http://hyperpolyglot.org/ml">ML Dialects and Haskell: SML, OCaml, F#, Haskell</a> 
</p>
</div>
</div>

<div id="outline-container-sec-3" class="outline-2">
<h2 id="sec-3"><span class="section-number-2">3</span> Influential People</h2>
<div class="outline-text-2" id="text-3">
<p>
A selection of people who influenced functional programming:
</p>

<ul class="org-ul">
<li><a href="https://en.wikipedia.org/wiki/Alonzo_Church">Alonzo Church</a>, Mathematician -&gt; Lambda Calculus
</li>

<li><a href="https://en.wikipedia.org/wiki/Haskell_Curry">Haskell Curry</a>, Mathematician -&gt; Concept of currying
</li>

<li><a href="https://en.wikipedia.org/wiki/Robin_Milner">Robin Milner</a>, Computer Scientist -&gt; Type inference

<ul class="org-ul">
<li><a href="https://en.wikipedia.org/wiki/Hindley%E2%80%93Milner_type_system">Hindleyâ€“Milner type system</a> 
</li>

<li><a href="https://en.wikipedia.org/wiki/ML_(programming_language">ML language</a>
</li>
</ul>
</li>

<li><a href="https://en.wikipedia.org/wiki/John_McCarthy_(computer_scientist">John McCarthy</a>,  Computer Scientist -&gt; Creator of <a href="https://en.wikipedia.org/wiki/Lisp_(programming_language">Lisp</a> and the
father of Artificial intelligence research.

<ul class="org-ul">
<li><a href="http://www.infoq.com/interviews/Steele-Interviews-John-McCarthy">Guy Steele Interviews John McCarthy, Father of Lisp</a>
</li>
</ul>
</li>

<li><a href="https://en.wikipedia.org/wiki/John_Backus">John Backus</a>, Computer Scientist -&gt;  Backus-Naur form (BNF), Fortran
Language, 

<ul class="org-ul">
<li><a href="https://web.stanford.edu/class/cs242/readings/backus.pdf">Can Programming Be Liberated from the von Neumann Style? A Functional Style and Its Algebra of Programs</a>
</li>
</ul>
</li>

<li><a href="https://en.wikipedia.org/wiki/Philip_Wadler">Philip Wadler</a>, Theory behind functional programming and the use of
monads in functional programming, the design of the purely
functional language Haskell.

<ul class="org-ul">
<li><a href="http://www.eliza.ch/doc/wadler92essence_of_FP.pdf">The essence of functional programing</a>
</li>
<li><a href="http://www.infoq.com/interviews/wadler-functional-programming">Philip Wadler on Functional Programming - Interview</a>
</li>
</ul>
</li>

<li><a href="https://en.wikipedia.org/wiki/Eugenio_Moggi">Eugenio Moggi</a>, Professor of computer science at the University of
Genoa, Italy. - He first described the general use of monads to
structure programs.

<ul class="org-ul">
<li><a href="http://www.disi.unige.it/person/MoggiE/ftp/ic91.pdf">Notions of computation and monads - Eugenio Moggi</a>
</li>
</ul>
</li>

<li><a href="https://en.wikipedia.org/wiki/Simon_Peyton_Jones">Simon Peyton Jones</a>, Computer Scientist -&gt; Major contributor to the
design of the Haskell programming language.

<ul class="org-ul">
<li><a href="http://www.techworld.com.au/article/261007/a-z_programming_languages_haskell/?">Interview with Peyton Jones - The A-Z of Programming Languages: Haskell - Techworld</a>
</li>

<li><a href="http://research.microsoft.com/en-us/people/simonpj/">Simon Peyton Jones - Microsoft Research</a>
</li>
</ul>
</li>

<li><a href="https://en.wikipedia.org/wiki/John_Hughes_(computer_scientist">John Hughes</a>, Computer Scientist -&gt; One of the most influentials
papers in FP field: Why functional programing matters.
</li>
</ul>


<ul class="org-ul">
<li><a href="https://en.wikipedia.org/wiki/Gerald_Jay_Sussman">Gerald Jay Sussman</a>, Mathematician and Computer Scientist

<ul class="org-ul">
<li><a href="https://en.wikipedia.org/wiki/Scheme_(programming_language">Scheme Lisp</a> Language
</li>
<li>Book: <a href="https://en.wikipedia.org/wiki/Structure_and_Interpretation_of_Computer_Programs">Structure and Interpretation of Computer Programs</a>
</li>
<li>Book: <a href="https://en.wikipedia.org/wiki/Structure_and_Interpretation_of_Classical_Mechanics">Structure and Interpretation of Classical Mechanics</a>
</li>

<li><a href="https://en.wikipedia.org/wiki/History_of_the_Scheme_programming_language#The_Lambda_Papers">Lambda Papers</a>: A series of MIT AI Memos published between 1975
and 1980, developing the Scheme programming language and a number
of influential concepts in programming language design and
implementation.
</li>
</ul>
</li>
</ul>
</div>
</div>

<div id="outline-container-sec-4" class="outline-2">
<h2 id="sec-4"><span class="section-number-2">4</span> Miscellaneous</h2>
<div class="outline-text-2" id="text-4">
</div><div id="outline-container-sec-4-1" class="outline-3">
<h3 id="sec-4-1"><span class="section-number-3">4.1</span> Selected Wikipedia Articles</h3>
<div class="outline-text-3" id="text-4-1">
<p>
<b>General</b>
</p>

<ul class="org-ul">
<li><a href="http://en.wikipedia.org/wiki/List_of_functional_programming_topics">List of functional programming topics</a>
</li>

<li><a href="http://en.wikipedia.org/wiki/Comparison_of_functional_programming_languages">Comparison of Functional Programming Languages</a>
</li>
<li><a href="http://en.wikipedia.org/wiki/Functional_programming">Functional programming</a>
</li>

<li><a href="http://en.wikipedia.org/wiki/Declarative_programming">Declarative programming</a>
</li>
<li><a href="http://en.wikipedia.org/wiki/Aspect-oriented_programming">Aspect-oriented programming</a>
</li>
</ul>

<p>
<b>Functions</b>
</p>

<p>
First Class Functions
</p>

<ul class="org-ul">
<li><a href="https://en.wikipedia.org/wiki/First-class_function">First-class function</a>
</li>
<li><a href="https://en.wikipedia.org/wiki/Pure_function">Pure function</a>
</li>
<li><a href="https://en.wikipedia.org/wiki/Side_effect_(computer_science)">Side effect (computer science)</a>
</li>
<li><a href="https://en.wikipedia.org/wiki/Purely_functional">Purely functional</a>
</li>

<li><a href="https://en.wikipedia.org/wiki/Referential_transparency_(computer_science)">Referential transparency (computer science)</a>
</li>
<li><a href="https://en.wikipedia.org/wiki/Function_type">Function type</a>
</li>

<li><a href="https://en.wikipedia.org/wiki/Arity">Arity</a>
</li>
<li><a href="https://en.wikipedia.org/wiki/Variadic_function">Variadic function</a>
</li>
</ul>

<p>
<b>Composition</b>
</p>

<ul class="org-ul">
<li><a href="https://en.wikipedia.org/wiki/Function_composition_(computer_science)">Function composition (computer science)</a>
</li>
<li><a href="https://en.wikipedia.org/wiki/Function_composition">Function composition - Mathematics</a>
</li>
<li><a href="https://en.wikipedia.org/wiki/Composability">Composability</a>
</li>

<li><a href="https://en.wikipedia.org/wiki/Functional_decomposition">Functional decomposition</a>
</li>
</ul>

<p>
<b>Scope</b>
</p>

<ul class="org-ul">
<li><a href="https://en.wikipedia.org/wiki/Scope_(computer_science)">Scope (computer science)</a>
</li>
</ul>

<p>
<b>Currying and Partial Evaluation</b>
</p>

<ul class="org-ul">
<li><a href="https://en.wikipedia.org/wiki/Currying">Currying</a>
</li>
<li><a href="https://en.wikipedia.org/wiki/Partial_evaluation">Partial evaluation</a>
</li>
</ul>

<p>
<b>Higher Order Functions, Closures, Anonymous Functions</b>
</p>

<ul class="org-ul">
<li><a href="https://en.wikipedia.org/wiki/Anonymous_function">Anonymous function</a>
</li>
<li><a href="https://en.wikipedia.org/wiki/Closure_(computer_programming)">Closure (computer programming)</a>
</li>
<li><a href="https://en.wikipedia.org/wiki/Higher-order_function">Higher-order function</a>
</li>
<li><a href="https://en.wikipedia.org/wiki/Fixed-point_combinator">Fixed-point combinator</a>
</li>
<li><a href="https://en.wikipedia.org/wiki/Defunctionalization">Defunctionalization</a>
</li>

<li><a href="http://en.wikipedia.org/wiki/Closure_(computer_programming">Closure (computer programming)</a>)
</li>
<li><a href="http://en.wikipedia.org/wiki/Callback_(computer_programming">Callback (computer programming)</a>)
</li>
<li><a href="http://en.wikipedia.org/wiki/Coroutine">Coroutine</a>
</li>
</ul>


<p>
<b>Recursion</b>
</p>

<ul class="org-ul">
<li><a href="https://en.wikipedia.org/wiki/Recursion_(computer_science)">Recursion (computer science)</a>
</li>
<li><a href="https://en.wikipedia.org/wiki/Tail_call">Tail call</a>
</li>
<li><a href="https://en.wikipedia.org/wiki/Double_recursion">Double recursion</a>
</li>
<li><a href="https://en.wikipedia.org/wiki/Primitive_recursive_function">Primitive recursive function</a>
</li>
</ul>


<ul class="org-ul">
<li><a href="https://en.wikipedia.org/wiki/Ackermann_function">Ackermann function</a>
</li>
<li><a href="https://en.wikipedia.org/wiki/Tak_(function)">Tak (function)</a>
</li>
</ul>


<p>
<b>Lambda Calculus and Process Calculus</b>
</p>

<ul class="org-ul">
<li><a href="http://en.wikipedia.org/wiki/Lambda_calculus">Lambda calculus</a>
</li>
<li><a href="https://en.wikipedia.org/wiki/Typed_lambda_calculus">Typed lambda calculus</a>
</li>
<li><a href="https://en.wikipedia.org/wiki/Process_calculus">Process calculus</a>
</li>
</ul>


<ul class="org-ul">
<li><a href="https://en.wikipedia.org/wiki/Futures_and_promises">Futures and promises</a>
</li>
<li><a href="https://en.wikipedia.org/wiki/Combinatory_logic">Combinatory logic</a>
</li>
</ul>


<p>
<b>Evaluation</b>
</p>

<ul class="org-ul">
<li><a href="https://en.wikipedia.org/wiki/Evaluation_strategy">Evaluation strategy</a>
</li>

<li><a href="http://en.wikipedia.org/wiki/Eager_evaluation">Eager Evaluation</a>
</li>
<li><a href="http://en.wikipedia.org/wiki/Short-circuit_evaluation">Short-circuit evaluation</a>
</li>
</ul>

<p>
<b>Related to Lazy Evaluation</b>
</p>

<ul class="org-ul">
<li><a href="http://en.wikipedia.org/wiki/Lazy_evaluation">Lazy Evaluation</a>
</li>
<li><a href="https://en.wikipedia.org/wiki/Thunk">Thunk</a>
</li>
</ul>

<p>
<b>Monads</b>
</p>

<ul class="org-ul">
<li><a href="http://en.wikipedia.org/wiki/Monad_(functional_programming">Monads Functional Programming</a>)
</li>
<li><a href="http://en.wikibooks.org/wiki/Haskell/Understanding_monads">Haskell/Understanding monads</a>
</li>
<li><a href="http://en.wikipedia.org/wiki/Monad_transformer">Monad transformer</a>
</li>
</ul>

<p>
<b>Continuations</b>
</p>

<ul class="org-ul">
<li><a href="http://en.wikipedia.org/wiki/Continuation">Continuation</a>
</li>
<li><a href="http://en.wikipedia.org/wiki/Continuation-passing_style">Continuation-passing style</a>
</li>
</ul>

<p>
<b>Fundamental Data Structures</b>
</p>

<ul class="org-ul">
<li><a href="https://en.wikipedia.org/wiki/List_(abstract_data_type)">List (abstract data type)</a>
</li>
<li><a href="https://en.wikipedia.org/wiki/Array_data_structure">Array data structure</a>
</li>
<li><a href="https://en.wikipedia.org/wiki/Array_data_type">Array data type</a>
</li>
</ul>


<p>
<b>Types</b>
</p>

<ul class="org-ul">
<li><a href="https://en.wikipedia.org/wiki/Category_theory">Category theory</a>
</li>
<li><a href="https://en.wikipedia.org/wiki/Type_theory">Type Theory</a>
</li>
<li><a href="https://en.wikipedia.org/wiki/Type_system">Type System</a>
</li>

<li><a href="https://en.wikipedia.org/wiki/Algebraic_data_type">Algebraic data type</a>
</li>

<li><a href="https://en.wikipedia.org/wiki/Type_signature">Type signature</a>
</li>
<li><a href="https://en.wikipedia.org/wiki/Enumerated_type">Enumerated type</a>
</li>
<li><a href="https://en.wikipedia.org/wiki/Product_type">Product type</a>
</li>
<li><a href="https://en.wikipedia.org/wiki/Tagged_union">Tagged union</a>
</li>
<li><a href="https://en.wikipedia.org/wiki/Dependent_type">Dependent type</a>
</li>
</ul>


<ul class="org-ul">
<li><a href="https://en.wikipedia.org/wiki/Recursive_data_type">Recursive data type</a>
</li>

<li><a href="https://en.wikipedia.org/wiki/Generalized_algebraic_data_type">Generalized algebraic data type</a>
</li>

<li><a href="https://en.wikipedia.org/wiki/Disjoint_union">Disjoint union</a>
</li>
</ul>


<p>
<b>Concurrency</b> 
</p>

<ul class="org-ul">
<li><a href="https://en.wikipedia.org/wiki/Thread_(computing)">Thread (computing)</a>
</li>
<li><a href="https://en.wikipedia.org/wiki/Concurrency_(computer_science)">Concurrency (computer science)</a>
</li>
<li><a href="https://en.wikipedia.org/wiki/Concurrent_computing">Concurrent computing </a>
</li>
<li><a href="https://en.wikipedia.org/wiki/Actor_model">Actor model </a>
</li>
<li><a href="https://en.wikipedia.org/wiki/Event_loop">Event loop </a>
</li>
<li><a href="https://en.wikipedia.org/wiki/Channel_(programming)">Channel (programming)</a>
</li>
<li><a href="https://en.wikipedia.org/wiki/MapReduce">MapReduce </a>
</li>
<li><a href="https://en.wikipedia.org/wiki/Futures_and_promises">Futures and promises</a>
</li>
<li><a href="https://en.wikipedia.org/wiki/Asynchronous_I/O">Asynchronous I/O</a>
</li>
<li><a href="https://en.wikipedia.org/wiki/Multi-core_processor">Multicore processor</a>
</li>
</ul>

<p>
<b>Miscellaneous</b>
</p>

<ul class="org-ul">
<li><a href="https://en.wikipedia.org/wiki/Call_stack">Call stack</a>
</li>
<li><a href="https://en.wikipedia.org/wiki/Call_graph">Call graph</a>
</li>

<li><a href="https://en.wikipedia.org/wiki/Reflection_(computer_programming)">Reflection (computer programming)</a>
</li>

<li><a href="https://en.wikipedia.org/wiki/Function_object">Function object</a>
</li>

<li><a href="https://en.wikipedia.org/wiki/Memoization">Memoization</a>
</li>

<li><a href="https://en.wikipedia.org/wiki/Garbage_collection_(computer_science)">Garbage collection (computer science)</a>
</li>
</ul>

<p>
<b>Functional Languages</b>
</p>

<ul class="org-ul">
<li><a href="https://en.wikipedia.org/wiki/Lisp_(programming_language)">Lisp (programming language)</a>
</li>
<li><a href="https://en.wikipedia.org/wiki/Scheme_(programming_language)">Scheme Lisp</a>
</li>
<li><a href="https://en.wikipedia.org/wiki/Haskell">Haskell</a>
</li>
<li><a href="https://en.wikipedia.org/wiki/ML_(programming_language)">ML (programming language)</a>
</li>
<li><a href="https://en.wikipedia.org/wiki/Standard_ML">Standard ML</a>
</li>
<li><a href="https://en.wikipedia.org/wiki/OCaml">OCaml</a>
</li>
<li><a href="https://en.wikipedia.org/wiki/F_Sharp_(programming_language)">F# - Fsharp</a>
</li>
</ul>
</div>
</div>

<div id="outline-container-sec-4-2" class="outline-3">
<h3 id="sec-4-2"><span class="section-number-3">4.2</span> Selected Rosettacode Pages</h3>
<div class="outline-text-3" id="text-4-2">
</div><div id="outline-container-sec-4-2-1" class="outline-4">
<h4 id="sec-4-2-1"><span class="section-number-4">4.2.1</span> Concepts Examples</h4>
<div class="outline-text-4" id="text-4-2-1">
<ul class="org-ul">
<li><a href="http://rosettacode.org/wiki/Call_a_function">Call a function</a>
</li>

<li><a href="http://rosettacode.org/wiki/Higher-order_functions">Higher-order functions</a>
</li>

<li><a href="http://rosettacode.org/wiki/Closures/Value_capture">Closures/Value capture</a>
</li>

<li><a href="http://rosettacode.org/wiki/Function_composition">Function composition</a>
</li>

<li><a href="http://rosettacode.org/wiki/Partial_function_application">Partial function application</a>
</li>

<li><a href="http://rosettacode.org/wiki/Currying">Currying</a>
</li>

<li><a href="http://rosettacode.org/wiki/Catamorphism">Catamorphism - Fold/Reduce</a>
</li>

<li><a href="http://rosettacode.org/wiki/Null_object">Null object</a>
</li>

<li><a href="http://rosettacode.org/wiki/Y_combinator">Y combinator</a>
</li>
</ul>

<p>
Recursion:
</p>

<ul class="org-ul">
<li><a href="http://rosettacode.org/wiki/Anonymous_recursion">Anonymous recursion</a>
</li>

<li><a href="http://rosettacode.org/wiki/Ackermann_function">Ackermann function</a>
</li>
</ul>
</div>
</div>

<div id="outline-container-sec-4-2-2" class="outline-4">
<h4 id="sec-4-2-2"><span class="section-number-4">4.2.2</span> Languages</h4>
<div class="outline-text-4" id="text-4-2-2">
<ul class="org-ul">
<li><a href="http://rosettacode.org/wiki/Haskell">Haskell</a>
</li>

<li><a href="http://rosettacode.org/wiki/OCaml">Ocaml</a>
</li>

<li><a href="http://rosettacode.org/wiki/Fsharp">F# - Fsharp</a>
</li>

<li><a href="http://rosettacode.org/wiki/scheme">Scheme</a>
</li>

<li><a href="http://rosettacode.org/wiki/Racket">Racket</a>
</li>

<li><a href="http://rosettacode.org/wiki/Clojure">Clojure</a>
</li>

<li><a href="http://rosettacode.org/wiki/Scala">Scala</a>
</li>

<li><a href="http://rosettacode.org/wiki/Category:JavaScript">JavaScript / ECMAScript</a>
</li>
</ul>
</div>
</div>
</div>

<div id="outline-container-sec-4-3" class="outline-3">
<h3 id="sec-4-3"><span class="section-number-3">4.3</span> Libraries and Frameworks</h3>
<div class="outline-text-3" id="text-4-3">
<p>
<b>Python</b>
</p>

<ul class="org-ul">
<li>Useful Python libraries for functional programming:

<ul class="org-ul">
<li><a href="https://docs.python.org/3/library/functools.html">functools â€” Higher-order functions and operations on callable objects</a>
</li>

<li><a href="https://docs.python.org/3/library/itertools.html">itertools â€” Functions creating iterators for efficient looping</a>
</li>

<li><a href="https://docs.python.org/3/library/operator.html">operator â€” Standard operators as functions</a>
</li>

<li><a href="https://www.ics.uci.edu/~pattis/ICS-33/lectures/functionalprogramming.txt">Functional Programming</a>
</li>
</ul>
</li>
</ul>

<p>
<b>Javascript</b>
</p>

<ul class="org-ul">
<li><a href="http://underscorejs.org/">Underscore.js</a>: "Underscore is a JavaScript library that provides a
whole mess of useful functional programming helpers without
extending any built-in objects."
</li>
</ul>
</div>
</div>
</div>

<div id="outline-container-sec-5" class="outline-2">
<h2 id="sec-5"><span class="section-number-2">5</span> Reading</h2>
<div class="outline-text-2" id="text-5">
</div><div id="outline-container-sec-5-1" class="outline-3">
<h3 id="sec-5-1"><span class="section-number-3">5.1</span> Monads</h3>
<div class="outline-text-3" id="text-5-1">
<ul class="org-ul">
<li>Moggi E. <b>Notions of computation and monads. Information and
computation.</b> 1991 Jul 1;93(1):55-92.
</li>
</ul>


<ul class="org-ul">
<li>Philip Wadler, <b>How to declare an imperative</b>, ACM Computing
Surveys, 29(3):240&#x2013;263, September 1997. Available at
<a href="http://homepages.inf.ed.ac.uk/wadler/papers/monadsdeclare/monadsdeclare.ps">http://homepages.inf.ed.ac.uk/wadler/papers/monadsdeclare/monadsdeclare.ps</a>

<p>
Note: Explains how IO monads works. 
</p>
</li>
</ul>


<ul class="org-ul">
<li>Philip Wadler, <b>The essence of functional programming.</b> Invited
talk, 19'th Symposium on Principles of Programming Languages, ACM
Press, Albuquerque, January 1992. Available at
<a href="http://homepages.inf.ed.ac.uk/wadler/papers/essence/essence.ps">http://homepages.inf.ed.ac.uk/wadler/papers/essence/essence.ps</a>
</li>
</ul>



<ul class="org-ul">
<li>Philip Wadler, <b>Monads for functional programming.</b> Available at
<a href="http://homepages.inf.ed.ac.uk/wadler/papers/marktoberdorf/baastad.pdf">http://homepages.inf.ed.ac.uk/wadler/papers/marktoberdorf/baastad.pdf</a>
</li>
</ul>


<ul class="org-ul">
<li>Wadler, Philip. <b>Comprehending monads.</b> Mathematical structures in
computer science 2.04 (1992): 461-493.
</li>
</ul>


<ul class="org-ul">
<li>Peyton Jones, Simon L., and Philip Wadler. <b>Imperative functional
programming.</b> Proceedings of the 20th ACM SIGPLAN-SIGACT symposium
on Principles of programming languages. ACM, 1993. Available at
<a href="http://www.cs.tufts.edu/~nr/cs257/archive/simon-peyton-jones/imperative.pdf">http://www.cs.tufts.edu/~nr/cs257/archive/simon-peyton-jones/imperative.pdf</a>
</li>
</ul>


<ul class="org-ul">
<li>Pyton Jones, Simon. <b>Tackling the awkward squad: monadic
input/output, concurrency, exceptions, and foreign-language calls</b>
<b>in Haskell</b> (2001) Available at
<a href="http://research.microsoft.com/en-us/um/people/simonpj/papers/marktoberdorf/mark.pdf">http://research.microsoft.com/en-us/um/people/simonpj/papers/marktoberdorf/mark.pdf</a>
</li>
</ul>


<ul class="org-ul">
<li>Jones, Mark P. <b>Functional programming with overloading and
higher-order polymorphism.</b> Advanced Functional
Programming. Springer Berlin Heidelberg, 1995. 97-136. Available
at: <a href="http://web.cecs.pdx.edu/~mpj/pubs/springschool95.pdf">http://web.cecs.pdx.edu/~mpj/pubs/springschool95.pdf</a>

<p>
Note: Explains about type classes.
</p>
</li>

<li>Launchbury, John, and Simon L. Peyton Jones. <b>State in haskell.</b>
Lisp and Symbolic Computation 8.4 (1995): 293-341. Available at:
<a href="http://research.microsoft.com/en-us/um/people/simonpj/Papers/state-lasc.pdf">http://research.microsoft.com/en-us/um/people/simonpj/Papers/state-lasc.pdf</a>
</li>

<li>Note: Introduces State monad and shows how it works. 
</li>
</ul>


<ul class="org-ul">
<li><a href="http://okmij.org/ftp/Computation/IO-monad-history.html#Peyton-Jones-2000">Kiselyov O. - IO monad in 1965</a> 
</li>
</ul>


<ul class="org-ul">
<li>Davidson, A. <a href="https://www.cs.hmc.edu/~adavidso/monads.pdf">Monads and Side Effects in Haskell</a>, 2013
</li>

<li>Newbern, Jeff. "All about monads, 2003." URL
<a href="https://wiki.haskell.org/All_About_Monads">https://wiki.haskell.org/All_About_Monads</a>
</li>
</ul>
</div>
</div>

<div id="outline-container-sec-5-2" class="outline-3">
<h3 id="sec-5-2"><span class="section-number-3">5.2</span> Applicative Functor</h3>
<div class="outline-text-3" id="text-5-2">
<ul class="org-ul">
<li>McBride, Conor, and Ross Paterson. <b>Functional pearl: Applicative
programming with effects.</b> Journal of functional programming 18.1
(2008): 1-13.

<p>
Notes: Popularized Applicative Functor and applicative style. 
</p>
</li>
</ul>


<ul class="org-ul">
<li>Paterson, R. A. (2012). Constructing applicative functors. Paper
 presented at the 11th International Conference, Mathematics of
 Program Construction, 25 - 27 Jun 2012, Madrid, Spain. 
<a href="http://openaccess.city.ac.uk/1141/1/Constructors.pdf">http://openaccess.city.ac.uk/1141/1/Constructors.pdf</a>
</li>

<li>Ruegg, Michael. <b>Applicative Functors in Haskell</b>. Seminar Program
Analysis and Transformation University of Applied Sciences Rapperswil, 2010
</li>
</ul>
</div>
</div>

<div id="outline-container-sec-5-3" class="outline-3">
<h3 id="sec-5-3"><span class="section-number-3">5.3</span> Category Theory</h3>
<div class="outline-text-3" id="text-5-3">
<ul class="org-ul">
<li>Andrea Asperti and Giuseppe Longo. <b>Categories, types, and
structures: an introduction to category theory for the working</b>
computer scientist. MIT Press, Cambridge, MA, USA, 1991
</li>
</ul>


<ul class="org-ul">
<li>HaskellWiki. <b>Category theory</b>. World Wide Web,
<a href="http://en.wikibooks.org/wiki/Haskell/Category_theory">http://en.wikibooks.org/wiki/Haskell/Category_theory</a>, 2010.
</li>
</ul>


<ul class="org-ul">
<li>Knighten, Robert L. "Notes on category theory." (2011).
</li>
</ul>


<ul class="org-ul">
<li><a href="https://wiki.haskell.org/Typeclassopedia#Laws_2">Typeclassopedia - HaskellWiki</a>
</li>
</ul>




<ul class="org-ul">
<li>Typeclassopedia - Brent Yorgey (in TheMonadReader 13)
</li>
</ul>
</div>
</div>

<div id="outline-container-sec-5-4" class="outline-3">
<h3 id="sec-5-4"><span class="section-number-3">5.4</span> Books about Haskell</h3>
<div class="outline-text-3" id="text-5-4">
<ul class="org-ul">
<li>Lipovaca, Miran. <b>Learn You a Haskell for Great Good!: A Beginner's
Guide.</b> no starch press, 2011. &lt;<a href="http://LearnYouAHaskell.com">http://LearnYouAHaskell.com</a>&gt;
</li>
</ul>


<ul class="org-ul">
<li>O'Sullivan, Bryan, John Goerzen, and Donald Bruce Stewart. <b>Real
world haskell: Code you can believe in.</b> " O'Reilly Media,
Inc.", 2008.

<ul class="org-ul">
<li>Note: Which parts of Real World Haskell are now obsolete or
considered bad practice? ( <a href="http://stackoverflow.com/questions/23727768/which-parts-of-real-world-haskell-are-now-obsolete-or-considered-bad-practice">Stack Overflow</a> )
</li>

<li><a href="https://github.com/afroisalreadyinu/real-world-haskell-chapter-10">A walk-through of Real World Haskell 10th Chapter</a>
</li>
</ul>
</li>

<li>Hudak, Paul, and Joseph H. Fasel. <b>A gentle introduction to
Haskell.</b> ACM Sigplan Notices 27.5 (1992): 1-52.
</li>
</ul>
</div>
</div>
</div>
<div id="footnotes">
<h2 class="footnotes">Footnotes: </h2>
<div id="text-footnotes">

<div class="footdef"><sup><a id="fn.1" name="fn.1" class="footnum" href="#fnr.1">1</a></sup> <p class="footpara">
Schwaighofer A. <b>Tail Call Optimization in the
Java HotSpotâ„¢ VM.</b> Available at:  <a href="http://www.ssw.uni-linz.ac.at/Research/Papers/Schwaighofer09Master/schwaighofer09master.pdf">http://www.ssw.uni-linz.ac.at/Research/Papers/Schwaighofer09Master/schwaighofer09master.pdf</a>
</p></div>

<div class="footdef"><sup><a id="fn.2" name="fn.2" class="footnum" href="#fnr.2">2</a></sup> <p class="footpara">
<a href="http://neopythonic.blogspot.com.au/2009/04/tail-recursion-elimination.html">Neopythonic: Tail Recursion Elimination</a> 
</p></div>

<div class="footdef"><sup><a id="fn.3" name="fn.3" class="footnum" href="#fnr.3">3</a></sup> <p class="footpara">
<a href="http://neopythonic.blogspot.com.au/2009/04/final-words-on-tail-calls.html">Neopythonic: Final Words on Tail Calls</a>
</p></div>

<div class="footdef"><sup><a id="fn.4" name="fn.4" class="footnum" href="#fnr.4">4</a></sup> <p class="footpara">
<a href="http://stackoverflow.com/questions/13208963/tail-recursion-on-r-statistical-environment">Tail recursion on R Statistical Environment - Stack Overflow</a>
</p></div>


</div>
</div></div>
<div id="postamble" class="status">
<p class="author">Author: Caio Rodrigues</p>
<p class="date">Created: 2016-04-07 Thu 13:16</p>
<p class="creator"><a href="http://www.gnu.org/software/emacs/">Emacs</a> 24.5.1 (<a href="http://orgmode.org">Org</a> mode 8.2.10)</p>
<p class="validation"><a href="http://validator.w3.org/check?uri=referer">Validate</a></p>
</div>
</body>
</html>
